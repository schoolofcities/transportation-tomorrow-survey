import{a as ri,n as u9,t as an,c as oo,d as Q7}from"../chunks/disclose-version.CvQRY0PQ.js";import{m as Pn,N as T1,h as j6,i as S1,S as C1,a7 as H6,a8 as J0,M as Q0,L as e9,o as f3,O as V6,aq as Rl,a5 as A1,j as E1,a6 as Z6,F as e1,ar as Y6,as as q6,at as $6,al as W6,_ as t1,au as X6,av as K6,R as J6,aw as Q6,k as e5,D as t5,J as i5,a9 as _3,b as r5,aa as p9,e as nt,ax as n5,z as L1,ay as o5,a4 as i1,az as a5,aA as s5,aB as l5,y as c5,a2 as h5,ao as u5,p as P1,aC as Ti,g as he,aD as Gt,aE as M1,aF as r1,t as dn,s as I1,a0 as Ut,v as Ht,q as $n,x as ei,w as Vt,aG as Pl,ak as n1,aH as Ua}from"../chunks/runtime.DZVPgBtq.js";import{i as p5,c as o1,d as d5,n as f5,a as m5,e as pr,s as Kn}from"../chunks/render.BRWYq_5g.js";import{p as bt,i as on,b as t9}from"../chunks/props.4STxoX-Z.js";import{i as O1}from"../chunks/lifecycle.B9OKKAis.js";import{a as N1,c as g5,b as _5,o as k1}from"../chunks/index-client.l9d6UsrJ.js";let i9=null;function a1(b,T){return T}function y5(b,T,L,k){for(var D=[],J=T.length,S=0;S<J;S++)K6(T[S].e,D,!0);var c=J>0&&D.length===0&&L!==null;if(c){var be=L.parentNode;J6(be),be.append(L),k.clear(),ea(b,T[0].prev,T[J-1].next)}Q6(D,()=>{for(var me=0;me<J;me++){var de=T[me];c||(k.delete(de.k),ea(b,de.prev,de.next)),e5(de.e,!c)}})}function s1(b,T,L,k,D,J=null){var S=b,c={flags:T,items:new Map,first:null};Pn&&T1();var be=null,me=!1;j6(()=>{var de=L(),Ae=S1(de)?de:de==null?[]:C1(de),fe=Ae.length;if(me&&fe===0)return;me=fe===0;let te=!1;if(Pn){var Ce=S.data===H6;Ce!==(fe===0)&&(S=J0(),Q0(S),e9(!1),te=!0)}if(Pn){for(var Je=null,it,je=0;je<fe;je++){if(f3.nodeType===8&&f3.data===V6){S=f3,te=!0,e9(!1);break}var Fe=Ae[je],dt=k(Fe,je);it=R1(f3,c,Je,null,Fe,dt,je,D,T),c.items.set(dt,it),Je=it}fe>0&&Q0(J0())}if(!Pn){var He=t5;x5(Ae,c,S,D,T,(He.f&Rl)!==0,k)}J!==null&&(fe===0?be?A1(be):be=E1(()=>J(S)):be!==null&&Z6(be,()=>{be=null})),te&&e9(!0),L()}),Pn&&(S=f3)}function x5(b,T,L,k,D,J,S){var c=b.length,be=T.items,me=T.first,de=me,Ae,fe=null,te=[],Ce=[],Je,it,je,Fe;for(Fe=0;Fe<c;Fe+=1){if(Je=b[Fe],it=S(Je,Fe),je=be.get(it),je===void 0){var dt=de?de.e.nodes_start:L;fe=R1(dt,T,fe,fe===null?T.first:fe.next,Je,it,Fe,k,D),be.set(it,fe),te=[],Ce=[],de=fe.next;continue}if(v5(je,Je,Fe),je.e.f&Rl&&A1(je.e),je!==de){if(Ae!==void 0&&Ae.has(je)){if(te.length<Ce.length){var He=Ce[0],ft;fe=He.prev;var mt=te[0],ot=te[te.length-1];for(ft=0;ft<te.length;ft+=1)l1(te[ft],He,L);for(ft=0;ft<Ce.length;ft+=1)Ae.delete(Ce[ft]);ea(T,mt.prev,ot.next),ea(T,fe,mt),ea(T,ot,He),de=He,fe=ot,Fe-=1,te=[],Ce=[]}else Ae.delete(je),l1(je,de,L),ea(T,je.prev,je.next),ea(T,je,fe===null?T.first:fe.next),ea(T,fe,je),fe=je;continue}for(te=[],Ce=[];de!==null&&de.k!==it;)(J||!(de.e.f&Rl))&&(Ae??(Ae=new Set)).add(de),Ce.push(de),de=de.next;if(de===null)continue;je=de}te.push(je),fe=je,de=je.next}if(de!==null||Ae!==void 0){for(var we=Ae===void 0?[]:C1(Ae);de!==null;)(J||!(de.e.f&Rl))&&we.push(de),de=de.next;var Et=we.length;if(Et>0){var Dt=null;y5(T,we,Dt,be)}}e1.first=T.first&&T.first.e,e1.last=fe&&fe.e}function v5(b,T,L,k){Y6(b.v,T),b.i=L}function R1(b,T,L,k,D,J,S,c,be){var me=i9;try{var de=(be&q6)!==0,Ae=(be&$6)===0,fe=de?Ae?W6(D):t1(D):D,te=be&X6?t1(S):S,Ce={i:te,v:fe,k:J,a:null,e:null,prev:L,next:k};return i9=Ce,Ce.e=E1(()=>c(b,fe,te),Pn),Ce.e.prev=L&&L.e,Ce.e.next=k&&k.e,L===null?T.first=Ce:(L.next=Ce,L.e.next=Ce.e),k!==null&&(k.prev=Ce,k.e.prev=Ce.e),Ce}finally{i9=me}}function l1(b,T,L){for(var k=b.next?b.next.e.nodes_start:L,D=T?T.e.nodes_start:L,J=b.e.nodes_start;J!==k;){var S=i5(J);D.before(J),J=S}}function ea(b,T,L){T===null?b.first=L:(T.next=L,T.e.next=L&&L.e),L!==null&&(L.prev=T,L.e.prev=T&&T.e)}function pn(b,T,L,k,D){var c;Pn&&T1();var J=(c=T.$$slots)==null?void 0:c[L],S=!1;J===!0&&(J=T[L==="default"?"children":L],S=!0),J===void 0?D!==null&&D(b):J(b,S?()=>k:k)}function b5(b){const T={};b.children&&(T.default=!0);for(const L in b.$$slots)T[L]=!0;return T}function Ml(b,T,L){_3(()=>{var k=r5(()=>T(b,L==null?void 0:L())||{});if(L&&(k!=null&&k.update)){var D=!1,J={};p9(()=>{var S=L();nt(S),D&&n5(J,S)&&(J=S,k.update(S))}),D=!0}if(k!=null&&k.destroy)return()=>k.destroy()})}function w5(b,T){if(T){const L=document.body;b.autofocus=!0,L1(()=>{document.activeElement===L&&b.focus()})}}let c1=!1;function D1(){c1||(c1=!0,document.addEventListener("reset",b=>{Promise.resolve().then(()=>{var T;if(!b.defaultPrevented)for(const L of b.target.elements)(T=L.__on_r)==null||T.call(L)})},{capture:!0}))}function Us(b){if(Pn){var T=!1,L=()=>{if(!T){if(T=!0,b.hasAttribute("value")){var k=b.value;En(b,"value",null),b.value=k}if(b.hasAttribute("checked")){var D=b.checked;En(b,"checked",null),b.checked=D}}};b.__on_r=L,s5(L),D1()}}function T5(b,T){var L=b.__attributes??(b.__attributes={});L.value===(L.value=T)||b.value===T&&(T!==0||b.nodeName!=="PROGRESS")||(b.value=T)}function En(b,T,L,k){var D=b.__attributes??(b.__attributes={});Pn&&(D[T]=b.getAttribute(T),T==="src"||T==="srcset"||T==="href"&&b.nodeName==="LINK")||D[T]!==(D[T]=L)&&(T==="style"&&"__styles"in b&&(b.__styles={}),T==="loading"&&(b[o5]=L),L==null?b.removeAttribute(T):typeof L!="string"&&z1(b).includes(T)?b[T]=L:b.setAttribute(T,L))}function S5(b,T,L,k,D=!1,J=!1,S=!1){var c=T||{},be=b.tagName==="OPTION";for(var me in T)me in L||(L[me]=null);L.class=L.class?L.class+" "+k:k;var de=z1(b),Ae=b.__attributes??(b.__attributes={}),fe=[];for(const je in L){let Fe=L[je];if(be&&je==="value"&&Fe==null){b.value=b.__value="",c[je]=Fe;continue}var te=c[je];if(Fe!==te){c[je]=Fe;var Ce=je[0]+je[1];if(Ce!=="$$"){if(Ce==="on"){const dt={},He="$$"+je;let ft=je.slice(2);var Je=m5(ft);if(p5(ft)&&(ft=ft.slice(0,-7),dt.capture=!0),!Je&&te){if(Fe!=null)continue;b.removeEventListener(ft,c[He],dt),c[He]=null}if(Fe!=null)if(Je)b[`__${ft}`]=Fe,d5([ft]);else{let mt=function(ot){c[je].call(this,ot)};T?c[He]=o1(ft,b,mt,dt):fe.push([je,Fe,()=>c[He]=o1(ft,b,mt,dt)])}}else if(je==="style"&&Fe!=null)b.style.cssText=Fe+"";else if(je==="autofocus")w5(b,!!Fe);else if(je==="__value"||je==="value"&&Fe!=null)b.value=b[je]=b.__value=Fe;else{var it=je;D||(it=f5(it)),Fe==null&&!J?(Ae[je]=null,b.removeAttribute(je)):de.includes(it)&&(J||typeof Fe!="string")?b[it]=Fe:typeof Fe!="function"&&(Pn&&(it==="src"||it==="href"||it==="srcset")||En(b,it,Fe))}je==="style"&&"__styles"in b&&(b.__styles={})}}}return T||L1(()=>{if(b.isConnected)for(const[je,Fe,dt]of fe)c[je]===Fe&&dt()}),c}var h1=new Map;function z1(b){var T=h1.get(b.nodeName);if(T)return T;h1.set(b.nodeName,T=[]);for(var L,k=i1(b),D=Element.prototype;D!==k;){L=a5(k);for(var J in L)L[J].set&&T.push(J);k=i1(k)}return T}function C5(b,T){var L=b.__className,k=A5(T);Pn&&b.className===k?b.__className=k:(L!==k||Pn&&b.className!==k)&&(T==null?b.removeAttribute("class"):b.className=k,b.__className=k)}function A5(b){return b??""}function Yr(b,T,L){if(L){if(b.classList.contains(T))return;b.classList.add(T)}else{if(!b.classList.contains(T))return;b.classList.remove(T)}}function B1(b,T,L,k=L){b.addEventListener(T,L);const D=b.__on_r;D?b.__on_r=()=>{D(),k()}:b.__on_r=k,D1()}function E5(b,T,L=T){var k=l5();B1(b,"input",()=>{var D=u1(b)?p1(b.value):b.value;L(D),k&&D!==(D=T())&&(b.value=D??"")}),p9(()=>{var D=T();if(Pn&&b.defaultValue!==b.value){L(b.value);return}u1(b)&&D===p1(b.value)||b.type==="date"&&!D&&!b.value||D!==b.value&&(b.value=D??"")})}function Il(b,T,L=T){B1(b,"change",()=>{var k=b.checked;L(k)}),T()==null&&L(!1),p9(()=>{var k=T();b.checked=!!k})}function u1(b){var T=b.type;return T==="number"||T==="range"}function p1(b){return b===""?null:+b}function d1(b,T,L){var k=h5(b,T);k&&k.set&&(b[T]=L,c5(()=>{b[T]=null}))}function Fs(b){return function(...T){var L=T[0];return L.stopPropagation(),b==null?void 0:b.apply(this,T)}}function ja(b){return function(...T){var L=T[0];return L.preventDefault(),b==null?void 0:b.apply(this,T)}}function Ol(b,T){var J;var L=(J=b.$$events)==null?void 0:J[T.type],k=S1(L)?L.slice():L==null?[]:[L];for(var D of k)D.call(this,T)}const L5=!0,eh=Object.freeze(Object.defineProperty({__proto__:null,prerender:L5},Symbol.toStringTag,{value:"Module"}));var P5=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M5(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var F1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.0.1/LICENSE.txt
 */(function(b,T){(function(L,k){b.exports=k()})(P5,function(){var L={},k={};function D(S,c,be){if(k[S]=be,S==="index"){var me="var sharedModule = {}; ("+k.shared+")(sharedModule); ("+k.worker+")(sharedModule);",de={};return k.shared(de),k.index(L,de),typeof window<"u"&&L.setWorkerUrl(window.URL.createObjectURL(new Blob([me],{type:"text/javascript"}))),L}}D("shared",["exports"],function(S){function c(n,t,r,o){return new(r||(r=Promise))(function(l,p){function d(x){try{_(o.next(x))}catch(w){p(w)}}function m(x){try{_(o.throw(x))}catch(w){p(w)}}function _(x){var w;x.done?l(x.value):(w=x.value,w instanceof r?w:new r(function(C){C(w)})).then(d,m)}_((o=o.apply(n,t||[])).next())})}function be(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var me,de;function Ae(){if(de)return me;function n(t,r){this.x=t,this.y=r}return de=1,me=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,o=t.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),o=Math.sin(t),l=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=l,this},_rotateAround:function(t,r){var o=Math.cos(t),l=Math.sin(t),p=r.y+l*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-l*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t},me}typeof SuppressedError=="function"&&SuppressedError;var fe,te,Ce=be(Ae()),Je=function(){if(te)return fe;function n(t,r,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=l}return te=1,fe=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<r)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=p/d}var m=0,_=1;for(o=t,l=0;l<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<r));l++)t>p?m=o:_=o,o=.5*(_-m)+m;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},fe}(),it=be(Je);let je,Fe;function dt(){return je==null&&(je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),je}function He(){if(Fe==null&&(Fe=!1,dt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const l=4*o;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){Fe=!0;break}}}return Fe||!1}var ft,mt=1e-6,ot=typeof Float32Array<"u"?Float32Array:Array;function we(){var n=new ot(9);return ot!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Et(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Dt(){var n=new ot(3);return ot!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Bi(n,t,r){var o=new ot(3);return o[0]=n,o[1]=t,o[2]=r,o}function si(n,t,r){var o=t[0],l=t[1],p=t[2],d=t[3];return n[0]=r[0]*o+r[4]*l+r[8]*p+r[12]*d,n[1]=r[1]*o+r[5]*l+r[9]*p+r[13]*d,n[2]=r[2]*o+r[6]*l+r[10]*p+r[14]*d,n[3]=r[3]*o+r[7]*l+r[11]*p+r[15]*d,n}function Wt(){var n=new ot(4);return ot!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Zt(){var n=new ot(2);return ot!=Float32Array&&(n[0]=0,n[1]=0),n}function gi(n,t){var r=new ot(2);return r[0]=n,r[1]=t,r}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)}),Dt(),ft=new ot(4),ot!=Float32Array&&(ft[0]=0,ft[1]=0,ft[2]=0,ft[3]=0),Dt(),Bi(1,0,0),Bi(0,1,0),Wt(),Wt(),we(),Zt();const xt=8192;function Ii(n,t,r){return t*(xt/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function ct(n,t){return(n%t+t)%t}function li(n,t,r){return n*(1-r)+t*r}function dr(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function fr(n,t,r,o){const l=new it(n,t,r,o);return p=>l.solve(p)}const Ei=fr(.25,.1,.25,1);function Fi(n,t,r){return Math.min(r,Math.max(t,n))}function Li(n,t,r){const o=r-t,l=((n-t)%o+o)%o+t;return l===t?r:l}function ci(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}let Tr=1;function nr(n,t,r){const o={};for(const l in n)o[l]=t.call(this,n[l],l,n);return o}function or(n,t,r){const o={};for(const l in n)t.call(this,n[l],l,n)&&(o[l]=n[l]);return o}function Oi(n){return Array.isArray(n)?n.map(Oi):typeof n=="object"&&n?nr(n,Oi):n}const qr={};function Kt(n){qr[n]||(typeof console<"u"&&console.warn(n),qr[n]=!0)}function at(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Sr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let _i=null;function $r(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const fn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Gi(n,t,r,o,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(n,{timestamp:0});try{const d=p==null?void 0:p.format;if(!d||!d.startsWith("BGR")&&!d.startsWith("RGB"))throw new Error(`Unrecognized format ${d}`);const m=d.startsWith("BGR"),_=new Uint8ClampedArray(o*l*4);if(yield p.copyTo(_,function(x,w,C,M,O){const N=4*Math.max(1,0),z=(Math.max(0,C)-C)*M*4+N,H=4*M,$=Math.max(0,w),ae=Math.max(0,C);return{rect:{x:$,y:ae,width:Math.min(x.width,w+M)-$,height:Math.min(x.height,C+O)-ae},layout:[{offset:z,stride:H}]}}(n,t,r,o,l)),m)for(let x=0;x<_.length;x+=4){const w=_[x];_[x]=_[x+2],_[x+2]=w}return _}finally{p.close()}})}let kr,Rr;function Ui(n){return n/Math.PI*180}const Lt="AbortError";function ar(){return new Error(Lt)}const Wr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function zt(n){return Wr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const ji="global-dispatcher";class mr extends Error{constructor(t,r,o,l){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=l}}const Cr=()=>Sr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ot=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=zt(n.url);if(o)return o(n,t);if(Sr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:ji},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Cr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,l){return c(this,void 0,void 0,function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Cr(),signal:l.signal});let d,m;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{d=yield fetch(p)}catch(x){throw new mr(0,x.message,o.url,new Blob)}if(!d.ok){const x=yield d.blob();throw new mr(d.status,d.statusText,o.url,x)}m=o.type==="arrayBuffer"||o.type==="image"?d.arrayBuffer():o.type==="json"?d.json():d.text();const _=yield m;if(l.signal.aborted)throw ar();return{data:_,cacheControl:d.headers.get("Cache-Control"),expires:d.headers.get("Expires")}})}(n,t);if(Sr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:ji},t)}var r;return function(o,l){return new Promise((p,d)=>{var m;const _=new XMLHttpRequest;_.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(_.responseType="arraybuffer");for(const x in o.headers)_.setRequestHeader(x,o.headers[x]);o.type==="json"&&(_.responseType="text",!((m=o.headers)===null||m===void 0)&&m.Accept||_.setRequestHeader("Accept","application/json")),_.withCredentials=o.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if(!l.signal.aborted)if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let x=_.response;if(o.type==="json")try{x=JSON.parse(_.response)}catch(w){return void d(w)}p({data:x,cacheControl:_.getResponseHeader("Cache-Control"),expires:_.getResponseHeader("Expires")})}else{const x=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});d(new mr(_.status,_.statusText,o.url,x))}},l.signal.addEventListener("abort",()=>{_.abort(),d(ar())}),_.send(o.body)})}(n,t)};function Yt(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function sn(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function gr(n,t,r){if(r&&r[n]){const o=r[n].indexOf(t);o!==-1&&r[n].splice(o,1)}}class Pi{constructor(t,r={}){ci(this,r),this.type=t}}class mn extends Pi{constructor(t,r={}){super("error",ci({error:t},r))}}class Dr{on(t,r){return this._listeners=this._listeners||{},sn(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return gr(t,r,this._listeners),gr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},sn(t,r,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,r){typeof t=="string"&&(t=new Pi(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const m of l)m.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const m of p)gr(o,m,this._oneTimeListeners),m.call(this,t);const d=this._eventedParent;d&&(ci(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(t))}else t instanceof mn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var V={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const B=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function G(n,t){const r={};for(const o in n)o!=="ref"&&(r[o]=n[o]);return B.forEach(o=>{o in t&&(r[o]=t[o])}),r}function U(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!U(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!U(n[r],t[r]))return!1;return!0}return n===t}function X(n,t){n.push(t)}function ne(n,t,r){X(r,{command:"addSource",args:[n,t[n]]})}function ue(n,t,r){X(t,{command:"removeSource",args:[n]}),r[n]=!0}function ye(n,t,r,o){ue(n,r,o),ne(n,t,r)}function ce(n,t,r){let o;for(o in n[r])if(Object.prototype.hasOwnProperty.call(n[r],o)&&o!=="data"&&!U(n[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!U(n[r][o],t[r][o]))return!1;return!0}function Me(n,t,r,o,l,p){n=n||{},t=t||{};for(const d in n)Object.prototype.hasOwnProperty.call(n,d)&&(U(n[d],t[d])||r.push({command:p,args:[o,d,t[d],l]}));for(const d in t)Object.prototype.hasOwnProperty.call(t,d)&&!Object.prototype.hasOwnProperty.call(n,d)&&(U(n[d],t[d])||r.push({command:p,args:[o,d,t[d],l]}))}function Se(n){return n.id}function pe(n,t){return n[t.id]=t,n}class se{constructor(t,r,o,l){this.message=(t?`${t}: `:"")+o,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ve(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}class Ze extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class st{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,l]of r)this.bindings[o]=l}concat(t){return new st(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const gt={kind:"null"},Ee={kind:"number"},$e={kind:"string"},Xe={kind:"boolean"},Tt={kind:"color"},Pt={kind:"projectionDefinition"},ut={kind:"object"},qe={kind:"value"},ui={kind:"collator"},gn={kind:"formatted"},Ni={kind:"padding"},xi={kind:"resolvedImage"},ti={kind:"variableAnchorOffsetCollection"};function _r(n,t){return{kind:"array",itemType:n,N:t}}function hi(n){if(n.kind==="array"){const t=hi(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const On=[gt,Ee,$e,Xe,Tt,Pt,gn,ut,_r(qe),Ni,xi,ti];function jn(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!jn(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of On)if(!jn(r,t))return null}}return`Expected ${hi(n)} but found ${hi(t)} instead.`}function ia(n,t){return t.some(r=>r.kind===n.kind)}function Hn(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Vn(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Ya=.96422,Io=.82521,qa=4/29,ln=6/29,$a=3*ln*ln,qs=ln*ln*ln,$s=Math.PI/180,ra=180/Math.PI;function Wa(n){return(n%=360)<0&&(n+=360),n}function Ji([n,t,r,o]){let l,p;const d=co((.2225045*(n=Nn(n))+.7168786*(t=Nn(t))+.0606169*(r=Nn(r)))/1);n===t&&t===r?l=p=d:(l=co((.4360747*n+.3850649*t+.1430804*r)/Ya),p=co((.0139322*n+.0971045*t+.7141733*r)/Io));const m=116*d-16;return[m<0?0:m,500*(l-d),200*(d-p),o]}function Nn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function co(n){return n>qs?Math.pow(n,1/3):n/$a+qa}function Xa([n,t,r,o]){let l=(n+16)/116,p=isNaN(t)?l:l+t/500,d=isNaN(r)?l:l-r/200;return l=1*na(l),p=Ya*na(p),d=Io*na(d),[_n(3.1338561*p-1.6168667*l-.4906146*d),_n(-.9787684*p+1.9161415*l+.033454*d),_n(.0719453*p-.2289914*l+1.4052427*d),o]}function _n(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function na(n){return n>ln?n*n*n:$a*(n-qa)}function eo(n){return parseInt(n.padEnd(2,n),16)/255}function oa(n,t){return Ar(t?n/100:n,0,1)}function Ar(n,t,r){return Math.min(Math.max(t,n),r)}function Oo(n){return!n.some(Number.isNaN)}const zr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function wt(n,t,r){return n+r*(t-n)}function Xr(n,t,r){return n.map((o,l)=>wt(o,t[l],r))}class St{constructor(t,r,o,l=1,p=!0){this.r=t,this.g=r,this.b=o,this.a=l,p||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,o,l]))}static parse(t){if(t instanceof St)return t;if(typeof t!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=zr[o];if(l){const[d,m,_]=l;return[d/255,m/255,_/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const d=o.length<6?1:2;let m=1;return[eo(o.slice(m,m+=d)),eo(o.slice(m,m+=d)),eo(o.slice(m,m+=d)),eo(o.slice(m,m+d)||"ff")]}if(o.startsWith("rgb")){const d=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[m,_,x,w,C,M,O,N,z,H,$,ae]=d,K=[w||" ",O||" ",H].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const I=[x,M,z].join(""),j=I==="%%%"?100:I===""?255:0;if(j){const Q=[Ar(+_/j,0,1),Ar(+C/j,0,1),Ar(+N/j,0,1),$?oa(+$,ae):1];if(Oo(Q))return Q}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[d,m,_,x,w,C,M,O,N]=p,z=[_||" ",w||" ",M].join("");if(z==="  "||z==="  /"||z===",,"||z===",,,"){const H=[+m,Ar(+x,0,100),Ar(+C,0,100),O?oa(+O,N):1];if(Oo(H))return function([$,ae,K,I]){function j(Q){const _e=(Q+$/30)%12,De=ae*Math.min(K,1-K);return K-De*Math.max(-1,Math.min(_e-3,9-_e,1))}return $=Wa($),ae/=100,K/=100,[j(0),j(8),j(4),I]}(H)}}}(t);return r?new St(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:l}=this,p=l||1/0;return this.overwriteGetter("rgb",[t/p,r/p,o/p,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,o,l,p]=Ji(t),d=Math.sqrt(o*o+l*l);return[Math.round(1e4*d)?Wa(Math.atan2(l,o)*ra):NaN,d,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ji(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,l]=this.rgb;return`rgba(${[t,r,o].map(p=>Math.round(255*p)).join(",")},${l})`}static interpolate(t,r,o,l="rgb"){switch(l){case"rgb":{const[p,d,m,_]=Xr(t.rgb,r.rgb,o);return new St(p,d,m,_,!1)}case"hcl":{const[p,d,m,_]=t.hcl,[x,w,C,M]=r.hcl;let O,N;if(isNaN(p)||isNaN(x))isNaN(p)?isNaN(x)?O=NaN:(O=x,m!==1&&m!==0||(N=w)):(O=p,C!==1&&C!==0||(N=d));else{let K=x-p;x>p&&K>180?K-=360:x<p&&p-x>180&&(K+=360),O=p+o*K}const[z,H,$,ae]=function([K,I,j,Q]){return K=isNaN(K)?0:K*$s,Xa([j,Math.cos(K)*I,Math.sin(K)*I,Q])}([O,N??wt(d,w,o),wt(m,C,o),wt(_,M,o)]);return new St(z,H,$,ae,!1)}case"lab":{const[p,d,m,_]=Xa(Xr(t.lab,r.lab,o));return new St(p,d,m,_,!1)}}}}St.black=new St(0,0,0,1),St.white=new St(1,1,1,1),St.transparent=new St(0,0,0,0),St.red=new St(1,0,0,1);class ho{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class No{constructor(t,r,o,l,p){this.text=t,this.image=r,this.scale=o,this.fontStack=l,this.textColor=p}}class ve{constructor(t){this.sections=t}static fromString(t){return new ve([new No(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ve?t:ve.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Re{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Re)return t;if(typeof t=="number")return new Re([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Re(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new Re(Xr(t.values,r.values,o))}}class et{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Xt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Mt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mt)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],l=t[r+1];if(typeof o!="string"||!Xt.has(o)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Mt(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){const l=t.values,p=r.values;if(l.length!==p.length)throw new et(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const d=[];for(let m=0;m<l.length;m+=2){if(l[m]!==p[m])throw new et(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${l[m]}, to[${m}]: ${p[m]}`);d.push(l[m]);const[_,x]=l[m+1],[w,C]=p[m+1];d.push([wt(_,w,o),wt(x,C,o)])}return new Mt(d)}}class vt{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new vt({name:t,available:!1}):null}}class jt{constructor(t,r,o){this.from=t,this.to=r,this.transition=o}static interpolate(t,r,o){return new jt(t,r,o)}static parse(t){return t instanceof jt?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new jt(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new jt(t.from,t.to,t.transition):typeof t=="string"?new jt(t,t,1):void 0}}function Hi(n,t,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,t,r,o]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Er(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof jt||n instanceof St||n instanceof ho||n instanceof ve||n instanceof Re||n instanceof Mt||n instanceof vt)return!0;if(Array.isArray(n)){for(const t of n)if(!Er(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Er(n[t]))return!1;return!0}return!1}function kt(n){if(n===null)return gt;if(typeof n=="string")return $e;if(typeof n=="boolean")return Xe;if(typeof n=="number")return Ee;if(n instanceof St)return Tt;if(n instanceof jt)return Pt;if(n instanceof ho)return ui;if(n instanceof ve)return gn;if(n instanceof Re)return Ni;if(n instanceof Mt)return ti;if(n instanceof vt)return xi;if(Array.isArray(n)){const t=n.length;let r;for(const o of n){const l=kt(o);if(r){if(r===l)continue;r=qe;break}r=l}return _r(r||qe,t)}return ut}function Vi(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof St||n instanceof jt||n instanceof ve||n instanceof Re||n instanceof Mt||n instanceof vt?n.toString():JSON.stringify(n)}class Kr{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Er(t[1]))return r.error("invalid value");const o=t[1];let l=kt(o);const p=r.expectedType;return l.kind!=="array"||l.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(l=p),new Kr(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ki={string:$e,number:Ee,boolean:Xe,object:ut};class qt{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,l=1;const p=t[0];if(p==="array"){let m,_;if(t.length>2){const x=t[1];if(typeof x!="string"||!(x in ki)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=ki[x],l++}else m=qe;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);_=t[2],l++}o=_r(m,_)}else{if(!ki[p])throw new Error(`Types doesn't contain name = ${p}`);o=ki[p]}const d=[];for(;l<t.length;l++){const m=r.parse(t[l],l,qe);if(!m)return null;d.push(m)}return new qt(o,d)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!jn(this.type,kt(o)))return o;if(r===this.args.length-1)throw new et(`Expected value to be of type ${hi(this.type)}, but found ${hi(kt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ri={"to-boolean":Xe,"to-color":Tt,"to-number":Ee,"to-string":$e};class vi{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!Ri[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=Ri[o],p=[];for(let d=1;d<t.length;d++){const m=r.parse(t[d],d,qe);if(!m)return null;p.push(m)}return new vi(l,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const l of this.args){if(r=l.evaluate(t),o=null,r instanceof St)return r;if(typeof r=="string"){const p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Hi(r[0],r[1],r[2],r[3]),!o))return new St(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new et(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const l=Re.parse(r);if(l)return l}throw new et(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const l=Mt.parse(r);if(l)return l}throw new et(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new et(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return ve.fromString(Vi(this.args[0].evaluate(t)));case"resolvedImage":return vt.fromString(Vi(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Vi(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ko=["Unknown","Point","LineString","Polygon"];class uo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ko[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=St.parse(t)),r}}class Jt{constructor(t,r,o=[],l,p=new st,d=[]){this.registry=t,this.path=o,this.key=o.map(m=>`[${m}]`).join(""),this.scope=p,this.errors=d,this.expectedType=l,this._isConstant=r}parse(t,r,o,l,p={}){return r?this.concat(r,o,l)._parse(t,p):this._parse(t,p)}_parse(t,r){function o(l,p,d){return d==="assert"?new qt(p,[l]):d==="coerce"?new vi(p,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[l];if(p){let d=p.parse(t,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,_=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||_.kind!=="value")if(m.kind!=="projectionDefinition"||_.kind!=="string"&&_.kind!=="array")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string")if(m.kind!=="padding"||_.kind!=="value"&&_.kind!=="number"&&_.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||_.kind!=="value"&&_.kind!=="array"){if(this.checkSubtype(m,_))return null}else d=o(d,m,r.typeAnnotation||"coerce");else d=o(d,m,r.typeAnnotation||"coerce");else d=o(d,m,r.typeAnnotation||"coerce");else d=o(d,m,r.typeAnnotation||"coerce");else d=o(d,m,r.typeAnnotation||"assert")}if(!(d instanceof Kr)&&d.type.kind!=="resolvedImage"&&this._isConstant(d)){const m=new uo;try{d=new Kr(d.type,d.evaluate(m))}catch(_){return this.error(_.message),null}}return d}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const l=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new Jt(this.registry,this._isConstant,l,r||null,p,this.errors)}error(t,...r){const o=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ze(o,t))}checkSubtype(t,r){const o=jn(t,r);return o&&this.error(o),o}}class sr{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const d=t[p];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,p);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const m=r.parse(t[p+1],p+1);if(!m)return null;o.push([d,m])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return l?new sr(o,l):null}outputDefined(){return this.result.outputDefined()}}class Ct{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new Ct(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class _t{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ee),l=r.parse(t[2],2,_r(r.expectedType||qe));return o&&l?new _t(l.type.itemType,o,l):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new et(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new et(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new et(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class aa{constructor(t,r){this.type=Xe,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,qe),l=r.parse(t[2],2,qe);return o&&l?ia(o.type,[Xe,$e,Ee,gt,qe])?new aa(o,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Hn(r,["boolean","string","number","null"]))throw new et(`Expected first argument to be of type boolean, string, number or null, but found ${hi(kt(r))} instead.`);if(!Hn(o,["string","array"]))throw new et(`Expected second argument to be of type array or string, but found ${hi(kt(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Nt{constructor(t,r,o){this.type=Ee,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,qe),l=r.parse(t[2],2,qe);if(!o||!l)return null;if(!ia(o.type,[Xe,$e,Ee,gt,qe]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(o.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,Ee);return p?new Nt(o,l,p):null}return new Nt(o,l)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Hn(r,["boolean","string","number","null"]))throw new et(`Expected first argument to be of type boolean, string, number or null, but found ${hi(kt(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Hn(o,["string"])){const p=o.indexOf(r,l);return p===-1?-1:[...o.slice(0,p)].length}if(Hn(o,["array"]))return o.indexOf(r,l);throw new et(`Expected second argument to be of type array or string, but found ${hi(kt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class sa{constructor(t,r,o,l,p,d){this.inputType=t,this.type=r,this.input=o,this.cases=l,this.outputs=p,this.otherwise=d}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const p={},d=[];for(let x=2;x<t.length-1;x+=2){let w=t[x];const C=t[x+1];Array.isArray(w)||(w=[w]);const M=r.concat(x);if(w.length===0)return M.error("Expected at least one branch label.");for(const N of w){if(typeof N!="number"&&typeof N!="string")return M.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,kt(N)))return null}else o=kt(N);if(p[String(N)]!==void 0)return M.error("Branch labels must be unique.");p[String(N)]=d.length}const O=r.parse(C,x,l);if(!O)return null;l=l||O.type,d.push(O)}const m=r.parse(t[1],1,qe);if(!m)return null;const _=r.parse(t[t.length-1],t.length-1,l);return _?m.type.kind!=="value"&&r.concat(1).checkSubtype(o,m.type)?null:new sa(o,l,m,p,d,_):null}evaluate(t){const r=this.input.evaluate(t);return(kt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class yn{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const l=[];for(let d=1;d<t.length-1;d+=2){const m=r.parse(t[d],d,Xe);if(!m)return null;const _=r.parse(t[d+1],d+1,o);if(!_)return null;l.push([m,_]),o=o||_.type}const p=r.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new yn(o,l,p)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Ro{constructor(t,r,o,l){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,qe),l=r.parse(t[2],2,Ee);if(!o||!l)return null;if(!ia(o.type,[_r(qe),$e,qe]))return r.error(`Expected first argument to be of type array or string, but found ${hi(o.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,Ee);return p?new Ro(o.type,o,l,p):null}return new Ro(o.type,o,l)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Hn(r,["string"]))return[...r].slice(o,l).join("");if(Hn(r,["array"]))return r.slice(o,l);throw new et(`Expected first argument to be of type array or string, but found ${hi(kt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function la(n,t){const r=n.length-1;let o,l,p=0,d=r,m=0;for(;p<=d;)if(m=Math.floor((p+d)/2),o=n[m],l=n[m+1],o<=t){if(m===r||t<l)return m;p=m+1}else{if(!(o>t))throw new et("Input is not a number.");d=m-1}return 0}class Do{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,p]of o)this.labels.push(l),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,Ee);if(!o)return null;const l=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let d=1;d<t.length;d+=2){const m=d===1?-1/0:t[d],_=t[d+1],x=d,w=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const C=r.parse(_,w,p);if(!C)return null;p=p||C.type,l.push([m,C])}return new Do(p,o,l)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return o[0].evaluate(t);const p=r.length;return l>=r[p-1]?o[p-1].evaluate(t):o[la(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ws(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ka,T3,S3=function(){if(T3)return Ka;function n(t,r,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=l}return T3=1,Ka=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<r)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=p/d}var m=0,_=1;for(o=t,l=0;l<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<r));l++)t>p?m=o:_=o,o=.5*(_-m)+m;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Ka}(),C3=Ws(S3);class lr{constructor(t,r,o,l,p){this.type=t,this.operator=r,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[d,m]of p)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(t,r,o,l){let p=0;if(t.name==="exponential")p=Qi(r,t.base,o,l);else if(t.name==="linear")p=Qi(r,1,o,l);else if(t.name==="cubic-bezier"){const d=t.controlPoints;p=new C3(d[0],d[1],d[2],d[3]).solve(Qi(r,1,o,l))}return p}static parse(t,r){let[o,l,p,...d]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Ee),!p)return null;const m=[];let _=null;o==="interpolate-hcl"||o==="interpolate-lab"?_=Tt:r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let x=0;x<d.length;x+=2){const w=d[x],C=d[x+1],M=x+3,O=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const N=r.parse(C,O,_);if(!N)return null;_=_||N.type,m.push([w,N])}return Vn(_,Ee)||Vn(_,Pt)||Vn(_,Tt)||Vn(_,Ni)||Vn(_,ti)||Vn(_,_r(Ee))?new lr(_,o,l,p,m):r.error(`Type ${hi(_)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return o[0].evaluate(t);const p=r.length;if(l>=r[p-1])return o[p-1].evaluate(t);const d=la(r,l),m=lr.interpolationFactor(this.interpolation,l,r[d],r[d+1]),_=o[d].evaluate(t),x=o[d+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return wt(_,x,m);case"color":return St.interpolate(_,x,m);case"padding":return Re.interpolate(_,x,m);case"variableAnchorOffsetCollection":return Mt.interpolate(_,x,m);case"array":return Xr(_,x,m);case"projectionDefinition":return jt.interpolate(_,x,m)}case"interpolate-hcl":return St.interpolate(_,x,m,"hcl");case"interpolate-lab":return St.interpolate(_,x,m,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Qi(n,t,r,o){const l=o-r,p=n-r;return l===0?0:t===1?p/l:(Math.pow(t,p)-1)/(Math.pow(t,l)-1)}const Jr={color:St.interpolate,number:wt,padding:Re.interpolate,variableAnchorOffsetCollection:Mt.interpolate,array:Xr};class ca{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o=null;const l=r.expectedType;l&&l.kind!=="value"&&(o=l);const p=[];for(const m of t.slice(1)){const _=r.parse(m,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!_)return null;o=o||_.type,p.push(_)}if(!o)throw new Error("No output type");const d=l&&p.some(m=>jn(l,m.type));return new ca(d?qe:o,p)}evaluate(t){let r,o=null,l=0;for(const p of this.args)if(l++,o=p.evaluate(t),o&&o instanceof vt&&!o.available&&(r||(r=o.name),o=null,l===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function ha(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Zi(n,t,r,o){return o.compare(t,r)===0}function po(n,t,r){const o=n!=="=="&&n!=="!=";return class G1{constructor(p,d,m){this.type=Xe,this.lhs=p,this.rhs=d,this.collator=m,this.hasUntypedArgument=p.type.kind==="value"||d.type.kind==="value"}static parse(p,d){if(p.length!==3&&p.length!==4)return d.error("Expected two or three arguments.");const m=p[0];let _=d.parse(p[1],1,qe);if(!_)return null;if(!ha(m,_.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${hi(_.type)}'.`);let x=d.parse(p[2],2,qe);if(!x)return null;if(!ha(m,x.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${hi(x.type)}'.`);if(_.type.kind!==x.type.kind&&_.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${hi(_.type)}' and '${hi(x.type)}'.`);o&&(_.type.kind==="value"&&x.type.kind!=="value"?_=new qt(x.type,[_]):_.type.kind!=="value"&&x.type.kind==="value"&&(x=new qt(_.type,[x])));let w=null;if(p.length===4){if(_.type.kind!=="string"&&x.type.kind!=="string"&&_.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(w=d.parse(p[3],3,ui),!w)return null}return new G1(_,x,w)}evaluate(p){const d=this.lhs.evaluate(p),m=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const _=kt(d),x=kt(m);if(_.kind!==x.kind||_.kind!=="string"&&_.kind!=="number")throw new et(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${_.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const _=kt(d),x=kt(m);if(_.kind!=="string"||x.kind!=="string")return t(p,d,m)}return this.collator?r(p,d,m,this.collator.evaluate(p)):t(p,d,m)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Xs=po("==",function(n,t,r){return t===r},Zi),A3=po("!=",function(n,t,r){return t!==r},function(n,t,r,o){return!Zi(0,t,r,o)}),Yl=po("<",function(n,t,r){return t<r},function(n,t,r,o){return o.compare(t,r)<0}),Ja=po(">",function(n,t,r){return t>r},function(n,t,r,o){return o.compare(t,r)>0}),Ks=po("<=",function(n,t,r){return t<=r},function(n,t,r,o){return o.compare(t,r)<=0}),ql=po(">=",function(n,t,r){return t>=r},function(n,t,r,o){return o.compare(t,r)>=0});class fo{constructor(t,r,o){this.type=ui,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const l=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Xe);if(!l)return null;const p=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Xe);if(!p)return null;let d=null;return o.locale&&(d=r.parse(o.locale,1,$e),!d)?null:new fo(l,p,d)}evaluate(t){return new ho(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class zo{constructor(t,r,o,l,p){this.type=$e,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=l,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Ee);if(!o)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let p=null;if(l.locale&&(p=r.parse(l.locale,1,$e),!p))return null;let d=null;if(l.currency&&(d=r.parse(l.currency,1,$e),!d))return null;let m=null;if(l["min-fraction-digits"]&&(m=r.parse(l["min-fraction-digits"],1,Ee),!m))return null;let _=null;return l["max-fraction-digits"]&&(_=r.parse(l["max-fraction-digits"],1,Ee),!_)?null:new zo(o,p,d,m,_)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Br{constructor(t){this.type=gn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const l=[];let p=!1;for(let d=1;d<=t.length-1;++d){const m=t[d];if(p&&typeof m=="object"&&!Array.isArray(m)){p=!1;let _=null;if(m["font-scale"]&&(_=r.parse(m["font-scale"],1,Ee),!_))return null;let x=null;if(m["text-font"]&&(x=r.parse(m["text-font"],1,_r($e)),!x))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,Tt),!w))return null;const C=l[l.length-1];C.scale=_,C.font=x,C.textColor=w}else{const _=r.parse(t[d],1,qe);if(!_)return null;const x=_.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,l.push({content:_,scale:null,font:null,textColor:null})}}return new Br(l)}evaluate(t){return new ve(this.sections.map(r=>{const o=r.content.evaluate(t);return kt(o)===xi?new No("",o,null,null,null):new No(Vi(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Qa{constructor(t){this.type=xi,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,$e);return o?new Qa(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=vt.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Bo{constructor(t){this.type=Ee,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${hi(o.type)} instead.`):new Bo(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new et(`Expected value to be of type string or array, but found ${hi(kt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const kn=8192;function Js(n,t){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*kn),Math.round(o*l*kn)]}function Qs(n,t){const r=Math.pow(2,t.z);return[(l=(n[0]/kn+t.x)/r,360*l-180),(o=(n[1]/kn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,l}function ua(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function pa(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function $l(n,t,r){const o=n[0]-t[0],l=n[1]-t[1],p=n[0]-r[0],d=n[1]-r[1];return o*d-p*l==0&&o*p<=0&&l*d<=0}function mo(n,t,r,o){return(l=[o[0]-r[0],o[1]-r[1]])[0]*(p=[t[0]-n[0],t[1]-n[1]])[1]-l[1]*p[0]!=0&&!(!M3(n,t,r,o)||!M3(r,o,n,t));var l,p}function Wl(n,t,r){for(const o of r)for(let l=0;l<o.length-1;++l)if(mo(n,t,o[l],o[l+1]))return!0;return!1}function go(n,t,r=!1){let o=!1;for(const m of t)for(let _=0;_<m.length-1;_++){if($l(n,m[_],m[_+1]))return r;(p=m[_])[1]>(l=n)[1]!=(d=m[_+1])[1]>l[1]&&l[0]<(d[0]-p[0])*(l[1]-p[1])/(d[1]-p[1])+p[0]&&(o=!o)}var l,p,d;return o}function E3(n,t){for(const r of t)if(go(n,r))return!0;return!1}function L3(n,t){for(const r of n)if(!go(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Wl(n[r],n[r+1],t))return!1;return!0}function P3(n,t){for(const r of t)if(L3(n,r))return!0;return!1}function M3(n,t,r,o){const l=o[0]-r[0],p=o[1]-r[1],d=(n[0]-r[0])*p-l*(n[1]-r[1]),m=(t[0]-r[0])*p-l*(t[1]-r[1]);return d>0&&m<0||d<0&&m>0}function e4(n,t,r){const o=[];for(let l=0;l<n.length;l++){const p=[];for(let d=0;d<n[l].length;d++){const m=Js(n[l][d],r);ua(t,m),p.push(m)}o.push(p)}return o}function I3(n,t,r){const o=[];for(let l=0;l<n.length;l++){const p=e4(n[l],t,r);o.push(p)}return o}function O3(n,t,r,o){if(n[0]<r[0]||n[0]>r[2]){const l=.5*o;let p=n[0]-r[0]>l?-o:r[0]-n[0]>l?o:0;p===0&&(p=n[0]-r[2]>l?-o:r[2]-n[0]>l?o:0),n[0]+=p}ua(t,n)}function N3(n,t,r,o){const l=Math.pow(2,o.z)*kn,p=[o.x*kn,o.y*kn],d=[];for(const m of n)for(const _ of m){const x=[_.x+p[0],_.y+p[1]];O3(x,t,r,l),d.push(x)}return d}function t4(n,t,r,o){const l=Math.pow(2,o.z)*kn,p=[o.x*kn,o.y*kn],d=[];for(const _ of n){const x=[];for(const w of _){const C=[w.x+p[0],w.y+p[1]];ua(t,C),x.push(C)}d.push(x)}if(t[2]-t[0]<=l/2){(m=t)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const _ of d)for(const x of _)O3(x,t,r,l)}var m;return d}class to{constructor(t,r){this.type=Xe,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Er(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const l=[];for(const p of o.features){const{type:d,coordinates:m}=p.geometry;d==="Polygon"&&l.push(m),d==="MultiPolygon"&&l.push(...m)}if(l.length)return new to(o,{type:"MultiPolygon",coordinates:l})}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new to(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new to(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(o.type==="Polygon"){const m=e4(o.coordinates,p,d),_=N3(r.geometry(),l,p,d);if(!pa(l,p))return!1;for(const x of _)if(!go(x,m))return!1}if(o.type==="MultiPolygon"){const m=I3(o.coordinates,p,d),_=N3(r.geometry(),l,p,d);if(!pa(l,p))return!1;for(const x of _)if(!E3(x,m))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(o.type==="Polygon"){const m=e4(o.coordinates,p,d),_=t4(r.geometry(),l,p,d);if(!pa(l,p))return!1;for(const x of _)if(!L3(x,m))return!1}if(o.type==="MultiPolygon"){const m=I3(o.coordinates,p,d),_=t4(r.geometry(),l,p,d);if(!pa(l,p))return!1;for(const x of _)if(!P3(x,m))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let i4=class{constructor(n=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,o=t[n];for(;n>0;){const l=n-1>>1,p=t[l];if(r(o,p)>=0)break;t[n]=p,n=l}t[n]=o}_down(n){const{data:t,compare:r}=this,o=this.length>>1,l=t[n];for(;n<o;){let p=1+(n<<1);const d=p+1;if(d<this.length&&r(t[d],t[p])<0&&(p=d),r(t[p],l)>=0)break;t[n]=t[p],n=p}t[n]=l}};function k3(n,t,r=0,o=n.length-1,l=Xl){for(;o>r;){if(o-r>600){const _=o-r+1,x=t-r+1,w=Math.log(_),C=.5*Math.exp(2*w/3),M=.5*Math.sqrt(w*C*(_-C)/_)*(x-_/2<0?-1:1);k3(n,t,Math.max(r,Math.floor(t-x*C/_+M)),Math.min(o,Math.floor(t+(_-x)*C/_+M)),l)}const p=n[t];let d=r,m=o;for(da(n,r,t),l(n[o],p)>0&&da(n,r,o);d<m;){for(da(n,d,m),d++,m--;l(n[d],p)<0;)d++;for(;l(n[m],p)>0;)m--}l(n[r],p)===0?da(n,r,m):(m++,da(n,m,o)),m<=t&&(r=m+1),t<=m&&(o=m-1)}}function da(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function Xl(n,t){return n<t?-1:n>t?1:0}function Fo(n,t){if(n.length<=1)return[n];const r=[];let o,l;for(const p of n){const d=Jl(p);d!==0&&(p.area=Math.abs(d),l===void 0&&(l=d<0),l===d<0?(o&&r.push(o),o=[p]):o.push(p))}if(o&&r.push(o),t>1)for(let p=0;p<r.length;p++)r[p].length<=t||(k3(r[p],t,1,r[p].length-1,Kl),r[p]=r[p].slice(0,t));return r}function Kl(n,t){return t.area-n.area}function Jl(n){let t=0;for(let r,o,l=0,p=n.length,d=p-1;l<p;d=l++)r=n[l],o=n[d],t+=(o.x-r.x)*(r.y+o.y);return t}const R3=1/298.257223563,r4=R3*(2-R3),n4=Math.PI/180;class o4{constructor(t){const r=6378.137*n4*1e3,o=Math.cos(t*n4),l=1/(1-r4*(1-o*o)),p=Math.sqrt(l);this.kx=r*p*o,this.ky=r*p*l*(1-r4)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+l*l)}pointOnLine(t,r){let o,l,p,d,m=1/0;for(let _=0;_<t.length-1;_++){let x=t[_][0],w=t[_][1],C=this.wrap(t[_+1][0]-x)*this.kx,M=(t[_+1][1]-w)*this.ky,O=0;C===0&&M===0||(O=(this.wrap(r[0]-x)*this.kx*C+(r[1]-w)*this.ky*M)/(C*C+M*M),O>1?(x=t[_+1][0],w=t[_+1][1]):O>0&&(x+=C/this.kx*O,w+=M/this.ky*O)),C=this.wrap(r[0]-x)*this.kx,M=(r[1]-w)*this.ky;const N=C*C+M*M;N<m&&(m=N,o=x,l=w,p=_,d=O)}return{point:[o,l],index:p,t:Math.max(0,Math.min(1,d))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function D3(n,t){return t[0]-n[0]}function fa(n){return n[1]-n[0]+1}function Rn(n,t){return n[1]>=n[0]&&n[1]<t}function a4(n,t){if(n[0]>n[1])return[null,null];const r=fa(n);if(t){if(r===2)return[n,null];const l=Math.floor(r/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function s4(n,t){if(!Rn(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)ua(r,n[o]);return r}function l4(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const o of r)ua(t,o);return t}function c4(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function h4(n,t,r){if(!c4(n)||!c4(t))return NaN;let o=0,l=0;return n[2]<t[0]&&(o=t[0]-n[2]),n[0]>t[2]&&(o=n[0]-t[2]),n[1]>t[3]&&(l=n[1]-t[3]),n[3]<t[1]&&(l=t[1]-n[3]),r.distance([0,0],[o,l])}function _o(n,t,r){const o=r.pointOnLine(t,n);return r.distance(n,o.point)}function u4(n,t,r,o,l){const p=Math.min(_o(n,[r,o],l),_o(t,[r,o],l)),d=Math.min(_o(r,[n,t],l),_o(o,[n,t],l));return Math.min(p,d)}function Ql(n,t,r,o,l){if(!Rn(t,n.length)||!Rn(o,r.length))return 1/0;let p=1/0;for(let d=t[0];d<t[1];++d){const m=n[d],_=n[d+1];for(let x=o[0];x<o[1];++x){const w=r[x],C=r[x+1];if(mo(m,_,w,C))return 0;p=Math.min(p,u4(m,_,w,C,l))}}return p}function $t(n,t,r,o,l){if(!Rn(t,n.length)||!Rn(o,r.length))return NaN;let p=1/0;for(let d=t[0];d<=t[1];++d)for(let m=o[0];m<=o[1];++m)if(p=Math.min(p,l.distance(n[d],r[m])),p===0)return p;return p}function e7(n,t,r){if(go(n,t,!0))return 0;let o=1/0;for(const l of t){const p=l[0],d=l[l.length-1];if(p!==d&&(o=Math.min(o,_o(n,[d,p],r)),o===0))return o;const m=r.pointOnLine(l,n);if(o=Math.min(o,r.distance(n,m.point)),o===0)return o}return o}function t7(n,t,r,o){if(!Rn(t,n.length))return NaN;for(let p=t[0];p<=t[1];++p)if(go(n[p],r,!0))return 0;let l=1/0;for(let p=t[0];p<t[1];++p){const d=n[p],m=n[p+1];for(const _ of r)for(let x=0,w=_.length,C=w-1;x<w;C=x++){const M=_[C],O=_[x];if(mo(d,m,M,O))return 0;l=Math.min(l,u4(d,m,M,O,o))}}return l}function z3(n,t){for(const r of n)for(const o of r)if(go(o,t,!0))return!0;return!1}function i7(n,t,r,o=1/0){const l=l4(n),p=l4(t);if(o!==1/0&&h4(l,p,r)>=o)return o;if(pa(l,p)){if(z3(n,t))return 0}else if(z3(t,n))return 0;let d=1/0;for(const m of n)for(let _=0,x=m.length,w=x-1;_<x;w=_++){const C=m[w],M=m[_];for(const O of t)for(let N=0,z=O.length,H=z-1;N<z;H=N++){const $=O[H],ae=O[N];if(mo(C,M,$,ae))return 0;d=Math.min(d,u4(C,M,$,ae,r))}}return d}function B3(n,t,r,o,l,p){if(!p)return;const d=h4(s4(o,p),l,r);d<t&&n.push([d,p,[0,0]])}function es(n,t,r,o,l,p,d){if(!p||!d)return;const m=h4(s4(o,p),s4(l,d),r);m<t&&n.push([m,p,d])}function ts(n,t,r,o,l=1/0){let p=Math.min(o.distance(n[0],r[0][0]),l);if(p===0)return p;const d=new i4([[0,[0,n.length-1],[0,0]]],D3),m=l4(r);for(;d.length>0;){const _=d.pop();if(_[0]>=p)continue;const x=_[1],w=t?50:100;if(fa(x)<=w){if(!Rn(x,n.length))return NaN;if(t){const C=t7(n,x,r,o);if(isNaN(C)||C===0)return C;p=Math.min(p,C)}else for(let C=x[0];C<=x[1];++C){const M=e7(n[C],r,o);if(p=Math.min(p,M),p===0)return 0}}else{const C=a4(x,t);B3(d,p,o,n,m,C[0]),B3(d,p,o,n,m,C[1])}}return p}function is(n,t,r,o,l,p=1/0){let d=Math.min(p,l.distance(n[0],r[0]));if(d===0)return d;const m=new i4([[0,[0,n.length-1],[0,r.length-1]]],D3);for(;m.length>0;){const _=m.pop();if(_[0]>=d)continue;const x=_[1],w=_[2],C=t?50:100,M=o?50:100;if(fa(x)<=C&&fa(w)<=M){if(!Rn(x,n.length)&&Rn(w,r.length))return NaN;let O;if(t&&o)O=Ql(n,x,r,w,l),d=Math.min(d,O);else if(t&&!o){const N=n.slice(x[0],x[1]+1);for(let z=w[0];z<=w[1];++z)if(O=_o(r[z],N,l),d=Math.min(d,O),d===0)return d}else if(!t&&o){const N=r.slice(w[0],w[1]+1);for(let z=x[0];z<=x[1];++z)if(O=_o(n[z],N,l),d=Math.min(d,O),d===0)return d}else O=$t(n,x,r,w,l),d=Math.min(d,O)}else{const O=a4(x,t),N=a4(w,o);es(m,d,l,n,r,O[0],N[0]),es(m,d,l,n,r,O[0],N[1]),es(m,d,l,n,r,O[1],N[0]),es(m,d,l,n,r,O[1],N[1])}}return d}function p4(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class yo{constructor(t,r){this.type=Ee,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Er(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new yo(o,o.features.map(l=>p4(l.geometry)).flat());if(o.type==="Feature")return new yo(o,p4(o.geometry));if("type"in o&&"coordinates"in o)return new yo(o,p4(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const l=r.geometry(),p=l.flat().map(_=>Qs([_.x,_.y],r.canonical));if(l.length===0)return NaN;const d=new o4(p[0][1]);let m=1/0;for(const _ of o){switch(_.type){case"Point":m=Math.min(m,is(p,!1,[_.coordinates],!1,d,m));break;case"LineString":m=Math.min(m,is(p,!1,_.coordinates,!0,d,m));break;case"Polygon":m=Math.min(m,ts(p,!1,_.coordinates,d,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const l=r.geometry(),p=l.flat().map(_=>Qs([_.x,_.y],r.canonical));if(l.length===0)return NaN;const d=new o4(p[0][1]);let m=1/0;for(const _ of o){switch(_.type){case"Point":m=Math.min(m,is(p,!0,[_.coordinates],!1,d,m));break;case"LineString":m=Math.min(m,is(p,!0,_.coordinates,!0,d,m));break;case"Polygon":m=Math.min(m,ts(p,!0,_.coordinates,d,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,o){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const p=Fo(l,0).map(_=>_.map(x=>x.map(w=>Qs([w.x,w.y],r.canonical)))),d=new o4(p[0][0][0][1]);let m=1/0;for(const _ of o)for(const x of p){switch(_.type){case"Point":m=Math.min(m,ts([_.coordinates],!1,x,d,m));break;case"LineString":m=Math.min(m,ts(_.coordinates,!0,x,d,m));break;case"Polygon":m=Math.min(m,i7(x,_.coordinates,d,m))}if(m===0)return m}return m}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Go={"==":Xs,"!=":A3,">":Ja,"<":Yl,">=":ql,"<=":Ks,array:qt,at:_t,boolean:qt,case:yn,coalesce:ca,collator:fo,format:Br,image:Qa,in:aa,"index-of":Nt,interpolate:lr,"interpolate-hcl":lr,"interpolate-lab":lr,length:Bo,let:sr,literal:Kr,match:sa,number:qt,"number-format":zo,object:qt,slice:Ro,step:Do,string:qt,"to-boolean":vi,"to-color":vi,"to-number":vi,"to-string":vi,var:Ct,within:to,distance:yo};class cn{constructor(t,r,o,l){this.name=t,this.type=r,this._evaluate=o,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],l=cn.definitions[o];if(!l)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=d.filter(([x])=>!Array.isArray(x)||x.length===t.length-1);let _=null;for(const[x,w]of m){_=new Jt(r.registry,rs,r.path,null,r.scope);const C=[];let M=!1;for(let O=1;O<t.length;O++){const N=t[O],z=Array.isArray(x)?x[O-1]:x.type,H=_.parse(N,1+C.length,z);if(!H){M=!0;break}C.push(H)}if(!M)if(Array.isArray(x)&&x.length!==C.length)_.error(`Expected ${x.length} arguments, but found ${C.length} instead.`);else{for(let O=0;O<C.length;O++){const N=Array.isArray(x)?x[O]:x.type,z=C[O];_.concat(O+1).checkSubtype(N,z.type)}if(_.errors.length===0)return new cn(o,p,w,C)}}if(m.length===1)r.errors.push(..._.errors);else{const x=(m.length?m:d).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(hi).join(", ")})`:`(${hi(M.type)}...)`;var M}).join(" | "),w=[];for(let C=1;C<t.length;C++){const M=r.parse(t[C],1+w.length);if(!M)return null;w.push(hi(M.type))}r.error(`Expected arguments of type ${x}, but found (${w.join(", ")}) instead.`)}return null}static register(t,r){cn.definitions=r;for(const o in r)t[o]=cn}}function F3(n,[t,r,o,l]){t=t.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const p=l?l.evaluate(n):1,d=Hi(t,r,o,p);if(d)throw new et(d);return new St(t/255,r/255,o/255,p,!1)}function G3(n,t){return n in t}function d4(n,t){const r=t[n];return r===void 0?null:r}function xo(n){return{type:n}}function rs(n){if(n instanceof Ct)return rs(n.boundExpression);if(n instanceof cn&&n.name==="error"||n instanceof fo||n instanceof to||n instanceof yo)return!1;const t=n instanceof vi||n instanceof qt;let r=!0;return n.eachChild(o=>{r=t?r&&rs(o):r&&o instanceof Kr}),!!r&&ns(n)&&os(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ns(n){if(n instanceof cn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof to||n instanceof yo)return!1;let t=!0;return n.eachChild(r=>{t&&!ns(r)&&(t=!1)}),t}function ma(n){if(n instanceof cn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!ma(r)&&(t=!1)}),t}function os(n,t){if(n instanceof cn&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(o=>{r&&!os(o,t)&&(r=!1)}),r}function U3(n){return{result:"success",value:n}}function Uo(n){return{result:"error",value:n}}function jo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function j3(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function f4(n){return!!n.expression&&n.expression.interpolated}function Rt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function as(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function r7(n){return n}function H3(n,t){const r=t.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",l=o||!(o||n.property!==void 0),p=n.type||(f4(t)?"exponential":"interval");if(r||t.type==="padding"){const w=r?St.parse:Re.parse;(n=Ve({},n)).stops&&(n.stops=n.stops.map(C=>[C[0],w(C[1])])),n.default=w(n.default?n.default:t.default)}if(n.colorSpace&&(d=n.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var d;let m,_,x;if(p==="exponential")m=V3;else if(p==="interval")m=m4;else if(p==="categorical"){m=n7,_=Object.create(null);for(const w of n.stops)_[w[0]]=w[1];x=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=o7}if(o){const w={},C=[];for(let N=0;N<n.stops.length;N++){const z=n.stops[N],H=z[0].zoom;w[H]===void 0&&(w[H]={zoom:H,type:n.type,property:n.property,default:n.default,stops:[]},C.push(H)),w[H].stops.push([z[0].value,z[1]])}const M=[];for(const N of C)M.push([w[N].zoom,H3(w[N],t)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:lr.interpolationFactor.bind(void 0,O),zoomStops:M.map(N=>N[0]),evaluate:({zoom:N},z)=>V3({stops:M,base:n.base},t,N).evaluate(N,z)}}if(l){const w=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:lr.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(n,t,C,_,x)}}return{kind:"source",evaluate(w,C){const M=C&&C.properties?C.properties[n.property]:void 0;return M===void 0?ga(n.default,t.default):m(n,t,M,_,x)}}}function ga(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function n7(n,t,r,o,l){return ga(typeof r===l?o[r]:void 0,n.default,t.default)}function m4(n,t,r){if(Rt(r)!=="number")return ga(n.default,t.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const l=la(n.stops.map(p=>p[0]),r);return n.stops[l][1]}function V3(n,t,r){const o=n.base!==void 0?n.base:1;if(Rt(r)!=="number")return ga(n.default,t.default);const l=n.stops.length;if(l===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const p=la(n.stops.map(w=>w[0]),r),d=function(w,C,M,O){const N=O-M,z=w-M;return N===0?0:C===1?z/N:(Math.pow(C,z)-1)/(Math.pow(C,N)-1)}(r,o,n.stops[p][0],n.stops[p+1][0]),m=n.stops[p][1],_=n.stops[p+1][1],x=Jr[t.type]||r7;return typeof m.evaluate=="function"?{evaluate(...w){const C=m.evaluate.apply(void 0,w),M=_.evaluate.apply(void 0,w);if(C!==void 0&&M!==void 0)return x(C,M,d,n.colorSpace)}}:x(m,_,d,n.colorSpace)}function o7(n,t,r){switch(t.type){case"color":r=St.parse(r);break;case"formatted":r=ve.fromString(r.toString());break;case"resolvedImage":r=vt.fromString(r.toString());break;case"padding":r=Re.parse(r);break;default:Rt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ga(r,n.default,t.default)}cn.register(Go,{error:[{kind:"error"},[$e],(n,[t])=>{throw new et(t.evaluate(n))}],typeof:[$e,[qe],(n,[t])=>hi(kt(t.evaluate(n)))],"to-rgba":[_r(Ee,4),[Tt],(n,[t])=>{const[r,o,l,p]=t.evaluate(n).rgb;return[255*r,255*o,255*l,p]}],rgb:[Tt,[Ee,Ee,Ee],F3],rgba:[Tt,[Ee,Ee,Ee,Ee],F3],has:{type:Xe,overloads:[[[$e],(n,[t])=>G3(t.evaluate(n),n.properties())],[[$e,ut],(n,[t,r])=>G3(t.evaluate(n),r.evaluate(n))]]},get:{type:qe,overloads:[[[$e],(n,[t])=>d4(t.evaluate(n),n.properties())],[[$e,ut],(n,[t,r])=>d4(t.evaluate(n),r.evaluate(n))]]},"feature-state":[qe,[$e],(n,[t])=>d4(t.evaluate(n),n.featureState||{})],properties:[ut,[],n=>n.properties()],"geometry-type":[$e,[],n=>n.geometryType()],id:[qe,[],n=>n.id()],zoom:[Ee,[],n=>n.globals.zoom],"heatmap-density":[Ee,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ee,[],n=>n.globals.lineProgress||0],accumulated:[qe,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ee,xo(Ee),(n,t)=>{let r=0;for(const o of t)r+=o.evaluate(n);return r}],"*":[Ee,xo(Ee),(n,t)=>{let r=1;for(const o of t)r*=o.evaluate(n);return r}],"-":{type:Ee,overloads:[[[Ee,Ee],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Ee],(n,[t])=>-t.evaluate(n)]]},"/":[Ee,[Ee,Ee],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Ee,[Ee,Ee],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Ee,[],()=>Math.LN2],pi:[Ee,[],()=>Math.PI],e:[Ee,[],()=>Math.E],"^":[Ee,[Ee,Ee],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Ee,[Ee],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Ee,[Ee],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Ee,[Ee],(n,[t])=>Math.log(t.evaluate(n))],log2:[Ee,[Ee],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Ee,[Ee],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Ee,[Ee],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Ee,[Ee],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Ee,[Ee],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Ee,[Ee],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Ee,[Ee],(n,[t])=>Math.atan(t.evaluate(n))],min:[Ee,xo(Ee),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Ee,xo(Ee),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Ee,[Ee],(n,[t])=>Math.abs(t.evaluate(n))],round:[Ee,[Ee],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ee,[Ee],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Ee,[Ee],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Xe,[$e,qe],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Xe,[qe],(n,[t])=>n.id()===t.value],"filter-type-==":[Xe,[$e],(n,[t])=>n.geometryType()===t.value],"filter-<":[Xe,[$e,qe],(n,[t,r])=>{const o=n.properties()[t.value],l=r.value;return typeof o==typeof l&&o<l}],"filter-id-<":[Xe,[qe],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Xe,[$e,qe],(n,[t,r])=>{const o=n.properties()[t.value],l=r.value;return typeof o==typeof l&&o>l}],"filter-id->":[Xe,[qe],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Xe,[$e,qe],(n,[t,r])=>{const o=n.properties()[t.value],l=r.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[Xe,[qe],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Xe,[$e,qe],(n,[t,r])=>{const o=n.properties()[t.value],l=r.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[Xe,[qe],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Xe,[qe],(n,[t])=>t.value in n.properties()],"filter-has-id":[Xe,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Xe,[_r($e)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Xe,[_r(qe)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Xe,[$e,_r(qe)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Xe,[$e,_r(qe)],(n,[t,r])=>function(o,l,p,d){for(;p<=d;){const m=p+d>>1;if(l[m]===o)return!0;l[m]>o?d=m-1:p=m+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Xe,overloads:[[[Xe,Xe],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[xo(Xe),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Xe,overloads:[[[Xe,Xe],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[xo(Xe),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Xe,[Xe],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Xe,[$e],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[$e,[$e],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[$e,[$e],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[$e,xo(qe),(n,t)=>t.map(r=>Vi(r.evaluate(n))).join("")],"resolved-locale":[$e,[ui],(n,[t])=>t.evaluate(n).resolvedLocale()]});class g4{constructor(t,r){var o;this.expression=t,this._warningHistory={},this._evaluator=new uo,this._defaultValue=r?(o=r).type==="color"&&as(o.default)?new St(0,0,0,0):o.type==="color"?St.parse(o.default)||null:o.type==="padding"?Re.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Mt.parse(o.default)||null:o.type==="projectionDefinition"?jt.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,l,p,d){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,l,p,d){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=d||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new et(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function _a(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Go}function ss(n,t){const r=new Jt(Go,rs,[],t?function(l){const p={color:Tt,string:$e,number:Ee,enum:$e,boolean:Xe,formatted:gn,padding:Ni,projectionDefinition:Pt,resolvedImage:xi,variableAnchorOffsetCollection:ti};return l.type==="array"?_r(p[l.value]||qe,l.length):p[l.type]}(t):void 0),o=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?U3(new g4(o,t)):Uo(r.errors)}class _4{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!ma(r.expression)}evaluateWithoutErrorHandling(t,r,o,l,p,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,l,p,d)}evaluate(t,r,o,l,p,d){return this._styleExpression.evaluate(t,r,o,l,p,d)}}class Ho{constructor(t,r,o,l){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ma(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,o,l,p,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,l,p,d)}evaluate(t,r,o,l,p,d){return this._styleExpression.evaluate(t,r,o,l,p,d)}interpolationFactor(t,r,o){return this.interpolationType?lr.interpolationFactor(this.interpolationType,t,r,o):0}}function y4(n,t){const r=ss(n,t);if(r.result==="error")return r;const o=r.value.expression,l=ns(o);if(!l&&!jo(t))return Uo([new Ze("","data expressions not supported")]);const p=os(o,["zoom"]);if(!p&&!j3(t))return Uo([new Ze("","zoom expressions not supported")]);const d=cs(o);return d||p?d instanceof Ze?Uo([d]):d instanceof lr&&!f4(t)?Uo([new Ze("",'"interpolate" expressions cannot be used with this property')]):U3(d?new Ho(l?"camera":"composite",r.value,d.labels,d instanceof lr?d.interpolation:void 0):new _4(l?"constant":"source",r.value)):Uo([new Ze("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ls{constructor(t,r){this._parameters=t,this._specification=r,Ve(this,H3(this._parameters,this._specification))}static deserialize(t){return new ls(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function cs(n){let t=null;if(n instanceof sr)t=cs(n.result);else if(n instanceof ca){for(const r of n.args)if(t=cs(r),t)break}else(n instanceof Do||n instanceof lr)&&n.input instanceof cn&&n.input.name==="zoom"&&(t=n);return t instanceof Ze||n.eachChild(r=>{const o=cs(r);o instanceof Ze?t=o:!t&&o?t=new Ze("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Ze("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function x4(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!x4(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const a7={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function v4(n){if(n==null)return{filter:()=>!0,needGeometry:!1};x4(n)||(n=hs(n));const t=ss(n,a7);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,l)=>t.value.evaluate(r,o,{},l),needGeometry:b4(n)}}function Z3(n,t){return n<t?-1:n>t?1:0}function b4(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(b4(n[t]))return!0;return!1}function hs(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?w4(n[1],n[2],"=="):t==="!="?ya(w4(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?w4(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(hs))):t==="all"?["all"].concat(n.slice(1).map(hs)):t==="none"?["all"].concat(n.slice(1).map(hs).map(ya)):t==="in"?T4(n[1],n.slice(2)):t==="!in"?ya(T4(n[1],n.slice(2))):t==="has"?S4(n[1]):t!=="!has"||ya(S4(n[1]));var r}function w4(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function T4(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Z3)]]:["filter-in-small",n,["literal",t]]}}function S4(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ya(n){return["!",n]}function us(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let l="[";for(const p of n)l+=`${us(p)},`;return`${l}]`}const r=Object.keys(n).sort();let o="{";for(let l=0;l<r.length;l++)o+=`${JSON.stringify(r[l])}:${us(n[r[l]])},`;return`${o}}`}function C4(n){let t="";for(const r of B)t+=`/${us(n[r])}`;return t}function ps(n){const t=n.value;return t?[new se(n.key,t,"constants have been deprecated as of v8")]:[]}function bi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Dn(n){if(Array.isArray(n))return n.map(Dn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Dn(n[r]);return t}return bi(n)}function hn(n){const t=n.key,r=n.value,o=n.valueSpec||{},l=n.objectElementValidators||{},p=n.style,d=n.styleSpec,m=n.validateSpec;let _=[];const x=Rt(r);if(x!=="object")return[new se(t,r,`object expected, ${x} found`)];for(const w in r){const C=w.split(".")[0],M=o[C]||o["*"];let O;if(l[C])O=l[C];else if(o[C])O=m;else if(l["*"])O=l["*"];else{if(!o["*"]){_.push(new se(t,r[w],`unknown property "${w}"`));continue}O=m}_=_.concat(O({key:(t&&`${t}.`)+w,value:r[w],valueSpec:M,style:p,styleSpec:d,object:r,objectKey:w,validateSpec:m},r))}for(const w in o)l[w]||o[w].required&&o[w].default===void 0&&r[w]===void 0&&_.push(new se(t,r,`missing required property "${w}"`));return _}function A4(n){const t=n.value,r=n.valueSpec,o=n.style,l=n.styleSpec,p=n.key,d=n.arrayElementValidator||n.validateSpec;if(Rt(t)!=="array")return[new se(p,t,`array expected, ${Rt(t)} found`)];if(r.length&&t.length!==r.length)return[new se(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new se(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),Rt(r.value)==="object"&&(m=r.value);let _=[];for(let x=0;x<t.length;x++)_=_.concat(d({array:t,arrayIndex:x,value:t[x],valueSpec:m,validateSpec:n.validateSpec,style:o,styleSpec:l,key:`${p}[${x}]`}));return _}function E4(n){const t=n.key,r=n.value,o=n.valueSpec;let l=Rt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new se(t,r,`number expected, ${l} found`)]:"minimum"in o&&r<o.minimum?[new se(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new se(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Y3(n){const t=n.valueSpec,r=bi(n.value.type);let o,l,p,d={};const m=r!=="categorical"&&n.value.property===void 0,_=!m,x=Rt(n.value.stops)==="array"&&Rt(n.value.stops[0])==="array"&&Rt(n.value.stops[0][0])==="object",w=hn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new se(O.key,O.value,'identity function may not have a "stops" property')];let N=[];const z=O.value;return N=N.concat(A4({key:O.key,value:z,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:C})),Rt(z)==="array"&&z.length===0&&N.push(new se(O.key,z,"array must have at least one stop")),N},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&m&&w.push(new se(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||w.push(new se(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!f4(n.valueSpec)&&w.push(new se(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(_&&!jo(n.valueSpec)?w.push(new se(n.key,n.value,"property functions not supported")):m&&!j3(n.valueSpec)&&w.push(new se(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!x||n.value.property!==void 0||w.push(new se(n.key,n.value,'"property" property is required')),w;function C(O){let N=[];const z=O.value,H=O.key;if(Rt(z)!=="array")return[new se(H,z,`array expected, ${Rt(z)} found`)];if(z.length!==2)return[new se(H,z,`array length 2 expected, length ${z.length} found`)];if(x){if(Rt(z[0])!=="object")return[new se(H,z,`object expected, ${Rt(z[0])} found`)];if(z[0].zoom===void 0)return[new se(H,z,"object stop key must have zoom")];if(z[0].value===void 0)return[new se(H,z,"object stop key must have value")];if(p&&p>bi(z[0].zoom))return[new se(H,z[0].zoom,"stop zoom values must appear in ascending order")];bi(z[0].zoom)!==p&&(p=bi(z[0].zoom),l=void 0,d={}),N=N.concat(hn({key:`${H}[0]`,value:z[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:E4,value:M}}))}else N=N.concat(M({key:`${H}[0]`,value:z[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},z));return _a(Dn(z[1]))?N.concat([new se(`${H}[1]`,z[1],"expressions are not allowed in function stops.")]):N.concat(O.validateSpec({key:`${H}[1]`,value:z[1],valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function M(O,N){const z=Rt(O.value),H=bi(O.value),$=O.value!==null?O.value:N;if(o){if(z!==o)return[new se(O.key,$,`${z} stop domain type must match previous stop domain type ${o}`)]}else o=z;if(z!=="number"&&z!=="string"&&z!=="boolean")return[new se(O.key,$,"stop domain value must be a number, string, or boolean")];if(z!=="number"&&r!=="categorical"){let ae=`number expected, ${z} found`;return jo(t)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new se(O.key,$,ae)]}return r!=="categorical"||z!=="number"||isFinite(H)&&Math.floor(H)===H?r!=="categorical"&&z==="number"&&l!==void 0&&H<l?[new se(O.key,$,"stop domain values must appear in ascending order")]:(l=H,r==="categorical"&&H in d?[new se(O.key,$,"stop domain values must be unique")]:(d[H]=!0,[])):[new se(O.key,$,`integer expected, found ${H}`)]}}function Vo(n){const t=(n.expressionContext==="property"?y4:ss)(Dn(n.value),n.valueSpec);if(t.result==="error")return t.value.map(o=>new se(`${n.key}${o.key}`,n.value,o.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new se(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ma(r))return[new se(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ma(r))return[new se(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!os(r,["zoom","feature-state"]))return[new se(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ns(r))return[new se(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xa(n){const t=n.key,r=n.value,o=n.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(bi(r))===-1&&l.push(new se(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(bi(r))===-1&&l.push(new se(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function ds(n){return x4(Dn(n.value))?Vo(Ve({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):L4(n)}function L4(n){const t=n.value,r=n.key;if(Rt(t)!=="array")return[new se(r,t,`array expected, ${Rt(t)} found`)];const o=n.styleSpec;let l,p=[];if(t.length<1)return[new se(r,t,"filter array must have at least 1 element")];switch(p=p.concat(xa({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),bi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&bi(t[1])==="$type"&&p.push(new se(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new se(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Rt(t[1]),l!=="string"&&p.push(new se(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let d=2;d<t.length;d++)l=Rt(t[d]),bi(t[1])==="$type"?p=p.concat(xa({key:`${r}[${d}]`,value:t[d],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&p.push(new se(`${r}[${d}]`,t[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<t.length;d++)p=p.concat(L4({key:`${r}[${d}]`,value:t[d],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":l=Rt(t[1]),t.length!==2?p.push(new se(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&p.push(new se(`${r}[1]`,t[1],`string expected, ${l} found`))}return p}function va(n,t){const r=n.key,o=n.validateSpec,l=n.style,p=n.styleSpec,d=n.value,m=n.objectKey,_=p[`${t}_${n.layerType}`];if(!_)return[];const x=m.match(/^(.*)-transition$/);if(t==="paint"&&x&&_[x[1]]&&_[x[1]].transition)return o({key:r,value:d,valueSpec:p.transition,style:l,styleSpec:p});const w=n.valueSpec||_[m];if(!w)return[new se(r,d,`unknown property "${m}"`)];let C;if(Rt(d)==="string"&&jo(w)&&!w.tokens&&(C=/^{([^}]+)}$/.exec(d)))return[new se(r,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const M=[];return n.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&M.push(new se(r,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&as(Dn(d))&&bi(d.type)==="identity"&&M.push(new se(r,d,'"text-font" does not support identity functions'))),M.concat(o({key:n.key,value:d,valueSpec:w,style:l,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:m}))}function q3(n){return va(n,"paint")}function P4(n){return va(n,"layout")}function M4(n){let t=[];const r=n.value,o=n.key,l=n.style,p=n.styleSpec;r.type||r.ref||t.push(new se(o,r,'either "type" or "ref" is required'));let d=bi(r.type);const m=bi(r.ref);if(r.id){const _=bi(r.id);for(let x=0;x<n.arrayIndex;x++){const w=l.layers[x];bi(w.id)===_&&t.push(new se(o,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let _;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&t.push(new se(o,r[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{bi(x.id)===m&&(_=x)}),_?_.ref?t.push(new se(o,r.ref,"ref cannot reference another ref layer")):d=bi(_.type):t.push(new se(o,r.ref,`ref layer "${m}" not found`))}else if(d!=="background")if(r.source){const _=l.sources&&l.sources[r.source],x=_&&bi(_.type);_?x==="vector"&&d==="raster"?t.push(new se(o,r.source,`layer "${r.id}" requires a raster source`)):x!=="raster-dem"&&d==="hillshade"?t.push(new se(o,r.source,`layer "${r.id}" requires a raster-dem source`)):x==="raster"&&d!=="raster"?t.push(new se(o,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&d!=="hillshade"?t.push(new se(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&_.lineMetrics||t.push(new se(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new se(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new se(o,r.source,`source "${r.source}" not found`))}else t.push(new se(o,r,'missing required property "source"'));return t=t.concat(hn({key:o,value:r,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:ds,layout:_=>hn({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":x=>P4(Ve({layerType:d},x))}}),paint:_=>hn({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":x=>q3(Ve({layerType:d},x))}})}})),t}function vo(n){const t=n.value,r=n.key,o=Rt(t);return o!=="string"?[new se(r,t,`string expected, ${o} found`)]:[]}const I4={promoteId:function({key:n,value:t}){if(Rt(t)==="string")return vo({key:n,value:t});{const r=[];for(const o in t)r.push(...vo({key:`${n}.${o}`,value:t[o]}));return r}}};function O4(n){const t=n.value,r=n.key,o=n.styleSpec,l=n.style,p=n.validateSpec;if(!t.type)return[new se(r,t,'"type" is required')];const d=bi(t.type);let m;switch(d){case"vector":case"raster":return m=hn({key:r,value:t,valueSpec:o[`source_${d.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:I4,validateSpec:p}),m;case"raster-dem":return m=function(_){var x;const w=(x=_.sourceName)!==null&&x!==void 0?x:"",C=_.value,M=_.styleSpec,O=M.source_raster_dem,N=_.style;let z=[];const H=Rt(C);if(C===void 0)return z;if(H!=="object")return z.push(new se("source_raster_dem",C,`object expected, ${H} found`)),z;const $=bi(C.encoding)==="custom",ae=["redFactor","greenFactor","blueFactor","baseShift"],K=_.value.encoding?`"${_.value.encoding}"`:"Default";for(const I in C)!$&&ae.includes(I)?z.push(new se(I,C[I],`In "${w}": "${I}" is only valid when "encoding" is set to "custom". ${K} encoding found`)):O[I]?z=z.concat(_.validateSpec({key:I,value:C[I],valueSpec:O[I],validateSpec:_.validateSpec,style:N,styleSpec:M})):z.push(new se(I,C[I],`unknown property "${I}"`));return z}({sourceName:r,value:t,style:n.style,styleSpec:o,validateSpec:p}),m;case"geojson":if(m=hn({key:r,value:t,valueSpec:o.source_geojson,style:l,styleSpec:o,validateSpec:p,objectElementValidators:I4}),t.cluster)for(const _ in t.clusterProperties){const[x,w]=t.clusterProperties[_],C=typeof x=="string"?[x,["accumulated"],["get",_]]:x;m.push(...Vo({key:`${r}.${_}.map`,value:w,validateSpec:p,expressionContext:"cluster-map"})),m.push(...Vo({key:`${r}.${_}.reduce`,value:C,validateSpec:p,expressionContext:"cluster-reduce"}))}return m;case"video":return hn({key:r,value:t,valueSpec:o.source_video,style:l,validateSpec:p,styleSpec:o});case"image":return hn({key:r,value:t,valueSpec:o.source_image,style:l,validateSpec:p,styleSpec:o});case"canvas":return[new se(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xa({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:p,styleSpec:o})}}function Zo(n){const t=n.value,r=n.styleSpec,o=r.light,l=n.style;let p=[];const d=Rt(t);if(t===void 0)return p;if(d!=="object")return p=p.concat([new se("light",t,`object expected, ${d} found`)]),p;for(const m in t){const _=m.match(/^(.*)-transition$/);p=p.concat(_&&o[_[1]]&&o[_[1]].transition?n.validateSpec({key:m,value:t[m],valueSpec:r.transition,validateSpec:n.validateSpec,style:l,styleSpec:r}):o[m]?n.validateSpec({key:m,value:t[m],valueSpec:o[m],validateSpec:n.validateSpec,style:l,styleSpec:r}):[new se(m,t[m],`unknown property "${m}"`)])}return p}function $3(n){const t=n.value,r=n.styleSpec,o=r.sky,l=n.style,p=Rt(t);if(t===void 0)return[];if(p!=="object")return[new se("sky",t,`object expected, ${p} found`)];let d=[];for(const m in t)d=d.concat(o[m]?n.validateSpec({key:m,value:t[m],valueSpec:o[m],style:l,styleSpec:r}):[new se(m,t[m],`unknown property "${m}"`)]);return d}function W3(n){const t=n.value,r=n.styleSpec,o=r.terrain,l=n.style;let p=[];const d=Rt(t);if(t===void 0)return p;if(d!=="object")return p=p.concat([new se("terrain",t,`object expected, ${d} found`)]),p;for(const m in t)p=p.concat(o[m]?n.validateSpec({key:m,value:t[m],valueSpec:o[m],validateSpec:n.validateSpec,style:l,styleSpec:r}):[new se(m,t[m],`unknown property "${m}"`)]);return p}function X3(n){let t=[];const r=n.value,o=n.key;if(Array.isArray(r)){const l=[],p=[];for(const d in r)r[d].id&&l.includes(r[d].id)&&t.push(new se(o,r,`all the sprites' ids must be unique, but ${r[d].id} is duplicated`)),l.push(r[d].id),r[d].url&&p.includes(r[d].url)&&t.push(new se(o,r,`all the sprites' URLs must be unique, but ${r[d].url} is duplicated`)),p.push(r[d].url),t=t.concat(hn({key:`${o}[${d}]`,value:r[d],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return vo({key:o,value:r})}const K3={"*":()=>[],array:A4,boolean:function(n){const t=n.value,r=n.key,o=Rt(t);return o!=="boolean"?[new se(r,t,`boolean expected, ${o} found`)]:[]},number:E4,color:function(n){const t=n.key,r=n.value,o=Rt(r);return o!=="string"?[new se(t,r,`color expected, ${o} found`)]:St.parse(String(r))?[]:[new se(t,r,`color expected, "${r}" found`)]},constants:ps,enum:xa,filter:ds,function:Y3,layer:M4,object:hn,source:O4,light:Zo,sky:$3,terrain:W3,projection:function(n){const t=n.value,r=n.styleSpec,o=r.projection,l=n.style,p=Rt(t);if(t===void 0)return[];if(p!=="object")return[new se("projection",t,`object expected, ${p} found`)];let d=[];for(const m in t)d=d.concat(o[m]?n.validateSpec({key:m,value:t[m],valueSpec:o[m],style:l,styleSpec:r}):[new se(m,t[m],`unknown property "${m}"`)]);return d},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const o=Rt(r);return o!=="array"||function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"}(r)||function(l){return!!["interpolate","step","literal"].includes(l[0])}(r)?["array","string"].includes(o)?[]:[new se(t,r,`projection expected, invalid type "${o}" found`)]:[new se(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:vo,formatted:function(n){return vo(n).length===0?[]:Vo(n)},resolvedImage:function(n){return vo(n).length===0?[]:Vo(n)},padding:function(n){const t=n.key,r=n.value;if(Rt(r)==="array"){if(r.length<1||r.length>4)return[new se(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let l=[];for(let p=0;p<r.length;p++)l=l.concat(n.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:n.validateSpec,valueSpec:o}));return l}return E4({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,o=Rt(r),l=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new se(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let d=0;d<r.length;d+=2)p=p.concat(xa({key:`${t}[${d}]`,value:r[d],valueSpec:l.layout_symbol["text-anchor"]})),p=p.concat(A4({key:`${t}[${d+1}]`,value:r[d+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:l}));return p},sprite:X3};function ba(n){const t=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=ba,r.expression&&as(bi(t))?Y3(n):r.expression&&_a(Dn(t))?Vo(n):r.type&&K3[r.type]?K3[r.type](n):hn(Ve({},n,{valueSpec:r.type?o[r.type]:r}))}function J3(n){const t=n.value,r=n.key,o=vo(n);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new se(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new se(r,t,'"glyphs" url must include a "{range}" token'))),o}function Lr(n,t=V){let r=[];return r=r.concat(ba({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:ba,objectElementValidators:{glyphs:J3,"*":()=>[]}})),n.constants&&(r=r.concat(ps({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:ba}))),Gr(r)}function Fr(n){return function(t){return n({...t,validateSpec:ba})}}function Gr(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function Ur(n){return function(...t){return Gr(n.apply(this,t))}}Lr.source=Ur(Fr(O4)),Lr.sprite=Ur(Fr(X3)),Lr.glyphs=Ur(Fr(J3)),Lr.light=Ur(Fr(Zo)),Lr.sky=Ur(Fr($3)),Lr.terrain=Ur(Fr(W3)),Lr.layer=Ur(Fr(M4)),Lr.filter=Ur(Fr(ds)),Lr.paintProperty=Ur(Fr(q3)),Lr.layoutProperty=Ur(Fr(P4));const bo=Lr,s7=bo.light,l7=bo.sky,wa=bo.paintProperty,Q3=bo.layoutProperty;function fs(n,t){let r=!1;if(t&&t.length)for(const o of t)n.fire(new mn(new Error(o.message))),r=!0;return r}class Ta{constructor(t,r,o){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const d=new Int32Array(this.arrayBuffer);t=d[0],this.d=(r=d[1])+2*(o=d[2]);for(let _=0;_<this.d*this.d;_++){const x=d[3+_],w=d[3+_+1];l.push(x===w?null:d.subarray(x,w))}const m=d[3+l.length+1];this.keys=d.subarray(d[3+l.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let d=0;d<this.d*this.d;d++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const p=o/r*t;this.min=-p,this.max=t+p}insert(t,r,o,l,p){this._forEachCell(r,o,l,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,l,p,d){this.cells[p].push(d)}query(t,r,o,l,p){const d=this.min,m=this.max;if(t<=d&&r<=d&&m<=o&&m<=l&&!p)return Array.prototype.slice.call(this.keys);{const _=[];return this._forEachCell(t,r,o,l,this._queryCell,_,{},p),_}}_queryCell(t,r,o,l,p,d,m,_){const x=this.cells[p];if(x!==null){const w=this.keys,C=this.bboxes;for(let M=0;M<x.length;M++){const O=x[M];if(m[O]===void 0){const N=4*O;(_?_(C[N+0],C[N+1],C[N+2],C[N+3]):t<=C[N+2]&&r<=C[N+3]&&o>=C[N+0]&&l>=C[N+1])?(m[O]=!0,d.push(w[O])):m[O]=!1}}}}_forEachCell(t,r,o,l,p,d,m,_){const x=this._convertToCellCoord(t),w=this._convertToCellCoord(r),C=this._convertToCellCoord(o),M=this._convertToCellCoord(l);for(let O=x;O<=C;O++)for(let N=w;N<=M;N++){const z=this.d*N+O;if((!_||_(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&p.call(this,t,r,o,l,z,d,m,_))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let d=0;d<this.cells.length;d++)o+=this.cells[d].length;const l=new Int32Array(r+o+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let p=r;for(let d=0;d<t.length;d++){const m=t[d];l[3+d]=p,l.set(m,p),p+=m.length}return l[3+t.length]=p,l.set(this.keys,p),p+=this.keys.length,l[3+t.length+1]=p,l.set(this.bboxes,p),p+=this.bboxes.length,l.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new Ta(t.buffer)}}const xn={};function We(n,t,r={}){if(xn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),xn[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}We("Object",Object),We("TransferableGridIndex",Ta),We("Color",St),We("Error",Error),We("AJAXError",mr),We("ResolvedImage",vt),We("StylePropertyFunction",ls),We("StyleExpression",g4,{omit:["_evaluator"]}),We("ZoomDependentExpression",Ho),We("ZoomConstantExpression",_4),We("CompoundExpression",cn,{omit:["_evaluate"]});for(const n in Go)Go[n]._classRegistryKey||We(`Expression_${n}`,Go[n]);function Yo(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function N4(n){return n.$name||n.constructor._classRegistryKey}function qo(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=N4(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Yo(n)||$r(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Sa(n,t){if(qo(n))return(Yo(n)||$r(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const p=[];for(const d of n)p.push(Sa(d,t));return p}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=N4(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!xn[r])throw new Error(`${r} is not registered.`);const{klass:o}=xn[r],l=o.serialize?o.serialize(n,t):{};if(o.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in n){if(!n.hasOwnProperty(p)||xn[r].omit.indexOf(p)>=0)continue;const d=n[p];l[p]=xn[r].shallow.indexOf(p)>=0?d:Sa(d,t)}n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function Ca(n){if(qo(n))return n;if(Array.isArray(n))return n.map(Ca);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=N4(n)||"Object";if(!xn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=xn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const l of Object.keys(n)){if(l==="$name")continue;const p=n[l];o[l]=xn[t].shallow.indexOf(l)>=0?p:Ca(p)}return o}class Aa{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const It={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Ea(n){for(const t of n)if(La(t.charCodeAt(0)))return!0;return!1}function ms(n){for(const t of n)if(!tl(t.charCodeAt(0)))return!1;return!0}function gs(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const el=gs(["Arab","Dupl","Mong","Ougr","Syrc"]);function tl(n){return!el.test(String.fromCodePoint(n))}const k4=gs(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function La(n){return!(n!==746&&n!==747&&(n<4352||!(It["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||It["CJK Compatibility"](n)||It["CJK Strokes"](n)||!(!It["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||It["Enclosed CJK Letters and Months"](n)||It["Ideographic Description Characters"](n)||It.Kanbun(n)||It.Katakana(n)&&n!==12540||!(!It["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!It["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||It["Vertical Forms"](n)||It["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||k4.test(String.fromCodePoint(n)))))}function R4(n){return!(La(n)||function(t){return!!(It["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||It["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||It["Letterlike Symbols"](t)||It["Number Forms"](t)||It["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||It["Control Pictures"](t)&&t!==9251||It["Optical Character Recognition"](t)||It["Enclosed Alphanumerics"](t)||It["Geometric Shapes"](t)||It["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||It["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||It["CJK Symbols and Punctuation"](t)||It.Katakana(t)||It["Private Use Area"](t)||It["CJK Compatibility Forms"](t)||It["Small Form Variants"](t)||It["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const c7=gs(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function D4(n){return c7.test(String.fromCodePoint(n))}function h7(n,t){return!(!t&&D4(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||It.Khmer(n))}function il(n){for(const t of n)if(D4(t.charCodeAt(0)))return!0;return!1}const Zn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Zn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,o=new Promise(p=>{this.loadScriptResolve=p});t(r);const l=new Promise(p=>setTimeout(()=>p(),this.TIMEOUT));if(yield Promise.race([o,l]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:r};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class pi{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Aa,this.transition={})}isSupportedScript(t){return function(r,o){for(const l of r)if(!h7(l.charCodeAt(0),o))return!1;return!0}(t,Zn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class _s{constructor(t,r){this.property=t,this.value=r,this.expression=function(o,l){if(as(o))return new ls(o,l);if(_a(o)){const p=y4(o,l);if(p.result==="error")throw new Error(p.value.map(d=>`${d.key}: ${d.message}`).join(", "));return p.value}{let p=o;return l.type==="color"&&typeof o=="string"?p=St.parse(o):l.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?p=Mt.parse(o):l.type==="projectionDefinition"&&typeof o=="string"&&(p=jt.parse(o)):p=Re.parse(o),{kind:"constant",evaluate:()=>p}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class z4{constructor(t){this.property=t,this.value=new _s(t,void 0)}transitioned(t,r){return new F4(this.property,this.value,r,ci({},t.transition,this.transition),t.now)}untransitioned(){return new F4(this.property,this.value,null,{},0)}}class B4{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Oi(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new z4(this._values[t].property)),this._values[t].value=new _s(this._values[t].property,r===null?void 0:Oi(r))}getTransition(t){return Oi(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new z4(this._values[t].property)),this._values[t].transition=Oi(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const o=new G4(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(t,r._values[l]);return o}untransitioned(){const t=new G4(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class F4{constructor(t,r,o,l,p){this.property=t,this.value=r,this.begin=p+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const l=t.now||0,p=this.value.possiblyEvaluate(t,r,o),d=this.prior;if(d){if(l>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(l<this.begin)return d.possiblyEvaluate(t,r,o);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(t,r,o),p,dr(m))}}return p}}class G4{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const l=new ys(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(t,r,o);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class rl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Oi(this._values[t].value)}setValue(t,r){this._values[t]=new _s(this._values[t].property,r===null?void 0:Oi(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const l=new ys(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(t,r,o);return l}}class Qr{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,l){return this.property.evaluate(this.value,this.parameters,t,r,o,l)}}class ys{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class rt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const l=Jr[this.specification.type];return l?l(t,r,o):t}}class pt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,l){return new Qr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,l)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Qr(this,{kind:"constant",value:void 0},t.parameters);const l=Jr[this.specification.type];if(l){const p=l(t.value.value,r.value.value,o);return new Qr(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,r,o,l,p,d){return t.kind==="constant"?t.value:t.evaluate(r,o,l,p,d)}}class xs extends pt{possiblyEvaluate(t,r,o,l){if(t.value===void 0)return new Qr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},o,l),d=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,m=this._calculate(d,d,d,r);return new Qr(this,{kind:"constant",value:m},r)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Qr(this,{kind:"constant",value:p},r)}return new Qr(this,t.expression,r)}evaluate(t,r,o,l,p,d){if(t.kind==="source"){const m=t.evaluate(r,o,l,p,d);return this._calculate(m,m,m,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,l),t.evaluate({zoom:Math.floor(r.zoom)},o,l),t.evaluate({zoom:Math.floor(r.zoom)+1},o,l),r):t.value}_calculate(t,r,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class vs{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},o,l);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new pi(Math.floor(r.zoom-1),r)),t.expression.evaluate(new pi(Math.floor(r.zoom),r)),t.expression.evaluate(new pi(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class bs{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,l){return!!t.expression.evaluate(r,null,{},o,l)}interpolate(){return!1}}class Pr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new _s(o,void 0),p=this.defaultTransitionablePropertyValues[r]=new z4(o);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}We("DataDrivenProperty",pt),We("DataConstantProperty",rt),We("CrossFadedDataDrivenProperty",xs),We("CrossFadedProperty",vs),We("ColorRampProperty",bs);const nl="-transition";class zn extends Dr{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new rl(r.layout)),r.paint)){this._transitionablePaint=new B4(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ys(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,o={}){r!=null&&this._validate(Q3,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(nl)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(wa,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(nl))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],p=l.property.specification["property-type"]==="cross-faded-data-driven",d=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const _=this._transitionablePaint._values[t].value;return _.isDataDriven()||d||p||this._handleOverridablePaintPropertyUpdate(t,m,_)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),or(t,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(t,r,o,l,p={}){return(!p||p.validate!==!1)&&fs(this,t.call(bo,{key:r,layerType:this.type,objectKey:o,value:l,styleSpec:V,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Qr&&jo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const u7={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pa{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Si{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function di(n,t=1){let r=0,o=0;return{members:n.map(l=>{const p=u7[l.type].BYTES_PER_ELEMENT,d=r=ol(r,Math.max(t,p)),m=l.components||1;return o=Math.max(o,p),r+=p*m,{name:l.name,type:l.type,components:m,offset:d}}),size:ol(r,Math.max(o,t)),alignment:t}}function ol(n,t){return Math.ceil(n/t)*t}class Ma extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=o,t}}Ma.prototype.bytesPerElement=4,We("StructArrayLayout2i4",Ma);class ws extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,o)}emplace(t,r,o,l){const p=3*t;return this.int16[p+0]=r,this.int16[p+1]=o,this.int16[p+2]=l,t}}ws.prototype.bytesPerElement=6,We("StructArrayLayout3i6",ws);class Ts extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,o,l)}emplace(t,r,o,l,p){const d=4*t;return this.int16[d+0]=r,this.int16[d+1]=o,this.int16[d+2]=l,this.int16[d+3]=p,t}}Ts.prototype.bytesPerElement=8,We("StructArrayLayout4i8",Ts);class U4 extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,l,p,d)}emplace(t,r,o,l,p,d,m){const _=6*t;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=l,this.int16[_+3]=p,this.int16[_+4]=d,this.int16[_+5]=m,t}}U4.prototype.bytesPerElement=12,We("StructArrayLayout2i4i12",U4);class j4 extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,l,p,d)}emplace(t,r,o,l,p,d,m){const _=4*t,x=8*t;return this.int16[_+0]=r,this.int16[_+1]=o,this.uint8[x+4]=l,this.uint8[x+5]=p,this.uint8[x+6]=d,this.uint8[x+7]=m,t}}j4.prototype.bytesPerElement=8,We("StructArrayLayout2i4ub8",j4);class vn extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=o,t}}vn.prototype.bytesPerElement=8,We("StructArrayLayout2f8",vn);class Ss extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d,m,_,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,o,l,p,d,m,_,x,w)}emplace(t,r,o,l,p,d,m,_,x,w,C){const M=10*t;return this.uint16[M+0]=r,this.uint16[M+1]=o,this.uint16[M+2]=l,this.uint16[M+3]=p,this.uint16[M+4]=d,this.uint16[M+5]=m,this.uint16[M+6]=_,this.uint16[M+7]=x,this.uint16[M+8]=w,this.uint16[M+9]=C,t}}Ss.prototype.bytesPerElement=20,We("StructArrayLayout10ui20",Ss);class Ia extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d,m,_,x,w,C,M){const O=this.length;return this.resize(O+1),this.emplace(O,t,r,o,l,p,d,m,_,x,w,C,M)}emplace(t,r,o,l,p,d,m,_,x,w,C,M,O){const N=12*t;return this.int16[N+0]=r,this.int16[N+1]=o,this.int16[N+2]=l,this.int16[N+3]=p,this.uint16[N+4]=d,this.uint16[N+5]=m,this.uint16[N+6]=_,this.uint16[N+7]=x,this.int16[N+8]=w,this.int16[N+9]=C,this.int16[N+10]=M,this.int16[N+11]=O,t}}Ia.prototype.bytesPerElement=24,We("StructArrayLayout4i4ui4i24",Ia);class Cs extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,o)}emplace(t,r,o,l){const p=3*t;return this.float32[p+0]=r,this.float32[p+1]=o,this.float32[p+2]=l,t}}Cs.prototype.bytesPerElement=12,We("StructArrayLayout3f12",Cs);class Oa extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Oa.prototype.bytesPerElement=4,We("StructArrayLayout1ul4",Oa);class H4 extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,o,l,p,d,m,_,x)}emplace(t,r,o,l,p,d,m,_,x,w){const C=10*t,M=5*t;return this.int16[C+0]=r,this.int16[C+1]=o,this.int16[C+2]=l,this.int16[C+3]=p,this.int16[C+4]=d,this.int16[C+5]=m,this.uint32[M+3]=_,this.uint16[C+8]=x,this.uint16[C+9]=w,t}}H4.prototype.bytesPerElement=20,We("StructArrayLayout6i1ul2ui20",H4);class $o extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,l,p,d)}emplace(t,r,o,l,p,d,m){const _=6*t;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=l,this.int16[_+3]=p,this.int16[_+4]=d,this.int16[_+5]=m,t}}$o.prototype.bytesPerElement=12,We("StructArrayLayout2i2i2i12",$o);class wo extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,o,l,p)}emplace(t,r,o,l,p,d){const m=4*t,_=8*t;return this.float32[m+0]=r,this.float32[m+1]=o,this.float32[m+2]=l,this.int16[_+6]=p,this.int16[_+7]=d,t}}wo.prototype.bytesPerElement=16,We("StructArrayLayout2f1f2i16",wo);class V4 extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,l,p,d)}emplace(t,r,o,l,p,d,m){const _=16*t,x=4*t,w=8*t;return this.uint8[_+0]=r,this.uint8[_+1]=o,this.float32[x+1]=l,this.float32[x+2]=p,this.int16[w+6]=d,this.int16[w+7]=m,t}}V4.prototype.bytesPerElement=16,We("StructArrayLayout2ub2f2i16",V4);class Na extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,o)}emplace(t,r,o,l){const p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=o,this.uint16[p+2]=l,t}}Na.prototype.bytesPerElement=6,We("StructArrayLayout3ui6",Na);class To extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$){const ae=this.length;return this.resize(ae+1),this.emplace(ae,t,r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$)}emplace(t,r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$,ae){const K=24*t,I=12*t,j=48*t;return this.int16[K+0]=r,this.int16[K+1]=o,this.uint16[K+2]=l,this.uint16[K+3]=p,this.uint32[I+2]=d,this.uint32[I+3]=m,this.uint32[I+4]=_,this.uint16[K+10]=x,this.uint16[K+11]=w,this.uint16[K+12]=C,this.float32[I+7]=M,this.float32[I+8]=O,this.uint8[j+36]=N,this.uint8[j+37]=z,this.uint8[j+38]=H,this.uint32[I+10]=$,this.int16[K+22]=ae,t}}To.prototype.bytesPerElement=48,We("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",To);class Z4 extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$,ae,K,I,j,Q,_e,De,Te,Pe,Be,ze){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$,ae,K,I,j,Q,_e,De,Te,Pe,Be,ze)}emplace(t,r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$,ae,K,I,j,Q,_e,De,Te,Pe,Be,ze,Ge){const ke=32*t,Ke=16*t;return this.int16[ke+0]=r,this.int16[ke+1]=o,this.int16[ke+2]=l,this.int16[ke+3]=p,this.int16[ke+4]=d,this.int16[ke+5]=m,this.int16[ke+6]=_,this.int16[ke+7]=x,this.uint16[ke+8]=w,this.uint16[ke+9]=C,this.uint16[ke+10]=M,this.uint16[ke+11]=O,this.uint16[ke+12]=N,this.uint16[ke+13]=z,this.uint16[ke+14]=H,this.uint16[ke+15]=$,this.uint16[ke+16]=ae,this.uint16[ke+17]=K,this.uint16[ke+18]=I,this.uint16[ke+19]=j,this.uint16[ke+20]=Q,this.uint16[ke+21]=_e,this.uint16[ke+22]=De,this.uint32[Ke+12]=Te,this.float32[Ke+13]=Pe,this.float32[Ke+14]=Be,this.uint16[ke+30]=ze,this.uint16[ke+31]=Ge,t}}Z4.prototype.bytesPerElement=64,We("StructArrayLayout8i15ui1ul2f2ui64",Z4);class As extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}As.prototype.bytesPerElement=4,We("StructArrayLayout1f4",As);class Es extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,o)}emplace(t,r,o,l){const p=3*t;return this.uint16[6*t+0]=r,this.float32[p+1]=o,this.float32[p+2]=l,t}}Es.prototype.bytesPerElement=12,We("StructArrayLayout1ui2f12",Es);class Y4 extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,o)}emplace(t,r,o,l){const p=4*t;return this.uint32[2*t+0]=r,this.uint16[p+2]=o,this.uint16[p+3]=l,t}}Y4.prototype.bytesPerElement=8,We("StructArrayLayout1ul2ui8",Y4);class h extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=o,t}}h.prototype.bytesPerElement=4,We("StructArrayLayout2ui4",h);class e extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}e.prototype.bytesPerElement=2,We("StructArrayLayout1ui2",e);class i extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,o,l)}emplace(t,r,o,l,p){const d=4*t;return this.float32[d+0]=r,this.float32[d+1]=o,this.float32[d+2]=l,this.float32[d+3]=p,t}}i.prototype.bytesPerElement=16,We("StructArrayLayout4f16",i);class a extends Pa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ce(this.anchorPointX,this.anchorPointY)}}a.prototype.size=20;class s extends H4{get(t){return new a(this,t)}}We("CollisionBoxArray",s);class u extends Pa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}u.prototype.size=48;class f extends To{get(t){return new u(this,t)}}We("PlacedSymbolArray",f);class g extends Pa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}g.prototype.size=64;class y extends Z4{get(t){return new g(this,t)}}We("SymbolInstanceArray",y);class v extends As{getoffsetX(t){return this.float32[1*t+0]}}We("GlyphOffsetArray",v);class A extends ws{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}We("SymbolLineVertexArray",A);class E extends Pa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}E.prototype.size=12;class P extends Es{get(t){return new E(this,t)}}We("TextAnchorOffsetArray",P);class R extends Pa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}R.prototype.size=8;class F extends Y4{get(t){return new R(this,t)}}We("FeatureIndexArray",F);class Y extends Ma{}class Z extends Ma{}class q extends Ma{}class W extends U4{}class ee extends j4{}class ie extends vn{}class re extends Ss{}class le extends Ia{}class oe extends Cs{}class ge extends Oa{}class xe extends $o{}class Oe extends V4{}class Ie extends Na{}class Le extends h{}const Ye=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ue}=Ye;class Ne{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,o,l){const p=this.segments[this.segments.length-1];return t>Ne.MAX_VERTEX_ARRAY_LENGTH&&Kt(`Max vertices per segment is ${Ne.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ne.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+t>Ne.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==l?this.createNewSegment(r,o,l):p}createNewSegment(t,r,o){const l={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(l.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,r,o){return this.prepareSegment(0,t,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,l){return new Ne([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function Qe(n,t){return 256*(n=Fi(Math.floor(n),0,255))+Fi(Math.floor(t),0,255)}Ne.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We("SegmentVector",Ne);const yt=di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Bt,yi,ii,oi={exports:{}},fi={exports:{}},Qt={exports:{}},ai=function(){if(ii)return oi.exports;ii=1;var n=(Bt||(Bt=1,fi.exports=function(r,o){var l,p,d,m,_,x,w,C;for(p=r.length-(l=3&r.length),d=o,_=3432918353,x=461845907,C=0;C<p;)w=255&r.charCodeAt(C)|(255&r.charCodeAt(++C))<<8|(255&r.charCodeAt(++C))<<16|(255&r.charCodeAt(++C))<<24,++C,d=27492+(65535&(m=5*(65535&(d=(d^=w=(65535&(w=(w=(65535&w)*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,l){case 3:w^=(255&r.charCodeAt(C+2))<<16;case 2:w^=(255&r.charCodeAt(C+1))<<8;case 1:d^=w=(65535&(w=(w=(65535&(w^=255&r.charCodeAt(C)))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return d^=r.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),fi.exports),t=(yi||(yi=1,Qt.exports=function(r,o){for(var l,p=r.length,d=o^p,m=0;p>=4;)l=1540483477*(65535&(l=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(l>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),p-=4,++m;switch(p){case 3:d^=(255&r.charCodeAt(m+2))<<16;case 2:d^=(255&r.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&r.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),Qt.exports);return oi.exports=n,oi.exports.murmur3=n,oi.exports.murmur2=t,oi.exports}(),Yi=be(ai);class Di{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,l){this.ids.push(er(t)),this.positions.push(r,o,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=er(t);let o=0,l=this.ids.length-1;for(;o<l;){const d=o+l>>1;this.ids[d]>=r?l=d:o=d+1}const p=[];for(;this.ids[o]===r;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,r){const o=new Float64Array(t.ids),l=new Uint32Array(t.positions);return yr(o,l,0,o.length-1),r&&r.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(t){const r=new Di;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function er(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Yi(String(n))}function yr(n,t,r,o){for(;r<o;){const l=n[r+o>>1];let p=r-1,d=o+1;for(;;){do p++;while(n[p]<l);do d--;while(n[d]>l);if(p>=d)break;Bn(n,p,d),Bn(t,3*p,3*d),Bn(t,3*p+1,3*d+1),Bn(t,3*p+2,3*d+2)}d-r<o-d?(yr(n,t,r,d),r=d+1):(yr(n,t,d+1,o),o=d)}}function Bn(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}We("FeaturePositionMap",Di);class en{constructor(t,r){this.gl=t.gl,this.location=r}}class Fn extends en{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class So extends en{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ka extends en{constructor(t,r){super(t,r),this.current=St.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ls=new Float32Array(16);function io(n){return[Qe(255*n.r,255*n.g),Qe(255*n.b,255*n.a)]}class xr{constructor(t,r,o){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new ka(t,r):new Fn(t,r)}}class tn{constructor(t,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,l){const p=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new So(t,r):new Fn(t,r)}}class Mr{constructor(t,r,o,l){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,o,l,p){const d=this.paintVertexArray.length,m=this.expression.evaluate(new pi(0),r,{},l,[],p);this.paintVertexArray.resize(t),this._setPaintValue(d,t,m)}updatePaintArray(t,r,o,l){const p=this.expression.evaluate({zoom:0},o,l);this._setPaintValue(t,r,p)}_setPaintValue(t,r,o){if(this.type==="color"){const l=io(o);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ir{constructor(t,r,o,l,p,d){this.expression=t,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=o,this.useIntegerZoom=l,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,o,l,p){const d=this.expression.evaluate(new pi(this.zoom),r,{},l,[],p),m=this.expression.evaluate(new pi(this.zoom+1),r,{},l,[],p),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,d,m)}updatePaintArray(t,r,o,l){const p=this.expression.evaluate({zoom:this.zoom},o,l),d=this.expression.evaluate({zoom:this.zoom+1},o,l);this._setPaintValue(t,r,p,d)}_setPaintValue(t,r,o,l){if(this.type==="color"){const p=io(o),d=io(l);for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,p[0],p[1],d[0],d[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Fi(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,o){return new Fn(t,r)}}class mi{constructor(t,r,o,l,p,d){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=l,this.layerId=d,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,r,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,l,p){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(t,r,o,l){if(!l||!o)return;const{min:p,mid:d,max:m}=o,_=l[p],x=l[d],w=l[m];if(_&&x&&w)for(let C=t;C<r;C++)this.zoomInPaintVertexArray.emplace(C,x.tl[0],x.tl[1],x.br[0],x.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],x.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,x.tl[0],x.tl[1],x.br[0],x.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],x.pixelRatio,w.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qi{constructor(t,r,o){this.binders={},this._buffers=[];const l=[];for(const p in t.paint._values){if(!o(p))continue;const d=t.paint.get(p);if(!(d instanceof Qr&&jo(d.property.specification)))continue;const m=ir(p,t.type),_=d.value,x=d.property.specification.type,w=d.property.useIntegerZoom,C=d.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven";if(_.kind==="constant")this.binders[p]=M?new tn(_.value,m):new xr(_.value,m,x),l.push(`/u_${p}`);else if(_.kind==="source"||M){const O=al(p,x,"source");this.binders[p]=M?new mi(_,x,w,r,O,t.id):new Mr(_,m,x,O),l.push(`/a_${p}`)}else{const O=al(p,x,"composite");this.binders[p]=new Ir(_,m,x,w,r,O),l.push(`/z_${p}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Mr||r instanceof Ir?r.maxValue:0}populatePaintArrays(t,r,o,l,p){for(const d in this.binders){const m=this.binders[d];(m instanceof Mr||m instanceof Ir||m instanceof mi)&&m.populatePaintArray(t,r,o,l,p)}}setConstantPatternPositions(t,r){for(const o in this.binders){const l=this.binders[o];l instanceof tn&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,l,p){let d=!1;for(const m in t){const _=r.getPositions(m);for(const x of _){const w=o.feature(x.index);for(const C in this.binders){const M=this.binders[C];if((M instanceof Mr||M instanceof Ir||M instanceof mi)&&M.expression.isStateDependent===!0){const O=l.paint.get(C);M.expression=O.value,M.updatePaintArray(x.start,x.end,w,t[m],p),d=!0}}}}return d}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof xr||o instanceof tn)&&t.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Mr||o instanceof Ir)for(let l=0;l<o.paintVertexAttributes.length;l++)t.push(o.paintVertexAttributes[l].name);else if(o instanceof mi)for(let l=0;l<yt.members.length;l++)t.push(yt.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof xr||o instanceof tn||o instanceof Ir)for(const l of o.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof xr||p instanceof tn||p instanceof Ir){for(const d of p.uniformNames)if(r[d]){const m=p.getBinding(t,r[d],d);o.push({name:d,property:l,binding:m})}}}return o}setUniforms(t,r,o,l){for(const{name:p,property:d,binding:m}of r)this.binders[d].setUniform(m,l,o.get(d),p)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof mi){const l=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof Mr||o instanceof Ir)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof Mr||o instanceof Ir||o instanceof mi)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Mr||r instanceof Ir||r instanceof mi)&&r.destroy()}}}class tr{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new qi(l,r,o);this.needsUpload=!1,this._featureMap=new Di,this._bufferOffset=0}populatePaintArrays(t,r,o,l,p,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,p,d);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,l){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,r,p,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ir(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function al(n,t,r){const o={color:{source:vn,composite:i},number:{source:As,composite:vn}},l=function(p){return{"line-pattern":{source:re,composite:re},"fill-pattern":{source:re,composite:re},"fill-extrusion-pattern":{source:re,composite:re}}[p]}(n);return l&&l[r]||o[t][r]}We("ConstantBinder",xr),We("CrossFadedConstantBinder",tn),We("SourceExpressionBinder",Mr),We("CrossFadedCompositeBinder",mi),We("CompositeExpressionBinder",Ir),We("ProgramConfiguration",qi,{omit:["_buffers"]}),We("ProgramConfigurationSet",tr);const q4=Math.pow(2,14)-1,sl=-q4-1;function Co(n){const t=xt/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){const l=r[o];for(let p=0;p<l.length;p++){const d=l[p],m=Math.round(d.x*t),_=Math.round(d.y*t);d.x=Fi(m,sl,q4),d.y=Fi(_,sl,q4),(m<d.x||m>d.x+1||_<d.y||_>d.y+1)&&Kt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ao(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Co(n):[]}}const ll=-32768;function Eo(n,t,r,o,l){n.emplaceBack(ll+8*t+o,ll+8*r+l)}class Ps{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.indexArray=new Ie,this.segments=new Ne,this.programConfigurations=new tr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){const l=this.layers[0],p=[];let d=null,m=!1,_=l.type==="heatmap";if(l.type==="circle"){const w=l;d=w.layout.get("circle-sort-key"),m=!d.isConstant(),_=_||w.paint.get("circle-pitch-alignment")==="map"}const x=_?r.subdivisionGranularity.circle:1;for(const{feature:w,id:C,index:M,sourceLayerIndex:O}of t){const N=this.layers[0]._featureFilter.needGeometry,z=Ao(w,N);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),z,o))continue;const H=m?d.evaluate(z,{},o):void 0,$={id:C,properties:w.properties,type:w.type,sourceLayerIndex:O,index:M,geometry:N?z.geometry:Co(w),patterns:{},sortKey:H};p.push($)}m&&p.sort((w,C)=>w.sortKey-C.sortKey);for(const w of p){const{geometry:C,index:M,sourceLayerIndex:O}=w,N=t[M].feature;this.addFeature(w,C,M,o,x),r.featureIndex.insert(N,C,M,O,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ue),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,l,p=1){let d;switch(p){case 1:d=[0,7];break;case 3:d=[0,2,5,7];break;case 5:d=[0,1,3,4,6,7];break;case 7:d=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const m=d.length;for(const _ of r)for(const x of _){const w=x.x,C=x.y;if(w<0||w>=xt||C<0||C>=xt)continue;const M=this.segments.prepareSegment(m*m,this.layoutVertexArray,this.indexArray,t.sortKey),O=M.vertexLength;for(let N=0;N<m;N++)for(let z=0;z<m;z++)Eo(this.layoutVertexArray,w,C,d[z],d[N]);for(let N=0;N<m-1;N++)for(let z=0;z<m-1;z++){const H=O+N*m+z,$=O+(N+1)*m+z;this.indexArray.emplaceBack(H,$+1,H+1),this.indexArray.emplaceBack(H,$,$+1)}M.vertexLength+=m*m,M.primitiveLength+=(m-1)*(m-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},l)}}function $4(n,t){for(let r=0;r<n.length;r++)if(Is(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Is(n,t[r]))return!0;return!!Ra(n,t)}function cl(n,t,r){return!!Is(n,t)||!!p7(t,n,r)}function Ms(n,t){if(n.length===1)return x9(t,n[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let l=0;l<o.length;l++)if(Is(n,o[l]))return!0}for(let r=0;r<n.length;r++)if(x9(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Ra(n,t[r]))return!0;return!1}function hl(n,t,r){if(n.length>1){if(Ra(n,t))return!0;for(let o=0;o<t.length;o++)if(p7(t[o],n,r))return!0}for(let o=0;o<n.length;o++)if(p7(n[o],t,r))return!0;return!1}function Ra(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],l=n[r+1];for(let p=0;p<t.length-1;p++)if(d2(o,l,t[p],t[p+1]))return!0}return!1}function d2(n,t,r,o){return at(n,r,o)!==at(t,r,o)&&at(n,t,r)!==at(n,t,o)}function p7(n,t,r){const o=r*r;if(t.length===1)return n.distSqr(t[0])<o;for(let l=1;l<t.length;l++)if(y9(n,t[l-1],t[l])<o)return!0;return!1}function y9(n,t,r){const o=t.distSqr(r);if(o===0)return n.distSqr(t);const l=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/o;return n.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function x9(n,t){let r,o,l,p=!1;for(let d=0;d<n.length;d++){r=n[d];for(let m=0,_=r.length-1;m<r.length;_=m++)o=r[m],l=r[_],o.y>t.y!=l.y>t.y&&t.x<(l.x-o.x)*(t.y-o.y)/(l.y-o.y)+o.x&&(p=!p)}return p}function Is(n,t){let r=!1;for(let o=0,l=n.length-1;o<n.length;l=o++){const p=n[o],d=n[l];p.y>t.y!=d.y>t.y&&t.x<(d.x-p.x)*(t.y-p.y)/(d.y-p.y)+p.x&&(r=!r)}return r}function f2(n,t,r){const o=r[0],l=r[2];if(n.x<o.x&&t.x<o.x||n.x>l.x&&t.x>l.x||n.y<o.y&&t.y<o.y||n.y>l.y&&t.y>l.y)return!1;const p=at(n,t,r[0]);return p!==at(n,t,r[1])||p!==at(n,t,r[2])||p!==at(n,t,r[3])}function W4(n,t,r){const o=t.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(n)}function ul(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function pl(n,t,r,o,l){if(!t[0]&&!t[1])return n;const p=Ce.convert(t)._mult(l);r==="viewport"&&p._rotate(-o);const d=[];for(let m=0;m<n.length;m++)d.push(n[m].sub(p));return d}let v9,b9;We("CircleBucket",Ps,{omit:["layers"]});var m2={get paint(){return b9=b9||new Pr({"circle-radius":new pt(V.paint_circle["circle-radius"]),"circle-color":new pt(V.paint_circle["circle-color"]),"circle-blur":new pt(V.paint_circle["circle-blur"]),"circle-opacity":new pt(V.paint_circle["circle-opacity"]),"circle-translate":new rt(V.paint_circle["circle-translate"]),"circle-translate-anchor":new rt(V.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rt(V.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rt(V.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pt(V.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pt(V.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pt(V.paint_circle["circle-stroke-opacity"])})},get layout(){return v9=v9||new Pr({"circle-sort-key":new pt(V.layout_circle["circle-sort-key"])})}};class g2 extends zn{constructor(t){super(t,m2)}createBucket(t){return new Ps(t)}queryRadius(t){const r=t;return W4("circle-radius",this,r)+W4("circle-stroke-width",this,r)+ul(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:l,transform:p,pixelsToTileUnits:d,pixelPosMatrix:m}){const _=pl(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,d),x=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),w=this.paint.get("circle-pitch-alignment")==="map",C=w?_:function(O,N){return O.map(z=>w9(z,N))}(_,m),M=w?x*d:x;for(const O of l)for(const N of O){const z=w?N:w9(N,m);let H=M;const $=si([],[N.x,N.y,0,1],m);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?H*=$[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(H*=p.cameraToCenterDistance/$[3]),cl(C,z,H))return!0}return!1}}function w9(n,t){const r=si([],[n.x,n.y,0,1],t);return new Ce(r[0]/r[3],r[1]/r[3])}class T9 extends Ps{}let S9;We("HeatmapBucket",T9,{omit:["layers"]});var _2={get paint(){return S9=S9||new Pr({"heatmap-radius":new pt(V.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pt(V.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rt(V.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bs(V.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rt(V.paint_heatmap["heatmap-opacity"])})}};function d7(n,{width:t,height:r},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*o}`)}else l=new Uint8Array(t*r*o);return n.width=t,n.height=r,n.data=l,n}function C9(n,{width:t,height:r},o){if(t===n.width&&r===n.height)return;const l=d7({},{width:t,height:r},o);f7(n,l,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},o),n.width=t,n.height=r,n.data=l.data}function f7(n,t,r,o,l,p){if(l.width===0||l.height===0)return t;if(l.width>n.width||l.height>n.height||r.x>n.width-l.width||r.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||o.x>t.width-l.width||o.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const d=n.data,m=t.data;if(d===m)throw new Error("srcData equals dstData, so image is already copied");for(let _=0;_<l.height;_++){const x=((r.y+_)*n.width+r.x)*p,w=((o.y+_)*t.width+o.x)*p;for(let C=0;C<l.width*p;C++)m[w+C]=d[x+C]}return t}class X4{constructor(t,r){d7(this,t,1,r)}resize(t){C9(this,t,1)}clone(){return new X4({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,l,p){f7(t,r,o,l,p,1)}}class bn{constructor(t,r){d7(this,t,4,r)}resize(t){C9(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new bn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,l,p){f7(t,r,o,l,p,4)}}function A9(n){const t={},r=n.resolution||256,o=n.clips?n.clips.length:1,l=n.image||new bn({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(d,m,_)=>{t[n.evaluationKey]=_;const x=n.expression.evaluate(t);l.data[d+m+0]=Math.floor(255*x.r/x.a),l.data[d+m+1]=Math.floor(255*x.g/x.a),l.data[d+m+2]=Math.floor(255*x.b/x.a),l.data[d+m+3]=Math.floor(255*x.a)};if(n.clips)for(let d=0,m=0;d<o;++d,m+=4*r)for(let _=0,x=0;_<r;_++,x+=4){const w=_/(r-1),{start:C,end:M}=n.clips[d];p(m,x,C*(1-w)+M*w)}else for(let d=0,m=0;d<r;d++,m+=4)p(0,m,d/(r-1));return l}We("AlphaImage",X4),We("RGBAImage",bn);const m7="big-fb";class y2 extends zn{createBucket(t){return new T9(t)}constructor(t){super(t,_2),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=A9({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(m7)&&this.heatmapFbos.delete(m7)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let E9;var x2={get paint(){return E9=E9||new Pr({"hillshade-illumination-direction":new rt(V.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rt(V.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rt(V.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rt(V.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rt(V.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rt(V.paint_hillshade["hillshade-accent-color"])})}};class v2 extends zn{constructor(t){super(t,x2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const b2=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:w2}=b2;function g7(n,t,r){const o=r.patternDependencies;let l=!1;for(const p of t){const d=p.paint.get(`${n}-pattern`);d.isConstant()||(l=!0);const m=d.constantOr(null);m&&(l=!0,o[m.to]=!0,o[m.from]=!0)}return l}function _7(n,t,r,o,l){const p=l.patternDependencies;for(const d of t){const m=d.paint.get(`${n}-pattern`).value;if(m.kind!=="constant"){let _=m.evaluate({zoom:o-1},r,{},l.availableImages),x=m.evaluate({zoom:o},r,{},l.availableImages),w=m.evaluate({zoom:o+1},r,{},l.availableImages);_=_&&_.name?_.name:_,x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,p[_]=!0,p[x]=!0,p[w]=!0,r.patterns[d.id]={min:_,mid:x,max:w}}}return r}function L9(n,t,r,o,l){let p;if(l===function(d,m,_,x){let w=0;for(let C=m,M=_-x;C<_;C+=x)w+=(d[M]-d[C])*(d[C+1]+d[M+1]),M=C;return w}(n,t,r,o)>0)for(let d=t;d<r;d+=o)p=O9(d/o|0,n[d],n[d+1],p);else for(let d=r-o;d>=t;d-=o)p=O9(d/o|0,n[d],n[d+1],p);return p&&Os(p,p.next)&&(e3(p),p=p.next),p}function Da(n,t){if(!n)return n;t||(t=n);let r,o=n;do if(r=!1,o.steiner||!Os(o,o.next)&&zi(o.prev,o,o.next)!==0)o=o.next;else{if(e3(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function K4(n,t,r,o,l,p,d){if(!n)return;!d&&p&&function(_,x,w,C){let M=_;do M.z===0&&(M.z=y7(M.x,M.y,x,w,C)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==_);M.prevZ.nextZ=null,M.prevZ=null,function(O){let N,z=1;do{let H,$=O;O=null;let ae=null;for(N=0;$;){N++;let K=$,I=0;for(let Q=0;Q<z&&(I++,K=K.nextZ,K);Q++);let j=z;for(;I>0||j>0&&K;)I!==0&&(j===0||!K||$.z<=K.z)?(H=$,$=$.nextZ,I--):(H=K,K=K.nextZ,j--),ae?ae.nextZ=H:O=H,H.prevZ=ae,ae=H;$=K}ae.nextZ=null,z*=2}while(N>1)}(M)}(n,o,l,p);let m=n;for(;n.prev!==n.next;){const _=n.prev,x=n.next;if(p?S2(n,o,l,p):T2(n))t.push(_.i,n.i,x.i),e3(n),n=x.next,m=x.next;else if((n=x)===m){d?d===1?K4(n=C2(Da(n),t),t,r,o,l,p,2):d===2&&A2(n,t,r,o,l,p):K4(Da(n),t,r,o,l,p,1);break}}}function T2(n){const t=n.prev,r=n,o=n.next;if(zi(t,r,o)>=0)return!1;const l=t.x,p=r.x,d=o.x,m=t.y,_=r.y,x=o.y,w=Math.min(l,p,d),C=Math.min(m,_,x),M=Math.max(l,p,d),O=Math.max(m,_,x);let N=o.next;for(;N!==t;){if(N.x>=w&&N.x<=M&&N.y>=C&&N.y<=O&&J4(l,m,p,_,d,x,N.x,N.y)&&zi(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function S2(n,t,r,o){const l=n.prev,p=n,d=n.next;if(zi(l,p,d)>=0)return!1;const m=l.x,_=p.x,x=d.x,w=l.y,C=p.y,M=d.y,O=Math.min(m,_,x),N=Math.min(w,C,M),z=Math.max(m,_,x),H=Math.max(w,C,M),$=y7(O,N,t,r,o),ae=y7(z,H,t,r,o);let K=n.prevZ,I=n.nextZ;for(;K&&K.z>=$&&I&&I.z<=ae;){if(K.x>=O&&K.x<=z&&K.y>=N&&K.y<=H&&K!==l&&K!==d&&J4(m,w,_,C,x,M,K.x,K.y)&&zi(K.prev,K,K.next)>=0||(K=K.prevZ,I.x>=O&&I.x<=z&&I.y>=N&&I.y<=H&&I!==l&&I!==d&&J4(m,w,_,C,x,M,I.x,I.y)&&zi(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;K&&K.z>=$;){if(K.x>=O&&K.x<=z&&K.y>=N&&K.y<=H&&K!==l&&K!==d&&J4(m,w,_,C,x,M,K.x,K.y)&&zi(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;I&&I.z<=ae;){if(I.x>=O&&I.x<=z&&I.y>=N&&I.y<=H&&I!==l&&I!==d&&J4(m,w,_,C,x,M,I.x,I.y)&&zi(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function C2(n,t){let r=n;do{const o=r.prev,l=r.next.next;!Os(o,l)&&M9(o,r,r.next,l)&&Q4(o,l)&&Q4(l,o)&&(t.push(o.i,r.i,l.i),e3(r),e3(r.next),r=n=l),r=r.next}while(r!==n);return Da(r)}function A2(n,t,r,o,l,p){let d=n;do{let m=d.next.next;for(;m!==d.prev;){if(d.i!==m.i&&I2(d,m)){let _=I9(d,m);return d=Da(d,d.next),_=Da(_,_.next),K4(d,t,r,o,l,p,0),void K4(_,t,r,o,l,p,0)}m=m.next}d=d.next}while(d!==n)}function E2(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function L2(n,t){const r=function(l,p){let d=p;const m=l.x,_=l.y;let x,w=-1/0;if(Os(l,d))return d;do{if(Os(l,d.next))return d.next;if(_<=d.y&&_>=d.next.y&&d.next.y!==d.y){const z=d.x+(_-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(z<=m&&z>w&&(w=z,x=d.x<d.next.x?d:d.next,z===m))return x}d=d.next}while(d!==p);if(!x)return null;const C=x,M=x.x,O=x.y;let N=1/0;d=x;do{if(m>=d.x&&d.x>=M&&m!==d.x&&P9(_<O?m:w,_,M,O,_<O?w:m,_,d.x,d.y)){const z=Math.abs(_-d.y)/(m-d.x);Q4(d,l)&&(z<N||z===N&&(d.x>x.x||d.x===x.x&&P2(x,d)))&&(x=d,N=z)}d=d.next}while(d!==C);return x}(n,t);if(!r)return t;const o=I9(r,n);return Da(o,o.next),Da(r,r.next)}function P2(n,t){return zi(n.prev,n,t.prev)<0&&zi(t.next,n,n.next)<0}function y7(n,t,r,o,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function M2(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function P9(n,t,r,o,l,p,d,m){return(l-d)*(t-m)>=(n-d)*(p-m)&&(n-d)*(o-m)>=(r-d)*(t-m)&&(r-d)*(p-m)>=(l-d)*(o-m)}function J4(n,t,r,o,l,p,d,m){return!(n===d&&t===m)&&P9(n,t,r,o,l,p,d,m)}function I2(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,o){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==o.i&&l.next.i!==o.i&&M9(l,l.next,r,o))return!0;l=l.next}while(l!==r);return!1}(n,t)&&(Q4(n,t)&&Q4(t,n)&&function(r,o){let l=r,p=!1;const d=(r.x+o.x)/2,m=(r.y+o.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&d<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(p=!p),l=l.next;while(l!==r);return p}(n,t)&&(zi(n.prev,n,t.prev)||zi(n,t.prev,t))||Os(n,t)&&zi(n.prev,n,n.next)>0&&zi(t.prev,t,t.next)>0)}function zi(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function Os(n,t){return n.x===t.x&&n.y===t.y}function M9(n,t,r,o){const l=fl(zi(n,t,r)),p=fl(zi(n,t,o)),d=fl(zi(r,o,n)),m=fl(zi(r,o,t));return l!==p&&d!==m||!(l!==0||!dl(n,r,t))||!(p!==0||!dl(n,o,t))||!(d!==0||!dl(r,n,o))||!(m!==0||!dl(r,t,o))}function dl(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function fl(n){return n>0?1:n<0?-1:0}function Q4(n,t){return zi(n.prev,n,n.next)<0?zi(n,t,n.next)>=0&&zi(n,n.prev,t)>=0:zi(n,t,n.prev)<0||zi(n,n.next,t)<0}function I9(n,t){const r=x7(n.i,n.x,n.y),o=x7(t.i,t.x,t.y),l=n.next,p=t.prev;return n.next=t,t.prev=n,r.next=l,l.prev=r,o.next=r,r.prev=o,p.next=o,o.prev=p,o}function O9(n,t,r,o){const l=x7(n,t,r);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function e3(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function x7(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ns{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class ml{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}ml.noSubdivision=new ml({fill:new Ns(0,0),line:new Ns(0,0),tile:new Ns(0,0),stencil:new Ns(0,0),circle:1}),We("SubdivisionGranularityExpression",Ns),We("SubdivisionGranularitySetting",ml);const ks=-32768,t3=32767;class O2{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=xt/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|(r+=32768)<<0}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),l=0|Math.round(r),p=this._getKey(o,l);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const d=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,d),this._vertexBuffer.push(o,l),d}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(l,p){const d=[];for(let m=0;m<p.length;m+=3){const _=p[m],x=p[m+1],w=p[m+2],C=l[2*_],M=l[2*_+1];(l[2*x]-C)*(l[2*w+1]-M)-(l[2*x+1]-M)*(l[2*w]-C)>0?(d.push(_),d.push(w),d.push(x)):(d.push(_),d.push(x),d.push(w))}return d}(this._vertexBuffer,t);const r=[],o=t.length;for(let l=0;l<o;l+=3){const p=[t[l+0],t[l+1],t[l+2]],d=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]];let m=1/0,_=1/0,x=-1/0,w=-1/0;for(let z=0;z<3;z++){const H=d[2*z],$=d[2*z+1];m=Math.min(m,H),x=Math.max(x,H),_=Math.min(_,$),w=Math.max(w,$)}if(m===x||_===w)continue;const C=Math.floor(m/this._granularityCellSize),M=Math.ceil(x/this._granularityCellSize),O=Math.floor(_/this._granularityCellSize),N=Math.ceil(w/this._granularityCellSize);if(C!==M||O!==N)for(let z=O;z<N;z++){const H=this._scanlineGenerateVertexRingForCellRow(z,d,p);N2(this._vertexBuffer,H,r)}else r.push(...p)}return r}_scanlineGenerateVertexRingForCellRow(t,r,o){const l=t*this._granularityCellSize,p=l+this._granularityCellSize,d=[];for(let m=0;m<3;m++){const _=r[2*m],x=r[2*m+1],w=r[2*(m+1)%6],C=r[(2*(m+1)+1)%6],M=r[2*(m+2)%6],O=r[(2*(m+2)+1)%6],N=w-_,z=C-x,H=N===0,$=z===0,ae=(l-x)/z,K=(p-x)/z,I=Math.min(ae,K),j=Math.max(ae,K);if(!$&&(I>=1||j<=0)||$&&(x<l||x>p)){C>=l&&C<=p&&d.push(o[(m+1)%3]);continue}!$&&I>0&&d.push(this._vertexToIndex(_+N*I,x+z*I));const Q=_+N*Math.max(I,0),_e=_+N*Math.min(j,1);H||this._generateIntraEdgeVertices(d,_,x,w,C,Q,_e),!$&&j<1&&d.push(this._vertexToIndex(_+N*j,x+z*j)),($||C>=l&&C<=p)&&d.push(o[(m+1)%3]),!$&&(C<=l||C>=p)&&this._generateInterEdgeVertices(d,_,x,w,C,M,O,_e,l,p)}return d}_generateIntraEdgeVertices(t,r,o,l,p,d,m){const _=l-r,x=p-o,w=x===0,C=w?Math.min(r,l):Math.min(d,m),M=w?Math.max(r,l):Math.max(d,m),O=Math.floor(C/this._granularityCellSize)+1,N=Math.ceil(M/this._granularityCellSize)-1;if(w?r<l:d<m)for(let z=O;z<=N;z++){const H=z*this._granularityCellSize;t.push(this._vertexToIndex(H,o+x*(H-r)/_))}else for(let z=N;z>=O;z--){const H=z*this._granularityCellSize;t.push(this._vertexToIndex(H,o+x*(H-r)/_))}}_generateInterEdgeVertices(t,r,o,l,p,d,m,_,x,w){const C=p-o,M=d-l,O=m-p,N=(x-p)/O,z=(w-p)/O,H=Math.min(N,z),$=Math.max(N,z),ae=l+M*H;let K=Math.floor(Math.min(ae,_)/this._granularityCellSize)+1,I=Math.ceil(Math.max(ae,_)/this._granularityCellSize)-1,j=_<ae;const Q=O===0;if(Q&&(m===x||m===w))return;if(Q||H>=1||$<=0){const De=o-m,Te=d+(r-d)*Math.min((x-m)/De,(w-m)/De);K=Math.floor(Math.min(Te,_)/this._granularityCellSize)+1,I=Math.ceil(Math.max(Te,_)/this._granularityCellSize)-1,j=_<Te}const _e=C>0?w:x;if(j)for(let De=K;De<=I;De++)t.push(this._vertexToIndex(De*this._granularityCellSize,_e));else for(let De=I;De>=K;De--)t.push(this._vertexToIndex(De*this._granularityCellSize,_e))}_generateOutline(t){const r=[];for(const o of t){const l=za(o,this._granularity,!0),p=this._pointArrayToIndices(l),d=[];for(let m=1;m<p.length;m++)d.push(p[m-1]),d.push(p[m]);r.push(d)}return r}_handlePoles(t){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(t,r,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const o=t[r+1];o===ks&&(t[r+1]=-32767),o===t3&&(t[r+1]=32766)}}_generatePoleQuad(t,r,o,l,p,d){l>p!=(d===ks)?(t.push(r),t.push(o),t.push(this._vertexToIndex(l,d)),t.push(o),t.push(this._vertexToIndex(p,d)),t.push(this._vertexToIndex(l,d))):(t.push(o),t.push(r),t.push(this._vertexToIndex(l,d)),t.push(this._vertexToIndex(p,d)),t.push(o),t.push(this._vertexToIndex(l,d)))}_fillPoles(t,r,o){const l=this._vertexBuffer,p=xt,d=t.length;for(let m=2;m<d;m+=3){const _=t[m-2],x=t[m-1],w=t[m],C=l[2*_],M=l[2*_+1],O=l[2*x],N=l[2*x+1],z=l[2*w],H=l[2*w+1];r&&(M===0&&N===0&&this._generatePoleQuad(t,_,x,C,O,ks),N===0&&H===0&&this._generatePoleQuad(t,x,w,O,z,ks),H===0&&M===0&&this._generatePoleQuad(t,w,_,z,C,ks)),o&&(M===p&&N===p&&this._generatePoleQuad(t,_,x,C,O,t3),N===p&&H===p&&this._generatePoleQuad(t,x,w,O,z,t3),H===p&&M===p&&this._generatePoleQuad(t,w,_,z,C,t3))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:l}=function(m){const _=[],x=[];for(const w of m)if(w.length!==0){w!==m[0]&&_.push(x.length/2);for(let C=0;C<w.length;C++)x.push(w[C].x),x.push(w[C].y)}return{flattened:x,holeIndices:_}}(t);let p;this._initializeVertices(o);try{const m=function(x,w,C=2){const M=w&&w.length,O=M?w[0]*C:x.length;let N=L9(x,0,O,C,!0);const z=[];if(!N||N.next===N.prev)return z;let H,$,ae;if(M&&(N=function(K,I,j,Q){const _e=[];for(let De=0,Te=I.length;De<Te;De++){const Pe=L9(K,I[De]*Q,De<Te-1?I[De+1]*Q:K.length,Q,!1);Pe===Pe.next&&(Pe.steiner=!0),_e.push(M2(Pe))}_e.sort(E2);for(let De=0;De<_e.length;De++)j=L2(_e[De],j);return j}(x,w,N,C)),x.length>80*C){H=1/0,$=1/0;let K=-1/0,I=-1/0;for(let j=C;j<O;j+=C){const Q=x[j],_e=x[j+1];Q<H&&(H=Q),_e<$&&($=_e),Q>K&&(K=Q),_e>I&&(I=_e)}ae=Math.max(K-H,I-$),ae=ae!==0?32767/ae:0}return K4(N,z,C,H,$,ae,0),z}(o,l),_=this._convertIndices(o,m);p=this._subdivideTrianglesScanline(_)}catch(m){console.error(m)}let d=[];return r&&(d=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:d}}_convertIndices(t,r){const o=[];for(let l=0;l<r.length;l++)o.push(this._vertexToIndex(t[2*r[l]],t[2*r[l]+1]));return o}_pointArrayToIndices(t){const r=[];for(let o=0;o<t.length;o++){const l=t[o];r.push(this._vertexToIndex(l.x,l.y))}return r}}function N9(n,t,r,o=!0){return new O2(r,t).subdividePolygonInternal(n,o)}function za(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],l=n[n.length-1],p=r&&(o.x!==l.x||o.y!==l.y);if(t<2)return p?[...n,n[0]]:[...n];const d=Math.floor(xt/t),m=[];m.push(new Ce(n[0].x,n[0].y));const _=n.length,x=p?_:_-1;for(let w=0;w<x;w++){const C=n[w],M=w<_-1?n[w+1]:n[0],O=C.x,N=C.y,z=M.x,H=M.y,$=O!==z,ae=N!==H;if(!$&&!ae)continue;const K=z-O,I=H-N,j=Math.abs(K),Q=Math.abs(I);let _e=O,De=N;for(;;){const Pe=K>0?(Math.floor(_e/d)+1)*d:(Math.ceil(_e/d)-1)*d,Be=I>0?(Math.floor(De/d)+1)*d:(Math.ceil(De/d)-1)*d,ze=Math.abs(_e-Pe),Ge=Math.abs(De-Be),ke=Math.abs(_e-z),Ke=Math.abs(De-H),ht=$?ze/j:Number.POSITIVE_INFINITY,lt=ae?Ge/Q:Number.POSITIVE_INFINITY;if((ke<=ze||!$)&&(Ke<=Ge||!ae))break;if(ht<lt&&$||!ae){_e=Pe,De+=I*ht;const tt=new Ce(_e,Math.round(De));m[m.length-1].x===tt.x&&m[m.length-1].y===tt.y||m.push(tt)}else{_e+=K*lt,De=Be;const tt=new Ce(Math.round(_e),De);m[m.length-1].x===tt.x&&m[m.length-1].y===tt.y||m.push(tt)}}const Te=new Ce(z,H);m[m.length-1].x===Te.x&&m[m.length-1].y===Te.y||m.push(Te)}return m}function N2(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,l=n[2*t[0]];for(let _=1;_<t.length;_++){const x=n[2*t[_]];x<l&&(l=x,o=_)}const p=t.length;let d=o,m=(d+1)%p;for(;;){const _=d-1>=0?d-1:p-1,x=(m+1)%p,w=n[2*t[_]],C=n[2*t[x]],M=n[2*t[d]],O=n[2*t[d]+1],N=n[2*t[m]+1];let z=!1;if(w<C)z=!0;else if(w>C)z=!1;else{const H=N-O,$=-(n[2*t[m]]-M),ae=O<N?1:-1;((w-M)*H+(n[2*t[_]+1]-O)*$)*ae>((C-M)*H+(n[2*t[x]+1]-O)*$)*ae&&(z=!0)}if(z){const H=t[_],$=t[d],ae=t[m];H!==$&&H!==ae&&$!==ae&&r.push(ae,$,H),d--,d<0&&(d=p-1)}else{const H=t[x],$=t[d],ae=t[m];H!==$&&H!==ae&&$!==ae&&r.push(ae,$,H),m++,m>=p&&(m=0)}if(_===x)break}}function k9(n,t,r,o,l,p,d,m,_){const x=l.length/2,w=d&&m&&_;if(x<Ne.MAX_VERTEX_ARRAY_LENGTH){const C=t.prepareSegment(x,r,o),M=C.vertexLength;for(let z=0;z<p.length;z+=3)o.emplaceBack(M+p[z],M+p[z+1],M+p[z+2]);let O,N;C.vertexLength+=x,C.primitiveLength+=p.length/3,w&&(N=d.prepareSegment(x,r,m),O=N.vertexLength,N.vertexLength+=x);for(let z=0;z<l.length;z+=2)n(l[z],l[z+1]);if(w)for(let z=0;z<_.length;z++){const H=_[z];for(let $=1;$<H.length;$+=2)m.emplaceBack(O+H[$-1],O+H[$]);N.primitiveLength+=H.length/2}}else(function(C,M,O,N,z,H){const $=[];for(let Q=0;Q<N.length/2;Q++)$.push(-1);const ae={count:0};let K=0,I=C.getOrCreateLatestSegment(M,O),j=I.vertexLength;for(let Q=2;Q<z.length;Q+=3){const _e=z[Q-2],De=z[Q-1],Te=z[Q];let Pe=$[_e]<K,Be=$[De]<K,ze=$[Te]<K;I.vertexLength+((Pe?1:0)+(Be?1:0)+(ze?1:0))>Ne.MAX_VERTEX_ARRAY_LENGTH&&(I=C.createNewSegment(M,O),K=ae.count,Pe=!0,Be=!0,ze=!0,j=0);const Ge=i3($,N,H,ae,_e,Pe,I),ke=i3($,N,H,ae,De,Be,I),Ke=i3($,N,H,ae,Te,ze,I);O.emplaceBack(j+Ge-K,j+ke-K,j+Ke-K),I.primitiveLength++}})(t,r,o,l,p,n),w&&function(C,M,O,N,z,H){const $=[];for(let Q=0;Q<N.length/2;Q++)$.push(-1);const ae={count:0};let K=0,I=C.getOrCreateLatestSegment(M,O),j=I.vertexLength;for(let Q=0;Q<z.length;Q++){const _e=z[Q];for(let De=1;De<z[Q].length;De+=2){const Te=_e[De-1],Pe=_e[De];let Be=$[Te]<K,ze=$[Pe]<K;I.vertexLength+((Be?1:0)+(ze?1:0))>Ne.MAX_VERTEX_ARRAY_LENGTH&&(I=C.createNewSegment(M,O),K=ae.count,Be=!0,ze=!0,j=0);const Ge=i3($,N,H,ae,Te,Be,I),ke=i3($,N,H,ae,Pe,ze,I);O.emplaceBack(j+Ge-K,j+ke-K),I.primitiveLength++}}}(d,r,m,l,_,n),t.forceNewSegmentOnNextPrepare(),d==null||d.forceNewSegmentOnNextPrepare()}function i3(n,t,r,o,l,p,d){if(p){const m=o.count;return r(t[2*l],t[2*l+1]),n[l]=o.count,o.count++,d.vertexLength++,m}return n[l]}class v7{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new q,this.indexArray=new Ie,this.indexArray2=new Le,this.programConfigurations=new tr(t.layers,t.zoom),this.segments=new Ne,this.segments2=new Ne,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=g7("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),p=!l.isConstant(),d=[];for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of t){const C=this.layers[0]._featureFilter.needGeometry,M=Ao(m,C);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),M,o))continue;const O=p?l.evaluate(M,{},o,r.availableImages):void 0,N={id:_,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:C?M.geometry:Co(m),patterns:{},sortKey:O};d.push(N)}p&&d.sort((m,_)=>m.sortKey-_.sortKey);for(const m of d){const{geometry:_,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){const C=_7("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(m,_,x,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[x].feature,_,x,w,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,w2),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,l,p,d){for(const m of Fo(r,500)){const _=N9(m,l,d.fill.getGranularityForZoomLevel(l.z)),x=this.layoutVertexArray;k9((w,C)=>{x.emplaceBack(w,C)},this.segments,this.layoutVertexArray,this.indexArray,_.verticesFlattened,_.indicesTriangles,this.segments2,this.indexArray2,_.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,l)}}let R9,D9;We("FillBucket",v7,{omit:["layers","patternFeatures"]});var k2={get paint(){return D9=D9||new Pr({"fill-antialias":new rt(V.paint_fill["fill-antialias"]),"fill-opacity":new pt(V.paint_fill["fill-opacity"]),"fill-color":new pt(V.paint_fill["fill-color"]),"fill-outline-color":new pt(V.paint_fill["fill-outline-color"]),"fill-translate":new rt(V.paint_fill["fill-translate"]),"fill-translate-anchor":new rt(V.paint_fill["fill-translate-anchor"]),"fill-pattern":new xs(V.paint_fill["fill-pattern"])})},get layout(){return R9=R9||new Pr({"fill-sort-key":new pt(V.layout_fill["fill-sort-key"])})}};class R2 extends zn{constructor(t){super(t,k2)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new v7(t)}queryRadius(){return ul(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:o,pixelsToTileUnits:l}){return Ms(pl(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,l),r)}isTileClipped(){return!0}}const D2=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),z2=di([{name:"a_centroid",components:2,type:"Int16"}],4),{members:B2}=D2;var b7,z9,w7,B9,T7,F9,G9,gl={};function U9(){if(z9)return b7;z9=1;var n=Ae();function t(l,p,d,m,_){this.properties={},this.extent=d,this.type=0,this._pbf=l,this._geometry=-1,this._keys=m,this._values=_,l.readFields(r,this,p)}function r(l,p,d){l==1?p.id=d.readVarint():l==2?function(m,_){for(var x=m.readVarint()+m.pos;m.pos<x;){var w=_._keys[m.readVarint()],C=_._values[m.readVarint()];_.properties[w]=C}}(d,p):l==3?p.type=d.readVarint():l==4&&(p._geometry=d.pos)}function o(l){for(var p,d,m=0,_=0,x=l.length,w=x-1;_<x;w=_++)m+=((d=l[w]).x-(p=l[_]).x)*(p.y+d.y);return m}return b7=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var p,d=l.readVarint()+l.pos,m=1,_=0,x=0,w=0,C=[];l.pos<d;){if(_<=0){var M=l.readVarint();m=7&M,_=M>>3}if(_--,m===1||m===2)x+=l.readSVarint(),w+=l.readSVarint(),m===1&&(p&&C.push(p),p=[]),p.push(new n(x,w));else{if(m!==7)throw new Error("unknown command "+m);p&&p.push(p[0].clone())}}return p&&C.push(p),C},t.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var p=l.readVarint()+l.pos,d=1,m=0,_=0,x=0,w=1/0,C=-1/0,M=1/0,O=-1/0;l.pos<p;){if(m<=0){var N=l.readVarint();d=7&N,m=N>>3}if(m--,d===1||d===2)(_+=l.readSVarint())<w&&(w=_),_>C&&(C=_),(x+=l.readSVarint())<M&&(M=x),x>O&&(O=x);else if(d!==7)throw new Error("unknown command "+d)}return[w,M,C,O]},t.prototype.toGeoJSON=function(l,p,d){var m,_,x=this.extent*Math.pow(2,d),w=this.extent*l,C=this.extent*p,M=this.loadGeometry(),O=t.types[this.type];function N($){for(var ae=0;ae<$.length;ae++){var K=$[ae];$[ae]=[360*(K.x+w)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+C)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(m=0;m<M.length;m++)z[m]=M[m][0];N(M=z);break;case 2:for(m=0;m<M.length;m++)N(M[m]);break;case 3:for(M=function($){var ae=$.length;if(ae<=1)return[$];for(var K,I,j=[],Q=0;Q<ae;Q++){var _e=o($[Q]);_e!==0&&(I===void 0&&(I=_e<0),I===_e<0?(K&&j.push(K),K=[$[Q]]):K.push($[Q]))}return K&&j.push(K),j}(M),m=0;m<M.length;m++)for(_=0;_<M[m].length;_++)N(M[m][_])}M.length===1?M=M[0]:O="Multi"+O;var H={type:"Feature",geometry:{type:O,coordinates:M},properties:this.properties};return"id"in this&&(H.id=this.id),H},b7}function j9(){if(B9)return w7;B9=1;var n=U9();function t(o,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,l),this.length=this._features.length}function r(o,l,p){o===15?l.version=p.readVarint():o===1?l.name=p.readString():o===5?l.extent=p.readVarint():o===2?l._features.push(p.pos):o===3?l._keys.push(p.readString()):o===4&&l._values.push(function(d){for(var m=null,_=d.readVarint()+d.pos;d.pos<_;){var x=d.readVarint()>>3;m=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return m}(p))}return w7=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var l=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,l,this.extent,this._keys,this._values)},w7}function H9(){return G9||(G9=1,gl.VectorTile=function(){if(F9)return T7;F9=1;var n=j9();function t(r,o,l){if(r===3){var p=new n(l,l.readVarint()+l.pos);p.length&&(o[p.name]=p)}}return T7=function(r,o){this.layers=r.readFields(t,{},o)},T7}(),gl.VectorTileFeature=U9(),gl.VectorTileLayer=j9()),gl}var r3=be(H9());const F2=r3.VectorTileFeature.types,S7=Math.pow(2,13);function n3(n,t,r,o,l,p,d,m){n.emplaceBack(t,r,2*Math.floor(o*S7)+d,l*S7*2,p*S7*2,Math.round(m))}class C7{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new W,this.centroidVertexArray=new Y,this.indexArray=new Ie,this.programConfigurations=new tr(t.layers,t.zoom),this.segments=new Ne,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.features=[],this.hasPattern=g7("fill-extrusion",this.layers,r);for(const{feature:l,id:p,index:d,sourceLayerIndex:m}of t){const _=this.layers[0]._featureFilter.needGeometry,x=Ao(l,_);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),x,o))continue;const w={id:p,sourceLayerIndex:m,index:d,geometry:_?x.geometry:Co(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(_7("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,d,o,{},r.subdivisionGranularity),r.featureIndex.insert(l,w.geometry,d,m,this.index,!0)}}addFeatures(t,r,o){for(const l of this.features){const{geometry:p}=l;this.addFeature(l,p,l.index,r,o,t.subdivisionGranularity)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,B2),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,z2.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,l,p,d){for(const m of Fo(r,500)){const _={x:0,y:0,sampleCount:0},x=this.layoutVertexArray.length;this.processPolygon(_,l,t,m,d);const w=this.layoutVertexArray.length-x,C=Math.floor(_.x/_.sampleCount),M=Math.floor(_.y/_.sampleCount);for(let O=0;O<w;O++)this.centroidVertexArray.emplaceBack(C,M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,l)}processPolygon(t,r,o,l,p){if(l.length<1||V9(l[0]))return;for(const C of l)C.length!==0&&G2(t,C);const d={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},m=p.fill.getGranularityForZoomLevel(r.z),_=F2[o.type]==="Polygon";for(const C of l){if(C.length===0||V9(C))continue;const M=za(C,m,_);this._generateSideFaces(M,d)}if(!_)return;const x=N9(l,r,m,!1),w=this.layoutVertexArray;k9((C,M)=>{n3(w,C,M,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles)}_generateSideFaces(t,r){let o=0;for(let l=1;l<t.length;l++){const p=t[l],d=t[l-1];if(U2(p,d))continue;r.segment.vertexLength+4>Ne.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const m=p.sub(d)._perp()._unit(),_=d.dist(p);o+_>32768&&(o=0),n3(this.layoutVertexArray,p.x,p.y,m.x,m.y,0,0,o),n3(this.layoutVertexArray,p.x,p.y,m.x,m.y,0,1,o),o+=_,n3(this.layoutVertexArray,d.x,d.y,m.x,m.y,0,0,o),n3(this.layoutVertexArray,d.x,d.y,m.x,m.y,0,1,o);const x=r.segment.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function G2(n,t){for(let r=0;r<t.length;r++){const o=t[r];r===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function U2(n,t){return n.x===t.x&&(n.x<0||n.x>xt)||n.y===t.y&&(n.y<0||n.y>xt)}function V9(n){return n.every(t=>t.x<0)||n.every(t=>t.x>xt)||n.every(t=>t.y<0)||n.every(t=>t.y>xt)}let Z9;We("FillExtrusionBucket",C7,{omit:["layers","features"]});var j2={get paint(){return Z9=Z9||new Pr({"fill-extrusion-opacity":new rt(V["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pt(V["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rt(V["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rt(V["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xs(V["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pt(V["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pt(V["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rt(V["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class H2 extends zn{constructor(t){super(t,j2)}createBucket(t){return new C7(t)}queryRadius(){return ul(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:l,transform:p,pixelsToTileUnits:d,pixelPosMatrix:m}){const _=pl(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,d),x=this.paint.get("fill-extrusion-height").evaluate(r,o),w=this.paint.get("fill-extrusion-base").evaluate(r,o),C=function(O,N,z){const H=[];for(const $ of O){const ae=[$.x,$.y,0,1];si(ae,ae,N),H.push(new Ce(ae[0]/ae[3],ae[1]/ae[3]))}return H}(_,m),M=function(O,N,z,H){const $=[],ae=[],K=H[8]*N,I=H[9]*N,j=H[10]*N,Q=H[11]*N,_e=H[8]*z,De=H[9]*z,Te=H[10]*z,Pe=H[11]*z;for(const Be of O){const ze=[],Ge=[];for(const ke of Be){const Ke=ke.x,ht=ke.y,lt=H[0]*Ke+H[4]*ht+H[12],tt=H[1]*Ke+H[5]*ht+H[13],At=H[2]*Ke+H[6]*ht+H[14],Ci=H[3]*Ke+H[7]*ht+H[15],Wi=At+j,cr=Ci+Q,Gn=lt+_e,jr=tt+De,hr=At+Te,br=Ci+Pe,Mi=new Ce((lt+K)/cr,(tt+I)/cr);Mi.z=Wi/cr,ze.push(Mi);const Xi=new Ce(Gn/br,jr/br);Xi.z=hr/br,Ge.push(Xi)}$.push(ze),ae.push(Ge)}return[$,ae]}(l,w,x,m);return function(O,N,z){let H=1/0;Ms(z,N)&&(H=Y9(z,N[0]));for(let $=0;$<N.length;$++){const ae=N[$],K=O[$];for(let I=0;I<ae.length-1;I++){const j=ae[I],Q=[j,ae[I+1],K[I+1],K[I],j];$4(z,Q)&&(H=Math.min(H,Y9(z,Q)))}}return H!==1/0&&H}(M[0],M[1],C)}}function o3(n,t){return n.x*t.x+n.y*t.y}function Y9(n,t){if(n.length===1){let r=0;const o=t[r++];let l;for(;!l||o.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const p=t[r],d=n[0],m=l.sub(o),_=p.sub(o),x=d.sub(o),w=o3(m,m),C=o3(m,_),M=o3(_,_),O=o3(x,m),N=o3(x,_),z=w*M-C*C,H=(M*O-C*N)/z,$=(w*N-C*O)/z,ae=o.z*(1-H-$)+l.z*H+p.z*$;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const V2=di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Z2}=V2,Y2=di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:q2}=Y2,$2=r3.VectorTileFeature.types,W2=Math.cos(Math.PI/180*37.5),q9=Math.pow(2,14)/.5;class A7{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ee,this.layoutVertexArray2=new ie,this.indexArray=new Ie,this.programConfigurations=new tr(t.layers,t.zoom),this.segments=new Ne,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=g7("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),p=!l.isConstant(),d=[];for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of t){const C=this.layers[0]._featureFilter.needGeometry,M=Ao(m,C);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),M,o))continue;const O=p?l.evaluate(M,{},o):void 0,N={id:_,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:C?M.geometry:Co(m),patterns:{},sortKey:O};d.push(N)}p&&d.sort((m,_)=>m.sortKey-_.sortKey);for(const m of d){const{geometry:_,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){const C=_7("line",this.layers,m,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(m,_,x,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[x].feature,_,x,w,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,q2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,l,p,d){const m=this.layers[0].layout,_=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),w=m.get("line-miter-limit"),C=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const M of r)this.addLine(M,t,_,x,w,C,l,d);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,l)}addLine(t,r,o,l,p,d,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=za(t,m?_.line.getGranularityForZoomLevel(m.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<t.length-1;K++)this.totalDistance+=t[K].dist(t[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=$2[r.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let C=0;for(;C<w-1&&t[C].equals(t[C+1]);)C++;if(w<(x?3:2))return;o==="bevel"&&(p=1.05);const M=this.overscaling<=16?15*xt/(512*this.overscaling):0,O=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let N,z,H,$,ae;this.e1=this.e2=-1,x&&(N=t[w-2],ae=t[C].sub(N)._unit()._perp());for(let K=C;K<w;K++){if(H=K===w-1?x?t[C+1]:void 0:t[K+1],H&&t[K].equals(H))continue;ae&&($=ae),N&&(z=N),N=t[K],ae=H?H.sub(N)._unit()._perp():$,$=$||ae;let I=$.add(ae);I.x===0&&I.y===0||I._unit();const j=$.x*ae.x+$.y*ae.y,Q=I.x*ae.x+I.y*ae.y,_e=Q!==0?1/Q:1/0,De=2*Math.sqrt(2-2*Q),Te=Q<W2&&z&&H,Pe=$.x*ae.y-$.y*ae.x>0;if(Te&&K>C){const Ge=N.dist(z);if(Ge>2*M){const ke=N.sub(N.sub(z)._mult(M/Ge)._round());this.updateDistance(z,ke),this.addCurrentVertex(ke,$,0,0,O),z=ke}}const Be=z&&H;let ze=Be?o:x?"butt":l;if(Be&&ze==="round"&&(_e<d?ze="miter":_e<=2&&(ze="fakeround")),ze==="miter"&&_e>p&&(ze="bevel"),ze==="bevel"&&(_e>2&&(ze="flipbevel"),_e<p&&(ze="miter")),z&&this.updateDistance(z,N),ze==="miter")I._mult(_e),this.addCurrentVertex(N,I,0,0,O);else if(ze==="flipbevel"){if(_e>100)I=ae.mult(-1);else{const Ge=_e*$.add(ae).mag()/$.sub(ae).mag();I._perp()._mult(Ge*(Pe?-1:1))}this.addCurrentVertex(N,I,0,0,O),this.addCurrentVertex(N,I.mult(-1),0,0,O)}else if(ze==="bevel"||ze==="fakeround"){const Ge=-Math.sqrt(_e*_e-1),ke=Pe?Ge:0,Ke=Pe?0:Ge;if(z&&this.addCurrentVertex(N,$,ke,Ke,O),ze==="fakeround"){const ht=Math.round(180*De/Math.PI/20);for(let lt=1;lt<ht;lt++){let tt=lt/ht;if(tt!==.5){const Ci=tt-.5;tt+=tt*Ci*(tt-1)*((1.0904+j*(j*(3.55645-1.43519*j)-3.2452))*Ci*Ci+(.848013+j*(.215638*j-1.06021)))}const At=ae.sub($)._mult(tt)._add($)._unit()._mult(Pe?-1:1);this.addHalfVertex(N,At.x,At.y,!1,Pe,0,O)}}H&&this.addCurrentVertex(N,ae,-ke,-Ke,O)}else if(ze==="butt")this.addCurrentVertex(N,I,0,0,O);else if(ze==="square"){const Ge=z?1:-1;this.addCurrentVertex(N,I,Ge,Ge,O)}else ze==="round"&&(z&&(this.addCurrentVertex(N,$,0,0,O),this.addCurrentVertex(N,$,1,1,O,!0)),H&&(this.addCurrentVertex(N,ae,-1,-1,O,!0),this.addCurrentVertex(N,ae,0,0,O)));if(Te&&K<w-1){const Ge=N.dist(H);if(Ge>2*M){const ke=N.add(H.sub(N)._mult(M/Ge)._round());this.updateDistance(N,ke),this.addCurrentVertex(ke,ae,0,0,O),N=ke}}}}addCurrentVertex(t,r,o,l,p,d=!1){const m=r.y*l-r.x,_=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,d,!1,o,p),this.addHalfVertex(t,m,_,d,!0,-l,p),this.distance>q9/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,l,p,d))}addHalfVertex({x:t,y:r},o,l,p,d,m,_){const x=.5*(this.lineClips?this.scaledDistance*(q9-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(d?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const w=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,w,this.e2),_.primitiveLength++),d?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let $9,W9;We("LineBucket",A7,{omit:["layers","patternFeatures"]});var X9={get paint(){return W9=W9||new Pr({"line-opacity":new pt(V.paint_line["line-opacity"]),"line-color":new pt(V.paint_line["line-color"]),"line-translate":new rt(V.paint_line["line-translate"]),"line-translate-anchor":new rt(V.paint_line["line-translate-anchor"]),"line-width":new pt(V.paint_line["line-width"]),"line-gap-width":new pt(V.paint_line["line-gap-width"]),"line-offset":new pt(V.paint_line["line-offset"]),"line-blur":new pt(V.paint_line["line-blur"]),"line-dasharray":new vs(V.paint_line["line-dasharray"]),"line-pattern":new xs(V.paint_line["line-pattern"]),"line-gradient":new bs(V.paint_line["line-gradient"])})},get layout(){return $9=$9||new Pr({"line-cap":new rt(V.layout_line["line-cap"]),"line-join":new pt(V.layout_line["line-join"]),"line-miter-limit":new rt(V.layout_line["line-miter-limit"]),"line-round-limit":new rt(V.layout_line["line-round-limit"]),"line-sort-key":new pt(V.layout_line["line-sort-key"])})}};class X2 extends pt{possiblyEvaluate(t,r){return r=new pi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,l){return r=ci({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,l)}}let _l;class K2 extends zn{constructor(t){super(t,X9),this.gradientVersion=0,_l||(_l=new X2(X9.paint.properties["line-width"].specification),_l.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Do,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=_l.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new A7(t)}queryRadius(t){const r=t,o=K9(W4("line-width",this,r),W4("line-gap-width",this,r)),l=W4("line-offset",this,r);return o/2+Math.abs(l)+ul(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:l,transform:p,pixelsToTileUnits:d}){const m=pl(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,d),_=d/2*K9(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),x=this.paint.get("line-offset").evaluate(r,o);return x&&(l=function(w,C){const M=[];for(let O=0;O<w.length;O++){const N=w[O],z=[];for(let H=0;H<N.length;H++){const $=N[H-1],ae=N[H],K=N[H+1],I=H===0?new Ce(0,0):ae.sub($)._unit()._perp(),j=H===N.length-1?new Ce(0,0):K.sub(ae)._unit()._perp(),Q=I._add(j)._unit(),_e=Q.x*j.x+Q.y*j.y;_e!==0&&Q._mult(1/_e),z.push(Q._mult(C)._add(ae))}M.push(z)}return M}(l,x*d)),function(w,C,M){for(let O=0;O<C.length;O++){const N=C[O];if(w.length>=3){for(let z=0;z<N.length;z++)if(Is(w,N[z]))return!0}if(hl(w,N,M))return!0}return!1}(m,l,_)}isTileClipped(){return!0}}function K9(n,t){return t>0?t+2*n:n}const J2=di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q2=di([{name:"a_projected_pos",components:3,type:"Float32"}],4);di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const e6=di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const J9=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),t6=di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function i6(n,t,r){return n.sections.forEach(o=>{o.text=function(l,p,d){const m=p.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Zn.applyArabicShaping&&(l=Zn.applyArabicShaping(l)),l}(o.text,t,r)}),n}di([{name:"triangle",components:3,type:"Uint16"}]),di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),di([{type:"Float32",name:"offsetX"}]),di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),di([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const a3={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Q9,E7,e0,$i=24,L7={};function r6(){return Q9||(Q9=1,L7.read=function(n,t,r,o,l){var p,d,m=8*l-o-1,_=(1<<m)-1,x=_>>1,w=-7,C=r?l-1:0,M=r?-1:1,O=n[t+C];for(C+=M,p=O&(1<<-w)-1,O>>=-w,w+=m;w>0;p=256*p+n[t+C],C+=M,w-=8);for(d=p&(1<<-w)-1,p>>=-w,w+=o;w>0;d=256*d+n[t+C],C+=M,w-=8);if(p===0)p=1-x;else{if(p===_)return d?NaN:1/0*(O?-1:1);d+=Math.pow(2,o),p-=x}return(O?-1:1)*d*Math.pow(2,p-o)},L7.write=function(n,t,r,o,l,p){var d,m,_,x=8*p-l-1,w=(1<<x)-1,C=w>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=o?0:p-1,N=o?1:-1,z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,d=w):(d=Math.floor(Math.log(t)/Math.LN2),t*(_=Math.pow(2,-d))<1&&(d--,_*=2),(t+=d+C>=1?M/_:M*Math.pow(2,1-C))*_>=2&&(d++,_/=2),d+C>=w?(m=0,d=w):d+C>=1?(m=(t*_-1)*Math.pow(2,l),d+=C):(m=t*Math.pow(2,C-1)*Math.pow(2,l),d=0));l>=8;n[r+O]=255&m,O+=N,m/=256,l-=8);for(d=d<<l|m,x+=l;x>0;n[r+O]=255&d,O+=N,d/=256,x-=8);n[r+O-N]|=128*z}),L7}function t0(){if(e0)return E7;e0=1,E7=t;var n=r6();function t(I){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(I)?I:new Uint8Array(I||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,o=1/r,l=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function p(I){return I.type===t.Bytes?I.readVarint()+I.pos:I.pos+1}function d(I,j,Q){return Q?4294967296*j+(I>>>0):4294967296*(j>>>0)+(I>>>0)}function m(I,j,Q){var _e=j<=16383?1:j<=2097151?2:j<=268435455?3:Math.floor(Math.log(j)/(7*Math.LN2));Q.realloc(_e);for(var De=Q.pos-1;De>=I;De--)Q.buf[De+_e]=Q.buf[De]}function _(I,j){for(var Q=0;Q<I.length;Q++)j.writeVarint(I[Q])}function x(I,j){for(var Q=0;Q<I.length;Q++)j.writeSVarint(I[Q])}function w(I,j){for(var Q=0;Q<I.length;Q++)j.writeFloat(I[Q])}function C(I,j){for(var Q=0;Q<I.length;Q++)j.writeDouble(I[Q])}function M(I,j){for(var Q=0;Q<I.length;Q++)j.writeBoolean(I[Q])}function O(I,j){for(var Q=0;Q<I.length;Q++)j.writeFixed32(I[Q])}function N(I,j){for(var Q=0;Q<I.length;Q++)j.writeSFixed32(I[Q])}function z(I,j){for(var Q=0;Q<I.length;Q++)j.writeFixed64(I[Q])}function H(I,j){for(var Q=0;Q<I.length;Q++)j.writeSFixed64(I[Q])}function $(I,j){return(I[j]|I[j+1]<<8|I[j+2]<<16)+16777216*I[j+3]}function ae(I,j,Q){I[Q]=j,I[Q+1]=j>>>8,I[Q+2]=j>>>16,I[Q+3]=j>>>24}function K(I,j){return(I[j]|I[j+1]<<8|I[j+2]<<16)+(I[j+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(I,j,Q){for(Q=Q||this.length;this.pos<Q;){var _e=this.readVarint(),De=_e>>3,Te=this.pos;this.type=7&_e,I(De,j,this),this.pos===Te&&this.skip(_e)}return j},readMessage:function(I,j){return this.readFields(I,j,this.readVarint()+this.pos)},readFixed32:function(){var I=$(this.buf,this.pos);return this.pos+=4,I},readSFixed32:function(){var I=K(this.buf,this.pos);return this.pos+=4,I},readFixed64:function(){var I=$(this.buf,this.pos)+$(this.buf,this.pos+4)*r;return this.pos+=8,I},readSFixed64:function(){var I=$(this.buf,this.pos)+K(this.buf,this.pos+4)*r;return this.pos+=8,I},readFloat:function(){var I=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,I},readDouble:function(){var I=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,I},readVarint:function(I){var j,Q,_e=this.buf;return j=127&(Q=_e[this.pos++]),Q<128?j:(j|=(127&(Q=_e[this.pos++]))<<7,Q<128?j:(j|=(127&(Q=_e[this.pos++]))<<14,Q<128?j:(j|=(127&(Q=_e[this.pos++]))<<21,Q<128?j:function(De,Te,Pe){var Be,ze,Ge=Pe.buf;if(Be=(112&(ze=Ge[Pe.pos++]))>>4,ze<128||(Be|=(127&(ze=Ge[Pe.pos++]))<<3,ze<128)||(Be|=(127&(ze=Ge[Pe.pos++]))<<10,ze<128)||(Be|=(127&(ze=Ge[Pe.pos++]))<<17,ze<128)||(Be|=(127&(ze=Ge[Pe.pos++]))<<24,ze<128)||(Be|=(1&(ze=Ge[Pe.pos++]))<<31,ze<128))return d(De,Be,Te);throw new Error("Expected varint not more than 10 bytes")}(j|=(15&(Q=_e[this.pos]))<<28,I,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var I=this.readVarint();return I%2==1?(I+1)/-2:I/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var I=this.readVarint()+this.pos,j=this.pos;return this.pos=I,I-j>=12&&l?function(Q,_e,De){return l.decode(Q.subarray(_e,De))}(this.buf,j,I):function(Q,_e,De){for(var Te="",Pe=_e;Pe<De;){var Be,ze,Ge,ke=Q[Pe],Ke=null,ht=ke>239?4:ke>223?3:ke>191?2:1;if(Pe+ht>De)break;ht===1?ke<128&&(Ke=ke):ht===2?(192&(Be=Q[Pe+1]))==128&&(Ke=(31&ke)<<6|63&Be)<=127&&(Ke=null):ht===3?(ze=Q[Pe+2],(192&(Be=Q[Pe+1]))==128&&(192&ze)==128&&((Ke=(15&ke)<<12|(63&Be)<<6|63&ze)<=2047||Ke>=55296&&Ke<=57343)&&(Ke=null)):ht===4&&(ze=Q[Pe+2],Ge=Q[Pe+3],(192&(Be=Q[Pe+1]))==128&&(192&ze)==128&&(192&Ge)==128&&((Ke=(15&ke)<<18|(63&Be)<<12|(63&ze)<<6|63&Ge)<=65535||Ke>=1114112)&&(Ke=null)),Ke===null?(Ke=65533,ht=1):Ke>65535&&(Ke-=65536,Te+=String.fromCharCode(Ke>>>10&1023|55296),Ke=56320|1023&Ke),Te+=String.fromCharCode(Ke),Pe+=ht}return Te}(this.buf,j,I)},readBytes:function(){var I=this.readVarint()+this.pos,j=this.buf.subarray(this.pos,I);return this.pos=I,j},readPackedVarint:function(I,j){if(this.type!==t.Bytes)return I.push(this.readVarint(j));var Q=p(this);for(I=I||[];this.pos<Q;)I.push(this.readVarint(j));return I},readPackedSVarint:function(I){if(this.type!==t.Bytes)return I.push(this.readSVarint());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readSVarint());return I},readPackedBoolean:function(I){if(this.type!==t.Bytes)return I.push(this.readBoolean());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readBoolean());return I},readPackedFloat:function(I){if(this.type!==t.Bytes)return I.push(this.readFloat());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readFloat());return I},readPackedDouble:function(I){if(this.type!==t.Bytes)return I.push(this.readDouble());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readDouble());return I},readPackedFixed32:function(I){if(this.type!==t.Bytes)return I.push(this.readFixed32());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readFixed32());return I},readPackedSFixed32:function(I){if(this.type!==t.Bytes)return I.push(this.readSFixed32());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readSFixed32());return I},readPackedFixed64:function(I){if(this.type!==t.Bytes)return I.push(this.readFixed64());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readFixed64());return I},readPackedSFixed64:function(I){if(this.type!==t.Bytes)return I.push(this.readSFixed64());var j=p(this);for(I=I||[];this.pos<j;)I.push(this.readSFixed64());return I},skip:function(I){var j=7&I;if(j===t.Varint)for(;this.buf[this.pos++]>127;);else if(j===t.Bytes)this.pos=this.readVarint()+this.pos;else if(j===t.Fixed32)this.pos+=4;else{if(j!==t.Fixed64)throw new Error("Unimplemented type: "+j);this.pos+=8}},writeTag:function(I,j){this.writeVarint(I<<3|j)},realloc:function(I){for(var j=this.length||16;j<this.pos+I;)j*=2;if(j!==this.length){var Q=new Uint8Array(j);Q.set(this.buf),this.buf=Q,this.length=j}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(I){this.realloc(4),ae(this.buf,I,this.pos),this.pos+=4},writeSFixed32:function(I){this.realloc(4),ae(this.buf,I,this.pos),this.pos+=4},writeFixed64:function(I){this.realloc(8),ae(this.buf,-1&I,this.pos),ae(this.buf,Math.floor(I*o),this.pos+4),this.pos+=8},writeSFixed64:function(I){this.realloc(8),ae(this.buf,-1&I,this.pos),ae(this.buf,Math.floor(I*o),this.pos+4),this.pos+=8},writeVarint:function(I){(I=+I||0)>268435455||I<0?function(j,Q){var _e,De;if(j>=0?(_e=j%4294967296|0,De=j/4294967296|0):(De=~(-j/4294967296),4294967295^(_e=~(-j%4294967296))?_e=_e+1|0:(_e=0,De=De+1|0)),j>=18446744073709552e3||j<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Q.realloc(10),function(Te,Pe,Be){Be.buf[Be.pos++]=127&Te|128,Te>>>=7,Be.buf[Be.pos++]=127&Te|128,Te>>>=7,Be.buf[Be.pos++]=127&Te|128,Te>>>=7,Be.buf[Be.pos++]=127&Te|128,Be.buf[Be.pos]=127&(Te>>>=7)}(_e,0,Q),function(Te,Pe){var Be=(7&Te)<<4;Pe.buf[Pe.pos++]|=Be|((Te>>>=3)?128:0),Te&&(Pe.buf[Pe.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Pe.buf[Pe.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Pe.buf[Pe.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Pe.buf[Pe.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Pe.buf[Pe.pos++]=127&Te)))))}(De,Q)}(I,this):(this.realloc(4),this.buf[this.pos++]=127&I|(I>127?128:0),I<=127||(this.buf[this.pos++]=127&(I>>>=7)|(I>127?128:0),I<=127||(this.buf[this.pos++]=127&(I>>>=7)|(I>127?128:0),I<=127||(this.buf[this.pos++]=I>>>7&127))))},writeSVarint:function(I){this.writeVarint(I<0?2*-I-1:2*I)},writeBoolean:function(I){this.writeVarint(!!I)},writeString:function(I){I=String(I),this.realloc(4*I.length),this.pos++;var j=this.pos;this.pos=function(_e,De,Te){for(var Pe,Be,ze=0;ze<De.length;ze++){if((Pe=De.charCodeAt(ze))>55295&&Pe<57344){if(!Be){Pe>56319||ze+1===De.length?(_e[Te++]=239,_e[Te++]=191,_e[Te++]=189):Be=Pe;continue}if(Pe<56320){_e[Te++]=239,_e[Te++]=191,_e[Te++]=189,Be=Pe;continue}Pe=Be-55296<<10|Pe-56320|65536,Be=null}else Be&&(_e[Te++]=239,_e[Te++]=191,_e[Te++]=189,Be=null);Pe<128?_e[Te++]=Pe:(Pe<2048?_e[Te++]=Pe>>6|192:(Pe<65536?_e[Te++]=Pe>>12|224:(_e[Te++]=Pe>>18|240,_e[Te++]=Pe>>12&63|128),_e[Te++]=Pe>>6&63|128),_e[Te++]=63&Pe|128)}return Te}(this.buf,I,this.pos);var Q=this.pos-j;Q>=128&&m(j,Q,this),this.pos=j-1,this.writeVarint(Q),this.pos+=Q},writeFloat:function(I){this.realloc(4),n.write(this.buf,I,this.pos,!0,23,4),this.pos+=4},writeDouble:function(I){this.realloc(8),n.write(this.buf,I,this.pos,!0,52,8),this.pos+=8},writeBytes:function(I){var j=I.length;this.writeVarint(j),this.realloc(j);for(var Q=0;Q<j;Q++)this.buf[this.pos++]=I[Q]},writeRawMessage:function(I,j){this.pos++;var Q=this.pos;I(j,this);var _e=this.pos-Q;_e>=128&&m(Q,_e,this),this.pos=Q-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(I,j,Q){this.writeTag(I,t.Bytes),this.writeRawMessage(j,Q)},writePackedVarint:function(I,j){j.length&&this.writeMessage(I,_,j)},writePackedSVarint:function(I,j){j.length&&this.writeMessage(I,x,j)},writePackedBoolean:function(I,j){j.length&&this.writeMessage(I,M,j)},writePackedFloat:function(I,j){j.length&&this.writeMessage(I,w,j)},writePackedDouble:function(I,j){j.length&&this.writeMessage(I,C,j)},writePackedFixed32:function(I,j){j.length&&this.writeMessage(I,O,j)},writePackedSFixed32:function(I,j){j.length&&this.writeMessage(I,N,j)},writePackedFixed64:function(I,j){j.length&&this.writeMessage(I,z,j)},writePackedSFixed64:function(I,j){j.length&&this.writeMessage(I,H,j)},writeBytesField:function(I,j){this.writeTag(I,t.Bytes),this.writeBytes(j)},writeFixed32Field:function(I,j){this.writeTag(I,t.Fixed32),this.writeFixed32(j)},writeSFixed32Field:function(I,j){this.writeTag(I,t.Fixed32),this.writeSFixed32(j)},writeFixed64Field:function(I,j){this.writeTag(I,t.Fixed64),this.writeFixed64(j)},writeSFixed64Field:function(I,j){this.writeTag(I,t.Fixed64),this.writeSFixed64(j)},writeVarintField:function(I,j){this.writeTag(I,t.Varint),this.writeVarint(j)},writeSVarintField:function(I,j){this.writeTag(I,t.Varint),this.writeSVarint(j)},writeStringField:function(I,j){this.writeTag(I,t.Bytes),this.writeString(j)},writeFloatField:function(I,j){this.writeTag(I,t.Fixed32),this.writeFloat(j)},writeDoubleField:function(I,j){this.writeTag(I,t.Fixed64),this.writeDouble(j)},writeBooleanField:function(I,j){this.writeVarintField(I,!!j)}},E7}var P7=be(t0());const M7=3;function n6(n,t,r){n===1&&r.readMessage(o6,t)}function o6(n,t,r){if(n===3){const{id:o,bitmap:l,width:p,height:d,left:m,top:_,advance:x}=r.readMessage(a6,{});t.push({id:o,bitmap:new X4({width:p+2*M7,height:d+2*M7},l),metrics:{width:p,height:d,left:m,top:_,advance:x}})}}function a6(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const s6=M7;function i0(n){let t=0,r=0;for(const d of n)t+=d.w*d.h,r=Math.max(r,d.w);n.sort((d,m)=>m.h-d.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,p=0;for(const d of n)for(let m=o.length-1;m>=0;m--){const _=o[m];if(!(d.w>_.w||d.h>_.h)){if(d.x=_.x,d.y=_.y,p=Math.max(p,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===_.w&&d.h===_.h){const x=o.pop();m<o.length&&(o[m]=x)}else d.h===_.h?(_.x+=d.w,_.w-=d.w):d.w===_.w?(_.y+=d.h,_.h-=d.h):(o.push({x:_.x+d.w,y:_.y,w:_.w-d.w,h:d.h}),_.y+=d.h,_.h-=d.h);break}}return{w:l,h:p,fill:t/(l*p)||0}}const rn=1;class I7{constructor(t,{pixelRatio:r,version:o,stretchX:l,stretchY:p,content:d,textFitWidth:m,textFitHeight:_}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=p,this.content=d,this.version=o,this.textFitWidth=m,this.textFitHeight=_}get tl(){return[this.paddedRect.x+rn,this.paddedRect.y+rn]}get br(){return[this.paddedRect.x+this.paddedRect.w-rn,this.paddedRect.y+this.paddedRect.h-rn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*rn)/this.pixelRatio,(this.paddedRect.h-2*rn)/this.pixelRatio]}}class r0{constructor(t,r){const o={},l={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(r,l,p);const{w:d,h:m}=i0(p),_=new bn({width:d||1,height:m||1});for(const x in t){const w=t[x],C=o[x].paddedRect;bn.copy(w.data,_,{x:0,y:0},{x:C.x+rn,y:C.y+rn},w.data)}for(const x in r){const w=r[x],C=l[x].paddedRect,M=C.x+rn,O=C.y+rn,N=w.data.width,z=w.data.height;bn.copy(w.data,_,{x:0,y:0},{x:M,y:O},w.data),bn.copy(w.data,_,{x:0,y:z-1},{x:M,y:O-1},{width:N,height:1}),bn.copy(w.data,_,{x:0,y:0},{x:M,y:O+z},{width:N,height:1}),bn.copy(w.data,_,{x:N-1,y:0},{x:M-1,y:O},{width:1,height:z}),bn.copy(w.data,_,{x:0,y:0},{x:M+N,y:O},{width:1,height:z})}this.image=_,this.iconPositions=o,this.patternPositions=l}addImages(t,r,o){for(const l in t){const p=t[l],d={x:0,y:0,w:p.data.width+2*rn,h:p.data.height+2*rn};o.push(d),r[l]=new I7(d,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,p]=t.tl;o.update(r.data,void 0,{x:l,y:p})}}var Wo;We("ImagePosition",I7),We("ImageAtlas",r0),S.ai=void 0,(Wo=S.ai||(S.ai={}))[Wo.none=0]="none",Wo[Wo.horizontal=1]="horizontal",Wo[Wo.vertical=2]="vertical",Wo[Wo.horizontalOnly=3]="horizontalOnly";const s3=-17;class l3{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const o=new l3;return o.scale=t||1,o.fontStack=r,o}static forImage(t){const r=new l3;return r.imageName=t,r}}class Rs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new Rs;for(let l=0;l<t.sections.length;l++){const p=t.sections[l];p.image?o.addImageSection(p):o.addTextSection(p,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let o=0;o<t.length;o++){const l=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;r+=l&&R4(l)&&!a3[t[o+1]]||p&&R4(p)&&!a3[t[o-1]]||!a3[t[o]]?t[o]:a3[t[o]]}return r}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&xl[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&xl[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new Rs;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(l3.forText(t.scale,t.fontStack||r));const o=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Kt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(l3.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yl(n,t,r,o,l,p,d,m,_,x,w,C,M,O,N){const z=Rs.fromFeature(n,l);let H;C===S.ai.vertical&&z.verticalizePunctuation();const{processBidirectionalText:$,processStyledBidirectionalText:ae}=Zn;if($&&z.sections.length===1){H=[];const j=$(z.toString(),O7(z,x,p,t,o,O));for(const Q of j){const _e=new Rs;_e.text=Q,_e.sections=z.sections;for(let De=0;De<Q.length;De++)_e.sectionIndex.push(0);H.push(_e)}}else if(ae){H=[];const j=ae(z.text,z.sectionIndex,O7(z,x,p,t,o,O));for(const Q of j){const _e=new Rs;_e.text=Q[0],_e.sectionIndex=Q[1],_e.sections=z.sections,H.push(_e)}}else H=function(j,Q){const _e=[],De=j.text;let Te=0;for(const Pe of Q)_e.push(j.substring(Te,Pe)),Te=Pe;return Te<De.length&&_e.push(j.substring(Te,De.length)),_e}(z,O7(z,x,p,t,o,O));const K=[],I={positionedLines:K,text:z.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(j,Q,_e,De,Te,Pe,Be,ze,Ge,ke,Ke,ht){let lt=0,tt=s3,At=0,Ci=0;const Wi=ze==="right"?1:ze==="left"?0:.5;let cr=0;for(const Mi of Te){Mi.trim();const Xi=Mi.getMaxScale(),Hr=(Xi-1)*$i,Vr={positionedGlyphs:[],lineOffset:0};j.positionedLines[cr]=Vr;const Zr=Vr.positionedGlyphs;let Ki=0;if(!Mi.length()){tt+=Pe,++cr;continue}for(let nn=0;nn<Mi.length();nn++){const Ft=Mi.getSection(nn),wr=Mi.getSectionIndex(nn),wi=Mi.getCharCode(nn);let Ai=0,rr=null,Ba=null,Sn=null,El=$i;const Un=!(Ge===S.ai.horizontal||!Ke&&!La(wi)||Ke&&(xl[wi]||(Gn=wi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Gn)))));if(Ft.imageName){const un=De[Ft.imageName];if(!un)continue;Sn=Ft.imageName,j.iconsInText=j.iconsInText||!0,Ba=un.paddedRect;const ur=un.displaySize;Ft.scale=Ft.scale*$i/ht,rr={width:ur[0],height:ur[1],left:rn,top:-3,advance:Un?ur[1]:ur[0]},Ai=Hr+($i-ur[1]*Ft.scale),El=rr.advance;const Cn=Un?ur[0]*Ft.scale-$i*Xi:ur[1]*Ft.scale-$i*Xi;Cn>0&&Cn>Ki&&(Ki=Cn)}else{const un=_e[Ft.fontStack],ur=un&&un[wi];if(ur&&ur.rect)Ba=ur.rect,rr=ur.metrics;else{const Cn=Q[Ft.fontStack],Lo=Cn&&Cn[wi];if(!Lo)continue;rr=Lo.metrics}Ai=(Xi-Ft.scale)*$i}Un?(j.verticalizable=!0,Zr.push({glyph:wi,imageName:Sn,x:lt,y:tt+Ai,vertical:Un,scale:Ft.scale,fontStack:Ft.fontStack,sectionIndex:wr,metrics:rr,rect:Ba}),lt+=El*Ft.scale+ke):(Zr.push({glyph:wi,imageName:Sn,x:lt,y:tt+Ai,vertical:Un,scale:Ft.scale,fontStack:Ft.fontStack,sectionIndex:wr,metrics:rr,rect:Ba}),lt+=rr.advance*Ft.scale+ke)}Zr.length!==0&&(At=Math.max(lt-ke,At),u6(Zr,0,Zr.length-1,Wi,Ki)),lt=0;const Tn=Pe*Xi+Ki;Vr.lineOffset=Math.max(Ki,Hr),tt+=Tn,Ci=Math.max(Tn,Ci),++cr}var Gn;const jr=tt-s3,{horizontalAlign:hr,verticalAlign:br}=N7(Be);(function(Mi,Xi,Hr,Vr,Zr,Ki,Tn,nn,Ft){const wr=(Xi-Hr)*Zr;let wi=0;wi=Ki!==Tn?-nn*Vr-s3:(-Vr*Ft+.5)*Tn;for(const Ai of Mi)for(const rr of Ai.positionedGlyphs)rr.x+=wr,rr.y+=wi})(j.positionedLines,Wi,hr,br,At,Ci,Pe,jr,Te.length),j.top+=-br*jr,j.bottom=j.top+jr,j.left+=-hr*At,j.right=j.left+At}(I,t,r,o,H,d,m,_,C,x,M,N),!function(j){for(const Q of j)if(Q.positionedGlyphs.length!==0)return!1;return!0}(K)&&I}const xl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},l6={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},c6={40:!0};function n0(n,t,r,o,l,p){if(t.imageName){const d=o[t.imageName];return d?d.displaySize[0]*t.scale*$i/p+l:0}{const d=r[t.fontStack],m=d&&d[n];return m?m.metrics.advance*t.scale+l:0}}function o0(n,t,r,o){const l=Math.pow(n-t,2);return o?n<t?l/2:2*l:l+Math.abs(r)*r}function h6(n,t,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function a0(n,t,r,o,l,p){let d=null,m=o0(t,r,l,p);for(const _ of o){const x=o0(t-_.x,r,l,p)+_.badness;x<=m&&(d=_,m=x)}return{index:n,x:t,priorBreak:d,badness:m}}function s0(n){return n?s0(n.priorBreak).concat(n.index):[]}function O7(n,t,r,o,l,p){if(!n)return[];const d=[],m=function(C,M,O,N,z,H){let $=0;for(let ae=0;ae<C.length();ae++){const K=C.getSection(ae);$+=n0(C.getCharCode(ae),K,N,z,M,H)}return $/Math.max(1,Math.ceil($/O))}(n,t,r,o,l,p),_=n.text.indexOf("")>=0;let x=0;for(let C=0;C<n.length();C++){const M=n.getSection(C),O=n.getCharCode(C);if(xl[O]||(x+=n0(O,M,o,l,t,p)),C<n.length()-1){const N=!((w=O)<11904)&&(!!It["CJK Compatibility Forms"](w)||!!It["CJK Compatibility"](w)||!!It["CJK Strokes"](w)||!!It["CJK Symbols and Punctuation"](w)||!!It["Enclosed CJK Letters and Months"](w)||!!It["Halfwidth and Fullwidth Forms"](w)||!!It["Ideographic Description Characters"](w)||!!It["Vertical Forms"](w)||k4.test(String.fromCodePoint(w)));(l6[O]||N||M.imageName||C!==n.length()-2&&c6[n.getCharCode(C+1)])&&d.push(a0(C+1,x,m,d,h6(O,n.getCharCode(C+1),N&&_),!1))}}var w;return s0(a0(n.length(),x,m,d,0,!0))}function N7(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function u6(n,t,r,o,l){if(!o&&!l)return;const p=n[r],d=(n[r].x+p.metrics.advance*p.scale)*o;for(let m=t;m<=r;m++)n[m].x-=d,n[m].y+=l}function p6(n,t,r){const{horizontalAlign:o,verticalAlign:l}=N7(r),p=t[0]-n.displaySize[0]*o,d=t[1]-n.displaySize[1]*l;return{image:n,top:d,bottom:d+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function l0(n){var t,r;let o=n.left,l=n.top,p=n.right-o,d=n.bottom-l;const m=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",_=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",x=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(_==="proportional"){if(m==="stretchOnly"&&p/d<x||m==="proportional"){const w=Math.ceil(d*x);o*=w/p,p=w}}else if(m==="proportional"&&_==="stretchOnly"&&x!==0&&p/d>x){const w=Math.ceil(p/x);l*=w/d,d=w}return{x1:o,y1:l,x2:o+p,y2:l+d}}function c0(n,t,r,o,l,p){const d=n.image;let m;if(d.content){const H=d.content,$=d.pixelRatio||1;m=[H[0]/$,H[1]/$,d.displaySize[0]-H[2]/$,d.displaySize[1]-H[3]/$]}const _=t.left*p,x=t.right*p;let w,C,M,O;r==="width"||r==="both"?(O=l[0]+_-o[3],C=l[0]+x+o[1]):(O=l[0]+(_+x-d.displaySize[0])/2,C=O+d.displaySize[0]);const N=t.top*p,z=t.bottom*p;return r==="height"||r==="both"?(w=l[1]+N-o[0],M=l[1]+z+o[2]):(w=l[1]+(N+z-d.displaySize[1])/2,M=w+d.displaySize[1]),{image:d,top:w,right:C,bottom:M,left:O,collisionPadding:m}}const c3=255,ro=128,Xo=c3*ro;function h0(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new pi(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=r;let p=0;for(;p<o.length&&o[p]<=n;)p++;p=Math.max(0,p-1);let d=p;for(;d<o.length&&o[d]<n+1;)d++;d=Math.min(o.length-1,d);const m=o[p],_=o[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:_,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:_,minSize:r.evaluate(new pi(m)),maxSize:r.evaluate(new pi(_)),interpolationType:l}}}function k7(n,t,r){let o="never";const l=n.get(t);return l?o=l:n.get(r)&&(o="always"),o}const d6=r3.VectorTileFeature.types,f6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vl(n,t,r,o,l,p,d,m,_,x,w,C,M){const O=m?Math.min(Xo,Math.round(m[0])):0,N=m?Math.min(Xo,Math.round(m[1])):0;n.emplaceBack(t,r,Math.round(32*o),Math.round(32*l),p,d,(O<<1)+(_?1:0),N,16*x,16*w,256*C,256*M)}function R7(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function m6(n){for(const t of n.sections)if(il(t.text))return!0;return!1}class D7{constructor(t){this.layoutVertexArray=new le,this.indexArray=new Ie,this.programConfigurations=t,this.segments=new Ne,this.dynamicLayoutVertexArray=new oe,this.opacityVertexArray=new ge,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,J2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Q2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,f6,!0),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We("SymbolBuffers",D7);class z7{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Ne,this.collisionVertexArray=new Oe}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,e6.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}We("CollisionBuffers",z7);class Ds{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(d=>d.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=h0(this.zoom,r["text-size"]),this.iconSizeData=h0(this.zoom,r["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=k7(o,"text-overlap","text-allow-overlap")!=="never"||k7(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(d=>S.ai[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=t.sourceID}createArrays(){this.text=new D7(new tr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new D7(new tr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new v,this.lineVertexArray=new A,this.symbolInstances=new y,this.textAnchorOffsets=new P}calculateGlyphDependencies(t,r,o,l,p){for(let d=0;d<t.length;d++)if(r[t.charCodeAt(d)]=!0,(o||l)&&p){const m=a3[t.charAt(d)];m&&(r[m.charCodeAt(0)]=!0)}}populate(t,r,o){const l=this.layers[0],p=l.layout,d=p.get("text-font"),m=p.get("text-field"),_=p.get("icon-image"),x=(m.value.kind!=="constant"||m.value.value instanceof ve&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),w=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,C=p.get("symbol-sort-key");if(this.features=[],!x&&!w)return;const M=r.iconDependencies,O=r.glyphDependencies,N=r.availableImages,z=new pi(this.zoom);for(const{feature:H,id:$,index:ae,sourceLayerIndex:K}of t){const I=l._featureFilter.needGeometry,j=Ao(H,I);if(!l._featureFilter.filter(z,j,o))continue;let Q,_e;if(I||(j.geometry=Co(H)),x){const Te=l.getValueAndResolveTokens("text-field",j,o,N),Pe=ve.factory(Te),Be=this.hasRTLText=this.hasRTLText||m6(Pe);(!Be||Zn.getRTLTextPluginStatus()==="unavailable"||Be&&Zn.isParsed())&&(Q=i6(Pe,l,j))}if(w){const Te=l.getValueAndResolveTokens("icon-image",j,o,N);_e=Te instanceof vt?Te:vt.fromString(Te)}if(!Q&&!_e)continue;const De=this.sortFeaturesByKey?C.evaluate(j,{},o):void 0;if(this.features.push({id:$,text:Q,icon:_e,index:ae,sourceLayerIndex:K,geometry:j.geometry,properties:H.properties,type:d6[H.type],sortKey:De}),_e&&(M[_e.name]=!0),Q){const Te=d.evaluate(j,{},o).join(","),Pe=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ai.vertical)>=0;for(const Be of Q.sections)if(Be.image)M[Be.image.name]=!0;else{const ze=Ea(Q.toString()),Ge=Be.fontStack||Te,ke=O[Ge]=O[Ge]||{};this.calculateGlyphDependencies(Be.text,ke,Pe,this.allowVerticalPlacement,ze)}}}p.get("symbol-placement")==="line"&&(this.features=function(H){const $={},ae={},K=[];let I=0;function j(Te){K.push(H[Te]),I++}function Q(Te,Pe,Be){const ze=ae[Te];return delete ae[Te],ae[Pe]=ze,K[ze].geometry[0].pop(),K[ze].geometry[0]=K[ze].geometry[0].concat(Be[0]),ze}function _e(Te,Pe,Be){const ze=$[Pe];return delete $[Pe],$[Te]=ze,K[ze].geometry[0].shift(),K[ze].geometry[0]=Be[0].concat(K[ze].geometry[0]),ze}function De(Te,Pe,Be){const ze=Be?Pe[0][Pe[0].length-1]:Pe[0][0];return`${Te}:${ze.x}:${ze.y}`}for(let Te=0;Te<H.length;Te++){const Pe=H[Te],Be=Pe.geometry,ze=Pe.text?Pe.text.toString():null;if(!ze){j(Te);continue}const Ge=De(ze,Be),ke=De(ze,Be,!0);if(Ge in ae&&ke in $&&ae[Ge]!==$[ke]){const Ke=_e(Ge,ke,Be),ht=Q(Ge,ke,K[Ke].geometry);delete $[Ge],delete ae[ke],ae[De(ze,K[ht].geometry,!0)]=ht,K[Ke].geometry=null}else Ge in ae?Q(Ge,ke,Be):ke in $?_e(Ge,ke,Be):(j(Te),$[Ge]=I-1,ae[ke]=I-1)}return K.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,$)=>H.sortKey-$.sortKey)}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),p=t.dist(r[t.segment]);const d={};for(let m=t.segment+1;m<r.length;m++)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:l},m<r.length-1&&(l+=r[m+1].dist(r[m]));for(let m=t.segment||0;m>=0;m--)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:p},m>0&&(p+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const _=d[m];this.lineVertexArray.emplaceBack(_.x,_.y,_.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,l,p,d,m,_,x,w,C,M){const O=t.indexArray,N=t.layoutVertexArray,z=t.segments.prepareSegment(4*r.length,N,O,this.canOverlap?d.sortKey:void 0),H=this.glyphOffsetArray.length,$=z.vertexLength,ae=this.allowVerticalPlacement&&m===S.ai.vertical?Math.PI/2:0,K=d.text&&d.text.sections;for(let I=0;I<r.length;I++){const{tl:j,tr:Q,bl:_e,br:De,tex:Te,pixelOffsetTL:Pe,pixelOffsetBR:Be,minFontScaleX:ze,minFontScaleY:Ge,glyphOffset:ke,isSDF:Ke,sectionIndex:ht}=r[I],lt=z.vertexLength,tt=ke[1];vl(N,_.x,_.y,j.x,tt+j.y,Te.x,Te.y,o,Ke,Pe.x,Pe.y,ze,Ge),vl(N,_.x,_.y,Q.x,tt+Q.y,Te.x+Te.w,Te.y,o,Ke,Be.x,Pe.y,ze,Ge),vl(N,_.x,_.y,_e.x,tt+_e.y,Te.x,Te.y+Te.h,o,Ke,Pe.x,Be.y,ze,Ge),vl(N,_.x,_.y,De.x,tt+De.y,Te.x+Te.w,Te.y+Te.h,o,Ke,Be.x,Be.y,ze,Ge),R7(t.dynamicLayoutVertexArray,_,ae),O.emplaceBack(lt,lt+2,lt+1),O.emplaceBack(lt+1,lt+2,lt+3),z.vertexLength+=4,z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),I!==r.length-1&&ht===r[I+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,d,d.index,{},M,K&&K[ht])}t.placedSymbolArray.emplaceBack(_.x,_.y,H,this.glyphOffsetArray.length-H,$,x,w,_.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],m,0,!1,0,C)}_addCollisionDebugVertex(t,r,o,l,p,d){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,l,p,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(t,r,o,l,p,d,m){const _=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),x=_.vertexLength,w=p.layoutVertexArray,C=p.collisionVertexArray,M=m.anchorX,O=m.anchorY;this._addCollisionDebugVertex(w,C,d,M,O,new Ce(t,r)),this._addCollisionDebugVertex(w,C,d,M,O,new Ce(o,r)),this._addCollisionDebugVertex(w,C,d,M,O,new Ce(o,l)),this._addCollisionDebugVertex(w,C,d,M,O,new Ce(t,l)),_.vertexLength+=4;const N=p.indexArray;N.emplaceBack(x,x+1),N.emplaceBack(x+1,x+2),N.emplaceBack(x+2,x+3),N.emplaceBack(x+3,x),_.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,l){for(let p=t;p<r;p++){const d=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,l?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new z7(xe,J9.members,Le),this.iconCollisionBox=new z7(xe,J9.members,Le);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,l,p,d,m,_,x){const w={};for(let C=r;C<o;C++){const M=t.get(C);w.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},w.textFeatureIndex=M.featureIndex;break}for(let C=l;C<p;C++){const M=t.get(C);w.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},w.verticalTextFeatureIndex=M.featureIndex;break}for(let C=d;C<m;C++){const M=t.get(C);w.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},w.iconFeatureIndex=M.featureIndex;break}for(let C=_;C<x;C++){const M=t.get(C);w.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},w.verticalIconFeatureIndex=M.featureIndex;break}return w}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),l=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<l;p+=4)t.indexArray.emplaceBack(p,p+2,p+1),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),l=[],p=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const _=this.symbolInstances.get(m);l.push(0|Math.round(r*_.anchorX+o*_.anchorY)),p.push(_.featureIndex)}return d.sort((m,_)=>l[m]-l[_]||p[_]-p[m]),d}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((l,p,d)=>{l>=0&&d.indexOf(l)===p&&this.addIndicesForPlacedSymbol(this.text,l)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let u0,p0;We("SymbolBucket",Ds,{omit:["layers","collisionBoxArray","features","compareText"]}),Ds.MAX_GLYPHS=65535,Ds.addDynamicAttributes=R7;var B7={get paint(){return p0=p0||new Pr({"icon-opacity":new pt(V.paint_symbol["icon-opacity"]),"icon-color":new pt(V.paint_symbol["icon-color"]),"icon-halo-color":new pt(V.paint_symbol["icon-halo-color"]),"icon-halo-width":new pt(V.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pt(V.paint_symbol["icon-halo-blur"]),"icon-translate":new rt(V.paint_symbol["icon-translate"]),"icon-translate-anchor":new rt(V.paint_symbol["icon-translate-anchor"]),"text-opacity":new pt(V.paint_symbol["text-opacity"]),"text-color":new pt(V.paint_symbol["text-color"],{runtimeType:Tt,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new pt(V.paint_symbol["text-halo-color"]),"text-halo-width":new pt(V.paint_symbol["text-halo-width"]),"text-halo-blur":new pt(V.paint_symbol["text-halo-blur"]),"text-translate":new rt(V.paint_symbol["text-translate"]),"text-translate-anchor":new rt(V.paint_symbol["text-translate-anchor"])})},get layout(){return u0=u0||new Pr({"symbol-placement":new rt(V.layout_symbol["symbol-placement"]),"symbol-spacing":new rt(V.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rt(V.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pt(V.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rt(V.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rt(V.layout_symbol["icon-allow-overlap"]),"icon-overlap":new rt(V.layout_symbol["icon-overlap"]),"icon-ignore-placement":new rt(V.layout_symbol["icon-ignore-placement"]),"icon-optional":new rt(V.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rt(V.layout_symbol["icon-rotation-alignment"]),"icon-size":new pt(V.layout_symbol["icon-size"]),"icon-text-fit":new rt(V.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rt(V.layout_symbol["icon-text-fit-padding"]),"icon-image":new pt(V.layout_symbol["icon-image"]),"icon-rotate":new pt(V.layout_symbol["icon-rotate"]),"icon-padding":new pt(V.layout_symbol["icon-padding"]),"icon-keep-upright":new rt(V.layout_symbol["icon-keep-upright"]),"icon-offset":new pt(V.layout_symbol["icon-offset"]),"icon-anchor":new pt(V.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rt(V.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rt(V.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rt(V.layout_symbol["text-rotation-alignment"]),"text-field":new pt(V.layout_symbol["text-field"]),"text-font":new pt(V.layout_symbol["text-font"]),"text-size":new pt(V.layout_symbol["text-size"]),"text-max-width":new pt(V.layout_symbol["text-max-width"]),"text-line-height":new rt(V.layout_symbol["text-line-height"]),"text-letter-spacing":new pt(V.layout_symbol["text-letter-spacing"]),"text-justify":new pt(V.layout_symbol["text-justify"]),"text-radial-offset":new pt(V.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rt(V.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new pt(V.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new pt(V.layout_symbol["text-anchor"]),"text-max-angle":new rt(V.layout_symbol["text-max-angle"]),"text-writing-mode":new rt(V.layout_symbol["text-writing-mode"]),"text-rotate":new pt(V.layout_symbol["text-rotate"]),"text-padding":new rt(V.layout_symbol["text-padding"]),"text-keep-upright":new rt(V.layout_symbol["text-keep-upright"]),"text-transform":new pt(V.layout_symbol["text-transform"]),"text-offset":new pt(V.layout_symbol["text-offset"]),"text-allow-overlap":new rt(V.layout_symbol["text-allow-overlap"]),"text-overlap":new rt(V.layout_symbol["text-overlap"]),"text-ignore-placement":new rt(V.layout_symbol["text-ignore-placement"]),"text-optional":new rt(V.layout_symbol["text-optional"])})}};class d0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:gt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We("FormatSectionOverride",d0,{omit:["defaultValue"]});class bl extends zn{constructor(t){super(t,B7)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const p of o)l.indexOf(p)<0&&l.push(p);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,l){const p=this.layout.get(t).evaluate(r,{},o,l),d=this._unevaluatedLayout._values[t];return d.isDataDriven()||_a(d.value)||!p?p:function(m,_){return _.replace(/{([^{}]+)}/g,(x,w)=>m&&w in m?String(m[w]):"")}(r.properties,p)}createBucket(t){return new Ds(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of B7.paint.overridableProperties){if(!bl.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new d0(r),l=new g4(o,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new _4("source",l):new Ho("composite",l,r.value.zoomStops),this.paint._values[t]=new Qr(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&bl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),l=B7.paint.properties[r];let p=!1;const d=m=>{for(const _ of m)if(l.overrides&&l.overrides.hasOverride(_))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ve)d(o.value.value.sections);else if(o.value.kind==="source"){const m=x=>{p||(x instanceof Kr&&kt(x.value)===gn?d(x.value.sections):x instanceof Br?d(x.sections):x.eachChild(m))},_=o.value;_._styleExpression&&m(_._styleExpression.expression)}return p}}let f0;var g6={get paint(){return f0=f0||new Pr({"background-color":new rt(V.paint_background["background-color"]),"background-pattern":new vs(V.paint_background["background-pattern"]),"background-opacity":new rt(V.paint_background["background-opacity"])})}};class _6 extends zn{constructor(t){super(t,g6)}}let m0;var y6={get paint(){return m0=m0||new Pr({"raster-opacity":new rt(V.paint_raster["raster-opacity"]),"raster-hue-rotate":new rt(V.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rt(V.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rt(V.paint_raster["raster-brightness-max"]),"raster-saturation":new rt(V.paint_raster["raster-saturation"]),"raster-contrast":new rt(V.paint_raster["raster-contrast"]),"raster-resampling":new rt(V.paint_raster["raster-resampling"]),"raster-fade-duration":new rt(V.paint_raster["raster-fade-duration"])})}};class x6 extends zn{constructor(t){super(t,y6)}}class v6 extends zn{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class b6{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const F7=63710088e-1;class Ko{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ko(Li(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,l=t.lat*r,p=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return F7*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof Ko)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ko(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ko(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const g0=2*Math.PI*F7;function _0(n){return g0*Math.cos(n*Math.PI/180)}function y0(n){return(180+n)/360}function x0(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function v0(n,t){return n/_0(t)}function G7(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function b0(n,t){return n*_0(G7(t))}class h3{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=Ko.convert(t);return new h3(y0(o.lng),x0(o.lat),v0(r,o.lat))}toLngLat(){return new Ko(360*this.x-180,G7(this.y))}toAltitude(){return b0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/g0*(t=G7(this.y),1/Math.cos(t*Math.PI/180));var t}}function w0(n,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class U7{constructor(t,r,o){if(!function(l,p,d){return!(l<0||l>25||d<0||d>=Math.pow(2,l)||p<0||p>=Math.pow(2,l))}(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=zs(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const l=(d=this.y,m=this.z,_=w0(256*(p=this.x),256*(d=Math.pow(2,m)-d-1),m),x=w0(256*(p+1),256*(d+1),m),_[0]+","+_[1]+","+x[0]+","+x[1]);var p,d,m,_,x;const w=function(C,M,O){let N,z="";for(let H=C;H>0;H--)N=1<<H-1,z+=(M&N?1:0)+(O&N?2:0);return z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new Ce((t.x*r-this.x)*xt,(t.y*r-this.y)*xt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class T0{constructor(t,r){this.wrap=t,this.canonical=r,this.key=zs(t,r.z,r.z,r.x,r.y)}}class wn{constructor(t,r,o,l,p){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new U7(o,+l,+p),this.key=zs(r,t,o,l,p)}clone(){return new wn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new wn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?zs(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):zs(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new wn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new wn(r,this.wrap,r,o,l),new wn(r,this.wrap,r,o+1,l),new wn(r,this.wrap,r,o,l+1),new wn(r,this.wrap,r,o+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new wn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new wn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new T0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new h3(t.x-this.wrap,t.y))}}function zs(n,t,r,o,l){(n*=2)<0&&(n=-1*n-1);const p=1<<r;return(p*p*n+p*l+o).toString(36)+r.toString(36)+t.toString(36)}We("CanonicalTileID",U7),We("OverscaledTileID",wn,{omit:["terrainRttPosMatrix32f"]});class S0{constructor(t,r,o,l=1,p=1,d=1,m=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Kt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const _=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=p,this.blueFactor=d,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<_;x++)for(let w=0;w<_;w++){const C=this.get(x,w);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,r){const o=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(o[l],o[l+1],o[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new bn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,p=r*this.dim+this.dim,d=o*this.dim,m=o*this.dim+this.dim;switch(r){case-1:l=p-1;break;case 1:p=l+1}switch(o){case-1:d=m-1;break;case 1:m=d+1}const _=-r*this.dim,x=-o*this.dim;for(let w=d;w<m;w++)for(let C=l;C<p;C++)this.data[this._idx(C,w)]=t.data[this._idx(C+_,w+x)]}}We("DEMData",S0);class C0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class A0{constructor(t,r,o,l,p){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=l,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class E0{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ta(xt,16,0),this.grid3D=new Ta(xt,16,0),this.featureIndexArray=new F,this.promoteId=r}insert(t,r,o,l,p,d){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,p);const _=d?this.grid3D:this.grid;for(let x=0;x<r.length;x++){const w=r[x],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<w.length;M++){const O=w[M];C[0]=Math.min(C[0],O.x),C[1]=Math.min(C[1],O.y),C[2]=Math.max(C[2],O.x),C[3]=Math.max(C[3],O.y)}C[0]<xt&&C[1]<xt&&C[2]>=0&&C[3]>=0&&_.insert(m,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new r3.VectorTile(new P7(this.rawTileData)).layers,this.sourceLayerCoder=new C0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,l){this.loadVTLayers();const p=t.params,d=xt/t.tileSize/t.scale,m=v4(p.filter),_=t.queryGeometry,x=t.queryPadding*d,w=P0(_),C=this.grid.query(w.minX-x,w.minY-x,w.maxX+x,w.maxY+x),M=P0(t.cameraQueryGeometry),O=this.grid3D.query(M.minX-x,M.minY-x,M.maxX+x,M.maxY+x,(H,$,ae,K)=>function(I,j,Q,_e,De){for(const Pe of I)if(j<=Pe.x&&Q<=Pe.y&&_e>=Pe.x&&De>=Pe.y)return!0;const Te=[new Ce(j,Q),new Ce(j,De),new Ce(_e,De),new Ce(_e,Q)];if(I.length>2){for(const Pe of Te)if(Is(I,Pe))return!0}for(let Pe=0;Pe<I.length-1;Pe++)if(f2(I[Pe],I[Pe+1],Te))return!0;return!1}(t.cameraQueryGeometry,H-x,$-x,ae+x,K+x));for(const H of O)C.push(H);C.sort(w6);const N={};let z;for(let H=0;H<C.length;H++){const $=C[H];if($===z)continue;z=$;const ae=this.featureIndexArray.get($);let K=null;this.loadMatchingFeature(N,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,m,p.layers,p.availableImages,r,o,l,(I,j,Q)=>(K||(K=Co(I)),j.queryIntersectsFeature({queryGeometry:_,feature:I,featureState:Q,geometry:K,zoom:this.z,transform:t.transform,pixelsToTileUnits:d,pixelPosMatrix:t.pixelPosMatrix})))}return N}loadMatchingFeature(t,r,o,l,p,d,m,_,x,w,C){const M=this.bucketLayerIDs[r];if(d&&!M.some(H=>d.has(H)))return;const O=this.sourceLayerCoder.decode(o),N=this.vtLayers[O].feature(l);if(p.needGeometry){const H=Ao(N,!0);if(!p.filter(new pi(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!p.filter(new pi(this.tileID.overscaledZ),N))return;const z=this.getId(N,O);for(let H=0;H<M.length;H++){const $=M[H];if(d&&!d.has($))continue;const ae=_[$];if(!ae)continue;let K={};z&&w&&(K=w.getState(ae.sourceLayer||"_geojsonTileLayer",z));const I=ci({},x[$]);I.paint=L0(I.paint,ae.paint,N,K,m),I.layout=L0(I.layout,ae.layout,N,K,m);const j=!C||C(N,ae,K);if(!j)continue;const Q=new A0(N,this.z,this.x,this.y,z);Q.layer=I;let _e=t[$];_e===void 0&&(_e=t[$]=[]),_e.push({featureIndex:l,feature:Q,intersectionZ:j})}}lookupSymbolFeatures(t,r,o,l,p,d,m,_){const x={};this.loadVTLayers();const w=v4(p);for(const C of t)this.loadMatchingFeature(x,o,l,C,w,d,m,_,r);return x}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){var o;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function L0(n,t,r,o,l){return nr(n,(p,d)=>{const m=t instanceof ys?t.get(d):null;return m&&m.evaluate?m.evaluate(r,o,l):m})}function P0(n){let t=1/0,r=1/0,o=-1/0,l=-1/0;for(const p of n)t=Math.min(t,p.x),r=Math.min(r,p.y),o=Math.max(o,p.x),l=Math.max(l,p.y);return{minX:t,minY:r,maxX:o,maxY:l}}function w6(n,t){return t-n}function M0(n,t,r,o,l){const p=[];for(let d=0;d<n.length;d++){const m=n[d];let _;for(let x=0;x<m.length-1;x++){let w=m[x],C=m[x+1];w.x<t&&C.x<t||(w.x<t?w=new Ce(t,w.y+(t-w.x)/(C.x-w.x)*(C.y-w.y))._round():C.x<t&&(C=new Ce(t,w.y+(t-w.x)/(C.x-w.x)*(C.y-w.y))._round()),w.y<r&&C.y<r||(w.y<r?w=new Ce(w.x+(r-w.y)/(C.y-w.y)*(C.x-w.x),r)._round():C.y<r&&(C=new Ce(w.x+(r-w.y)/(C.y-w.y)*(C.x-w.x),r)._round()),w.x>=o&&C.x>=o||(w.x>=o?w=new Ce(o,w.y+(o-w.x)/(C.x-w.x)*(C.y-w.y))._round():C.x>=o&&(C=new Ce(o,w.y+(o-w.x)/(C.x-w.x)*(C.y-w.y))._round()),w.y>=l&&C.y>=l||(w.y>=l?w=new Ce(w.x+(l-w.y)/(C.y-w.y)*(C.x-w.x),l)._round():C.y>=l&&(C=new Ce(w.x+(l-w.y)/(C.y-w.y)*(C.x-w.x),l)._round()),_&&w.equals(_[_.length-1])||(_=[w],p.push(_)),_.push(C)))))}}return p}We("FeatureIndex",E0,{omit:["rawTileData","sourceLayerCoder"]});class Jo extends Ce{constructor(t,r,o,l){super(t,r),this.angle=o,l!==void 0&&(this.segment=l)}clone(){return new Jo(this.x,this.y,this.angle,this.segment)}}function I0(n,t,r,o,l){if(t.segment===void 0||r===0)return!0;let p=t,d=t.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=n[d].dist(p),p=n[d]}m+=n[d].dist(n[d+1]),d++;const _=[];let x=0;for(;m<r/2;){const w=n[d],C=n[d+1];if(!C)return!1;let M=n[d-1].angleTo(w)-w.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:m,angleDelta:M}),x+=M;m-_[0].distance>o;)x-=_.shift().angleDelta;if(x>l)return!1;d++,m+=w.dist(C)}return!0}function O0(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function N0(n,t,r){return n?.6*t*r:0}function k0(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function T6(n,t,r,o,l,p){const d=N0(r,l,p),m=k0(r,o)*p;let _=0;const x=O0(n)/2;for(let w=0;w<n.length-1;w++){const C=n[w],M=n[w+1],O=C.dist(M);if(_+O>x){const N=(x-_)/O,z=Jr.number(C.x,M.x,N),H=Jr.number(C.y,M.y,N),$=new Jo(z,H,M.angleTo(C),w);return $._round(),!d||I0(n,$,m,d,t)?$:void 0}_+=O}}function S6(n,t,r,o,l,p,d,m,_){const x=N0(o,p,d),w=k0(o,l),C=w*d,M=n[0].x===0||n[0].x===_||n[0].y===0||n[0].y===_;return t-C<t/4&&(t=C+t/4),R0(n,M?t/2*m%t:(w/2+2*p)*d*m%t,t,x,r,C,M,!1,_)}function R0(n,t,r,o,l,p,d,m,_){const x=p/2,w=O0(n);let C=0,M=t-r,O=[];for(let N=0;N<n.length-1;N++){const z=n[N],H=n[N+1],$=z.dist(H),ae=H.angleTo(z);for(;M+r<C+$;){M+=r;const K=(M-C)/$,I=Jr.number(z.x,H.x,K),j=Jr.number(z.y,H.y,K);if(I>=0&&I<_&&j>=0&&j<_&&M-x>=0&&M+x<=w){const Q=new Jo(I,j,ae,N);Q._round(),o&&!I0(n,Q,p,o,l)||O.push(Q)}}C+=$}return m||O.length||d||(O=R0(n,C/2,r,o,l,p,d,!0,_)),O}We("Anchor",Jo);const u3=rn;function D0(n,t,r,o){const l=[],p=n.image,d=p.pixelRatio,m=p.paddedRect.w-2*u3,_=p.paddedRect.h-2*u3;let x={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const w=p.stretchX||[[0,m]],C=p.stretchY||[[0,_]],M=(ke,Ke)=>ke+Ke[1]-Ke[0],O=w.reduce(M,0),N=C.reduce(M,0),z=m-O,H=_-N;let $=0,ae=O,K=0,I=N,j=0,Q=z,_e=0,De=H;if(p.content&&o){const ke=p.content,Ke=ke[2]-ke[0],ht=ke[3]-ke[1];(p.textFitWidth||p.textFitHeight)&&(x=l0(n)),$=wl(w,0,ke[0]),K=wl(C,0,ke[1]),ae=wl(w,ke[0],ke[2]),I=wl(C,ke[1],ke[3]),j=ke[0]-$,_e=ke[1]-K,Q=Ke-ae,De=ht-I}const Te=x.x1,Pe=x.y1,Be=x.x2-Te,ze=x.y2-Pe,Ge=(ke,Ke,ht,lt)=>{const tt=Tl(ke.stretch-$,ae,Be,Te),At=Sl(ke.fixed-j,Q,ke.stretch,O),Ci=Tl(Ke.stretch-K,I,ze,Pe),Wi=Sl(Ke.fixed-_e,De,Ke.stretch,N),cr=Tl(ht.stretch-$,ae,Be,Te),Gn=Sl(ht.fixed-j,Q,ht.stretch,O),jr=Tl(lt.stretch-K,I,ze,Pe),hr=Sl(lt.fixed-_e,De,lt.stretch,N),br=new Ce(tt,Ci),Mi=new Ce(cr,Ci),Xi=new Ce(cr,jr),Hr=new Ce(tt,jr),Vr=new Ce(At/d,Wi/d),Zr=new Ce(Gn/d,hr/d),Ki=t*Math.PI/180;if(Ki){const Ft=Math.sin(Ki),wr=Math.cos(Ki),wi=[wr,-Ft,Ft,wr];br._matMult(wi),Mi._matMult(wi),Hr._matMult(wi),Xi._matMult(wi)}const Tn=ke.stretch+ke.fixed,nn=Ke.stretch+Ke.fixed;return{tl:br,tr:Mi,bl:Hr,br:Xi,tex:{x:p.paddedRect.x+u3+Tn,y:p.paddedRect.y+u3+nn,w:ht.stretch+ht.fixed-Tn,h:lt.stretch+lt.fixed-nn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:Zr,minFontScaleX:Q/d/Be,minFontScaleY:De/d/ze,isSDF:r}};if(o&&(p.stretchX||p.stretchY)){const ke=z0(w,z,O),Ke=z0(C,H,N);for(let ht=0;ht<ke.length-1;ht++){const lt=ke[ht],tt=ke[ht+1];for(let At=0;At<Ke.length-1;At++)l.push(Ge(lt,Ke[At],tt,Ke[At+1]))}}else l.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:_+1}));return l}function wl(n,t,r){let o=0;for(const l of n)o+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return o}function z0(n,t,r){const o=[{fixed:-1,stretch:0}];for(const[l,p]of n){const d=o[o.length-1];o.push({fixed:l-d.stretch,stretch:d.stretch}),o.push({fixed:l-d.stretch,stretch:d.stretch+(p-l)})}return o.push({fixed:t+u3,stretch:r}),o}function Tl(n,t,r,o){return n/t*r+o}function Sl(n,t,r,o){return n-t*r/o}class Cl{constructor(t,r,o,l,p,d,m,_,x,w){var C;if(this.boxStartIndex=t.length,x){let M=d.top,O=d.bottom;const N=d.collisionPadding;N&&(M-=N[1],O+=N[3]);let z=O-M;z>0&&(z=Math.max(10,z),this.circleDiameter=z)}else{const M=!((C=d.image)===null||C===void 0)&&C.content&&(d.image.textFitWidth||d.image.textFitHeight)?l0(d):{x1:d.left,y1:d.top,x2:d.right,y2:d.bottom};M.y1=M.y1*m-_[0],M.y2=M.y2*m+_[2],M.x1=M.x1*m-_[3],M.x2=M.x2*m+_[1];const O=d.collisionPadding;if(O&&(M.x1-=O[0]*m,M.y1-=O[1]*m,M.x2+=O[2]*m,M.y2+=O[3]*m),w){const N=new Ce(M.x1,M.y1),z=new Ce(M.x2,M.y1),H=new Ce(M.x1,M.y2),$=new Ce(M.x2,M.y2),ae=w*Math.PI/180;N._rotate(ae),z._rotate(ae),H._rotate(ae),$._rotate(ae),M.x1=Math.min(N.x,z.x,H.x,$.x),M.x2=Math.max(N.x,z.x,H.x,$.x),M.y1=Math.min(N.y,z.y,H.y,$.y),M.y2=Math.max(N.y,z.y,H.y,$.y)}t.emplaceBack(r.x,r.y,M.x1,M.y1,M.x2,M.y2,o,l,p)}this.boxEndIndex=t.length}}class C6{constructor(t=[],r=(o,l)=>o<l?-1:o>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,l=r[t];for(;t>0;){const p=t-1>>1,d=r[p];if(o(l,d)>=0)break;r[t]=d,t=p}r[t]=l}_down(t){const{data:r,compare:o}=this,l=this.length>>1,p=r[t];for(;t<l;){let d=1+(t<<1);const m=d+1;if(m<this.length&&o(r[m],r[d])<0&&(d=m),o(r[d],p)>=0)break;r[t]=r[d],t=d}r[t]=p}}function A6(n,t=1,r=!1){let o=1/0,l=1/0,p=-1/0,d=-1/0;const m=n[0];for(let O=0;O<m.length;O++){const N=m[O];(!O||N.x<o)&&(o=N.x),(!O||N.y<l)&&(l=N.y),(!O||N.x>p)&&(p=N.x),(!O||N.y>d)&&(d=N.y)}const _=Math.min(p-o,d-l);let x=_/2;const w=new C6([],E6);if(_===0)return new Ce(o,l);for(let O=o;O<p;O+=_)for(let N=l;N<d;N+=_)w.push(new Bs(O+x,N+x,x,n));let C=function(O){let N=0,z=0,H=0;const $=O[0];for(let ae=0,K=$.length,I=K-1;ae<K;I=ae++){const j=$[ae],Q=$[I],_e=j.x*Q.y-Q.x*j.y;z+=(j.x+Q.x)*_e,H+=(j.y+Q.y)*_e,N+=3*_e}return new Bs(z/N,H/N,0,O)}(n),M=w.length;for(;w.length;){const O=w.pop();(O.d>C.d||!C.d)&&(C=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,M)),O.max-C.d<=t||(x=O.h/2,w.push(new Bs(O.p.x-x,O.p.y-x,x,n)),w.push(new Bs(O.p.x+x,O.p.y-x,x,n)),w.push(new Bs(O.p.x-x,O.p.y+x,x,n)),w.push(new Bs(O.p.x+x,O.p.y+x,x,n)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function E6(n,t){return t.max-n.max}function Bs(n,t,r,o){this.p=new Ce(n,t),this.h=r,this.d=function(l,p){let d=!1,m=1/0;for(let _=0;_<p.length;_++){const x=p[_];for(let w=0,C=x.length,M=C-1;w<C;M=w++){const O=x[w],N=x[M];O.y>l.y!=N.y>l.y&&l.x<(N.x-O.x)*(l.y-O.y)/(N.y-O.y)+O.x&&(d=!d),m=Math.min(m,y9(l,O,N))}}return(d?1:-1)*Math.sqrt(m)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var vr;S.av=void 0,(vr=S.av||(S.av={}))[vr.center=1]="center",vr[vr.left=2]="left",vr[vr.right=3]="right",vr[vr.top=4]="top",vr[vr.bottom=5]="bottom",vr[vr["top-left"]=6]="top-left",vr[vr["top-right"]=7]="top-right",vr[vr["bottom-left"]=8]="bottom-left",vr[vr["bottom-right"]=9]="bottom-right";const Qo=7,j7=Number.POSITIVE_INFINITY;function B0(n,t){return t[1]!==j7?function(r,o,l){let p=0,d=0;switch(o=Math.abs(o),l=Math.abs(l),r){case"top-right":case"top-left":case"top":d=l-Qo;break;case"bottom-right":case"bottom-left":case"bottom":d=-l+Qo}switch(r){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,d]}(n,t[0],t[1]):function(r,o){let l=0,p=0;o<0&&(o=0);const d=o/Math.SQRT2;switch(r){case"top-right":case"top-left":p=d-Qo;break;case"bottom-right":case"bottom-left":p=-d+Qo;break;case"bottom":p=-o+Qo;break;case"top":p=o-Qo}switch(r){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=o;break;case"right":l=-o}return[l,p]}(n,t[0])}function F0(n,t,r){var o;const l=n.layout,p=(o=l.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(p){const m=p.values,_=[];for(let x=0;x<m.length;x+=2){const w=_[x]=m[x],C=m[x+1].map(M=>M*$i);w.startsWith("top")?C[1]-=Qo:w.startsWith("bottom")&&(C[1]+=Qo),_[x+1]=C}return new Mt(_)}const d=l.get("text-variable-anchor");if(d){let m;m=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*$i,j7]:l.get("text-offset").evaluate(t,{},r).map(x=>x*$i);const _=[];for(const x of d)_.push(x,B0(x,m));return new Mt(_)}return null}function H7(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function L6(n,t,r,o,l,p,d,m,_,x,w,C){let M=p.textMaxSize.evaluate(t,{});M===void 0&&(M=d);const O=n.layers[0].layout,N=O.get("icon-offset").evaluate(t,{},w),z=U0(r.horizontal),H=d/24,$=n.tilePixelRatio*H,ae=n.tilePixelRatio*M/24,K=n.tilePixelRatio*m,I=n.tilePixelRatio*O.get("symbol-spacing"),j=O.get("text-padding")*n.tilePixelRatio,Q=function(ht,lt,tt,At=1){const Ci=ht.get("icon-padding").evaluate(lt,{},tt),Wi=Ci&&Ci.values;return[Wi[0]*At,Wi[1]*At,Wi[2]*At,Wi[3]*At]}(O,t,w,n.tilePixelRatio),_e=O.get("text-max-angle")/180*Math.PI,De=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Te=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Pe=O.get("symbol-placement"),Be=I/2,ze=O.get("icon-text-fit");let Ge;o&&ze!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Ge=c0(o,r.vertical,ze,O.get("icon-text-fit-padding"),N,H)),z&&(o=c0(o,z,ze,O.get("icon-text-fit-padding"),N,H)));const ke=w?C.line.getGranularityForZoomLevel(w.z):1,Ke=(ht,lt)=>{lt.x<0||lt.x>=xt||lt.y<0||lt.y>=xt||function(tt,At,Ci,Wi,cr,Gn,jr,hr,br,Mi,Xi,Hr,Vr,Zr,Ki,Tn,nn,Ft,wr,wi,Ai,rr,Ba,Sn,El){const Un=tt.addToLineVertexArray(At,Ci);let un,ur,Cn,Lo,Z0=0,Y0=0,q0=0,$0=0,K7=-1,J7=-1;const Po={};let W0=Yi("");if(tt.allowVerticalPlacement&&Wi.vertical){const Or=hr.layout.get("text-rotate").evaluate(Ai,{},Sn)+90;Cn=new Cl(br,At,Mi,Xi,Hr,Wi.vertical,Vr,Zr,Ki,Or),jr&&(Lo=new Cl(br,At,Mi,Xi,Hr,jr,nn,Ft,Ki,Or))}if(cr){const Or=hr.layout.get("icon-rotate").evaluate(Ai,{}),An=hr.layout.get("icon-text-fit")!=="none",Fa=D0(cr,Or,Ba,An),qn=jr?D0(jr,Or,Ba,An):void 0;ur=new Cl(br,At,Mi,Xi,Hr,cr,nn,Ft,!1,Or),Z0=4*Fa.length;const Ga=tt.iconSizeData;let no=null;Ga.kind==="source"?(no=[ro*hr.layout.get("icon-size").evaluate(Ai,{})],no[0]>Xo&&Kt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${c3}. Reduce your "icon-size".`)):Ga.kind==="composite"&&(no=[ro*rr.compositeIconSizes[0].evaluate(Ai,{},Sn),ro*rr.compositeIconSizes[1].evaluate(Ai,{},Sn)],(no[0]>Xo||no[1]>Xo)&&Kt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${c3}. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Fa,no,wi,wr,Ai,S.ai.none,At,Un.lineStartIndex,Un.lineLength,-1,Sn),K7=tt.icon.placedSymbolArray.length-1,qn&&(Y0=4*qn.length,tt.addSymbols(tt.icon,qn,no,wi,wr,Ai,S.ai.vertical,At,Un.lineStartIndex,Un.lineLength,-1,Sn),J7=tt.icon.placedSymbolArray.length-1)}const X0=Object.keys(Wi.horizontal);for(const Or of X0){const An=Wi.horizontal[Or];if(!un){W0=Yi(An.text);const qn=hr.layout.get("text-rotate").evaluate(Ai,{},Sn);un=new Cl(br,At,Mi,Xi,Hr,An,Vr,Zr,Ki,qn)}const Fa=An.positionedLines.length===1;if(q0+=G0(tt,At,An,Gn,hr,Ki,Ai,Tn,Un,Wi.vertical?S.ai.horizontal:S.ai.horizontalOnly,Fa?X0:[Or],Po,K7,rr,Sn),Fa)break}Wi.vertical&&($0+=G0(tt,At,Wi.vertical,Gn,hr,Ki,Ai,Tn,Un,S.ai.vertical,["vertical"],Po,J7,rr,Sn));const I6=un?un.boxStartIndex:tt.collisionBoxArray.length,O6=un?un.boxEndIndex:tt.collisionBoxArray.length,N6=Cn?Cn.boxStartIndex:tt.collisionBoxArray.length,k6=Cn?Cn.boxEndIndex:tt.collisionBoxArray.length,R6=ur?ur.boxStartIndex:tt.collisionBoxArray.length,D6=ur?ur.boxEndIndex:tt.collisionBoxArray.length,z6=Lo?Lo.boxStartIndex:tt.collisionBoxArray.length,B6=Lo?Lo.boxEndIndex:tt.collisionBoxArray.length;let Yn=-1;const Ll=(Or,An)=>Or&&Or.circleDiameter?Math.max(Or.circleDiameter,An):An;Yn=Ll(un,Yn),Yn=Ll(Cn,Yn),Yn=Ll(ur,Yn),Yn=Ll(Lo,Yn);const K0=Yn>-1?1:0;K0&&(Yn*=El/$i),tt.glyphOffsetArray.length>=Ds.MAX_GLYPHS&&Kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ai.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,Ai.sortKey);const F6=F0(hr,Ai,Sn),[G6,U6]=function(Or,An){const Fa=Or.length,qn=An==null?void 0:An.values;if((qn==null?void 0:qn.length)>0)for(let Ga=0;Ga<qn.length;Ga+=2){const no=qn[Ga+1];Or.emplaceBack(S.av[qn[Ga]],no[0],no[1])}return[Fa,Or.length]}(tt.textAnchorOffsets,F6);tt.symbolInstances.emplaceBack(At.x,At.y,Po.right>=0?Po.right:-1,Po.center>=0?Po.center:-1,Po.left>=0?Po.left:-1,Po.vertical||-1,K7,J7,W0,I6,O6,N6,k6,R6,D6,z6,B6,Mi,q0,$0,Z0,Y0,K0,0,Vr,Yn,G6,U6)}(n,lt,ht,r,o,l,Ge,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,$,[j,j,j,j],De,_,K,Q,Te,N,t,p,x,w,d)};if(Pe==="line")for(const ht of M0(t.geometry,0,0,xt,xt)){const lt=za(ht,ke),tt=S6(lt,I,_e,r.vertical||z,o,24,ae,n.overscaling,xt);for(const At of tt)z&&P6(n,z.text,Be,At)||Ke(lt,At)}else if(Pe==="line-center"){for(const ht of t.geometry)if(ht.length>1){const lt=za(ht,ke),tt=T6(lt,_e,r.vertical||z,o,24,ae);tt&&Ke(lt,tt)}}else if(t.type==="Polygon")for(const ht of Fo(t.geometry,0)){const lt=A6(ht,16);Ke(za(ht[0],ke,!0),new Jo(lt.x,lt.y,0))}else if(t.type==="LineString")for(const ht of t.geometry){const lt=za(ht,ke);Ke(lt,new Jo(lt[0].x,lt[0].y,0))}else if(t.type==="Point")for(const ht of t.geometry)for(const lt of ht)Ke([lt],new Jo(lt.x,lt.y,0))}function G0(n,t,r,o,l,p,d,m,_,x,w,C,M,O,N){const z=function(ae,K,I,j,Q,_e,De,Te){const Pe=j.layout.get("text-rotate").evaluate(_e,{})*Math.PI/180,Be=[];for(const ze of K.positionedLines)for(const Ge of ze.positionedGlyphs){if(!Ge.rect)continue;const ke=Ge.rect||{};let Ke=s6+1,ht=!0,lt=1,tt=0;const At=(Q||Te)&&Ge.vertical,Ci=Ge.metrics.advance*Ge.scale/2;if(Te&&K.verticalizable&&(tt=ze.lineOffset/2-(Ge.imageName?-($i-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*$i)),Ge.imageName){const Ft=De[Ge.imageName];ht=Ft.sdf,lt=Ft.pixelRatio,Ke=rn/lt}const Wi=Q?[Ge.x+Ci,Ge.y]:[0,0];let cr=Q?[0,0]:[Ge.x+Ci+I[0],Ge.y+I[1]-tt],Gn=[0,0];At&&(Gn=cr,cr=[0,0]);const jr=Ge.metrics.isDoubleResolution?2:1,hr=(Ge.metrics.left-Ke)*Ge.scale-Ci+cr[0],br=(-Ge.metrics.top-Ke)*Ge.scale+cr[1],Mi=hr+ke.w/jr*Ge.scale/lt,Xi=br+ke.h/jr*Ge.scale/lt,Hr=new Ce(hr,br),Vr=new Ce(Mi,br),Zr=new Ce(hr,Xi),Ki=new Ce(Mi,Xi);if(At){const Ft=new Ce(-Ci,Ci-s3),wr=-Math.PI/2,wi=$i/2-Ci,Ai=new Ce(5-s3-wi,-(Ge.imageName?wi:0)),rr=new Ce(...Gn);Hr._rotateAround(wr,Ft)._add(Ai)._add(rr),Vr._rotateAround(wr,Ft)._add(Ai)._add(rr),Zr._rotateAround(wr,Ft)._add(Ai)._add(rr),Ki._rotateAround(wr,Ft)._add(Ai)._add(rr)}if(Pe){const Ft=Math.sin(Pe),wr=Math.cos(Pe),wi=[wr,-Ft,Ft,wr];Hr._matMult(wi),Vr._matMult(wi),Zr._matMult(wi),Ki._matMult(wi)}const Tn=new Ce(0,0),nn=new Ce(0,0);Be.push({tl:Hr,tr:Vr,bl:Zr,br:Ki,tex:ke,writingMode:K.writingMode,glyphOffset:Wi,sectionIndex:Ge.sectionIndex,isSDF:ht,pixelOffsetTL:Tn,pixelOffsetBR:nn,minFontScaleX:0,minFontScaleY:0})}return Be}(0,r,m,l,p,d,o,n.allowVerticalPlacement),H=n.textSizeData;let $=null;H.kind==="source"?($=[ro*l.layout.get("text-size").evaluate(d,{})],$[0]>Xo&&Kt(`${n.layerIds[0]}: Value for "text-size" is >= ${c3}. Reduce your "text-size".`)):H.kind==="composite"&&($=[ro*O.compositeTextSizes[0].evaluate(d,{},N),ro*O.compositeTextSizes[1].evaluate(d,{},N)],($[0]>Xo||$[1]>Xo)&&Kt(`${n.layerIds[0]}: Value for "text-size" is >= ${c3}. Reduce your "text-size".`)),n.addSymbols(n.text,z,$,m,p,d,x,t,_.lineStartIndex,_.lineLength,M,N);for(const ae of w)C[ae]=n.text.placedSymbolArray.length-1;return 4*z.length}function U0(n){for(const t in n)return n[t];return null}function P6(n,t,r,o){const l=n.compareText;if(t in l){const p=l[t];for(let d=p.length-1;d>=0;d--)if(o.dist(p[d])<r)return!0}else l[t]=[];return l[t].push(o),!1}const j0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class V7{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const p=j0[15&o];if(!p)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,2,1),[m]=new Uint32Array(t,4,1);return new V7(m,d,p,t)}constructor(t,r=64,o=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=j0.indexOf(this.ArrayType),d=2*t*this.ArrayType.BYTES_PER_ELEMENT,m=t*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-m%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+_,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+_),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+_,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Z7(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:d,nodeSize:m}=this,_=[0,p.length-1,0],x=[];for(;_.length;){const w=_.pop()||0,C=_.pop()||0,M=_.pop()||0;if(C-M<=m){for(let H=M;H<=C;H++){const $=d[2*H],ae=d[2*H+1];$>=t&&$<=o&&ae>=r&&ae<=l&&x.push(p[H])}continue}const O=M+C>>1,N=d[2*O],z=d[2*O+1];N>=t&&N<=o&&z>=r&&z<=l&&x.push(p[O]),(w===0?t<=N:r<=z)&&(_.push(M),_.push(O-1),_.push(1-w)),(w===0?o>=N:l>=z)&&(_.push(O+1),_.push(C),_.push(1-w))}return x}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:p,nodeSize:d}=this,m=[0,l.length-1,0],_=[],x=o*o;for(;m.length;){const w=m.pop()||0,C=m.pop()||0,M=m.pop()||0;if(C-M<=d){for(let H=M;H<=C;H++)V0(p[2*H],p[2*H+1],t,r)<=x&&_.push(l[H]);continue}const O=M+C>>1,N=p[2*O],z=p[2*O+1];V0(N,z,t,r)<=x&&_.push(l[O]),(w===0?t-o<=N:r-o<=z)&&(m.push(M),m.push(O-1),m.push(1-w)),(w===0?t+o>=N:r+o>=z)&&(m.push(O+1),m.push(C),m.push(1-w))}return _}}function Z7(n,t,r,o,l,p){if(l-o<=r)return;const d=o+l>>1;H0(n,t,d,o,l,p),Z7(n,t,r,o,d-1,1-p),Z7(n,t,r,d+1,l,1-p)}function H0(n,t,r,o,l,p){for(;l>o;){if(l-o>600){const x=l-o+1,w=r-o+1,C=Math.log(x),M=.5*Math.exp(2*C/3),O=.5*Math.sqrt(C*M*(x-M)/x)*(w-x/2<0?-1:1);H0(n,t,r,Math.max(o,Math.floor(r-w*M/x+O)),Math.min(l,Math.floor(r+(x-w)*M/x+O)),p)}const d=t[2*r+p];let m=o,_=l;for(p3(n,t,o,r),t[2*l+p]>d&&p3(n,t,o,l);m<_;){for(p3(n,t,m,_),m++,_--;t[2*m+p]<d;)m++;for(;t[2*_+p]>d;)_--}t[2*o+p]===d?p3(n,t,o,_):(_++,p3(n,t,_,l)),_<=r&&(o=_+1),r<=_&&(l=_-1)}}function p3(n,t,r,o){Y7(n,r,o),Y7(t,2*r,2*o),Y7(t,2*r+1,2*o+1)}function Y7(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function V0(n,t,r,o){const l=n-r,p=t-o;return l*l+p*p}var q7;S.ce=void 0,(q7=S.ce||(S.ce={})).create="create",q7.load="load",q7.fullLoad="fullLoad";let Al=null,d3=[];const $7=1e3/60,W7="loadTime",X7="fullLoadTime",M6={mark(n){performance.mark(n)},frame(n){const t=n;Al!=null&&d3.push(t-Al),Al=t},clearMetrics(){Al=null,d3=[],performance.clearMeasures(W7),performance.clearMeasures(X7);for(const n in S.ce)performance.clearMarks(S.ce[n])},getPerformanceMetrics(){performance.measure(W7,S.ce.create,S.ce.load),performance.measure(X7,S.ce.create,S.ce.fullLoad);const n=performance.getEntriesByName(W7)[0].duration,t=performance.getEntriesByName(X7)[0].duration,r=d3.length,o=1/(d3.reduce((p,d)=>p+d,0)/r/1e3),l=d3.filter(p=>p>$7).reduce((p,d)=>p+(d-$7)/$7,0);return{loadTime:n,fullLoadTime:t,fps:o,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};S.$=se,S.A=ot,S.B=l7,S.C=function(n){if(_i==null){const t=n.navigator?n.navigator.userAgent:null;_i=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _i},S.D=rt,S.E=Dr,S.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new b6(()=>this.process()),this.subscription=function(r,o,l,p){return r.addEventListener(o,l,!1),{unsubscribe:()=>{r.removeEventListener(o,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Sr(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,o)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];const m={id:l,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(m)},{once:!0});const p=[],d=Object.assign(Object.assign({},n),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Sa(n.data,p)});this.target.postMessage(d,{transfer:p})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(Sr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[n];return delete this.resolveRejects[n],l?void(t.error?l.reject(Ca(t.error)):l.resolve(Ca(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ca(t.data),o=new AbortController;this.abortControllers[n]=o;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(n,null,l)}catch(l){this.completeTask(n,l)}})}completeTask(n,t,r){const o=[];delete this.abortControllers[n];const l={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Sa(t):null,data:Sa(r,o)};this.target.postMessage(l,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=ji,S.H=function(){var n=new ot(16);return ot!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},S.I=I7,S.J=function(n,t,r){var o,l,p,d,m,_,x,w,C,M,O,N,z=r[0],H=r[1],$=r[2];return t===n?(n[12]=t[0]*z+t[4]*H+t[8]*$+t[12],n[13]=t[1]*z+t[5]*H+t[9]*$+t[13],n[14]=t[2]*z+t[6]*H+t[10]*$+t[14],n[15]=t[3]*z+t[7]*H+t[11]*$+t[15]):(l=t[1],p=t[2],d=t[3],m=t[4],_=t[5],x=t[6],w=t[7],C=t[8],M=t[9],O=t[10],N=t[11],n[0]=o=t[0],n[1]=l,n[2]=p,n[3]=d,n[4]=m,n[5]=_,n[6]=x,n[7]=w,n[8]=C,n[9]=M,n[10]=O,n[11]=N,n[12]=o*z+m*H+C*$+t[12],n[13]=l*z+_*H+M*$+t[13],n[14]=p*z+x*H+O*$+t[14],n[15]=d*z+w*H+N*$+t[15]),n},S.K=function(n,t,r){var o=r[0],l=r[1],p=r[2];return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*l,n[5]=t[5]*l,n[6]=t[6]*l,n[7]=t[7]*l,n[8]=t[8]*p,n[9]=t[9]*p,n[10]=t[10]*p,n[11]=t[11]*p,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},S.L=function(n,t,r){var o=t[0],l=t[1],p=t[2],d=t[3],m=t[4],_=t[5],x=t[6],w=t[7],C=t[8],M=t[9],O=t[10],N=t[11],z=t[12],H=t[13],$=t[14],ae=t[15],K=r[0],I=r[1],j=r[2],Q=r[3];return n[0]=K*o+I*m+j*C+Q*z,n[1]=K*l+I*_+j*M+Q*H,n[2]=K*p+I*x+j*O+Q*$,n[3]=K*d+I*w+j*N+Q*ae,n[4]=(K=r[4])*o+(I=r[5])*m+(j=r[6])*C+(Q=r[7])*z,n[5]=K*l+I*_+j*M+Q*H,n[6]=K*p+I*x+j*O+Q*$,n[7]=K*d+I*w+j*N+Q*ae,n[8]=(K=r[8])*o+(I=r[9])*m+(j=r[10])*C+(Q=r[11])*z,n[9]=K*l+I*_+j*M+Q*H,n[10]=K*p+I*x+j*O+Q*$,n[11]=K*d+I*w+j*N+Q*ae,n[12]=(K=r[12])*o+(I=r[13])*m+(j=r[14])*C+(Q=r[15])*z,n[13]=K*l+I*_+j*M+Q*H,n[14]=K*p+I*x+j*O+Q*$,n[15]=K*d+I*w+j*N+Q*ae,n},S.M=function(n,t){const r={};for(let o=0;o<t.length;o++){const l=t[o];l in n&&(r[l]=n[l])}return r},S.N=Ko,S.O=y0,S.P=Ce,S.Q=x0,S.R=bn,S.S=wn,S.T=B4,S.U=dt,S.V=He,S.W=Gi,S.X=xt,S.Y=h3,S.Z=U7,S._=c,S.a=Wr,S.a$=function(){return new Float64Array(16)},S.a0=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const o of n){const l=window.document.createElement("source");Yt(o)||(t.crossOrigin="Anonymous"),l.src=o,t.appendChild(l)}})},S.a1=function(){return Tr++},S.a2=s,S.a3=Ds,S.a4=v4,S.a5=Ao,S.a6=A0,S.a7=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,l,p)=>{const d=l||p;return t[o]=!d||d.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},S.a8=function(n){return Math.log(n)/Math.LN2},S.a9=function(n){var t=n[0],r=n[1];return t*t+r*r},S.aA=di,S.aB=ml,S.aC=Y,S.aD=Ne,S.aE=Ie,S.aF=85.051129,S.aG=function(n){return Math.pow(2,n)},S.aH=v0,S.aI=Li,S.aJ=Ui,S.aK=b0,S.aL=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},S.aM=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},S.aN=function(n){var t=new ot(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},S.aO=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},S.aP=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},S.aQ=function(n,t){var r=t[0],o=t[1],l=t[2],p=r*r+o*o+l*l;return p>0&&(p=1/Math.sqrt(p)),n[0]=t[0]*p,n[1]=t[1]*p,n[2]=t[2]*p,n},S.aR=function(n,t,r){var o=t[0],l=t[1],p=t[2],d=r[0],m=r[1],_=r[2];return n[0]=l*_-p*m,n[1]=p*d-o*_,n[2]=o*m-l*d,n},S.aS=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},S.aT=T0,S.aU=zs,S.aV=function(n,t,r,o,l){var p,d=1/Math.tan(t/2);return n[0]=d/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0?(n[10]=(l+o)*(p=1/(o-l)),n[14]=2*l*o*p):(n[10]=-1,n[14]=-2*o),n},S.aW=function(n){var t=new ot(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},S.aX=function(n,t,r){var o=Math.sin(r),l=Math.cos(r),p=t[0],d=t[1],m=t[2],_=t[3],x=t[4],w=t[5],C=t[6],M=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=p*l+x*o,n[1]=d*l+w*o,n[2]=m*l+C*o,n[3]=_*l+M*o,n[4]=x*l-p*o,n[5]=w*l-d*o,n[6]=C*l-m*o,n[7]=M*l-_*o,n},S.aY=function(n,t,r){var o=Math.sin(r),l=Math.cos(r),p=t[4],d=t[5],m=t[6],_=t[7],x=t[8],w=t[9],C=t[10],M=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=p*l+x*o,n[5]=d*l+w*o,n[6]=m*l+C*o,n[7]=_*l+M*o,n[8]=x*l-p*o,n[9]=w*l-d*o,n[10]=C*l-m*o,n[11]=M*l-_*o,n},S.aZ=function(){const n=new Float32Array(16);return Et(n),n},S.a_=function(){const n=new Float64Array(16);return Et(n),n},S.aa=function(n){return n*Math.PI/180},S.ab=Fi,S.ac=function(n,t){const r=[];for(const o in n)o in t||r.push(o);return r},S.ad=Zt,S.ae=function(n){return Math.hypot(n[0],n[1])},S.af=function(n){return n[0]=0,n[1]=0,n},S.ag=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},S.ah=function(n,t){let r=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:l,minZoom:p,maxZoom:d}=n,m=l?Fi(lr.interpolationFactor(l,t,p,d),0,1):0;n.kind==="camera"?o=Jr.number(n.minSize,n.maxSize,m):r=m}return{uSizeT:r,uSize:o}},S.aj=function(n,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:l}){return n.kind==="source"?o/ro:n.kind==="composite"?Jr.number(o/ro,l/ro,r):t},S.ak=R7,S.al=si,S.am=function(n,t,r,o){const l=t.y-n.y,p=t.x-n.x,d=o.y-r.y,m=o.x-r.x,_=d*p-m*l;if(_===0)return null;const x=(m*(n.y-r.y)-d*(n.x-r.x))/_;return new Ce(n.x+x*p,n.y+x*l)},S.an=function(n,t){var r=t[0],o=t[1],l=t[2],p=t[3],d=t[4],m=t[5],_=t[6],x=t[7],w=t[8],C=t[9],M=t[10],O=t[11],N=t[12],z=t[13],H=t[14],$=t[15],ae=r*m-o*d,K=r*_-l*d,I=r*x-p*d,j=o*_-l*m,Q=o*x-p*m,_e=l*x-p*_,De=w*z-C*N,Te=w*H-M*N,Pe=w*$-O*N,Be=C*H-M*z,ze=C*$-O*z,Ge=M*$-O*H,ke=ae*Ge-K*ze+I*Be+j*Pe-Q*Te+_e*De;return ke?(n[0]=(m*Ge-_*ze+x*Be)*(ke=1/ke),n[1]=(l*ze-o*Ge-p*Be)*ke,n[2]=(z*_e-H*Q+$*j)*ke,n[3]=(M*Q-C*_e-O*j)*ke,n[4]=(_*Pe-d*Ge-x*Te)*ke,n[5]=(r*Ge-l*Pe+p*Te)*ke,n[6]=(H*I-N*_e-$*K)*ke,n[7]=(w*_e-M*I+O*K)*ke,n[8]=(d*ze-m*Pe+x*De)*ke,n[9]=(o*Pe-r*ze-p*De)*ke,n[10]=(N*Q-z*I+$*ae)*ke,n[11]=(C*I-w*Q-O*ae)*ke,n[12]=(m*Te-d*Be-_*De)*ke,n[13]=(r*Be-o*Te+l*De)*ke,n[14]=(z*K-N*j-H*ae)*ke,n[15]=(w*j-C*K+M*ae)*ke,n):null},S.ao=M0,S.ap=$4,S.aq=Et,S.ar=function(n){let t=1/0,r=1/0,o=-1/0,l=-1/0;for(const p of n)t=Math.min(t,p.x),r=Math.min(r,p.y),o=Math.max(o,p.x),l=Math.max(l,p.y);return[t,r,o,l]},S.as=$i,S.at=Ii,S.au=function(n,t,r,o,l=!1){if(!r[0]&&!r[1])return[0,0];const p=l?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(p){const d=Math.sin(p),m=Math.cos(p);r=[r[0]*m-r[1]*d,r[0]*d+r[1]*m]}return[l?r[0]:Ii(t,r[0],n.zoom),l?r[1]:Ii(t,r[1],n.zoom)]},S.aw=k7,S.ax=H7,S.ay=N7,S.az=V7,S.b=$r,S.b$=n=>n.type==="line",S.b0=function(n,t,r){const o=new Float64Array(4);return function(l,p,d,m){var _=.5*Math.PI/180;p*=_,d*=_,m*=_;var x=Math.sin(p),w=Math.cos(p),C=Math.sin(d),M=Math.cos(d),O=Math.sin(m),N=Math.cos(m);l[0]=x*M*N-w*C*O,l[1]=w*C*N+x*M*O,l[2]=w*M*O-x*C*N,l[3]=w*M*N+x*C*O}(o,n,t-90,r),o},S.b1=function(n,t,r,o){var l,p,d,m,_,x=t[0],w=t[1],C=t[2],M=t[3],O=r[0],N=r[1],z=r[2],H=r[3];return(p=x*O+w*N+C*z+M*H)<0&&(p=-p,O=-O,N=-N,z=-z,H=-H),1-p>mt?(l=Math.acos(p),d=Math.sin(l),m=Math.sin((1-o)*l)/d,_=Math.sin(o*l)/d):(m=1-o,_=o),n[0]=m*x+_*O,n[1]=m*w+_*N,n[2]=m*C+_*z,n[3]=m*M+_*H,n},S.b2=function(n){const t=new Float64Array(9);var r,o,l,p,d,m,_,x,w,C,M,O,N,z,H,$,ae,K;C=(l=(o=n)[0])*(_=l+l),M=(p=o[1])*_,N=(d=o[2])*_,z=d*(x=p+p),$=(m=o[3])*_,ae=m*x,K=m*(w=d+d),(r=t)[0]=1-(O=p*x)-(H=d*w),r[3]=M-K,r[6]=N+ae,r[1]=M+K,r[4]=1-C-H,r[7]=z-$,r[2]=N-ae,r[5]=z+$,r[8]=1-C-O;const I=Ui(-Math.asin(Fi(t[2],-1,1)));let j,Q;return Math.hypot(t[5],t[8])<.001?(j=0,Q=-Ui(Math.atan2(t[3],t[4]))):(j=Ui(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Q=Ui(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:j,pitch:I+90,bearing:Q}},S.b3=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},S.b4=St,S.b5=Fn,S.b6=ks,S.b7=t3,S.b8=Ns,S.b9=li,S.bA=nr,S.bB=or,S.bC=class extends en{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},S.bD=class extends en{constructor(n,t){super(n,t),this.current=Ls}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},S.bE=So,S.bF=ka,S.bG=class extends en{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},S.bH=class extends en{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},S.bI=we,S.bJ=function(n,t){var r=Math.sin(t),o=Math.cos(t);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},S.bK=function(n,t,r){var o=t[0],l=t[1],p=t[2];return n[0]=o*r[0]+l*r[3]+p*r[6],n[1]=o*r[1]+l*r[4]+p*r[7],n[2]=o*r[2]+l*r[5]+p*r[8],n},S.bL=function(n,t,r,o,l,p,d){var m=1/(t-r),_=1/(o-l),x=1/(p-d);return n[0]=-2*m,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*x,n[11]=0,n[12]=(t+r)*m,n[13]=(l+o)*_,n[14]=(d+p)*x,n[15]=1,n},S.bM=class extends wo{},S.bN=t6,S.bO=class extends Na{},S.bP=m7,S.bQ=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},S.bR=A9,S.bS=function(n,t,r){var o=t[0],l=t[1],p=t[2],d=r[3]*o+r[7]*l+r[11]*p+r[15];return n[0]=(r[0]*o+r[4]*l+r[8]*p+r[12])/(d=d||1),n[1]=(r[1]*o+r[5]*l+r[9]*p+r[13])/d,n[2]=(r[2]*o+r[6]*l+r[10]*p+r[14])/d,n},S.bT=class extends Ts{},S.bU=class extends e{},S.bV=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},S.bW=function(n,t){var r=n[0],o=n[1],l=n[2],p=n[3],d=n[4],m=n[5],_=n[6],x=n[7],w=n[8],C=n[9],M=n[10],O=n[11],N=n[12],z=n[13],H=n[14],$=n[15],ae=t[0],K=t[1],I=t[2],j=t[3],Q=t[4],_e=t[5],De=t[6],Te=t[7],Pe=t[8],Be=t[9],ze=t[10],Ge=t[11],ke=t[12],Ke=t[13],ht=t[14],lt=t[15];return Math.abs(r-ae)<=mt*Math.max(1,Math.abs(r),Math.abs(ae))&&Math.abs(o-K)<=mt*Math.max(1,Math.abs(o),Math.abs(K))&&Math.abs(l-I)<=mt*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(p-j)<=mt*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(d-Q)<=mt*Math.max(1,Math.abs(d),Math.abs(Q))&&Math.abs(m-_e)<=mt*Math.max(1,Math.abs(m),Math.abs(_e))&&Math.abs(_-De)<=mt*Math.max(1,Math.abs(_),Math.abs(De))&&Math.abs(x-Te)<=mt*Math.max(1,Math.abs(x),Math.abs(Te))&&Math.abs(w-Pe)<=mt*Math.max(1,Math.abs(w),Math.abs(Pe))&&Math.abs(C-Be)<=mt*Math.max(1,Math.abs(C),Math.abs(Be))&&Math.abs(M-ze)<=mt*Math.max(1,Math.abs(M),Math.abs(ze))&&Math.abs(O-Ge)<=mt*Math.max(1,Math.abs(O),Math.abs(Ge))&&Math.abs(N-ke)<=mt*Math.max(1,Math.abs(N),Math.abs(ke))&&Math.abs(z-Ke)<=mt*Math.max(1,Math.abs(z),Math.abs(Ke))&&Math.abs(H-ht)<=mt*Math.max(1,Math.abs(H),Math.abs(ht))&&Math.abs($-lt)<=mt*Math.max(1,Math.abs($),Math.abs(lt))},S.bX=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},S.bY=n=>n.type==="symbol",S.bZ=n=>n.type==="circle",S.b_=n=>n.type==="heatmap",S.ba=dr,S.bb=jt,S.bc=function(n,t,r,o,l){return li(o,l,Fi((n-t)/(r-t),0,1))},S.bd=ct,S.be=function(){return new Float64Array(4)},S.bf=function(){return new Float64Array(3)},S.bg=function(n,t,r,o){var l=[],p=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],p[0]=l[0]*Math.cos(o)-l[1]*Math.sin(o),p[1]=l[0]*Math.sin(o)+l[1]*Math.cos(o),p[2]=l[2],n[0]=p[0]+r[0],n[1]=p[1]+r[1],n[2]=p[2]+r[2],n},S.bh=function(n,t,r,o){var l=[],p=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],p[0]=l[0],p[1]=l[1]*Math.cos(o)-l[2]*Math.sin(o),p[2]=l[1]*Math.sin(o)+l[2]*Math.cos(o),n[0]=p[0]+r[0],n[1]=p[1]+r[1],n[2]=p[2]+r[2],n},S.bi=function(n,t,r,o){var l=[],p=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],p[0]=l[2]*Math.sin(o)+l[0]*Math.cos(o),p[1]=l[1],p[2]=l[2]*Math.cos(o)-l[0]*Math.sin(o),n[0]=p[0]+r[0],n[1]=p[1]+r[1],n[2]=p[2]+r[2],n},S.bj=function(n,t,r){var o=Math.sin(r),l=Math.cos(r),p=t[0],d=t[1],m=t[2],_=t[3],x=t[8],w=t[9],C=t[10],M=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=p*l-x*o,n[1]=d*l-w*o,n[2]=m*l-C*o,n[3]=_*l-M*o,n[8]=p*o+x*l,n[9]=d*o+w*l,n[10]=m*o+C*l,n[11]=_*o+M*l,n},S.bk=function(n,t){const r=ct(n,360),o=ct(t,360),l=o-r,p=o>r?l-360:l+360;return Math.abs(l)<Math.abs(p)?l:p},S.bl=function(n){return n[0]=0,n[1]=0,n[2]=0,n},S.bm=function(n,t,r,o){const l=Math.sqrt(n*n+t*t),p=Math.sqrt(r*r+o*o);n/=l,t/=l,r/=p,o/=p;const d=Math.acos(n*r+t*o);return-t*r+n*o>0?d:-d},S.bn=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},S.bo=F7,S.bp=function(n,t){const r=ct(n,2*Math.PI),o=ct(t,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},S.bq=function(n){return Math.hypot(n[0],n[1],n[2])},S.br=function(){const n={},t=V.$version;for(const r in V.$root){const o=V.$root[r];if(o.required){let l=null;l=r==="version"?t:o.type==="array"?[]:{},l!=null&&(n[r]=l)}}return n},S.bs=Aa,S.bt=Cr,S.bu=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=G(n[r],t[n[r].ref]));return n},S.bv=function(n){if(n.type==="custom")return new v6(n);switch(n.type){case"background":return new _6(n);case"circle":return new g2(n);case"fill":return new R2(n);case"fill-extrusion":return new H2(n);case"heatmap":return new y2(n);case"hillshade":return new v2(n);case"line":return new K2(n);case"raster":return new x6(n);case"symbol":return new bl(n)}},S.bw=Oi,S.bx=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!U(n.version,t.version))return[{command:"setStyle",args:[t]}];U(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),U(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),U(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),U(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),U(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),U(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),U(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),U(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),U(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),U(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),U(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),U(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),U(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},l=[];(function(d,m,_,x){let w;for(w in m=m||{},d=d||{})Object.prototype.hasOwnProperty.call(d,w)&&(Object.prototype.hasOwnProperty.call(m,w)||ue(w,_,x));for(w in m)Object.prototype.hasOwnProperty.call(m,w)&&(Object.prototype.hasOwnProperty.call(d,w)?U(d[w],m[w])||(d[w].type==="geojson"&&m[w].type==="geojson"&&ce(d,m,w)?X(_,{command:"setGeoJSONSourceData",args:[w,m[w].data]}):ye(w,m,_,x)):ne(w,m,_))})(n.sources,t.sources,l,o);const p=[];n.layers&&n.layers.forEach(d=>{"source"in d&&o[d.source]?r.push({command:"removeLayer",args:[d.id]}):p.push(d)}),r=r.concat(l),function(d,m,_){m=m||[];const x=(d=d||[]).map(Se),w=m.map(Se),C=d.reduce(pe,{}),M=m.reduce(pe,{}),O=x.slice(),N=Object.create(null);let z,H,$,ae,K;for(let I=0,j=0;I<x.length;I++)z=x[I],Object.prototype.hasOwnProperty.call(M,z)?j++:(X(_,{command:"removeLayer",args:[z]}),O.splice(O.indexOf(z,j),1));for(let I=0,j=0;I<w.length;I++)z=w[w.length-1-I],O[O.length-1-I]!==z&&(Object.prototype.hasOwnProperty.call(C,z)?(X(_,{command:"removeLayer",args:[z]}),O.splice(O.lastIndexOf(z,O.length-j),1)):j++,ae=O[O.length-I],X(_,{command:"addLayer",args:[M[z],ae]}),O.splice(O.length-I,0,z),N[z]=!0);for(let I=0;I<w.length;I++)if(z=w[I],H=C[z],$=M[z],!N[z]&&!U(H,$))if(U(H.source,$.source)&&U(H["source-layer"],$["source-layer"])&&U(H.type,$.type)){for(K in Me(H.layout,$.layout,_,z,null,"setLayoutProperty"),Me(H.paint,$.paint,_,z,null,"setPaintProperty"),U(H.filter,$.filter)||X(_,{command:"setFilter",args:[z,$.filter]}),U(H.minzoom,$.minzoom)&&U(H.maxzoom,$.maxzoom)||X(_,{command:"setLayerZoomRange",args:[z,$.minzoom,$.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,K)&&K!=="layout"&&K!=="paint"&&K!=="filter"&&K!=="metadata"&&K!=="minzoom"&&K!=="maxzoom"&&(K.indexOf("paint.")===0?Me(H[K],$[K],_,z,K.slice(6),"setPaintProperty"):U(H[K],$[K])||X(_,{command:"setLayerProperty",args:[z,K,$[K]]}));for(K in $)Object.prototype.hasOwnProperty.call($,K)&&!Object.prototype.hasOwnProperty.call(H,K)&&K!=="layout"&&K!=="paint"&&K!=="filter"&&K!=="metadata"&&K!=="minzoom"&&K!=="maxzoom"&&(K.indexOf("paint.")===0?Me(H[K],$[K],_,z,K.slice(6),"setPaintProperty"):U(H[K],$[K])||X(_,{command:"setLayerProperty",args:[z,K,$[K]]}))}else X(_,{command:"removeLayer",args:[z]}),ae=O[O.lastIndexOf(z)+1],X(_,{command:"addLayer",args:[$,ae]})}(p,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},S.by=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},S.bz=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!n(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!n(t[o],r[o]))return!1;return!0}return t===r},S.c=ar,S.c0=n=>n.type==="fill",S.c1=n=>n.type==="fill-extrusion",S.c2=n=>n.type==="hillshade",S.c3=n=>n.type==="raster",S.c4=n=>n.type==="background",S.c5=n=>n.type==="custom",S.c6=fr,S.c7=function(n,t,r){const o=gi(t.x-r.x,t.y-r.y),l=gi(n.x-r.x,n.y-r.y);var p,d;return Ui(Math.atan2(o[0]*l[1]-o[1]*l[0],(p=o)[0]*(d=l)[0]+p[1]*d[1]))},S.c8=Ei,S.c9=function(n,t,r){var o=t[0],l=t[1];return n[0]=r[0]*o+r[4]*l+r[12],n[1]=r[1]*o+r[5]*l+r[13],n},S.cA=t0,S.cB=ss,S.cC=Zn,S.ca=function(n,t){const{x:r,y:o}=h3.fromLngLat(t);return!(n<0||n>25||o<0||o>=1||r<0||r>=1)},S.cb=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},S.cc=class extends ws{},S.cd=M6,S.cf=function(n){return n.message===Lt},S.cg=mr,S.ch=function(n,t){Wr.REGISTERED_PROTOCOLS[n]=t},S.ci=function(n){delete Wr.REGISTERED_PROTOCOLS[n]},S.cj=function(n,t){const r={};for(let l=0;l<n.length;l++){const p=t&&t[n[l].id]||C4(n[l]);t&&(t[n[l].id]=p);let d=r[p];d||(d=r[p]=[]),d.push(n[l])}const o=[];for(const l in r)o.push(r[l]);return o},S.ck=We,S.cl=C0,S.cm=E0,S.cn=r0,S.co=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=xt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,l={layoutIconSize:o["icon-size"].possiblyEvaluate(new pi(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new pi(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new pi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:x,maxZoom:w}=n.bucket.textSizeData;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new pi(x),n.canonical),o["text-size"].possiblyEvaluate(new pi(w),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:x,maxZoom:w}=n.bucket.iconSizeData;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new pi(x),n.canonical),o["icon-size"].possiblyEvaluate(new pi(w),n.canonical)]}const p=r.get("text-line-height")*$i,d=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),_=r.get("text-size");for(const x of n.bucket.features){const w=r.get("text-font").evaluate(x,{},n.canonical).join(","),C=_.evaluate(x,{},n.canonical),M=l.layoutTextSize.evaluate(x,{},n.canonical),O=l.layoutIconSize.evaluate(x,{},n.canonical),N={horizontal:{},vertical:void 0},z=x.text;let H,$=[0,0];if(z){const I=z.toString(),j=r.get("text-letter-spacing").evaluate(x,{},n.canonical)*$i,Q=ms(I)?j:0,_e=r.get("text-anchor").evaluate(x,{},n.canonical),De=F0(t,x,n.canonical);if(!De){const ze=r.get("text-radial-offset").evaluate(x,{},n.canonical);$=ze?B0(_e,[ze*$i,j7]):r.get("text-offset").evaluate(x,{},n.canonical).map(Ge=>Ge*$i)}let Te=d?"center":r.get("text-justify").evaluate(x,{},n.canonical);const Pe=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(x,{},n.canonical)*$i:1/0,Be=()=>{n.bucket.allowVerticalPlacement&&Ea(I)&&(N.vertical=yl(z,n.glyphMap,n.glyphPositions,n.imagePositions,w,Pe,p,_e,"left",Q,$,S.ai.vertical,!0,M,C))};if(!d&&De){const ze=new Set;if(Te==="auto")for(let ke=0;ke<De.values.length;ke+=2)ze.add(H7(De.values[ke]));else ze.add(Te);let Ge=!1;for(const ke of ze)if(!N.horizontal[ke])if(Ge)N.horizontal[ke]=N.horizontal[0];else{const Ke=yl(z,n.glyphMap,n.glyphPositions,n.imagePositions,w,Pe,p,"center",ke,Q,$,S.ai.horizontal,!1,M,C);Ke&&(N.horizontal[ke]=Ke,Ge=Ke.positionedLines.length===1)}Be()}else{Te==="auto"&&(Te=H7(_e));const ze=yl(z,n.glyphMap,n.glyphPositions,n.imagePositions,w,Pe,p,_e,Te,Q,$,S.ai.horizontal,!1,M,C);ze&&(N.horizontal[Te]=ze),Be(),Ea(I)&&d&&m&&(N.vertical=yl(z,n.glyphMap,n.glyphPositions,n.imagePositions,w,Pe,p,_e,Te,Q,$,S.ai.vertical,!1,M,C))}}let ae=!1;if(x.icon&&x.icon.name){const I=n.imageMap[x.icon.name];I&&(H=p6(n.imagePositions[x.icon.name],r.get("icon-offset").evaluate(x,{},n.canonical),r.get("icon-anchor").evaluate(x,{},n.canonical)),ae=!!I.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ae:n.bucket.sdfIcons!==ae&&Kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(I.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const K=U0(N.horizontal)||N.vertical;n.bucket.iconsInText=!!K&&K.iconsInText,(K||H)&&L6(n.bucket,x,N,H,n.imageMap,l,M,O,$,ae,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},S.cp=A7,S.cq=v7,S.cr=C7,S.cs=r3,S.ct=P7,S.cu=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},S.cv=function(n,t,r,o,l){return c(this,void 0,void 0,function*(){if(He())try{return yield Gi(n,t,r,o,l)}catch{}return function(p,d,m,_,x){const w=p.width,C=p.height;kr&&Rr||(kr=new OffscreenCanvas(w,C),Rr=kr.getContext("2d",{willReadFrequently:!0})),kr.width=w,kr.height=C,Rr.drawImage(p,0,0,w,C);const M=Rr.getImageData(d,m,_,x);return Rr.clearRect(0,0,w,C),M.data}(n,t,r,o,l)})},S.cw=S0,S.cx=be,S.cy=Ae,S.cz=H9,S.d=n=>c(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=ci,S.f=n=>new Promise((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=fn})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(l):fn}),S.g=zt,S.h=(n,t)=>Ot(ci(n,{type:"json"}),t),S.i=Sr,S.j=mn,S.k=Pi,S.l=(n,t)=>Ot(ci(n,{type:"arrayBuffer"}),t),S.m=Ot,S.n=function(n){return new P7(n).readFields(n6,[])},S.o=X4,S.p=i0,S.q=Pr,S.r=s7,S.s=Yt,S.t=fs,S.u=bo,S.v=V,S.w=Kt,S.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},S.y=Jr,S.z=pi}),D("worker",["./shared"],function(S){class c{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,G){for(const X of B){this._layerConfigs[X.id]=X;const ne=this._layers[X.id]=S.bv(X);ne._featureFilter=S.a4(ne.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of G)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const U=S.cj(Object.values(this._layerConfigs),this.keyCache);for(const X of U){const ne=X.map(pe=>this._layers[pe.id]),ue=ne[0];if(ue.visibility==="none")continue;const ye=ue.source||"";let ce=this.familiesBySource[ye];ce||(ce=this.familiesBySource[ye]={});const Me=ue.sourceLayer||"_geojsonTileLayer";let Se=ce[Me];Se||(Se=ce[Me]=[]),Se.push(ne)}}}class be{constructor(B){const G={},U=[];for(const ye in B){const ce=B[ye],Me=G[ye]={};for(const Se in ce){const pe=ce[+Se];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const se={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};U.push(se),Me[Se]={rect:se,metrics:pe.metrics}}}const{w:X,h:ne}=S.p(U),ue=new S.o({width:X||1,height:ne||1});for(const ye in B){const ce=B[ye];for(const Me in ce){const Se=ce[+Me];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const pe=G[ye][Me].rect;S.o.copy(Se.bitmap,ue,{x:0,y:0},{x:pe.x+1,y:pe.y+1},Se.bitmap)}}this.image=ue,this.positions=G}}S.ck("GlyphAtlas",be);class me{constructor(B){this.tileID=new S.S(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[]}parse(B,G,U,X,ne){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=B,this.collisionBoxArray=new S.a2;const ue=new S.cl(Object.keys(B.layers).sort()),ye=new S.cm(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const ce={},Me={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U,subdivisionGranularity:ne},Se=G.familiesBySource[this.source];for(const ut in Se){const qe=B.layers[ut];if(!qe)continue;qe.version===1&&S.w(`Vector tile source "${this.source}" layer "${ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ui=ue.encode(ut),gn=[];for(let Ni=0;Ni<qe.length;Ni++){const xi=qe.feature(Ni),ti=ye.getId(xi,ut);gn.push({feature:xi,id:ti,index:Ni,sourceLayerIndex:ui})}for(const Ni of Se[ut]){const xi=Ni[0];xi.source!==this.source&&S.w(`layer.source = ${xi.source} does not equal this.source = ${this.source}`),xi.minzoom&&this.zoom<Math.floor(xi.minzoom)||xi.maxzoom&&this.zoom>=xi.maxzoom||xi.visibility!=="none"&&(de(Ni,this.zoom,U),(ce[xi.id]=xi.createBucket({index:ye.bucketLayerIDs.length,layers:Ni,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ui,sourceID:this.source})).populate(gn,Me,this.tileID.canonical),ye.bucketLayerIDs.push(Ni.map(ti=>ti.id)))}}const pe=S.bA(Me.glyphDependencies,ut=>Object.keys(ut).map(Number));this.inFlightDependencies.forEach(ut=>ut==null?void 0:ut.abort()),this.inFlightDependencies=[];let se=Promise.resolve({});if(Object.keys(pe).length){const ut=new AbortController;this.inFlightDependencies.push(ut),se=X.sendAsync({type:"GG",data:{stacks:pe,source:this.source,tileID:this.tileID,type:"glyphs"}},ut)}const Ve=Object.keys(Me.iconDependencies);let Ze=Promise.resolve({});if(Ve.length){const ut=new AbortController;this.inFlightDependencies.push(ut),Ze=X.sendAsync({type:"GI",data:{icons:Ve,source:this.source,tileID:this.tileID,type:"icons"}},ut)}const st=Object.keys(Me.patternDependencies);let gt=Promise.resolve({});if(st.length){const ut=new AbortController;this.inFlightDependencies.push(ut),gt=X.sendAsync({type:"GI",data:{icons:st,source:this.source,tileID:this.tileID,type:"patterns"}},ut)}const[Ee,$e,Xe]=yield Promise.all([se,Ze,gt]),Tt=new be(Ee),Pt=new S.cn($e,Xe);for(const ut in ce){const qe=ce[ut];qe instanceof S.a3?(de(qe.layers,this.zoom,U),S.co({bucket:qe,glyphMap:Ee,glyphPositions:Tt.positions,imageMap:$e,imagePositions:Pt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Me.subdivisionGranularity})):qe.hasPattern&&(qe instanceof S.cp||qe instanceof S.cq||qe instanceof S.cr)&&(de(qe.layers,this.zoom,U),qe.addFeatures(Me,this.tileID.canonical,Pt.patternPositions))}return this.status="done",{buckets:Object.values(ce).filter(ut=>!ut.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tt.image,imageAtlas:Pt,glyphMap:this.returnDependencies?Ee:null,iconMap:this.returnDependencies?$e:null,glyphPositions:this.returnDependencies?Tt.positions:null}})}}function de(V,B,G){const U=new S.z(B);for(const X of V)X.recalculate(U,G)}class Ae{constructor(B,G,U){this.actor=B,this.layerIndex=G,this.availableImages=U,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(B,G){return S._(this,void 0,void 0,function*(){const U=yield S.l(B.request,G);try{return{vectorTile:new S.cs.VectorTile(new S.ct(U.data)),rawData:U.data,cacheControl:U.cacheControl,expires:U.expires}}catch(X){const ne=new Uint8Array(U.data);let ue=`Unable to parse the tile at ${B.request.url}, `;throw ue+=ne[0]===31&&ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${X.message}`,new Error(ue)}})}loadTile(B){return S._(this,void 0,void 0,function*(){const G=B.uid,U=!!(B&&B.request&&B.request.collectResourceTiming)&&new S.cu(B.request),X=new me(B);this.loading[G]=X;const ne=new AbortController;X.abort=ne;try{const ue=yield this.loadVectorTile(B,ne);if(delete this.loading[G],!ue)return null;const ye=ue.rawData,ce={};ue.expires&&(ce.expires=ue.expires),ue.cacheControl&&(ce.cacheControl=ue.cacheControl);const Me={};if(U){const pe=U.finish();pe&&(Me.resourceTiming=JSON.parse(JSON.stringify(pe)))}X.vectorTile=ue.vectorTile;const Se=X.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,B.subdivisionGranularity);this.loaded[G]=X,this.fetching[G]={rawTileData:ye,cacheControl:ce,resourceTiming:Me};try{const pe=yield Se;return S.e({rawTileData:ye.slice(0)},pe,ce,Me)}finally{delete this.fetching[G]}}catch(ue){throw delete this.loading[G],X.status="done",this.loaded[G]=X,ue}})}reloadTile(B){return S._(this,void 0,void 0,function*(){const G=B.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const U=this.loaded[G];if(U.showCollisionBoxes=B.showCollisionBoxes,U.status==="parsing"){const X=yield U.parse(U.vectorTile,this.layerIndex,this.availableImages,this.actor,B.subdivisionGranularity);let ne;if(this.fetching[G]){const{rawTileData:ue,cacheControl:ye,resourceTiming:ce}=this.fetching[G];delete this.fetching[G],ne=S.e({rawTileData:ue.slice(0)},X,ye,ce)}else ne=X;return ne}if(U.status==="done"&&U.vectorTile)return U.parse(U.vectorTile,this.layerIndex,this.availableImages,this.actor,B.subdivisionGranularity)})}abortTile(B){return S._(this,void 0,void 0,function*(){const G=this.loading,U=B.uid;G&&G[U]&&G[U].abort&&(G[U].abort.abort(),delete G[U])})}removeTile(B){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[B.uid]&&delete this.loaded[B.uid]})}}class fe{constructor(){this.loaded={}}loadTile(B){return S._(this,void 0,void 0,function*(){const{uid:G,encoding:U,rawImageData:X,redFactor:ne,greenFactor:ue,blueFactor:ye,baseShift:ce}=B,Me=X.width+2,Se=X.height+2,pe=S.b(X)?new S.R({width:Me,height:Se},yield S.cv(X,-1,-1,Me,Se)):X,se=new S.cw(G,pe,U,ne,ue,ye,ce);return this.loaded=this.loaded||{},this.loaded[G]=se,se})}removeTile(B){const G=this.loaded,U=B.uid;G&&G[U]&&delete G[U]}}var te,Ce,Je=function(){if(Ce)return te;function V(G,U){if(G.length!==0){B(G[0],U);for(var X=1;X<G.length;X++)B(G[X],!U)}}function B(G,U){for(var X=0,ne=0,ue=0,ye=G.length,ce=ye-1;ue<ye;ce=ue++){var Me=(G[ue][0]-G[ce][0])*(G[ce][1]+G[ue][1]),Se=X+Me;ne+=Math.abs(X)>=Math.abs(Me)?X-Se+Me:Me-Se+X,X=Se}X+ne>=0!=!!U&&G.reverse()}return Ce=1,te=function G(U,X){var ne,ue=U&&U.type;if(ue==="FeatureCollection")for(ne=0;ne<U.features.length;ne++)G(U.features[ne],X);else if(ue==="GeometryCollection")for(ne=0;ne<U.geometries.length;ne++)G(U.geometries[ne],X);else if(ue==="Feature")G(U.geometry,X);else if(ue==="Polygon")V(U.coordinates,X);else if(ue==="MultiPolygon")for(ne=0;ne<U.coordinates.length;ne++)V(U.coordinates[ne],X);return U}}(),it=S.cx(Je);const je=S.cs.VectorTileFeature.prototype.toGeoJSON;class Fe{constructor(B){this._feature=B,this.extent=S.X,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const G of this._feature.geometry)B.push([new S.P(G[0],G[1])]);return B}{const B=[];for(const G of this._feature.geometry){const U=[];for(const X of G)U.push(new S.P(X[0],X[1]));B.push(U)}return B}}toGeoJSON(B,G,U){return je.call(this,B,G,U)}}class dt{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=B.length,this._features=B}feature(B){return new Fe(this._features[B])}}var He,ft,mt,ot={exports:{}},we=function(){if(mt)return ot.exports;mt=1;var V=S.cA(),B=function(){if(ft)return He;ft=1;var Se=S.cy(),pe=S.cz().VectorTileFeature;function se(Ze,st){this.options=st||{},this.features=Ze,this.length=Ze.length}function Ve(Ze,st){this.id=typeof Ze.id=="number"?Ze.id:void 0,this.type=Ze.type,this.rawGeometry=Ze.type===1?[Ze.geometry]:Ze.geometry,this.properties=Ze.tags,this.extent=st||4096}return He=se,se.prototype.feature=function(Ze){return new Ve(this.features[Ze],this.options.extent)},Ve.prototype.loadGeometry=function(){var Ze=this.rawGeometry;this.geometry=[];for(var st=0;st<Ze.length;st++){for(var gt=Ze[st],Ee=[],$e=0;$e<gt.length;$e++)Ee.push(new Se(gt[$e][0],gt[$e][1]));this.geometry.push(Ee)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ze=this.geometry,st=1/0,gt=-1/0,Ee=1/0,$e=-1/0,Xe=0;Xe<Ze.length;Xe++)for(var Tt=Ze[Xe],Pt=0;Pt<Tt.length;Pt++){var ut=Tt[Pt];st=Math.min(st,ut.x),gt=Math.max(gt,ut.x),Ee=Math.min(Ee,ut.y),$e=Math.max($e,ut.y)}return[st,Ee,gt,$e]},Ve.prototype.toGeoJSON=pe.prototype.toGeoJSON,He}();function G(Se){var pe=new V;return function(se,Ve){for(var Ze in se.layers)Ve.writeMessage(3,U,se.layers[Ze])}(Se,pe),pe.finish()}function U(Se,pe){var se;pe.writeVarintField(15,Se.version||1),pe.writeStringField(1,Se.name||""),pe.writeVarintField(5,Se.extent||4096);var Ve={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<Se.length;se++)Ve.feature=Se.feature(se),pe.writeMessage(2,X,Ve);var Ze=Ve.keys;for(se=0;se<Ze.length;se++)pe.writeStringField(3,Ze[se]);var st=Ve.values;for(se=0;se<st.length;se++)pe.writeMessage(4,Me,st[se])}function X(Se,pe){var se=Se.feature;se.id!==void 0&&pe.writeVarintField(1,se.id),pe.writeMessage(2,ne,Se),pe.writeVarintField(3,se.type),pe.writeMessage(4,ce,se)}function ne(Se,pe){var se=Se.feature,Ve=Se.keys,Ze=Se.values,st=Se.keycache,gt=Se.valuecache;for(var Ee in se.properties){var $e=se.properties[Ee],Xe=st[Ee];if($e!==null){Xe===void 0&&(Ve.push(Ee),st[Ee]=Xe=Ve.length-1),pe.writeVarint(Xe);var Tt=typeof $e;Tt!=="string"&&Tt!=="boolean"&&Tt!=="number"&&($e=JSON.stringify($e));var Pt=Tt+":"+$e,ut=gt[Pt];ut===void 0&&(Ze.push($e),gt[Pt]=ut=Ze.length-1),pe.writeVarint(ut)}}}function ue(Se,pe){return(pe<<3)+(7&Se)}function ye(Se){return Se<<1^Se>>31}function ce(Se,pe){for(var se=Se.loadGeometry(),Ve=Se.type,Ze=0,st=0,gt=se.length,Ee=0;Ee<gt;Ee++){var $e=se[Ee],Xe=1;Ve===1&&(Xe=$e.length),pe.writeVarint(ue(1,Xe));for(var Tt=Ve===3?$e.length-1:$e.length,Pt=0;Pt<Tt;Pt++){Pt===1&&Ve!==1&&pe.writeVarint(ue(2,Tt-1));var ut=$e[Pt].x-Ze,qe=$e[Pt].y-st;pe.writeVarint(ye(ut)),pe.writeVarint(ye(qe)),Ze+=ut,st+=qe}Ve===3&&pe.writeVarint(ue(7,1))}}function Me(Se,pe){var se=typeof Se;se==="string"?pe.writeStringField(1,Se):se==="boolean"?pe.writeBooleanField(7,Se):se==="number"&&(Se%1!=0?pe.writeDoubleField(3,Se):Se<0?pe.writeSVarintField(6,Se):pe.writeVarintField(5,Se))}return ot.exports=G,ot.exports.fromVectorTileJs=G,ot.exports.fromGeojsonVt=function(Se,pe){pe=pe||{};var se={};for(var Ve in Se)se[Ve]=new B(Se[Ve].features,pe),se[Ve].name=Ve,se[Ve].version=pe.version,se[Ve].extent=pe.extent;return G({layers:se})},ot.exports.GeoJSONWrapper=B,ot.exports}(),Et=S.cx(we);const Dt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},Bi=Math.fround||(si=new Float32Array(1),V=>(si[0]=+V,si[0]));var si;const Wt=3,Zt=5,gi=6;class xt{constructor(B){this.options=Object.assign(Object.create(Dt),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:G,minZoom:U,maxZoom:X}=this.options;G&&console.time("total time");const ne=`prepare ${B.length} points`;G&&console.time(ne),this.points=B;const ue=[];for(let ce=0;ce<B.length;ce++){const Me=B[ce];if(!Me.geometry)continue;const[Se,pe]=Me.geometry.coordinates,se=Bi(li(Se)),Ve=Bi(dr(pe));ue.push(se,Ve,1/0,ce,-1,1),this.options.reduce&&ue.push(0)}let ye=this.trees[X+1]=this._createTree(ue);G&&console.timeEnd(ne);for(let ce=X;ce>=U;ce--){const Me=+Date.now();ye=this.trees[ce]=this._createTree(this._cluster(ye,ce)),G&&console.log("z%d: %d clusters in %dms",ce,ye.numItems,+Date.now()-Me)}return G&&console.timeEnd("total time"),this}getClusters(B,G){let U=((B[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,B[1]));let ne=B[2]===180?180:((B[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)U=-180,ne=180;else if(U>ne){const pe=this.getClusters([U,X,180,ue],G),se=this.getClusters([-180,X,ne,ue],G);return pe.concat(se)}const ye=this.trees[this._limitZoom(G)],ce=ye.range(li(U),dr(ue),li(ne),dr(X)),Me=ye.data,Se=[];for(const pe of ce){const se=this.stride*pe;Se.push(Me[se+Zt]>1?Ii(Me,se,this.clusterProps):this.points[Me[se+Wt]])}return Se}getChildren(B){const G=this._getOriginId(B),U=this._getOriginZoom(B),X="No cluster with the specified id.",ne=this.trees[U];if(!ne)throw new Error(X);const ue=ne.data;if(G*this.stride>=ue.length)throw new Error(X);const ye=this.options.radius/(this.options.extent*Math.pow(2,U-1)),ce=ne.within(ue[G*this.stride],ue[G*this.stride+1],ye),Me=[];for(const Se of ce){const pe=Se*this.stride;ue[pe+4]===B&&Me.push(ue[pe+Zt]>1?Ii(ue,pe,this.clusterProps):this.points[ue[pe+Wt]])}if(Me.length===0)throw new Error(X);return Me}getLeaves(B,G,U){const X=[];return this._appendLeaves(X,B,G=G||10,U=U||0,0),X}getTile(B,G,U){const X=this.trees[this._limitZoom(B)],ne=Math.pow(2,B),{extent:ue,radius:ye}=this.options,ce=ye/ue,Me=(U-ce)/ne,Se=(U+1+ce)/ne,pe={features:[]};return this._addTileFeatures(X.range((G-ce)/ne,Me,(G+1+ce)/ne,Se),X.data,G,U,ne,pe),G===0&&this._addTileFeatures(X.range(1-ce/ne,Me,1,Se),X.data,ne,U,ne,pe),G===ne-1&&this._addTileFeatures(X.range(0,Me,ce/ne,Se),X.data,-1,U,ne,pe),pe.features.length?pe:null}getClusterExpansionZoom(B){let G=this._getOriginZoom(B)-1;for(;G<=this.options.maxZoom;){const U=this.getChildren(B);if(G++,U.length!==1)break;B=U[0].properties.cluster_id}return G}_appendLeaves(B,G,U,X,ne){const ue=this.getChildren(G);for(const ye of ue){const ce=ye.properties;if(ce&&ce.cluster?ne+ce.point_count<=X?ne+=ce.point_count:ne=this._appendLeaves(B,ce.cluster_id,U,X,ne):ne<X?ne++:B.push(ye),B.length===U)break}return ne}_createTree(B){const G=new S.az(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<B.length;U+=this.stride)G.add(B[U],B[U+1]);return G.finish(),G.data=B,G}_addTileFeatures(B,G,U,X,ne,ue){for(const ye of B){const ce=ye*this.stride,Me=G[ce+Zt]>1;let Se,pe,se;if(Me)Se=ct(G,ce,this.clusterProps),pe=G[ce],se=G[ce+1];else{const st=this.points[G[ce+Wt]];Se=st.properties;const[gt,Ee]=st.geometry.coordinates;pe=li(gt),se=dr(Ee)}const Ve={type:1,geometry:[[Math.round(this.options.extent*(pe*ne-U)),Math.round(this.options.extent*(se*ne-X))]],tags:Se};let Ze;Ze=Me||this.options.generateId?G[ce+Wt]:this.points[G[ce+Wt]].id,Ze!==void 0&&(Ve.id=Ze),ue.features.push(Ve)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,G){const{radius:U,extent:X,reduce:ne,minPoints:ue}=this.options,ye=U/(X*Math.pow(2,G)),ce=B.data,Me=[],Se=this.stride;for(let pe=0;pe<ce.length;pe+=Se){if(ce[pe+2]<=G)continue;ce[pe+2]=G;const se=ce[pe],Ve=ce[pe+1],Ze=B.within(ce[pe],ce[pe+1],ye),st=ce[pe+Zt];let gt=st;for(const Ee of Ze){const $e=Ee*Se;ce[$e+2]>G&&(gt+=ce[$e+Zt])}if(gt>st&&gt>=ue){let Ee,$e=se*st,Xe=Ve*st,Tt=-1;const Pt=((pe/Se|0)<<5)+(G+1)+this.points.length;for(const ut of Ze){const qe=ut*Se;if(ce[qe+2]<=G)continue;ce[qe+2]=G;const ui=ce[qe+Zt];$e+=ce[qe]*ui,Xe+=ce[qe+1]*ui,ce[qe+4]=Pt,ne&&(Ee||(Ee=this._map(ce,pe,!0),Tt=this.clusterProps.length,this.clusterProps.push(Ee)),ne(Ee,this._map(ce,qe)))}ce[pe+4]=Pt,Me.push($e/gt,Xe/gt,1/0,Pt,-1,gt),ne&&Me.push(Tt)}else{for(let Ee=0;Ee<Se;Ee++)Me.push(ce[pe+Ee]);if(gt>1)for(const Ee of Ze){const $e=Ee*Se;if(!(ce[$e+2]<=G)){ce[$e+2]=G;for(let Xe=0;Xe<Se;Xe++)Me.push(ce[$e+Xe])}}}}return Me}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,G,U){if(B[G+Zt]>1){const ue=this.clusterProps[B[G+gi]];return U?Object.assign({},ue):ue}const X=this.points[B[G+Wt]].properties,ne=this.options.map(X);return U&&ne===X?Object.assign({},ne):ne}}function Ii(V,B,G){return{type:"Feature",id:V[B+Wt],properties:ct(V,B,G),geometry:{type:"Point",coordinates:[(U=V[B],360*(U-.5)),fr(V[B+1])]}};var U}function ct(V,B,G){const U=V[B+Zt],X=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,ne=V[B+gi],ue=ne===-1?{}:Object.assign({},G[ne]);return Object.assign(ue,{cluster:!0,cluster_id:V[B+Wt],point_count:U,point_count_abbreviated:X})}function li(V){return V/360+.5}function dr(V){const B=Math.sin(V*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function fr(V){const B=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Ei(V,B,G,U){let X=U;const ne=B+(G-B>>1);let ue,ye=G-B;const ce=V[B],Me=V[B+1],Se=V[G],pe=V[G+1];for(let se=B+3;se<G;se+=3){const Ve=Fi(V[se],V[se+1],ce,Me,Se,pe);if(Ve>X)ue=se,X=Ve;else if(Ve===X){const Ze=Math.abs(se-ne);Ze<ye&&(ue=se,ye=Ze)}}X>U&&(ue-B>3&&Ei(V,B,ue,U),V[ue+2]=X,G-ue>3&&Ei(V,ue,G,U))}function Fi(V,B,G,U,X,ne){let ue=X-G,ye=ne-U;if(ue!==0||ye!==0){const ce=((V-G)*ue+(B-U)*ye)/(ue*ue+ye*ye);ce>1?(G=X,U=ne):ce>0&&(G+=ue*ce,U+=ye*ce)}return ue=V-G,ye=B-U,ue*ue+ye*ye}function Li(V,B,G,U){const X={id:V??null,type:B,geometry:G,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(B==="Point"||B==="MultiPoint"||B==="LineString")ci(X,G);else if(B==="Polygon")ci(X,G[0]);else if(B==="MultiLineString")for(const ne of G)ci(X,ne);else if(B==="MultiPolygon")for(const ne of G)ci(X,ne[0]);return X}function ci(V,B){for(let G=0;G<B.length;G+=3)V.minX=Math.min(V.minX,B[G]),V.minY=Math.min(V.minY,B[G+1]),V.maxX=Math.max(V.maxX,B[G]),V.maxY=Math.max(V.maxY,B[G+1])}function Tr(V,B,G,U){if(!B.geometry)return;const X=B.geometry.coordinates;if(X&&X.length===0)return;const ne=B.geometry.type,ue=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let ye=[],ce=B.id;if(G.promoteId?ce=B.properties[G.promoteId]:G.generateId&&(ce=U||0),ne==="Point")nr(X,ye);else if(ne==="MultiPoint")for(const Me of X)nr(Me,ye);else if(ne==="LineString")or(X,ye,ue,!1);else if(ne==="MultiLineString"){if(G.lineMetrics){for(const Me of X)ye=[],or(Me,ye,ue,!1),V.push(Li(ce,"LineString",ye,B.properties));return}Oi(X,ye,ue,!1)}else if(ne==="Polygon")Oi(X,ye,ue,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(const Me of B.geometry.geometries)Tr(V,{id:ce,geometry:Me,properties:B.properties},G,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of X){const Se=[];Oi(Me,Se,ue,!0),ye.push(Se)}}V.push(Li(ce,ne,ye,B.properties))}function nr(V,B){B.push(qr(V[0]),Kt(V[1]),0)}function or(V,B,G,U){let X,ne,ue=0;for(let ce=0;ce<V.length;ce++){const Me=qr(V[ce][0]),Se=Kt(V[ce][1]);B.push(Me,Se,0),ce>0&&(ue+=U?(X*Se-Me*ne)/2:Math.sqrt(Math.pow(Me-X,2)+Math.pow(Se-ne,2))),X=Me,ne=Se}const ye=B.length-3;B[2]=1,Ei(B,0,ye,G),B[ye+2]=1,B.size=Math.abs(ue),B.start=0,B.end=B.size}function Oi(V,B,G,U){for(let X=0;X<V.length;X++){const ne=[];or(V[X],ne,G,U),B.push(ne)}}function qr(V){return V/360+.5}function Kt(V){const B=Math.sin(V*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function at(V,B,G,U,X,ne,ue,ye){if(U/=B,ne>=(G/=B)&&ue<U)return V;if(ue<G||ne>=U)return null;const ce=[];for(const Me of V){const Se=Me.geometry;let pe=Me.type;const se=X===0?Me.minX:Me.minY,Ve=X===0?Me.maxX:Me.maxY;if(se>=G&&Ve<U){ce.push(Me);continue}if(Ve<G||se>=U)continue;let Ze=[];if(pe==="Point"||pe==="MultiPoint")Sr(Se,Ze,G,U,X);else if(pe==="LineString")_i(Se,Ze,G,U,X,!1,ye.lineMetrics);else if(pe==="MultiLineString")fn(Se,Ze,G,U,X,!1);else if(pe==="Polygon")fn(Se,Ze,G,U,X,!0);else if(pe==="MultiPolygon")for(const st of Se){const gt=[];fn(st,gt,G,U,X,!0),gt.length&&Ze.push(gt)}if(Ze.length){if(ye.lineMetrics&&pe==="LineString"){for(const st of Ze)ce.push(Li(Me.id,pe,st,Me.tags));continue}pe!=="LineString"&&pe!=="MultiLineString"||(Ze.length===1?(pe="LineString",Ze=Ze[0]):pe="MultiLineString"),pe!=="Point"&&pe!=="MultiPoint"||(pe=Ze.length===3?"Point":"MultiPoint"),ce.push(Li(Me.id,pe,Ze,Me.tags))}}return ce.length?ce:null}function Sr(V,B,G,U,X){for(let ne=0;ne<V.length;ne+=3){const ue=V[ne+X];ue>=G&&ue<=U&&Gi(B,V[ne],V[ne+1],V[ne+2])}}function _i(V,B,G,U,X,ne,ue){let ye=$r(V);const ce=X===0?kr:Rr;let Me,Se,pe=V.start;for(let gt=0;gt<V.length-3;gt+=3){const Ee=V[gt],$e=V[gt+1],Xe=V[gt+2],Tt=V[gt+3],Pt=V[gt+4],ut=X===0?Ee:$e,qe=X===0?Tt:Pt;let ui=!1;ue&&(Me=Math.sqrt(Math.pow(Ee-Tt,2)+Math.pow($e-Pt,2))),ut<G?qe>G&&(Se=ce(ye,Ee,$e,Tt,Pt,G),ue&&(ye.start=pe+Me*Se)):ut>U?qe<U&&(Se=ce(ye,Ee,$e,Tt,Pt,U),ue&&(ye.start=pe+Me*Se)):Gi(ye,Ee,$e,Xe),qe<G&&ut>=G&&(Se=ce(ye,Ee,$e,Tt,Pt,G),ui=!0),qe>U&&ut<=U&&(Se=ce(ye,Ee,$e,Tt,Pt,U),ui=!0),!ne&&ui&&(ue&&(ye.end=pe+Me*Se),B.push(ye),ye=$r(V)),ue&&(pe+=Me)}let se=V.length-3;const Ve=V[se],Ze=V[se+1],st=X===0?Ve:Ze;st>=G&&st<=U&&Gi(ye,Ve,Ze,V[se+2]),se=ye.length-3,ne&&se>=3&&(ye[se]!==ye[0]||ye[se+1]!==ye[1])&&Gi(ye,ye[0],ye[1],ye[2]),ye.length&&B.push(ye)}function $r(V){const B=[];return B.size=V.size,B.start=V.start,B.end=V.end,B}function fn(V,B,G,U,X,ne){for(const ue of V)_i(ue,B,G,U,X,ne,!1)}function Gi(V,B,G,U){V.push(B,G,U)}function kr(V,B,G,U,X,ne){const ue=(ne-B)/(U-B);return Gi(V,ne,G+(X-G)*ue,1),ue}function Rr(V,B,G,U,X,ne){const ue=(ne-G)/(X-G);return Gi(V,B+(U-B)*ue,ne,1),ue}function Ui(V,B){const G=[];for(let U=0;U<V.length;U++){const X=V[U],ne=X.type;let ue;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ue=Lt(X.geometry,B);else if(ne==="MultiLineString"||ne==="Polygon"){ue=[];for(const ye of X.geometry)ue.push(Lt(ye,B))}else if(ne==="MultiPolygon"){ue=[];for(const ye of X.geometry){const ce=[];for(const Me of ye)ce.push(Lt(Me,B));ue.push(ce)}}G.push(Li(X.id,ne,ue,X.tags))}return G}function Lt(V,B){const G=[];G.size=V.size,V.start!==void 0&&(G.start=V.start,G.end=V.end);for(let U=0;U<V.length;U+=3)G.push(V[U]+B,V[U+1],V[U+2]);return G}function ar(V,B){if(V.transformed)return V;const G=1<<V.z,U=V.x,X=V.y;for(const ne of V.features){const ue=ne.geometry,ye=ne.type;if(ne.geometry=[],ye===1)for(let ce=0;ce<ue.length;ce+=2)ne.geometry.push(Wr(ue[ce],ue[ce+1],B,G,U,X));else for(let ce=0;ce<ue.length;ce++){const Me=[];for(let Se=0;Se<ue[ce].length;Se+=2)Me.push(Wr(ue[ce][Se],ue[ce][Se+1],B,G,U,X));ne.geometry.push(Me)}}return V.transformed=!0,V}function Wr(V,B,G,U,X,ne){return[Math.round(G*(V*U-X)),Math.round(G*(B*U-ne))]}function zt(V,B,G,U,X){const ne=B===X.maxZoom?0:X.tolerance/((1<<B)*X.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:V.length,source:null,x:G,y:U,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ye of V)ji(ue,ye,ne,X);return ue}function ji(V,B,G,U){const X=B.geometry,ne=B.type,ue=[];if(V.minX=Math.min(V.minX,B.minX),V.minY=Math.min(V.minY,B.minY),V.maxX=Math.max(V.maxX,B.maxX),V.maxY=Math.max(V.maxY,B.maxY),ne==="Point"||ne==="MultiPoint")for(let ye=0;ye<X.length;ye+=3)ue.push(X[ye],X[ye+1]),V.numPoints++,V.numSimplified++;else if(ne==="LineString")mr(ue,X,V,G,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(let ye=0;ye<X.length;ye++)mr(ue,X[ye],V,G,ne==="Polygon",ye===0);else if(ne==="MultiPolygon")for(let ye=0;ye<X.length;ye++){const ce=X[ye];for(let Me=0;Me<ce.length;Me++)mr(ue,ce[Me],V,G,!0,Me===0)}if(ue.length){let ye=B.tags||null;if(ne==="LineString"&&U.lineMetrics){ye={};for(const Me in B.tags)ye[Me]=B.tags[Me];ye.mapbox_clip_start=X.start/X.size,ye.mapbox_clip_end=X.end/X.size}const ce={geometry:ue,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:ye};B.id!==null&&(ce.id=B.id),V.features.push(ce)}}function mr(V,B,G,U,X,ne){const ue=U*U;if(U>0&&B.size<(X?ue:U))return void(G.numPoints+=B.length/3);const ye=[];for(let ce=0;ce<B.length;ce+=3)(U===0||B[ce+2]>ue)&&(G.numSimplified++,ye.push(B[ce],B[ce+1])),G.numPoints++;X&&function(ce,Me){let Se=0;for(let pe=0,se=ce.length,Ve=se-2;pe<se;Ve=pe,pe+=2)Se+=(ce[pe]-ce[Ve])*(ce[pe+1]+ce[Ve+1]);if(Se>0===Me)for(let pe=0,se=ce.length;pe<se/2;pe+=2){const Ve=ce[pe],Ze=ce[pe+1];ce[pe]=ce[se-2-pe],ce[pe+1]=ce[se-1-pe],ce[se-2-pe]=Ve,ce[se-1-pe]=Ze}}(ye,ne),V.push(ye)}const Cr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ot{constructor(B,G){const U=(G=this.options=function(ne,ue){for(const ye in ue)ne[ye]=ue[ye];return ne}(Object.create(Cr),G)).debug;if(U&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let X=function(ne,ue){const ye=[];if(ne.type==="FeatureCollection")for(let ce=0;ce<ne.features.length;ce++)Tr(ye,ne.features[ce],ue,ce);else Tr(ye,ne.type==="Feature"?ne:{geometry:ne},ue);return ye}(B,G);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(ne,ue){const ye=ue.buffer/ue.extent;let ce=ne;const Me=at(ne,1,-1-ye,ye,0,-1,2,ue),Se=at(ne,1,1-ye,2+ye,0,-1,2,ue);return(Me||Se)&&(ce=at(ne,1,-ye,1+ye,0,-1,2,ue)||[],Me&&(ce=Ui(Me,1).concat(ce)),Se&&(ce=ce.concat(Ui(Se,-1)))),ce}(X,G),X.length&&this.splitTile(X,0,0,0),U&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(B,G,U,X,ne,ue,ye){const ce=[B,G,U,X],Me=this.options,Se=Me.debug;for(;ce.length;){X=ce.pop(),U=ce.pop(),G=ce.pop(),B=ce.pop();const pe=1<<G,se=Yt(G,U,X);let Ve=this.tiles[se];if(!Ve&&(Se>1&&console.time("creation"),Ve=this.tiles[se]=zt(B,G,U,X,Me),this.tileCoords.push({z:G,x:U,y:X}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,U,X,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));const ui=`z${G}`;this.stats[ui]=(this.stats[ui]||0)+1,this.total++}if(Ve.source=B,ne==null){if(G===Me.indexMaxZoom||Ve.numPoints<=Me.indexMaxPoints)continue}else{if(G===Me.maxZoom||G===ne)continue;if(ne!=null){const ui=ne-G;if(U!==ue>>ui||X!==ye>>ui)continue}}if(Ve.source=null,B.length===0)continue;Se>1&&console.time("clipping");const Ze=.5*Me.buffer/Me.extent,st=.5-Ze,gt=.5+Ze,Ee=1+Ze;let $e=null,Xe=null,Tt=null,Pt=null,ut=at(B,pe,U-Ze,U+gt,0,Ve.minX,Ve.maxX,Me),qe=at(B,pe,U+st,U+Ee,0,Ve.minX,Ve.maxX,Me);B=null,ut&&($e=at(ut,pe,X-Ze,X+gt,1,Ve.minY,Ve.maxY,Me),Xe=at(ut,pe,X+st,X+Ee,1,Ve.minY,Ve.maxY,Me),ut=null),qe&&(Tt=at(qe,pe,X-Ze,X+gt,1,Ve.minY,Ve.maxY,Me),Pt=at(qe,pe,X+st,X+Ee,1,Ve.minY,Ve.maxY,Me),qe=null),Se>1&&console.timeEnd("clipping"),ce.push($e||[],G+1,2*U,2*X),ce.push(Xe||[],G+1,2*U,2*X+1),ce.push(Tt||[],G+1,2*U+1,2*X),ce.push(Pt||[],G+1,2*U+1,2*X+1)}}getTile(B,G,U){B=+B,G=+G,U=+U;const X=this.options,{extent:ne,debug:ue}=X;if(B<0||B>24)return null;const ye=1<<B,ce=Yt(B,G=G+ye&ye-1,U);if(this.tiles[ce])return ar(this.tiles[ce],ne);ue>1&&console.log("drilling down to z%d-%d-%d",B,G,U);let Me,Se=B,pe=G,se=U;for(;!Me&&Se>0;)Se--,pe>>=1,se>>=1,Me=this.tiles[Yt(Se,pe,se)];return Me&&Me.source?(ue>1&&(console.log("found parent tile z%d-%d-%d",Se,pe,se),console.time("drilling down")),this.splitTile(Me.source,Se,pe,se,B,G,U),ue>1&&console.timeEnd("drilling down"),this.tiles[ce]?ar(this.tiles[ce],ne):null):null}}function Yt(V,B,G){return 32*((1<<V)*G+B)+V}function sn(V,B){return B?V.properties[B]:V.id}function gr(V,B){if(V==null)return!0;if(V.type==="Feature")return sn(V,B)!=null;if(V.type==="FeatureCollection"){const G=new Set;for(const U of V.features){const X=sn(U,B);if(X==null||G.has(X))return!1;G.add(X)}return!0}return!1}function Pi(V,B){const G=new Map;if(V!=null)if(V.type==="Feature")G.set(sn(V,B),V);else for(const U of V.features)G.set(sn(U,B),U);return G}class mn extends Ae{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(B,G){return S._(this,void 0,void 0,function*(){const U=B.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const X=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!X)return null;const ne=new dt(X.features);let ue=Et(ne);return ue.byteOffset===0&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),{vectorTile:ne,rawData:ue.buffer}})}loadData(B){return S._(this,void 0,void 0,function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const U=!!(B&&B.request&&B.request.collectResourceTiming)&&new S.cu(B.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(B,this._pendingRequest),this._geoJSONIndex=B.cluster?new xt(function({superclusterOptions:ue,clusterProperties:ye}){if(!ye||!ue)return ue;const ce={},Me={},Se={accumulated:null,zoom:0},pe={properties:null},se=Object.keys(ye);for(const Ve of se){const[Ze,st]=ye[Ve],gt=S.cB(st),Ee=S.cB(typeof Ze=="string"?[Ze,["accumulated"],["get",Ve]]:Ze);ce[Ve]=gt.value,Me[Ve]=Ee.value}return ue.map=Ve=>{pe.properties=Ve;const Ze={};for(const st of se)Ze[st]=ce[st].evaluate(Se,pe);return Ze},ue.reduce=(Ve,Ze)=>{pe.properties=Ze;for(const st of se)Se.accumulated=Ve[st],Ve[st]=Me[st].evaluate(Se,pe)},ue}(B)).load((yield this._pendingData).features):(X=yield this._pendingData,new Ot(X,B.geojsonVtOptions)),this.loaded={};const ne={};if(U){const ue=U.finish();ue&&(ne.resourceTiming={},ne.resourceTiming[B.source]=JSON.parse(JSON.stringify(ue)))}return ne}catch(ne){if(delete this._pendingRequest,S.cf(ne))return{abandoned:!0};throw ne}var X})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(B){const G=this.loaded;return G&&G[B.uid]?super.reloadTile(B):this.loadTile(B)}loadAndProcessGeoJSON(B,G){return S._(this,void 0,void 0,function*(){let U=yield this.loadGeoJSON(B,G);if(delete this._pendingRequest,typeof U!="object")throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(it(U,!0),B.filter){const X=S.cB(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(X.result==="error")throw new Error(X.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));U={type:"FeatureCollection",features:U.features.filter(ue=>X.value.evaluate({zoom:0},ue))}}return U})}loadGeoJSON(B,G){return S._(this,void 0,void 0,function*(){const{promoteId:U}=B;if(B.request){const X=yield S.h(B.request,G);return this._dataUpdateable=gr(X.data,U)?Pi(X.data,U):void 0,X.data}if(typeof B.data=="string")try{const X=JSON.parse(B.data);return this._dataUpdateable=gr(X,U)?Pi(X,U):void 0,X}catch{throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`)}if(!B.dataDiff)throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${B.source}`);return function(X,ne,ue){var ye,ce,Me,Se;if(ne.removeAll&&X.clear(),ne.remove)for(const pe of ne.remove)X.delete(pe);if(ne.add)for(const pe of ne.add){const se=sn(pe,ue);se!=null&&X.set(se,pe)}if(ne.update)for(const pe of ne.update){let se=X.get(pe.id);if(se==null)continue;const Ve=!pe.removeAllProperties&&(((ye=pe.removeProperties)===null||ye===void 0?void 0:ye.length)>0||((ce=pe.addOrUpdateProperties)===null||ce===void 0?void 0:ce.length)>0);if((pe.newGeometry||pe.removeAllProperties||Ve)&&(se=Object.assign({},se),X.set(pe.id,se),Ve&&(se.properties=Object.assign({},se.properties))),pe.newGeometry&&(se.geometry=pe.newGeometry),pe.removeAllProperties)se.properties={};else if(((Me=pe.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const Ze of pe.removeProperties)Object.prototype.hasOwnProperty.call(se.properties,Ze)&&delete se.properties[Ze];if(((Se=pe.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0)for(const{key:Ze,value:st}of pe.addOrUpdateProperties)se.properties[Ze]=st}}(this._dataUpdateable,B.dataDiff,U),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(B){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(B){return this._geoJSONIndex.getClusterExpansionZoom(B.clusterId)}getClusterChildren(B){return this._geoJSONIndex.getChildren(B.clusterId)}getClusterLeaves(B){return this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset)}}class Dr{constructor(B){this.self=B,this.actor=new S.F(B),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(G,U)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=U},this.self.addProtocol=S.ch,this.self.removeProtocol=S.ci,this.self.registerRTLTextPlugin=G=>{S.cC.setMethods(G)},this.actor.registerMessageHandler("LDT",(G,U)=>this._getDEMWorkerSource(G,U.source).loadTile(U)),this.actor.registerMessageHandler("RDT",(G,U)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(G,U.source).removeTile(U)})),this.actor.registerMessageHandler("GCEZ",(G,U)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(G,U.type,U.source).getClusterExpansionZoom(U)})),this.actor.registerMessageHandler("GCC",(G,U)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(G,U.type,U.source).getClusterChildren(U)})),this.actor.registerMessageHandler("GCL",(G,U)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(G,U.type,U.source).getClusterLeaves(U)})),this.actor.registerMessageHandler("LD",(G,U)=>this._getWorkerSource(G,U.type,U.source).loadData(U)),this.actor.registerMessageHandler("GD",(G,U)=>this._getWorkerSource(G,U.type,U.source).getData()),this.actor.registerMessageHandler("LT",(G,U)=>this._getWorkerSource(G,U.type,U.source).loadTile(U)),this.actor.registerMessageHandler("RT",(G,U)=>this._getWorkerSource(G,U.type,U.source).reloadTile(U)),this.actor.registerMessageHandler("AT",(G,U)=>this._getWorkerSource(G,U.type,U.source).abortTile(U)),this.actor.registerMessageHandler("RMT",(G,U)=>this._getWorkerSource(G,U.type,U.source).removeTile(U)),this.actor.registerMessageHandler("RS",(G,U)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[G]||!this.workerSources[G][U.type]||!this.workerSources[G][U.type][U.source])return;const X=this.workerSources[G][U.type][U.source];delete this.workerSources[G][U.type][U.source],X.removeSource!==void 0&&X.removeSource(U)})),this.actor.registerMessageHandler("RM",G=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G]})),this.actor.registerMessageHandler("SR",(G,U)=>S._(this,void 0,void 0,function*(){this.referrer=U})),this.actor.registerMessageHandler("SRPS",(G,U)=>this._syncRTLPluginState(G,U)),this.actor.registerMessageHandler("IS",(G,U)=>S._(this,void 0,void 0,function*(){this.self.importScripts(U)})),this.actor.registerMessageHandler("SI",(G,U)=>this._setImages(G,U)),this.actor.registerMessageHandler("UL",(G,U)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(G).update(U.layers,U.removedIds)})),this.actor.registerMessageHandler("SL",(G,U)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(G).replace(U)}))}_setImages(B,G){return S._(this,void 0,void 0,function*(){this.availableImages[B]=G;for(const U in this.workerSources[B]){const X=this.workerSources[B][U];for(const ne in X)X[ne].availableImages=G}})}_syncRTLPluginState(B,G){return S._(this,void 0,void 0,function*(){return yield S.cC.syncState(G,this.self.importScripts)})}_getAvailableImages(B){let G=this.availableImages[B];return G||(G=[]),G}_getLayerIndex(B){let G=this.layerIndexes[B];return G||(G=this.layerIndexes[B]=new c),G}_getWorkerSource(B,G,U){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][G]||(this.workerSources[B][G]={}),!this.workerSources[B][G][U]){const X={sendAsync:(ne,ue)=>(ne.targetMapId=B,this.actor.sendAsync(ne,ue))};switch(G){case"vector":this.workerSources[B][G][U]=new Ae(X,this._getLayerIndex(B),this._getAvailableImages(B));break;case"geojson":this.workerSources[B][G][U]=new mn(X,this._getLayerIndex(B),this._getAvailableImages(B));break;default:this.workerSources[B][G][U]=new this.externalWorkerSourceTypes[G](X,this._getLayerIndex(B),this._getAvailableImages(B))}}return this.workerSources[B][G][U]}_getDEMWorkerSource(B,G){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][G]||(this.demWorkerSources[B][G]=new fe),this.demWorkerSources[B][G]}}return S.i(self)&&(self.worker=new Dr(self)),Dr}),D("index",["exports","./shared"],function(S,c){var be="5.0.1";function me(){var h=new c.A(4);return c.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let de,Ae;const fe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:h=>new Promise((e,i)=>{const a=requestAnimationFrame(e);h.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),i(c.c())})}),getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,i.drawImage(h,0,0,h.width,h.height),i},resolveURL:h=>(de||(de=document.createElement("a")),de.href=h,de.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ae==null&&(Ae=matchMedia("(prefers-reduced-motion: reduce)")),Ae.matches)}};class te{static testProp(e){if(!te.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in te.docStyle)return e[i];return e[0]}static create(e,i,a){const s=window.document.createElement(e);return i!==void 0&&(s.className=i),a&&a.appendChild(s),s}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){te.docStyle&&te.selectProp&&(te.userSelect=te.docStyle[te.selectProp],te.docStyle[te.selectProp]="none")}static enableDrag(){te.docStyle&&te.selectProp&&(te.docStyle[te.selectProp]=te.userSelect)}static setTransform(e,i){e.style[te.transformProp]=i}static addEventListener(e,i,a,s={}){e.addEventListener(i,a,"passive"in s?s:s.capture)}static removeEventListener(e,i,a,s={}){e.removeEventListener(i,a,"passive"in s?s:s.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",te.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",te.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,a){const s=i.boundingClientRect;return new c.P((a.clientX-s.left)/i.x-e.clientLeft,(a.clientY-s.top)/i.y-e.clientTop)}static mousePos(e,i){const a=te.getScale(e);return te.getPoint(e,a,i)}static touchPos(e,i){const a=[],s=te.getScale(e);for(let u=0;u<i.length;u++)a.push(te.getPoint(e,s,i[u]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),a=i.querySelectorAll("script");for(const s of a)s.remove();return te.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const a=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!a.includes("javascript:")&&!a.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const a of i)te.removeAttributes(a),te.clean(a)}static removeAttributes(e){for(const{name:i,value:a}of e.attributes)te.isPossiblyDangerous(i,a)&&e.removeAttribute(i)}}te.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,te.selectProp=te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),te.transformProp=te.testProp(["transform","WebkitTransform"]);const Ce={supported:!1,testSupport:function(h){!je&&it&&(Fe?dt(h):Je=h)}};let Je,it,je=!1,Fe=!1;function dt(h){const e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,it),h.isContextLost())return;Ce.supported=!0}catch{}h.deleteTexture(e),je=!0}var He;typeof document<"u"&&(it=document.createElement("img"),it.onload=()=>{Je&&dt(Je),Je=null,Fe=!0},it.onerror=()=>{je=!0,Je=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let e,i,a,s;h.resetRequestQueue=()=>{e=[],i=0,a=0,s={}},h.addThrottleControl=y=>{const v=a++;return s[v]=y,v},h.removeThrottleControl=y=>{delete s[y],f()},h.getImage=(y,v,A=!0)=>new Promise((E,P)=>{Ce.supported&&(y.headers||(y.headers={}),y.headers.accept="image/webp,*/*"),c.e(y,{type:"image"}),e.push({abortController:v,requestParameters:y,supportImageRefresh:A,state:"queued",onError:R=>{P(R)},onSuccess:R=>{E(R)}}),f()});const u=y=>c._(this,void 0,void 0,function*(){y.state="running";const{requestParameters:v,supportImageRefresh:A,onError:E,onSuccess:P,abortController:R}=y,F=A===!1&&!c.i(self)&&!c.g(v.url)&&(!v.headers||Object.keys(v.headers).reduce((q,W)=>q&&W==="accept",!0));i++;const Y=F?g(v,R):c.m(v,R);try{const q=yield Y;delete y.abortController,y.state="completed",q.data instanceof HTMLImageElement||c.b(q.data)?P(q):q.data&&P({data:yield(Z=q.data,typeof createImageBitmap=="function"?c.d(Z):c.f(Z)),cacheControl:q.cacheControl,expires:q.expires})}catch(q){delete y.abortController,E(q)}finally{i--,f()}var Z}),f=()=>{const y=(()=>{for(const v of Object.keys(s))if(s[v]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let v=i;v<y&&e.length>0;v++){const A=e.shift();A.abortController.signal.aborted?v--:u(A)}},g=(y,v)=>new Promise((A,E)=>{const P=new Image,R=y.url,F=y.credentials;F&&F==="include"?P.crossOrigin="use-credentials":(F&&F==="same-origin"||!c.s(R))&&(P.crossOrigin="anonymous"),v.signal.addEventListener("abort",()=>{P.src="",E(c.c())}),P.fetchPriority="high",P.onload=()=>{P.onerror=P.onload=null,A({data:P})},P.onerror=()=>{P.onerror=P.onload=null,v.signal.aborted||E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},P.src=R})}(He||(He={})),He.resetRequestQueue();class ft{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function mt(h){const e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){const i=[];for(const{id:a,url:s}of h){const u=`${a}${s}`;i.indexOf(u)===-1&&(i.push(u),e.push({id:a,url:s}))}}return e}function ot(h,e,i){try{const a=new URL(h);return a.pathname+=`${e}${i}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class we{constructor(e,i,a,s){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,s)}update(e,i,a){const{width:s,height:u}=e,f=!(this.size&&this.size[0]===s&&this.size[1]===u||a),{context:g}=this,{gl:y}=g;if(this.useMipmap=!!(i&&i.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),f)this.size=[s,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,s,u,0,this.format,y.UNSIGNED_BYTE,e.data);else{const{x:v,y:A}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?y.texSubImage2D(y.TEXTURE_2D,0,v,A,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,v,A,s,u,y.RGBA,y.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i,a){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),a!==u.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=u.LINEAR),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,a||e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Et(h){const{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class Dt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:a}of this.requestors)a(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const a=i.spriteData;i.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let a=!0;const s=i.data||i.spriteData;return this._validateStretch(i.stretchX,s&&s.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(i.stretchY,s&&s.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(i.content,i)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,i){if(!e)return!0;let a=0;for(const s of e){if(s[0]<a||s[1]<s[0]||i<s[1])return!1;a=s[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const a=i.spriteData,s=a&&a.width||i.data.width,u=a&&a.height||i.data.height;return!(e[0]<0||s<e[0]||e[1]<0||u<e[1]||e[2]<0||s<e[2]||e[3]<0||u<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,a=!0){const s=this.getImage(e);if(a&&(s.data.width!==i.data.width||s.data.height!==i.data.height))throw new Error(`size mismatch between old image (${s.data.width}x${s.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=s.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,a)=>{let s=!0;if(!this.isLoaded())for(const u of e)this.images[u]||(s=!1);this.isLoaded()||s?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const a of e){let s=this.getImage(a);s||(this.fire(new c.k("styleimagemissing",{id:a})),s=this.getImage(a)),s?i[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,textFitWidth:s.textFitWidth,textFitHeight:s.textFitHeight,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],a=this.getImage(e);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const s={w:a.data.width+2,h:a.data.height+2,x:0,y:0},u=new c.I(s,a);this.patterns[e]={bin:s,position:u}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const u in this.patterns)e.push(this.patterns[u].bin);const{w:i,h:a}=c.p(e),s=this.atlasImage;s.resize({width:i||1,height:a||1});for(const u in this.patterns){const{bin:f}=this.patterns[u],g=f.x+1,y=f.y+1,v=this.getImage(u).data,A=v.width,E=v.height;c.R.copy(v,s,{x:0,y:0},{x:g,y},{width:A,height:E}),c.R.copy(v,s,{x:0,y:E-1},{x:g,y:y-1},{width:A,height:1}),c.R.copy(v,s,{x:0,y:0},{x:g,y:y+E},{width:A,height:1}),c.R.copy(v,s,{x:A-1,y:0},{x:g-1,y},{width:1,height:E}),c.R.copy(v,s,{x:0,y:0},{x:g+A,y},{width:1,height:E})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const a=this.getImage(i);a||c.w(`Image with ID: "${i}" was not found`),Et(a)&&this.updateImage(i,a)}}}const Bi=1e20;function si(h,e,i,a,s,u,f,g,y){for(let v=e;v<e+a;v++)Wt(h,i*u+v,u,s,f,g,y);for(let v=i;v<i+s;v++)Wt(h,v*u+e,1,a,f,g,y)}function Wt(h,e,i,a,s,u,f){u[0]=0,f[0]=-1e20,f[1]=Bi,s[0]=h[e];for(let g=1,y=0,v=0;g<a;g++){s[g]=h[e+g*i];const A=g*g;do{const E=u[y];v=(s[g]-s[E]+A-E*E)/(g-E)/2}while(v<=f[y]&&--y>-1);y++,u[y]=g,f[y]=v,f[y+1]=Bi}for(let g=0,y=0;g<a;g++){for(;f[y+1]<g;)y++;const v=u[y],A=g-v;h[e+g*i]=s[v]+A*A}}class Zt{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const i=[];for(const u in e)for(const f of e[u])i.push(this._getAndCacheGlyphsPromise(u,f));const a=yield Promise.all(i),s={};for(const{stack:u,id:f,glyph:g}of a)s[u]||(s[u]={}),s[u][f]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics};return s})}_getAndCacheGlyphsPromise(e,i){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let s=a.glyphs[i];if(s!==void 0)return{stack:e,id:i,glyph:s};if(s=this._tinySDF(a,e,i),s)return a.glyphs[i]=s,{stack:e,id:i,glyph:s};const u=Math.floor(i/256);if(256*u>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[u])return{stack:e,id:i,glyph:s};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[u]){const g=Zt.loadGlyphRange(e,u,this.url,this.requestManager);a.requests[u]=g}const f=yield a.requests[u];for(const g in f)this._doesCharSupportLocalGlyph(+g)||(a.glyphs[+g]=f[+g]);return a.ranges[u]=!0,{stack:e,id:i,glyph:f[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,i,a){const s=this.localIdeographFontFamily;if(!s||!this._doesCharSupportLocalGlyph(a))return;let u=e.tinySDF;if(!u){let g="400";/bold/i.test(i)?g="900":/medium/i.test(i)?g="500":/light/i.test(i)&&(g="200"),u=e.tinySDF=new Zt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:s,fontWeight:g})}const f=u.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}Zt.loadGlyphRange=function(h,e,i,a){return c._(this,void 0,void 0,function*(){const s=256*e,u=s+255,f=a.transformRequest(i.replace("{fontstack}",h).replace("{range}",`${s}-${u}`),"Glyphs"),g=yield c.l(f,new AbortController);if(!g||!g.data)throw new Error(`Could not load glyph range. range: ${e}, ${s}-${u}`);const y={};for(const v of c.n(g.data))y[v.id]=v;return y})},Zt.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:s="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const g=this.size=h+4*e,y=this._createCanvas(g),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${f} ${u} ${h}px ${s}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(h){const e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:s,actualBoundingBoxRight:u}=this.ctx.measureText(h),f=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-s))),y=Math.min(this.size-this.buffer,f+Math.ceil(a)),v=g+2*this.buffer,A=y+2*this.buffer,E=Math.max(v*A,0),P=new Uint8ClampedArray(E),R={data:P,width:v,height:A,glyphWidth:g,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return R;const{ctx:F,buffer:Y,gridInner:Z,gridOuter:q}=this;F.clearRect(Y,Y,g,y),F.fillText(h,Y,Y+f);const W=F.getImageData(Y,Y,g,y);q.fill(Bi,0,E),Z.fill(0,0,E);for(let ee=0;ee<y;ee++)for(let ie=0;ie<g;ie++){const re=W.data[4*(ee*g+ie)+3]/255;if(re===0)continue;const le=(ee+Y)*v+ie+Y;if(re===1)q[le]=0,Z[le]=Bi;else{const oe=.5-re;q[le]=oe>0?oe*oe:0,Z[le]=oe<0?oe*oe:0}}si(q,0,0,v,A,v,this.f,this.v,this.z),si(Z,Y,Y,g,y,v,this.f,this.v,this.z);for(let ee=0;ee<E;ee++){const ie=Math.sqrt(q[ee])-Math.sqrt(Z[ee]);P[ee]=Math.round(255-255*(ie/this.radius+this.cutoff))}return R}};class gi{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,i){return c.x(e.expression.evaluate(i))}interpolate(e,i,a){return{x:c.y.number(e.x,i.x,a),y:c.y.number(e.y,i.y,a),z:c.y.number(e.z,i.z,a)}}}let xt;class Ii extends c.E{constructor(e){super(),xt=xt||new c.q({anchor:new c.D(c.v.light.anchor),position:new gi,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(xt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(c.r,e,i))for(const a in e){const s=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),s):this._transitionable.setValue(a,s)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const ct=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class li extends c.E{constructor(e){super(),this._transitionable=new c.T(ct),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,i={}){if(!this._validate(c.B,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const s=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),s):this._transitionable.setValue(a,s)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class dr{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const a=e.join(",")+String(i);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,i)),this.dashEntry[a]}getDashRanges(e,i,a){const s=[];let u=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,g=!0;s.push({left:u,right:f,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){g=!g;const A=e[v];u=y*a,y+=A,f=y*a,s.push({left:u,right:f,isDash:g,zeroLength:A===0})}return s}addRoundDash(e,i,a){const s=i/2;for(let u=-a;u<=a;u++){const f=this.width*(this.nextRow+a+u);let g=0,y=e[g];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++g]);const A=Math.abs(v-y.left),E=Math.abs(v-y.right),P=Math.min(A,E);let R;const F=u/a*(s+1);if(y.isDash){const Y=s-Math.abs(F);R=Math.sqrt(P*P+Y*Y)}else R=s-Math.sqrt(P*P+F*F);this.data[f+v]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e){for(let g=e.length-1;g>=0;--g){const y=e[g],v=e[g+1];y.zeroLength?e.splice(g,1):v&&v.isDash===y.isDash&&(v.left=y.left,e.splice(g,1))}const i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const s=this.width*this.nextRow;let u=0,f=e[u];for(let g=0;g<this.width;g++){g/f.right>1&&(f=e[++u]);const y=Math.abs(g-f.left),v=Math.abs(g-f.right),A=Math.min(y,v);this.data[s+g]=Math.max(0,Math.min(255,(f.isDash?A:-A)+128))}}addDash(e,i){const a=i?7:0,s=2*a+1;if(this.nextRow+s>this.height)return c.w("LineAtlas out of space"),null;let u=0;for(let g=0;g<e.length;g++)u+=e[g];if(u!==0){const g=this.width/u,y=this.getDashRanges(e,this.width,g);i?this.addRoundDash(y,g,a):this.addRegularDash(y)}const f={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:u};return this.nextRow+=s,this.dirty=!0,f}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const fr="maplibre_preloaded_worker_pool";class Ei{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ei.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fr]}numActive(){return Object.keys(this.active).length}}const Fi=Math.floor(fe.hardwareConcurrency/2);let Li,ci;function Tr(){return Li||(Li=new Ei),Li}Ei.workerCount=c.C(globalThis)?Math.max(Math.min(Fi,3),1):1;class nr{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const a=this.workerPool.acquire(i);for(let s=0;s<a.length;s++){const u=new c.F(a[s],i);u.name=`Worker ${s}`,this.actors.push(u)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const a=[];for(const s of this.actors)a.push(s.sendAsync({type:e,data:i}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const a of this.actors)a.registerMessageHandler(e,i)}}function or(){return ci||(ci=new nr(Tr(),c.G),ci.registerMessageHandler("GR",(h,e,i)=>c.m(e,i))),ci}function Oi(h,e){const i=c.H();return c.J(i,i,[1,1,0]),c.K(i,i,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?c.L(i,i,h.calculatePosMatrix(e.toUnwrapped())):i}function qr(h,e,i,a,s,u){var f;const g=function(E,P,R){if(E)for(const F of E){const Y=P[F];if(Y&&Y.source===R&&Y.type==="fill-extrusion")return!0}else for(const F in P){const Y=P[F];if(Y.source===R&&Y.type==="fill-extrusion")return!0}return!1}((f=s==null?void 0:s.layers)!==null&&f!==void 0?f:null,e,h.id),y=u.maxPitchScaleFactor(),v=h.tilesIn(a,y,g);v.sort(Kt);const A=[];for(const E of v)A.push({wrappedTileID:E.tileID.wrapped().key,queryResults:E.tile.queryRenderedFeatures(e,i,h._state,E.queryGeometry,E.cameraQueryGeometry,E.scale,s,u,y,Oi(h.transform,E.tileID))});return function(E,P){for(const R in E)for(const F of E[R])at(F,P);return E}(function(E){const P={},R={};for(const F of E){const Y=F.queryResults,Z=F.wrappedTileID,q=R[Z]=R[Z]||{};for(const W in Y){const ee=Y[W],ie=q[W]=q[W]||{},re=P[W]=P[W]||[];for(const le of ee)ie[le.featureIndex]||(ie[le.featureIndex]=!0,re.push(le))}}return P}(A),h)}function Kt(h,e){const i=h.tileID,a=e.tileID;return i.overscaledZ-a.overscaledZ||i.canonical.y-a.canonical.y||i.wrap-a.wrap||i.canonical.x-a.canonical.x}function at(h,e){const i=h.feature,a=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}function Sr(h,e,i){return c._(this,void 0,void 0,function*(){let a=h;if(h.url?a=(yield c.h(e.transformRequest(h.url,"Source"),i)).data:yield fe.frameAsync(i),!a)return null;const s=c.M(c.e(a,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(s.vectorLayerIds=a.vector_layers.map(u=>u.id)),s})}class _i{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const i=this._sw,a=this._ne;let s,u;if(e instanceof c.N)s=e,u=e;else{if(!(e instanceof _i))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(_i.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(s=e._sw,u=e._ne,!s||!u)return this}return i||a?(i.lng=Math.min(s.lng,i.lng),i.lat=Math.min(s.lat,i.lat),a.lng=Math.max(u.lng,a.lng),a.lat=Math.max(u.lat,a.lat)):(this._sw=new c.N(s.lng,s.lat),this._ne=new c.N(u.lng,u.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=c.N.convert(e);let s=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&s}static convert(e){return e instanceof _i?e:e&&new _i(e)}static fromLngLat(e,i=0){const a=360*i/40075017,s=a/Math.cos(Math.PI/180*e.lat);return new _i(new c.N(e.lng-s,e.lat-a),new c.N(e.lng+s,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),i=new c.N(this._ne.lng,this._ne.lat);return new _i(e,e.lng>i.lng?new c.N(i.lng+360,i.lat):i)}}class $r{constructor(e,i,a){this.bounds=_i.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*i),s=Math.floor(c.Q(this.bounds.getNorth())*i),u=Math.ceil(c.O(this.bounds.getEast())*i),f=Math.ceil(c.Q(this.bounds.getSouth())*i);return e.x>=a&&e.x<u&&e.y>=s&&e.y<f}}class fn extends c.E{constructor(e,i,a,s){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(i,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new $r(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};a.request.collectResourceTiming=this._collectResourceTiming;let s="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((u,f)=>{e.reloadPromise={resolve:u,reject:f}})}else e.actor=this.dispatcher.getActor(),s="LT";e.abortController=new AbortController;try{const u=yield e.actor.sendAsync({type:s,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,u)}catch(u){if(delete e.abortController,e.aborted)return;if(u&&u.status!==404)throw u;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Gi extends c.E{constructor(e,i,a,s){super(),this.id=e,this.dispatcher=a,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},i),c.e(this,c.M(i,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(c.e(this,i),i.bounds&&(this.tileBounds=new $r(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new c.j(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield He.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const s=this.map.painter.context,u=s.gl,f=a.data;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new we(s,f,u.RGBA,{useMipmap:!0}),e.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class kr extends Gi{constructor(e,i,a,s){super(e,i,a,s),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const s=yield He.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){const u=s.data;this.map._refreshExpiredTiles&&s.cacheControl&&s.expires&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});const f=c.b(u)&&c.U()?u:yield this.readImageNow(u),g={type:this.type,uid:e.uid,source:this.id,rawImageData:f,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const y=yield e.actor.sendAsync({type:"LDT",data:g});e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const i=e.width+2,a=e.height+2;try{return new c.R({width:i,height:a},yield c.W(e,-1,-1,i,a))}catch{}}return fe.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,a=Math.pow(2,i.z),s=(i.x-1+a)%a,u=i.x===0?e.wrap-1:e.wrap,f=(i.x+1+a)%a,g=i.x+1===a?e.wrap+1:e.wrap,y={};return y[new c.S(e.overscaledZ,u,i.z,s,i.y).key]={backfilled:!1},y[new c.S(e.overscaledZ,g,i.z,f,i.y).key]={backfilled:!1},i.y>0&&(y[new c.S(e.overscaledZ,u,i.z,s,i.y-1).key]={backfilled:!1},y[new c.S(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},y[new c.S(e.overscaledZ,g,i.z,f,i.y-1).key]={backfilled:!1}),i.y+1<a&&(y[new c.S(e.overscaledZ,u,i.z,s,i.y+1).key]={backfilled:!1},y[new c.S(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},y[new c.S(e.overscaledZ,g,i.z,f,i.y+1).key]={backfilled:!1}),y}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Rr extends c.E{constructor(e,i,a,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(s),this._data=i.data,this._options=c.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:c.X,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:c.X,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(c.X/this.tileSize)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const i=c.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(fe.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let s=null;a.resourceTiming&&a.resourceTiming[this.id]&&(s=a.resourceTiming[this.id].slice(0));const u={dataType:"source"};this._collectResourceTiming&&s&&s.length>0&&c.e(u,{resourceTiming:s}),this.fire(new c.k("data",Object.assign(Object.assign({},u),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},u),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const s=yield this.actor.sendAsync({type:i,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(s,this.map.painter,i==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Ui extends c.E{constructor(e,i,a,s){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(s),this.options=i}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield He.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new c.j(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(c.Y.fromLngLat);var a;return this.tileID=function(s){let u=1/0,f=1/0,g=-1/0,y=-1/0;for(const P of s)u=Math.min(u,P.x),f=Math.min(f,P.y),g=Math.max(g,P.x),y=Math.max(y,P.y);const v=Math.max(g-u,y-f),A=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),E=Math.pow(2,A);return new c.Z(A,Math.floor((u+g)/2*E),Math.floor((f+y)/2*E))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(s=>this.tileID.getTilePoint(s)._round()),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new we(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const s in this.tiles){const u=this.tiles[s];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Lt extends Ui{constructor(e,i,a,s){super(e,i,a,s),this.roundZoom=!0,this.type="video",this.options=i}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield c.a0(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new c.j(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new c.j(new c.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new we(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const s in this.tiles){const u=this.tiles[s];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ar extends Ui{constructor(e,i,a,s){super(e,i,a,s),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(u=>!Array.isArray(u)||u.length!==2||u.some(f=>typeof f!="number"))||this.fire(new c.j(new c.$(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.$(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new c.j(new c.$(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.$(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.$(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,a=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(i,this.canvas,a.RGBA,{premultiply:!0});let s=!1;for(const u in this.tiles){const f=this.tiles[u];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,s=!0)}s&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Wr={},zt=h=>{switch(h){case"geojson":return Rr;case"image":return Ui;case"raster":return Gi;case"raster-dem":return kr;case"vector":return fn;case"video":return Lt;case"canvas":return ar}return Wr[h]},ji="RTLPluginLoaded";class mr extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=or()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(i,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=fe.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ji))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Cr=null;function Ot(){return Cr||(Cr=new mr),Cr}class Yt{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a1(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,u){const f={};if(!u)return f;for(const g of s){const y=g.layerIds.map(v=>u.getLayer(v)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(v=>y.filter(A=>A.id===v)[0]));for(const v of y)f[v.id]=g}}return f}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const s in this.buckets){const u=this.buckets[s];if(u instanceof c.a3){if(this.hasSymbolBuckets=!0,!a)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const s in this.buckets){const u=this.buckets[s];if(u instanceof c.a3&&u.hasRTLText){this.hasRTLText=!0,Ot().lazyLoad();break}}this.queryPadding=0;for(const s in this.buckets){const u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(s).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a2}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const s=this.buckets[a];s.uploadPending()&&s.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,s,u,f,g,y,v,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:u,scale:f,tileSize:this.tileSize,pixelPosMatrix:A,transform:y,params:g,queryPadding:this.queryPadding*v},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const s=a.loadVTLayers(),u=i&&i.sourceLayer?i.sourceLayer:"",f=s._geojsonTileLayer||s[u];if(!f)return;const g=c.a4(i&&i.filter),{z:y,x:v,y:A}=this.tileID.canonical,E={z:y,x:v,y:A};for(let P=0;P<f.length;P++){const R=f.feature(P);if(g.needGeometry){const Z=c.a5(R,!0);if(!g.filter(new c.z(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!g.filter(new c.z(this.tileID.overscaledZ),R))continue;const F=a.getId(R,u),Y=new c.a6(R,y,v,A,F);Y.tile=E,e.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=c.a7(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let s=!1;if(this.expirationTime>a)s=!1;else if(i)if(this.expirationTime<i)s=!0;else{const u=this.expirationTime-i;u?this.expirationTime=a+Math.max(u,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const s in this.buckets){if(!i.style.hasLayer(s))continue;const u=this.buckets[s],f=u.layers[0].sourceLayer||"_geojsonTileLayer",g=a[f],y=e[f];if(!g||!y||Object.keys(y).length===0)continue;u.update(y,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=i&&i.style&&i.style.getLayer(s);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(u)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=fe.now()+e}setDependencies(e,i){const a={};for(const s of i)a[s]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const s=this.dependencies[a];if(s){for(const u of i)if(s[u])return!0}}return!1}}class sn{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);const u={value:i,timeout:void 0};if(a!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},a)),this.data[s].push(u),this.order.push(s),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,s=i===void 0?0:this.data[a].indexOf(i),u=this.data[a][s];return this.data[a].splice(s,1),u.timeout&&clearTimeout(u.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(u.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const s of this.data[a])e(s.value)||i.push(s);for(const a of i)this.remove(a.value.tileID,a)}}class gr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const s=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},c.e(this.stateChanges[e][s],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==s&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(const u in this.state[e][s])a[u]||(this.deletedStates[e][s][u]=null)}else for(const u in a)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][u]===null&&delete this.deletedStates[e][s][u]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const s=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(a in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][a]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),s=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][i];if(u===null)return{};for(const f in u)delete s[f]}return s}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const s in this.stateChanges){this.state[s]=this.state[s]||{};const u={};for(const f in this.stateChanges[s])this.state[s][f]||(this.state[s][f]={}),c.e(this.state[s][f],this.stateChanges[s][f]),u[f]=this.state[s][f];a[s]=u}for(const s in this.deletedStates){this.state[s]=this.state[s]||{};const u={};if(this.deletedStates[s]===null)for(const f in this.state[s])u[f]={},this.state[s][f]={};else for(const f in this.deletedStates[s]){if(this.deletedStates[s][f]===null)this.state[s][f]={};else for(const g of Object.keys(this.deletedStates[s][f]))delete this.state[s][f][g];u[f]=this.state[s][f]}a[s]=a[s]||{},c.e(a[s],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const s in e)e[s].setFeatureState(a,i)}}function Pi(h,e,i){const a=e.intersectsFrustum(h);if(!i)return a;const s=e.intersectsPlane(i);return a===0||s===0?0:a===2&&s===2?2:1}function mn(h,e,i,a,s){let u=h;const f=Math.atan(e/i),g=Math.hypot(e,i);return u=h+c.a8(a/g/Math.max(.5,Math.cos(c.aa(s/2)))),u+=1*c.a8(Math.cos(f))/2,u+=c.ab(h-u,-0,0),u}function Dr(h,e){const i=(e.roundZoom?Math.round:Math.floor)(h.zoom+c.a8(h.tileSize/e.tileSize));return Math.max(0,i)}function V(h,e){const i=h.getCameraFrustum(),a=h.getClippingPlane(),s=h.screenPointToMercatorCoordinate(h.getCameraPoint()),u=c.Y.fromLngLat(h.center,h.elevation);s.z=u.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;const f=h.getCoveringTilesDetailsProvider(),g=f.allowVariableZoom(h,e),y=Dr(h,e),v=e.minzoom||0,A=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,E=Math.min(Math.max(0,y),A),P=Math.pow(2,E),R=[P*s.x,P*s.y,0],F=[P*u.x,P*u.y,0],Y=Math.hypot(u.x-s.x,u.y-s.y),Z=Math.abs(u.z-s.z),q=Math.hypot(Y,Z),W=re=>({zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ee=[],ie=[];if(h.renderWorldCopies&&f.allowWorldCopies())for(let re=1;re<=3;re++)ee.push(W(-re)),ee.push(W(re));for(ee.push(W(0));ee.length>0;){const re=ee.pop(),le=re.x,oe=re.y;let ge=re.fullyVisible;const xe={x:le,y:oe,z:re.zoom},Oe=f.getTileAABB(xe,re.wrap,h.elevation,e);if(!ge){const Ue=Pi(i,Oe,a);if(Ue===0)continue;ge=Ue===2}const Ie=f.distanceToTile2d(s.x,s.y,xe,Oe);let Le=y;g&&(Le=(e.calculateTileZoom||mn)(h.zoom+c.a8(h.tileSize/e.tileSize),Ie,Z,q,h.fov)),Le=(e.roundZoom?Math.round:Math.floor)(Le),Le=Math.max(0,Le);const Ye=Math.min(Le,A);if(re.wrap=f.getWrap(u,xe,re.wrap),re.zoom>=Ye){if(re.zoom<v)continue;const Ue=E-re.zoom,Ne=R[0]-.5-(le<<Ue),Qe=R[1]-.5-(oe<<Ue),yt=e.reparseOverscaled?Math.max(re.zoom,Le):re.zoom;ie.push({tileID:new c.S(re.zoom===A?yt:re.zoom,re.wrap,re.zoom,le,oe),distanceSq:c.a9([F[0]-.5-le,F[1]-.5-oe]),tileDistanceToCamera:Math.sqrt(Ne*Ne+Qe*Qe)})}else for(let Ue=0;Ue<4;Ue++)ee.push({zoom:re.zoom+1,x:(le<<1)+Ue%2,y:(oe<<1)+(Ue>>1),wrap:re.wrap,fullyVisible:ge})}return ie.sort((re,le)=>re.distanceSq-le.distanceSq).map(re=>re.tileID)}class B extends c.E{constructor(e,i,a){super(),this.id=e,this.dispatcher=a,this.on("data",s=>this._dataHandler(s)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((s,u,f,g)=>{const y=new(zt(u.type))(s,u,f,g);if(y.id!==s)throw new Error(`Expected Source id to be ${s} instead of ${y.id}`);return y})(e,i,a,this),this._tiles={},this._cache=new sn(0,s=>this._unloadTile(s)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gr,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,a)}catch(s){e.state="errored",s.status!==404?this._source.fire(new c.j(s,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(G).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&i.push(this._tiles[a]);return e?i.sort((a,s)=>{const u=a.tileID,f=s.tileID,g=new c.P(u.canonical.x,u.canonical.y)._rotate(-this.transform.bearingInRadians),y=new c.P(f.canonical.x,f.canonical.y)._rotate(-this.transform.bearingInRadians);return u.overscaledZ-f.overscaledZ||y.y-g.y||y.x-g.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(G).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)(e||this._tiles[i].state!=="errored")&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),yield this._loadTile(a,e,i))})}_tileLoaded(e,i,a){e.timeAdded=fe.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let s=0;s<i.length;s++){const u=i[s];if(e.neighboringTiles&&e.neighboringTiles[u]){const f=this.getTileByID(u);a(e,f),a(f,e)}}function a(s,u){s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0;let f=u.tileID.canonical.x-s.tileID.canonical.x;const g=u.tileID.canonical.y-s.tileID.canonical.y,y=Math.pow(2,s.tileID.canonical.z),v=u.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),u.dem&&s.dem&&(s.dem.backfillBorder(u.dem,f,g),s.neighboringTiles&&s.neighboringTiles[v]&&(s.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,s){for(const u in this._tiles){let f=this._tiles[u];if(s[u]||!f.hasData()||f.tileID.overscaledZ<=i||f.tileID.overscaledZ>a)continue;let g=f.tileID;for(;f&&f.tileID.overscaledZ>i+1;){const v=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[v.key],f&&f.hasData()&&(g=v)}let y=g;for(;y.overscaledZ>i;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]||e[y.canonical.key]){s[g.key]=g;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const s=e.scaledTo(a),u=this._getLoadedTile(s);if(u)return u}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,s=Math.floor(i*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(u)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const s in this._tiles){const u=this._tiles[s];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+i),a[u.tileID.key]=u}this._tiles=a;for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}}_updateCoveredAndRetainedTiles(e,i,a,s,u,f){const g={},y={},v=Object.keys(e),A=fe.now();for(const E of v){const P=e[E],R=this._tiles[E];if(!R||R.fadeEndTime!==0&&R.fadeEndTime<=A)continue;const F=this.findLoadedParent(P,i),Y=this.findLoadedSibling(P),Z=F||Y||null;Z&&(this._addTile(Z.tileID),g[Z.tileID.key]=Z.tileID),y[E]=P}this._retainLoadedChildren(y,s,a,e);for(const E in g)e[E]||(this._coveredTiles[E]=!0,e[E]=g[E]);if(f){const E={},P={};for(const R of u)this._tiles[R.key].hasData()?E[R.key]=R:P[R.key]=R;for(const R in P){const F=P[R].children(this._source.maxzoom);this._tiles[F[0].key]&&this._tiles[F[1].key]&&this._tiles[F[2].key]&&this._tiles[F[3].key]&&(E[F[0].key]=e[F[0].key]=F[0],E[F[1].key]=e[F[1].key]=F[1],E[F[2].key]=e[F[2].key]=F[2],E[F[3].key]=e[F[3].key]=F[3],delete P[R])}for(const R in P){const F=P[R],Y=this.findLoadedParent(F,this._source.minzoom),Z=this.findLoadedSibling(F),q=Y||Z||null;if(q){E[q.tileID.key]=e[q.tileID.key]=q.tileID;for(const W in E)E[W].isChildOf(q.tileID)&&delete E[W]}}for(const R in this._tiles)E[R]||(this._coveredTiles[R]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new c.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(a=V(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter(A=>this._source.hasTile(A)))):a=[];const s=Dr(e,this._source),u=Math.max(s-B.maxOverzooming,this._source.minzoom),f=Math.max(s+B.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const E of a)if(E.canonical.z>this._source.minzoom){const P=E.scaledTo(E.canonical.z-1);A[P.key]=P;const R=E.scaledTo(Math.max(this._source.minzoom,Math.min(E.canonical.z,5)));A[R.key]=R}a=a.concat(Object.values(A))}const g=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=this._updateRetainedTiles(a,s);U(this._source.type)&&this._updateCoveredAndRetainedTiles(y,u,f,s,a,i);for(const A in y)this._tiles[A].clearFadeHold();const v=c.ac(this._tiles,y);for(const A of v){const E=this._tiles[A];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var a;const s={},u={},f=Math.max(i-B.maxOverzooming,this._source.minzoom),g=Math.max(i+B.maxUnderzooming,this._source.minzoom),y={};for(const v of e){const A=this._addTile(v);s[v.key]=v,A.hasData()||i<this._source.maxzoom&&(y[v.key]=v)}this._retainLoadedChildren(y,i,g,s);for(const v of e){let A=this._tiles[v.key];if(A.hasData())continue;if(i+1>this._source.maxzoom){const P=v.children(this._source.maxzoom)[0],R=this.getTile(P);if(R&&R.hasData()){s[P.key]=P;continue}}else{const P=v.children(this._source.maxzoom);if(s[P[0].key]&&s[P[1].key]&&s[P[2].key]&&s[P[3].key])continue}let E=A.wasRequested();for(let P=v.overscaledZ-1;P>=f;--P){const R=v.scaledTo(P);if(u[R.key])break;if(u[R.key]=!0,A=this.getTile(R),!A&&E&&(A=this._addTile(R)),A){const F=A.hasData();if((F||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||E)&&(s[R.key]=R),E=A.wasRequested(),F)break}}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){a=this._loadedParentTiles[s.key];break}i.push(s.key);const u=s.scaledTo(s.overscaledZ-1);if(a=this._getLoadedTile(u),a)break;s=u}for(const u of i)this._loadedParentTiles[u]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,a=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=i;return i||(i=new Yt(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,a||this._source.fire(new c.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,a){const s=[],u=this.transform;if(!u)return s;const f=a?u.getCameraQueryGeometry(e):e,g=e.map(F=>u.screenPointToMercatorCoordinate(F,this.terrain)),y=f.map(F=>u.screenPointToMercatorCoordinate(F,this.terrain)),v=this.getIds();let A=1/0,E=1/0,P=-1/0,R=-1/0;for(const F of y)A=Math.min(A,F.x),E=Math.min(E,F.y),P=Math.max(P,F.x),R=Math.max(R,F.y);for(let F=0;F<v.length;F++){const Y=this._tiles[v[F]];if(Y.holdingForFade())continue;const Z=Y.tileID,q=Math.pow(2,u.zoom-Y.tileID.overscaledZ),W=i*Y.queryPadding*c.X/Y.tileSize/q,ee=[Z.getTilePoint(new c.Y(A,E)),Z.getTilePoint(new c.Y(P,R))];if(ee[0].x-W<c.X&&ee[0].y-W<c.X&&ee[1].x+W>=0&&ee[1].y+W>=0){const ie=g.map(le=>Z.getTilePoint(le)),re=y.map(le=>Z.getTilePoint(le));s.push({tile:Y,tileID:Z,queryGeometry:ie,cameraQueryGeometry:re,scale:q})}}return s}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(U(this._source.type)){const e=fe.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const s=this._tiles[e];s&&s.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}}function G(h,e){const i=Math.abs(2*h.wrap)-+(h.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||a-i||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function U(h){return h==="raster"||h==="image"||h==="video"}B.maxOverzooming=10,B.maxUnderzooming=3;class X{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ab(e,0,1);let i=1,a=this._distances[i];const s=e*this.paddedLength+this.padding;for(;a<s&&i<this._distances.length;)a=this._distances[++i];const u=i-1,f=this._distances[u],g=a-f,y=g>0?(s-f)/g:0;return this.points[u].mult(1-y).add(this.points[i].mult(y))}}function ne(h,e){let i=!0;return h==="always"||h!=="never"&&e!=="never"||(i=!1),i}class ue{constructor(e,i,a){const s=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(i/a);for(let f=0;f<this.xCellCount*this.yCellCount;f++)s.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,a,s,u){this._forEachCell(i,a,s,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(u)}insertCircle(e,i,a,s){this._forEachCell(i-s,a-s,i+s,a+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(a),this.circles.push(s)}_insertBoxCell(e,i,a,s,u,f){this.boxCells[u].push(f)}_insertCircleCell(e,i,a,s,u,f){this.circleCells[u].push(f)}_query(e,i,a,s,u,f,g){if(a<0||e>this.width||s<0||i>this.height)return[];const y=[];if(e<=0&&i<=0&&this.width<=a&&this.height<=s){if(u)return[{key:null,x1:e,y1:i,x2:a,y2:s}];for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const A=this.circles[3*v],E=this.circles[3*v+1],P=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:A-P,y1:E-P,x2:A+P,y2:E+P})}}else this._forEachCell(e,i,a,s,this._queryCell,y,{hitTest:u,overlapMode:f,seenUids:{box:{},circle:{}}},g);return y}query(e,i,a,s){return this._query(e,i,a,s,!1,null)}hitTest(e,i,a,s,u,f){return this._query(e,i,a,s,!0,u,f).length>0}hitTestCircle(e,i,a,s,u){const f=e-a,g=e+a,y=i-a,v=i+a;if(g<0||f>this.width||v<0||y>this.height)return!1;const A=[];return this._forEachCell(f,y,g,v,this._queryCellCircle,A,{hitTest:!0,overlapMode:s,circle:{x:e,y:i,radius:a},seenUids:{box:{},circle:{}}},u),A.length>0}_queryCell(e,i,a,s,u,f,g,y){const{seenUids:v,hitTest:A,overlapMode:E}=g,P=this.boxCells[u];if(P!==null){const F=this.bboxes;for(const Y of P)if(!v.box[Y]){v.box[Y]=!0;const Z=4*Y,q=this.boxKeys[Y];if(e<=F[Z+2]&&i<=F[Z+3]&&a>=F[Z+0]&&s>=F[Z+1]&&(!y||y(q))&&(!A||!ne(E,q.overlapMode))&&(f.push({key:q,x1:F[Z],y1:F[Z+1],x2:F[Z+2],y2:F[Z+3]}),A))return!0}}const R=this.circleCells[u];if(R!==null){const F=this.circles;for(const Y of R)if(!v.circle[Y]){v.circle[Y]=!0;const Z=3*Y,q=this.circleKeys[Y];if(this._circleAndRectCollide(F[Z],F[Z+1],F[Z+2],e,i,a,s)&&(!y||y(q))&&(!A||!ne(E,q.overlapMode))){const W=F[Z],ee=F[Z+1],ie=F[Z+2];if(f.push({key:q,x1:W-ie,y1:ee-ie,x2:W+ie,y2:ee+ie}),A)return!0}}}return!1}_queryCellCircle(e,i,a,s,u,f,g,y){const{circle:v,seenUids:A,overlapMode:E}=g,P=this.boxCells[u];if(P!==null){const F=this.bboxes;for(const Y of P)if(!A.box[Y]){A.box[Y]=!0;const Z=4*Y,q=this.boxKeys[Y];if(this._circleAndRectCollide(v.x,v.y,v.radius,F[Z+0],F[Z+1],F[Z+2],F[Z+3])&&(!y||y(q))&&!ne(E,q.overlapMode))return f.push(!0),!0}}const R=this.circleCells[u];if(R!==null){const F=this.circles;for(const Y of R)if(!A.circle[Y]){A.circle[Y]=!0;const Z=3*Y,q=this.circleKeys[Y];if(this._circlesCollide(F[Z],F[Z+1],F[Z+2],v.x,v.y,v.radius)&&(!y||y(q))&&!ne(E,q.overlapMode))return f.push(!0),!0}}}_forEachCell(e,i,a,s,u,f,g,y){const v=this._convertToXCellCoord(e),A=this._convertToYCellCoord(i),E=this._convertToXCellCoord(a),P=this._convertToYCellCoord(s);for(let R=v;R<=E;R++)for(let F=A;F<=P;F++)if(u.call(this,e,i,a,s,this.xCellCount*F+R,f,g,y))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,a,s,u,f){const g=s-e,y=u-i,v=a+f;return v*v>g*g+y*y}_circleAndRectCollide(e,i,a,s,u,f,g){const y=(f-s)/2,v=Math.abs(e-(s+y));if(v>y+a)return!1;const A=(g-u)/2,E=Math.abs(i-(u+A));if(E>A+a)return!1;if(v<=y||E<=A)return!0;const P=v-y,R=E-A;return P*P+R*R<=a*a}}function ye(h,e,i){const a=c.H();if(!h){const{vecSouth:E,vecEast:P}=Me(e),R=me();R[0]=P[0],R[1]=P[1],R[2]=E[0],R[3]=E[1],s=R,(A=(f=(u=R)[0])*(v=u[3])-(y=u[2])*(g=u[1]))&&(s[0]=v*(A=1/A),s[1]=-g*A,s[2]=-y*A,s[3]=f*A),a[0]=R[0],a[1]=R[1],a[4]=R[2],a[5]=R[3]}var s,u,f,g,y,v,A;return c.K(a,a,[1/i,1/i,1]),a}function ce(h,e,i,a){if(h){const s=c.H();if(!e){const{vecSouth:u,vecEast:f}=Me(i);s[0]=f[0],s[1]=f[1],s[4]=u[0],s[5]=u[1]}return c.K(s,s,[a,a,1]),s}return i.pixelsToClipSpaceMatrix}function Me(h){const e=Math.cos(h.rollInRadians),i=Math.sin(h.rollInRadians),a=Math.cos(h.pitchInRadians),s=Math.cos(h.bearingInRadians),u=Math.sin(h.bearingInRadians),f=c.ad();f[0]=-s*a*i-u*e,f[1]=-u*a*i+s*e;const g=c.ae(f);g<1e-9?c.af(f):c.ag(f,f,1/g);const y=c.ad();y[0]=s*a*e-u*i,y[1]=u*a*e+s*i;const v=c.ae(y);return v<1e-9?c.af(y):c.ag(y,y,1/v),{vecEast:y,vecSouth:f}}function Se(h,e,i,a){let s;a?(s=[h,e,a(h,e),1],c.al(s,s,i)):(s=[h,e,0,1],xi(s,s,i));const u=s[3];return{point:new c.P(s[0]/u,s[1]/u),signedDistanceFromCamera:u,isOccluded:!1}}function pe(h,e){return .5+h/e*.5}function se(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function Ve(h,e,i,a,s,u,f,g,y,v,A,E,P){const R=i?h.textSizeData:h.iconSizeData,F=c.ah(R,e.transform.zoom),Y=[256/e.width*2+1,256/e.height*2+1],Z=i?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Z.clear();const q=h.lineVertexArray,W=i?h.text.placedSymbolArray:h.icon.placedSymbolArray,ee=e.transform.width/e.transform.height;let ie=!1;for(let re=0;re<W.length;re++){const le=W.get(re);if(le.hidden||le.writingMode===c.ai.vertical&&!ie){Ni(le.numGlyphs,Z);continue}ie=!1;const oe=new c.P(le.anchorX,le.anchorY),ge={getElevation:P,pitchedLabelPlaneMatrix:a,lineVertexArray:q,pitchWithMap:u,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:oe,unwrappedTileID:y,width:v,height:A,translation:E},xe=Pt(le.anchorX,le.anchorY,ge);if(!se(xe.point,Y)){Ni(le.numGlyphs,Z);continue}const Oe=pe(e.transform.cameraToCenterDistance,xe.signedDistanceFromCamera),Ie=c.aj(R,F,le),Le=u?Ie*e.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,y)/Oe:Ie*Oe,Ye=gt({projectionContext:ge,pitchedLabelPlaneMatrixInverse:s,symbol:le,fontSize:Le,flip:!1,keepUpright:f,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:Z,aspectRatio:ee,rotateToLine:g});ie=Ye.useVertical,(Ye.notEnoughRoom||ie||Ye.needsFlipping&&gt({projectionContext:ge,pitchedLabelPlaneMatrixInverse:s,symbol:le,fontSize:Le,flip:!0,keepUpright:f,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:Z,aspectRatio:ee,rotateToLine:g}).notEnoughRoom)&&Ni(le.numGlyphs,Z)}i?h.text.dynamicLayoutVertexBuffer.updateData(Z):h.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Ze(h,e,i,a,s,u,f,g){const y=u.glyphStartIndex+u.numGlyphs,v=u.lineStartIndex,A=u.lineStartIndex+u.lineLength,E=e.getoffsetX(u.glyphStartIndex),P=e.getoffsetX(y-1),R=ui(h*E,i,a,s,u.segment,v,A,g,f);if(!R)return null;const F=ui(h*P,i,a,s,u.segment,v,A,g,f);return F?g.projectionCache.anyProjectionOccluded?null:{first:R,last:F}:null}function st(h,e,i,a){return h===c.ai.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*a?{useVertical:!0}:(h===c.ai.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function gt(h){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:a,fontSize:s,flip:u,keepUpright:f,glyphOffsetArray:g,dynamicLayoutVertexArray:y,aspectRatio:v,rotateToLine:A}=h,E=s/24,P=a.lineOffsetX*E,R=a.lineOffsetY*E;let F;if(a.numGlyphs>1){const Y=a.glyphStartIndex+a.numGlyphs,Z=a.lineStartIndex,q=a.lineStartIndex+a.lineLength,W=Ze(E,g,P,R,u,a,A,e);if(!W)return{notEnoughRoom:!0};const ee=Tt(W.first.point.x,W.first.point.y,e,i),ie=Tt(W.last.point.x,W.last.point.y,e,i);if(f&&!u){const re=st(a.writingMode,ee,ie,v);if(re)return re}F=[W.first];for(let re=a.glyphStartIndex+1;re<Y-1;re++)F.push(ui(E*g.getoffsetX(re),P,R,u,a.segment,Z,q,e,A));F.push(W.last)}else{if(f&&!u){const Z=Xe(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,q=a.lineStartIndex+a.segment+1,W=new c.P(e.lineVertexArray.getx(q),e.lineVertexArray.gety(q)),ee=Xe(W.x,W.y,e),ie=ee.signedDistanceFromCamera>0?ee.point:Ee(e.tileAnchorPoint,W,Z,1,e),re=Tt(Z.x,Z.y,e,i),le=Tt(ie.x,ie.y,e,i),oe=st(a.writingMode,re,le,v);if(oe)return oe}const Y=ui(E*g.getoffsetX(a.glyphStartIndex),P,R,u,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,e,A);if(!Y||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};F=[Y]}for(const Y of F)c.ak(y,Y.point,Y.angle);return{}}function Ee(h,e,i,a,s){const u=h.add(h.sub(e)._unit()),f=Xe(u.x,u.y,s).point,g=i.sub(f);return i.add(g._mult(a/g.mag()))}function $e(h,e,i){const a=e.projectionCache;if(a.projections[h])return a.projections[h];const s=new c.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),u=Xe(s.x,s.y,e);if(u.signedDistanceFromCamera>0)return a.projections[h]=u.point,a.anyProjectionOccluded=a.anyProjectionOccluded||u.isOccluded,u.point;const f=h-i.direction;return Ee(i.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),s,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function Xe(h,e,i){const a=h+i.translation[0],s=e+i.translation[1];let u;return i.pitchWithMap?(u=Se(a,s,i.pitchedLabelPlaneMatrix,i.getElevation),u.isOccluded=!1):(u=i.transform.projectTileCoordinates(a,s,i.unwrappedTileID,i.getElevation),u.point.x=(.5*u.point.x+.5)*i.width,u.point.y=(.5*-u.point.y+.5)*i.height),u}function Tt(h,e,i,a){if(i.pitchWithMap){const s=[h,e,0,1];return c.al(s,s,a),i.transform.projectTileCoordinates(s[0]/s[3],s[1]/s[3],i.unwrappedTileID,i.getElevation).point}return{x:h/i.width*2-1,y:e/i.height*2-1}}function Pt(h,e,i){return i.transform.projectTileCoordinates(h,e,i.unwrappedTileID,i.getElevation)}function ut(h,e,i){return h._unit()._perp()._mult(e*i)}function qe(h,e,i,a,s,u,f,g,y){if(g.projectionCache.offsets[h])return g.projectionCache.offsets[h];const v=i.add(e);if(h+y.direction<a||h+y.direction>=s)return g.projectionCache.offsets[h]=v,v;const A=$e(h+y.direction,g,y),E=ut(A.sub(i),f,y.direction),P=i.add(E),R=A.add(E);return g.projectionCache.offsets[h]=c.am(u,v,P,R)||v,g.projectionCache.offsets[h]}function ui(h,e,i,a,s,u,f,g,y){const v=a?h-e:h+e;let A=v>0?1:-1,E=0;a&&(A*=-1,E=Math.PI),A<0&&(E+=Math.PI);let P,R=A>0?u+s:u+s+1;g.projectionCache.cachedAnchorPoint?P=g.projectionCache.cachedAnchorPoint:(P=Xe(g.tileAnchorPoint.x,g.tileAnchorPoint.y,g).point,g.projectionCache.cachedAnchorPoint=P);let F,Y,Z=P,q=P,W=0,ee=0;const ie=Math.abs(v),re=[];let le;for(;W+ee<=ie;){if(R+=A,R<u||R>=f)return null;W+=ee,q=Z,Y=F;const xe={absOffsetX:ie,direction:A,distanceFromAnchor:W,previousVertex:q};if(Z=$e(R,g,xe),i===0)re.push(q),le=Z.sub(q);else{let Oe;const Ie=Z.sub(q);Oe=Ie.mag()===0?ut($e(R+A,g,xe).sub(Z),i,A):ut(Ie,i,A),Y||(Y=q.add(Oe)),F=qe(R,Oe,Z,u,f,Y,i,g,xe),re.push(Y),le=F.sub(Y)}ee=le.mag()}const oe=le._mult((ie-W)/ee)._add(Y||q),ge=E+Math.atan2(Z.y-q.y,Z.x-q.x);return re.push(oe),{point:oe,angle:y?ge:0,path:re}}const gn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ni(h,e){for(let i=0;i<h;i++){const a=e.length;e.resize(a+4),e.float32.set(gn,3*a)}}function xi(h,e,i){const a=e[0],s=e[1];return h[0]=i[0]*a+i[4]*s+i[12],h[1]=i[1]*a+i[5]*s+i[13],h[3]=i[3]*a+i[7]*s+i[15],h}const ti=100;class _r{constructor(e,i=new ue(e.width+200,e.height+200,25),a=new ue(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=a,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ti,this.screenBottomBoundary=e.height+ti,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,a,s,u,f,g,y,v,A,E,P){const R=this.projectAndGetPerspectiveRatio(e.anchorPointX+y[0],e.anchorPointY+y[1],u,A,P),F=a*R.perspectiveRatio;let Y;if(f||g)Y=this._projectCollisionBox(e,F,s,u,f,g,y,R,A,E,P);else{const le=R.x+(E?E.x*F:0),oe=R.y+(E?E.y*F:0);Y={allPointsOccluded:!1,box:[le+e.x1*F,oe+e.y1*F,le+e.x2*F,oe+e.y2*F]}}const[Z,q,W,ee]=Y.box,ie=f?Y.allPointsOccluded:R.isOccluded;let re=ie;return re||(re=R.perspectiveRatio<this.perspectiveRatioCutoff),re||(re=!this.isInsideGrid(Z,q,W,ee)),re||i!=="always"&&this.grid.hitTest(Z,q,W,ee,i,v)?{box:[Z,q,W,ee],placeable:!1,offscreen:!1,occluded:ie}:{box:[Z,q,W,ee],placeable:!0,offscreen:this.isOffscreen(Z,q,W,ee),occluded:ie}}placeCollisionCircles(e,i,a,s,u,f,g,y,v,A,E,P,R,F){const Y=[],Z=new c.P(i.anchorX,i.anchorY),q=this.getPerspectiveRatio(Z.x,Z.y,f,F),W=(v?u*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,f)/q:u*q)/c.as,ee={getElevation:F,pitchedLabelPlaneMatrix:g,lineVertexArray:a,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Z,unwrappedTileID:f,width:this.transform.width,height:this.transform.height,translation:R},ie=Ze(W,s,i.lineOffsetX*W,i.lineOffsetY*W,!1,i,!1,ee);let re=!1,le=!1,oe=!0;if(ie){const ge=.5*E*q+P,xe=new c.P(-100,-100),Oe=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Ie=new X,Le=ie.first,Ye=ie.last;let Ue=[];for(let yt=Le.path.length-1;yt>=1;yt--)Ue.push(Le.path[yt]);for(let yt=1;yt<Ye.path.length;yt++)Ue.push(Ye.path[yt]);const Ne=2.5*ge;if(v){const yt=this.projectPathToScreenSpace(Ue,ee);Ue=yt.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:yt.map(Bt=>Bt.point)}let Qe=[];if(Ue.length>0){const yt=Ue[0].clone(),Bt=Ue[0].clone();for(let yi=1;yi<Ue.length;yi++)yt.x=Math.min(yt.x,Ue[yi].x),yt.y=Math.min(yt.y,Ue[yi].y),Bt.x=Math.max(Bt.x,Ue[yi].x),Bt.y=Math.max(Bt.y,Ue[yi].y);Qe=yt.x>=xe.x&&Bt.x<=Oe.x&&yt.y>=xe.y&&Bt.y<=Oe.y?[Ue]:Bt.x<xe.x||yt.x>Oe.x||Bt.y<xe.y||yt.y>Oe.y?[]:c.ao([Ue],xe.x,xe.y,Oe.x,Oe.y)}for(const yt of Qe){Ie.reset(yt,.25*ge);let Bt=0;Bt=Ie.length<=.5*ge?1:Math.ceil(Ie.paddedLength/Ne)+1;for(let yi=0;yi<Bt;yi++){const ii=yi/Math.max(Bt-1,1),oi=Ie.lerp(ii),fi=oi.x+ti,Qt=oi.y+ti;Y.push(fi,Qt,ge,0);const ai=fi-ge,Yi=Qt-ge,Di=fi+ge,er=Qt+ge;if(oe=oe&&this.isOffscreen(ai,Yi,Di,er),le=le||this.isInsideGrid(ai,Yi,Di,er),e!=="always"&&this.grid.hitTestCircle(fi,Qt,ge,e,A)&&(re=!0,!y))return{circles:[],offscreen:!1,collisionDetected:re}}}}return{circles:!y&&re||!le||q<this.perspectiveRatioCutoff?[]:Y,offscreen:oe,collisionDetected:re}}projectPathToScreenSpace(e,i){const a=function(s,u){const f=c.H();return c.an(f,u.pitchedLabelPlaneMatrix),s.map(g=>{const y=Se(g.x,g.y,f,u.getElevation),v=u.transform.projectTileCoordinates(y.point.x,y.point.y,u.unwrappedTileID,u.getElevation);return v.point.x=(.5*v.point.x+.5)*u.width,v.point.y=(.5*-v.point.y+.5)*u.height,v})}(e,i);return function(s){let u=0,f=0,g=0,y=0;for(let v=0;v<s.length;v++)s[v].isOccluded?(g=v+1,y=0):(y++,y>f&&(f=y,u=g));return s.slice(u,u+f)}(a)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let a=1/0,s=1/0,u=-1/0,f=-1/0;for(const A of e){const E=new c.P(A.x+ti,A.y+ti);a=Math.min(a,E.x),s=Math.min(s,E.y),u=Math.max(u,E.x),f=Math.max(f,E.y),i.push(E)}const g=this.grid.query(a,s,u,f).concat(this.ignoredGrid.query(a,s,u,f)),y={},v={};for(const A of g){const E=A.key;if(y[E.bucketInstanceId]===void 0&&(y[E.bucketInstanceId]={}),y[E.bucketInstanceId][E.featureIndex])continue;const P=[new c.P(A.x1,A.y1),new c.P(A.x2,A.y1),new c.P(A.x2,A.y2),new c.P(A.x1,A.y2)];c.ap(i,P)&&(y[E.bucketInstanceId][E.featureIndex]=!0,v[E.bucketInstanceId]===void 0&&(v[E.bucketInstanceId]=[]),v[E.bucketInstanceId].push(E.featureIndex))}return v}insertCollisionBox(e,i,a,s,u,f){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:u,collisionGroupID:f,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,a,s,u,f){const g=a?this.ignoredGrid:this.grid,y={bucketInstanceId:s,featureIndex:u,collisionGroupID:f,overlapMode:i};for(let v=0;v<e.length;v+=4)g.insertCircle(y,e[v],e[v+1],e[v+2])}projectAndGetPerspectiveRatio(e,i,a,s,u){if(u){let f;s?(f=[e,i,s(e,i),1],c.al(f,f,u)):(f=[e,i,0,1],xi(f,f,u));const g=f[3];return{x:(f[0]/g+1)/2*this.transform.width+ti,y:(-f[1]/g+1)/2*this.transform.height+ti,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g*.5,isOccluded:!1,signedDistanceFromCamera:g}}{const f=this.transform.projectTileCoordinates(e,i,a,s);return{x:(f.point.x+1)/2*this.transform.width+ti,y:(1-f.point.y)/2*this.transform.height+ti,perspectiveRatio:.5+this.transform.cameraToCenterDistance/f.signedDistanceFromCamera*.5,isOccluded:f.isOccluded,signedDistanceFromCamera:f.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,a,s){const u=this.transform.projectTileCoordinates(e,i,a,s);return .5+this.transform.cameraToCenterDistance/u.signedDistanceFromCamera*.5}isOffscreen(e,i,a,s){return a<ti||e>=this.screenRightBoundary||s<ti||i>this.screenBottomBoundary}isInsideGrid(e,i,a,s){return a>=0&&e<this.gridRightBoundary&&s>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=c.aq([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,a,s,u,f,g,y,v,A,E){let P=1,R=0,F=0,Y=1;const Z=e.anchorPointX+g[0],q=e.anchorPointY+g[1];if(f&&!u){const Ue=this.projectAndGetPerspectiveRatio(Z+1,q,s,v,E),Ne=Ue.x-y.x,Qe=Math.atan((Ue.y-y.y)/Ne)+(Ne<0?Math.PI:0),yt=Math.sin(Qe),Bt=Math.cos(Qe);P=Bt,R=yt,F=-yt,Y=Bt}else if(!f&&u){const Ue=Me(this.transform);P=Ue.vecEast[0],R=Ue.vecEast[1],F=Ue.vecSouth[0],Y=Ue.vecSouth[1]}let W=y.x,ee=y.y,ie=i;u&&(W=Z,ee=q,ie=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),ie*=this.transform.getPitchedTextCorrection(Z,q,s),A||(ie*=c.ab(.5+y.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),A&&(W+=P*A.x*ie+F*A.y*ie,ee+=R*A.x*ie+Y*A.y*ie);const re=e.x1*ie,le=e.x2*ie,oe=(re+le)/2,ge=e.y1*ie,xe=e.y2*ie,Oe=(ge+xe)/2,Ie=[{offsetX:re,offsetY:ge},{offsetX:oe,offsetY:ge},{offsetX:le,offsetY:ge},{offsetX:le,offsetY:Oe},{offsetX:le,offsetY:xe},{offsetX:oe,offsetY:xe},{offsetX:re,offsetY:xe},{offsetX:re,offsetY:Oe}];let Le=[];for(const{offsetX:Ue,offsetY:Ne}of Ie)Le.push(new c.P(W+P*Ue+F*Ne,ee+R*Ue+Y*Ne));let Ye=!1;if(u){const Ue=Le.map(Ne=>this.projectAndGetPerspectiveRatio(Ne.x,Ne.y,s,v,E));Ye=Ue.some(Ne=>!Ne.isOccluded),Le=Ue.map(Ne=>new c.P(Ne.x,Ne.y))}else Ye=!0;return{box:c.ar(Le),allPointsOccluded:!Ye}}}class hi{constructor(e,i,a,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):s&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class On{constructor(e,i,a,s,u){this.text=new hi(e?e.text:null,i,a,u),this.icon=new hi(e?e.icon:null,i,s,u)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jn{constructor(e,i,a){this.text=e,this.icon=i,this.skipFade=a}}class ia{constructor(e,i,a,s,u){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=a,this.bucketIndex=s,this.tileID=u}}class Hn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:a=>a.collisionGroupID===i}}return this.collisionGroups[e]}}function Vn(h,e,i,a,s){const{horizontalAlign:u,verticalAlign:f}=c.ay(h);return new c.P(-(u-.5)*e+a[0]*s,-(f-.5)*i+a[1]*s)}class Ya{constructor(e,i,a,s,u){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new _r(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Hn(s),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=u,u&&(u.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(a,s)=>i.getElevation(e,a,s):null}getBucketParts(e,i,a,s){const u=a.getBucket(i),f=a.latestFeatureIndex;if(!u||!f||i.id!==u.layerIds[0])return;const g=a.collisionBoxArray,y=u.layers[0].layout,v=u.layers[0].paint,A=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),E=a.tileSize/c.X,P=a.tileID.toUnwrapped(),R=y.get("text-rotation-alignment")==="map",F=c.at(a,1,this.transform.zoom),Y=c.au(this.collisionIndex.transform,a,v.get("text-translate"),v.get("text-translate-anchor")),Z=c.au(this.collisionIndex.transform,a,v.get("icon-translate"),v.get("icon-translate-anchor")),q=ye(R,this.transform,F);this.retainedQueryData[u.bucketInstanceId]=new ia(u.bucketInstanceId,f,u.sourceLayerIndex,u.index,a.tileID);const W={bucket:u,layout:y,translationText:Y,translationIcon:Z,unwrappedTileID:P,pitchedLabelPlaneMatrix:q,scale:A,textPixelRatio:E,holdingForFade:a.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:c.ah(u.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(s)for(const ee of u.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:re,symbolInstanceEnd:le}=ee;e.push({sortKey:ie,symbolInstanceStart:re,symbolInstanceEnd:le,parameters:W})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:W})}attemptAnchorPlacement(e,i,a,s,u,f,g,y,v,A,E,P,R,F,Y,Z,q,W,ee,ie){const re=c.av[e.textAnchor],le=[e.textOffset0,e.textOffset1],oe=Vn(re,a,s,le,u),ge=this.collisionIndex.placeCollisionBox(i,P,y,v,A,g,f,Z,E.predicate,ee,oe,ie);if((!W||this.collisionIndex.placeCollisionBox(W,P,y,v,A,g,f,q,E.predicate,ee,oe,ie).placeable)&&ge.placeable){let xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(xe=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:le,width:a,height:s,anchor:re,textBoxScale:u,prevAnchor:xe},this.markUsedJustification(F,re,R,Y),F.allowVerticalPlacement&&(this.markUsedOrientation(F,Y,R),this.placedOrientations[R.crossTileID]=Y),{shift:oe,placedGlyphBoxes:ge}}}placeLayerBucketPart(e,i,a){const{bucket:s,layout:u,translationText:f,translationIcon:g,unwrappedTileID:y,pitchedLabelPlaneMatrix:v,textPixelRatio:A,holdingForFade:E,collisionBoxArray:P,partiallyEvaluatedTextSize:R,collisionGroup:F}=e.parameters,Y=u.get("text-optional"),Z=u.get("icon-optional"),q=c.aw(u,"text-overlap","text-allow-overlap"),W=q==="always",ee=c.aw(u,"icon-overlap","icon-allow-overlap"),ie=ee==="always",re=u.get("text-rotation-alignment")==="map",le=u.get("text-pitch-alignment")==="map",oe=u.get("icon-text-fit")!=="none",ge=u.get("symbol-z-order")==="viewport-y",xe=W&&(ie||!s.hasIconData()||Z),Oe=ie&&(W||!s.hasTextData()||Y);!s.collisionArrays&&P&&s.deserializeCollisionBoxes(P);const Ie=this.retainedQueryData[s.bucketInstanceId].tileID,Le=this._getTerrainElevationFunc(Ie),Ye=this.transform.getFastPathSimpleProjectionMatrix(Ie),Ue=(Ne,Qe,yt)=>{var Bt,yi;if(i[Ne.crossTileID])return;if(E)return void(this.placements[Ne.crossTileID]=new jn(!1,!1,!1));let ii=!1,oi=!1,fi=!0,Qt=null,ai={box:null,placeable:!1,offscreen:null,occluded:!1},Yi={box:null,placeable:!1,offscreen:null},Di=null,er=null,yr=null,Bn=0,en=0,Fn=0;Qe.textFeatureIndex?Bn=Qe.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(Bn=Ne.featureIndex),Qe.verticalTextFeatureIndex&&(en=Qe.verticalTextFeatureIndex);const So=Qe.textBox;if(So){const xr=mi=>{let qi=c.ai.horizontal;if(s.allowVerticalPlacement&&!mi&&this.prevPlacement){const tr=this.prevPlacement.placedOrientations[Ne.crossTileID];tr&&(this.placedOrientations[Ne.crossTileID]=tr,qi=tr,this.markUsedOrientation(s,qi,Ne))}return qi},tn=(mi,qi)=>{if(s.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Qe.verticalTextBox){for(const tr of s.writingModes)if(tr===c.ai.vertical?(ai=qi(),Yi=ai):ai=mi(),ai&&ai.placeable)break}else ai=mi()},Mr=Ne.textAnchorOffsetStartIndex,Ir=Ne.textAnchorOffsetEndIndex;if(Ir===Mr){const mi=(qi,tr)=>{const ir=this.collisionIndex.placeCollisionBox(qi,q,A,Ie,y,le,re,f,F.predicate,Le,void 0,Ye);return ir&&ir.placeable&&(this.markUsedOrientation(s,tr,Ne),this.placedOrientations[Ne.crossTileID]=tr),ir};tn(()=>mi(So,c.ai.horizontal),()=>{const qi=Qe.verticalTextBox;return s.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&qi?mi(qi,c.ai.vertical):{box:null,offscreen:null}}),xr(ai&&ai.placeable)}else{let mi=c.av[(yi=(Bt=this.prevPlacement)===null||Bt===void 0?void 0:Bt.variableOffsets[Ne.crossTileID])===null||yi===void 0?void 0:yi.anchor];const qi=(ir,al,q4)=>{const sl=ir.x2-ir.x1,Co=ir.y2-ir.y1,Ao=Ne.textBoxScale,ll=oe&&ee==="never"?al:null;let Eo=null,Ps=q==="never"?1:2,$4="never";mi&&Ps++;for(let cl=0;cl<Ps;cl++){for(let Ms=Mr;Ms<Ir;Ms++){const hl=s.textAnchorOffsets.get(Ms);if(mi&&hl.textAnchor!==mi)continue;const Ra=this.attemptAnchorPlacement(hl,ir,sl,Co,Ao,re,le,A,Ie,y,F,$4,Ne,s,q4,f,g,ll,Le);if(Ra&&(Eo=Ra.placedGlyphBoxes,Eo&&Eo.placeable))return ii=!0,Qt=Ra.shift,Eo}mi?mi=null:$4=q}return a&&!Eo&&(Eo={box:this.collisionIndex.placeCollisionBox(So,"always",A,Ie,y,le,re,f,F.predicate,Le,void 0,Ye).box,offscreen:!1,placeable:!1,occluded:!1}),Eo};tn(()=>qi(So,Qe.iconBox,c.ai.horizontal),()=>{const ir=Qe.verticalTextBox;return s.allowVerticalPlacement&&(!ai||!ai.placeable)&&Ne.numVerticalGlyphVertices>0&&ir?qi(ir,Qe.verticalIconBox,c.ai.vertical):{box:null,occluded:!0,offscreen:null}}),ai&&(ii=ai.placeable,fi=ai.offscreen);const tr=xr(ai&&ai.placeable);if(!ii&&this.prevPlacement){const ir=this.prevPlacement.variableOffsets[Ne.crossTileID];ir&&(this.variableOffsets[Ne.crossTileID]=ir,this.markUsedJustification(s,ir.anchor,Ne,tr))}}}if(Di=ai,ii=Di&&Di.placeable,fi=Di&&Di.offscreen,Ne.useRuntimeCollisionCircles){const xr=s.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),tn=c.aj(s.textSizeData,R,xr),Mr=u.get("text-padding");er=this.collisionIndex.placeCollisionCircles(q,xr,s.lineVertexArray,s.glyphOffsetArray,tn,y,v,a,le,F.predicate,Ne.collisionCircleDiameter,Mr,f,Le),er.circles.length&&er.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),ii=W||er.circles.length>0&&!er.collisionDetected,fi=fi&&er.offscreen}if(Qe.iconFeatureIndex&&(Fn=Qe.iconFeatureIndex),Qe.iconBox){const xr=tn=>this.collisionIndex.placeCollisionBox(tn,ee,A,Ie,y,le,re,g,F.predicate,Le,oe&&Qt?Qt:void 0,Ye);Yi&&Yi.placeable&&Qe.verticalIconBox?(yr=xr(Qe.verticalIconBox),oi=yr.placeable):(yr=xr(Qe.iconBox),oi=yr.placeable),fi=fi&&yr.offscreen}const ka=Y||Ne.numHorizontalGlyphVertices===0&&Ne.numVerticalGlyphVertices===0,Ls=Z||Ne.numIconVertices===0;ka||Ls?Ls?ka||(oi=oi&&ii):ii=oi&&ii:oi=ii=oi&&ii;const io=oi&&yr.placeable;if(ii&&Di.placeable&&this.collisionIndex.insertCollisionBox(Di.box,q,u.get("text-ignore-placement"),s.bucketInstanceId,Yi&&Yi.placeable&&en?en:Bn,F.ID),io&&this.collisionIndex.insertCollisionBox(yr.box,ee,u.get("icon-ignore-placement"),s.bucketInstanceId,Fn,F.ID),er&&ii&&this.collisionIndex.insertCollisionCircles(er.circles,q,u.get("text-ignore-placement"),s.bucketInstanceId,Bn,F.ID),a&&this.storeCollisionData(s.bucketInstanceId,yt,Qe,Di,yr,er),Ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(s.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ne.crossTileID]=new jn((ii||xe)&&!(Di!=null&&Di.occluded),(oi||Oe)&&!(yr!=null&&yr.occluded),fi||s.justReloaded),i[Ne.crossTileID]=!0};if(ge){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ne=s.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Qe=Ne.length-1;Qe>=0;--Qe){const yt=Ne[Qe];Ue(s.symbolInstances.get(yt),s.collisionArrays[yt],yt)}}else for(let Ne=e.symbolInstanceStart;Ne<e.symbolInstanceEnd;Ne++)Ue(s.symbolInstances.get(Ne),s.collisionArrays[Ne],Ne);s.justReloaded=!1}storeCollisionData(e,i,a,s,u,f){if(a.textBox||a.iconBox){let g,y;this.collisionBoxArrays.has(e)?g=this.collisionBoxArrays.get(e):(g=new Map,this.collisionBoxArrays.set(e,g)),g.has(i)?y=g.get(i):(y={text:null,icon:null},g.set(i,y)),a.textBox&&(y.text=s.box),a.iconBox&&(y.icon=u.box)}if(f){let g=this.collisionCircleArrays[e];g===void 0&&(g=this.collisionCircleArrays[e]=[]);for(let y=0;y<f.circles.length;y+=4)g.push(f.circles[y+0]-ti),g.push(f.circles[y+1]-ti),g.push(f.circles[y+2]),g.push(f.collisionDetected?1:0)}}markUsedJustification(e,i,a,s){let u;u=s===c.ai.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.ax(i)];const f=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const g of f)g>=0&&(e.text.placedSymbolArray.get(g).crossTileID=u>=0&&g!==u?0:a.crossTileID)}markUsedOrientation(e,i,a){const s=i===c.ai.horizontal||i===c.ai.horizontalOnly?i:0,u=i===c.ai.vertical?i:0,f=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const g of f)e.text.placedSymbolArray.get(g).placedOrientation=s;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=u)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let a=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const s=i?i.symbolFadeChange(e):1,u=i?i.opacities:{},f=i?i.variableOffsets:{},g=i?i.placedOrientations:{};for(const y in this.placements){const v=this.placements[y],A=u[y];A?(this.opacities[y]=new On(A,s,v.text,v.icon),a=a||v.text!==A.text.placed||v.icon!==A.icon.placed):(this.opacities[y]=new On(null,s,v.text,v.icon,v.skipFade),a=a||v.text||v.icon)}for(const y in u){const v=u[y];if(!this.opacities[y]){const A=new On(v,s,!1,!1);A.isHidden()||(this.opacities[y]=A,a=a||v.text.placed||v.icon.placed)}}for(const y in f)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=f[y]);for(const y in g)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=g[y]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const a={};for(const s of i){const u=s.getBucket(e);u&&s.latestFeatureIndex&&e.id===u.layerIds[0]&&this.updateBucketOpacities(u,s.tileID,a,s.collisionBoxArray)}}updateBucketOpacities(e,i,a,s){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const u=e.layers[0],f=u.layout,g=new On(null,0,!1,!1,!0),y=f.get("text-allow-overlap"),v=f.get("icon-allow-overlap"),A=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),E=f.get("text-rotation-alignment")==="map",P=f.get("text-pitch-alignment")==="map",R=f.get("icon-text-fit")!=="none",F=new On(null,0,y&&(v||!e.hasIconData()||f.get("icon-optional")),v&&(y||!e.hasTextData()||f.get("text-optional")),!0);!e.collisionArrays&&s&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(s);const Y=(q,W,ee)=>{for(let ie=0;ie<W/4;ie++)q.opacityVertexArray.emplaceBack(ee);q.hasVisibleVertices=q.hasVisibleVertices||ee!==Nn},Z=this.collisionBoxArrays.get(e.bucketInstanceId);for(let q=0;q<e.symbolInstances.length;q++){const W=e.symbolInstances.get(q),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:ie,crossTileID:re}=W;let le=this.opacities[re];a[re]?le=g:le||(le=F,this.opacities[re]=le),a[re]=!0;const oe=W.numIconVertices>0,ge=this.placedOrientations[W.crossTileID],xe=ge===c.ai.vertical,Oe=ge===c.ai.horizontal||ge===c.ai.horizontalOnly;if(ee>0||ie>0){const Le=Ji(le.text);Y(e.text,ee,xe?Nn:Le),Y(e.text,ie,Oe?Nn:Le);const Ye=le.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Qe=>{Qe>=0&&(e.text.placedSymbolArray.get(Qe).hidden=Ye||xe?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ye||Oe?1:0);const Ue=this.variableOffsets[W.crossTileID];Ue&&this.markUsedJustification(e,Ue.anchor,W,ge);const Ne=this.placedOrientations[W.crossTileID];Ne&&(this.markUsedJustification(e,"left",W,Ne),this.markUsedOrientation(e,Ne,W))}if(oe){const Le=Ji(le.icon),Ye=!(R&&W.verticalPlacedIconSymbolIndex&&xe);W.placedIconSymbolIndex>=0&&(Y(e.icon,W.numIconVertices,Ye?Le:Nn),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=le.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Y(e.icon,W.numVerticalIconVertices,Ye?Nn:Le),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const Ie=Z&&Z.has(q)?Z.get(q):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Le=e.collisionArrays[q];if(Le){let Ye=new c.P(0,0);if(Le.textBox||Le.verticalTextBox){let Ue=!0;if(A){const Ne=this.variableOffsets[re];Ne?(Ye=Vn(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),E&&Ye._rotate(P?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ue=!1}if(Le.textBox||Le.verticalTextBox){let Ne;Le.textBox&&(Ne=xe),Le.verticalTextBox&&(Ne=Oe),Io(e.textCollisionBox.collisionVertexArray,le.text.placed,!Ue||Ne,Ie.text,Ye.x,Ye.y)}}if(Le.iconBox||Le.verticalIconBox){const Ue=!!(!Oe&&Le.verticalIconBox);let Ne;Le.iconBox&&(Ne=Ue),Le.verticalIconBox&&(Ne=!Ue),Io(e.iconCollisionBox.collisionVertexArray,le.icon.placed,Ne,Ie.icon,R?Ye.x:0,R?Ye.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const a=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function Io(h,e,i,a,s,u){a&&a.length!==0||(a=[0,0,0,0]);const f=a[0]-ti,g=a[1]-ti,y=a[2]-ti,v=a[3]-ti;h.emplaceBack(e?1:0,i?1:0,s||0,u||0,f,g),h.emplaceBack(e?1:0,i?1:0,s||0,u||0,y,g),h.emplaceBack(e?1:0,i?1:0,s||0,u||0,y,v),h.emplaceBack(e?1:0,i?1:0,s||0,u||0,f,v)}const qa=Math.pow(2,25),ln=Math.pow(2,24),$a=Math.pow(2,17),qs=Math.pow(2,16),$s=Math.pow(2,9),ra=Math.pow(2,8),Wa=Math.pow(2,1);function Ji(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const e=h.placed?1:0,i=Math.floor(127*h.opacity);return i*qa+e*ln+i*$a+e*qs+i*$s+e*ra+i*Wa+e}const Nn=0;class co{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,a,s,u){const f=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(f,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((g,y)=>g.sortKey-y.sortKey));this._currentPartIndex<f.length;)if(i.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,u())return!0;return!1}}class Xa{constructor(e,i,a,s,u,f,g,y){this.placement=new Ya(e,i,f,g,y),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(e,i,a){const s=fe.now(),u=()=>!this._forceFullPlacement&&fe.now()-s>2;for(;this._currentPlacementIndex>=0;){const f=i[e[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=g)&&(!f.maxzoom||f.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new co(f)),this._inProgressLayer.continuePlacement(a[f.source],this.placement,this._showCollisionBoxes,f,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const _n=512/c.X/2;class na{constructor(e,i,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const s=new Map;for(let u=0;u<i.length;u++){const f=i.get(u),g=f.key,y=s.get(g);y?y.push(f):s.set(g,[f])}for(const[u,f]of s){const g={positions:f.map(y=>({x:Math.floor(y.anchorX*_n),y:Math.floor(y.anchorY*_n)})),crossTileIDs:f.map(y=>y.crossTileID)};if(g.positions.length>128){const y=new c.az(g.positions.length,16,Uint16Array);for(const{x:v,y:A}of g.positions)y.add(v,A);y.finish(),delete g.positions,g.index=y}this._symbolsByKey[u]=g}}getScaledCoordinates(e,i){const{x:a,y:s,z:u}=this.tileID.canonical,{x:f,y:g,z:y}=i.canonical,v=_n/Math.pow(2,y-u),A=(g*c.X+e.anchorY)*v,E=s*c.X*_n;return{x:Math.floor((f*c.X+e.anchorX)*v-a*c.X*_n),y:Math.floor(A-E)}}findMatches(e,i,a){const s=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let u=0;u<e.length;u++){const f=e.get(u);if(f.crossTileID)continue;const g=this._symbolsByKey[f.key];if(!g)continue;const y=this.getScaledCoordinates(f,i);if(g.index){const v=g.index.range(y.x-s,y.y-s,y.x+s,y.y+s).sort();for(const A of v){const E=g.crossTileIDs[A];if(!a[E]){a[E]=!0,f.crossTileID=E;break}}}else if(g.positions)for(let v=0;v<g.positions.length;v++){const A=g.positions[v],E=g.crossTileIDs[v];if(Math.abs(A.x-y.x)<=s&&Math.abs(A.y-y.y)<=s&&!a[E]){a[E]=!0,f.crossTileID=E;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class eo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const a in this.indexes){const s=this.indexes[a],u={};for(const f in s){const g=s[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+i),u[g.tileID.key]=g}this.indexes[a]=u}this.lng=e}addBucket(e,i,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let u=0;u<i.symbolInstances.length;u++)i.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const s=this.usedCrossTileIDs[e.overscaledZ];for(const u in this.indexes){const f=this.indexes[u];if(Number(u)>e.overscaledZ)for(const g in f){const y=f[g];y.tileID.isChildOf(e)&&y.findMatches(i.symbolInstances,e,s)}else{const g=f[e.scaledTo(Number(u)).key];g&&g.findMatches(i.symbolInstances,e,s)}}for(let u=0;u<i.symbolInstances.length;u++){const f=i.symbolInstances.get(u);f.crossTileID||(f.crossTileID=a.generate(),s[f.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new na(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const a of i.getCrossTileIDsLists())for(const s of a)delete this.usedCrossTileIDs[e][s]}removeStaleBuckets(e){let i=!1;for(const a in this.indexes){const s=this.indexes[a];for(const u in s)e[s[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,s[u]),delete s[u],i=!0)}return i}}class Ar{constructor(){this.layerIndexes={},this.crossTileIDs=new eo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,a){let s=this.layerIndexes[e.id];s===void 0&&(s=this.layerIndexes[e.id]=new oa);let u=!1;const f={};s.handleWrapJump(a);for(const g of i){const y=g.getBucket(e);y&&e.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(g.tileID,y,this.crossTileIDs)&&(u=!0),f[y.bucketInstanceId]=!0)}return s.removeStaleBuckets(f)&&(u=!0),u}pruneUnusedLayers(e){const i={};e.forEach(a=>{i[a]=!0});for(const a in this.layerIndexes)i[a]||delete this.layerIndexes[a]}}var Oo="void main() {fragColor=vec4(1.0);}";const zr={prelude:wt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wt(Oo,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wt(Oo,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wt(h,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/in ([\w]+) ([\w]+)/g),s=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),u=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=u?u.concat(s):s,g={};return{fragmentSource:h=h.replace(i,(y,v,A,E,P)=>(g[P]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${P}
in ${A} ${E} ${P};
#else
uniform ${A} ${E} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${A} ${E} ${P} = u_${P};
#endif
`)),vertexSource:e=e.replace(i,(y,v,A,E,P)=>{const R=E==="float"?"vec2":"vec4",F=P.match(/color/)?"color":R;return g[P]?v==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${A} ${R} a_${P};
out ${A} ${E} ${P};
#else
uniform ${A} ${E} u_${P};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${A} ${E} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${F}(a_${P}, u_${P}_t);
#else
    ${A} ${E} ${P} = u_${P};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${A} ${R} a_${P};
#else
uniform ${A} ${E} u_${P};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${A} ${E} ${P} = a_${P};
#else
    ${A} ${E} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${A} ${E} ${P} = unpack_mix_${F}(a_${P}, u_${P}_t);
#else
    ${A} ${E} ${P} = u_${P};
#endif
`}),staticAttributes:a,staticUniforms:f}}class Xr{constructor(e,i,a){this.vertexBuffer=e,this.indexBuffer=i,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var St=c.aA([{name:"a_pos",type:"Int16",components:2}]);const ho="#define PROJECTION_MERCATOR",No="mercator";class ve{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return No}get shaderDefine(){return ho}get shaderPreludeCode(){return zr.projectionMercator}get vertexShaderPreludeCode(){return zr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,a,s,u){if(this._cachedMesh)return this._cachedMesh;const f=new c.aC;f.emplaceBack(0,0),f.emplaceBack(c.X,0),f.emplaceBack(0,c.X),f.emplaceBack(c.X,c.X);const g=e.createVertexBuffer(f,St.members),y=c.aD.simpleSegment(0,0,4,2),v=new c.aE;v.emplaceBack(1,0,2),v.emplaceBack(1,2,3);const A=e.createIndexBuffer(v);return this._cachedMesh=new Xr(g,A,y),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function Re(h,e){const i=c.ab(e.lat,-85.051129,c.aF);return new c.P(c.O(e.lng)*h,c.Q(i)*h)}function et(h,e){return new c.Y(e.x/h,e.y/h).toLngLat()}function Xt(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(c.aa(90-h.pitch)),Math.tan(c.aa(89.25-h.pitch)))}function Mt(h,e){const i=h.canonical,a=e/c.aG(i.z),s=i.x+Math.pow(2,i.z)*h.wrap,u=c.aq(new Float64Array(16));return c.J(u,u,[s*a,i.y*a,0]),c.K(u,u,[a/c.X,a/c.X,1]),u}function vt(h,e,i,a,s){const u=c.Y.fromLngLat(h,e),f=s*c.aH(1,h.lat),g=f*Math.cos(c.aa(i)),y=Math.sqrt(f*f-g*g),v=y*Math.sin(c.aa(-a)),A=y*Math.cos(c.aa(-a));return new c.Y(u.x+v,u.y+A,u.z+g)}class jt{constructor(e=0,i=0,a=0,s=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(a)||a<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=a,this.right=s}interpolate(e,i,a){return i.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,i.top,a)),i.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,i.bottom,a)),i.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,i.left,a)),i.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,i.right,a)),this}getCenter(e,i){const a=c.ab((this.left+e-this.right)/2,0,e),s=c.ab((this.top+i-this.bottom)/2,0,i);return new c.P(a,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new jt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Hi(h,e){if(!h.renderWorldCopies||h.lngRange)return;const i=e.lng-h.center.lng;e.lng+=i>180?-360:i<-180?360:0}function Er(h){return Math.max(0,Math.floor(h))}class kt{constructor(e,i,a,s,u,f){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=s??0,this._maxPitch=u??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Er(this._zoom),this._scale=c.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new jt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,a){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Er(this._zoom),this._scale=c.aG(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new jt(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!a&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=c.aI(e,-180,180)*Math.PI/180;var a,s,u,f,g,y,v,A,E;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=me(),a=this._rotationMatrix,u=-this._bearingInRadians,f=(s=this._rotationMatrix)[0],g=s[1],y=s[2],v=s[3],A=Math.sin(u),E=Math.cos(u),a[0]=f*E+y*A,a[1]=g*E+v*A,a[2]=f*-A+y*E,a[3]=g*-A+v*E)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=c.ab(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aJ(this._fovInRadians)}setFov(e){e=c.ab(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.aa(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=c.aG(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,a){this._unmodified=!1,this._edgeInsets.interpolate(e,i,a),this._constrain(),this._calcMatrices()}resize(e,i,a=!0){this._width=e,this._height=i,a&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new _i([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,c.aF])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{let a=e.x,s=e.y,u=e.x,f=e.y;for(const g of i)a=Math.min(a,g.x),s=Math.min(s,g.y),u=Math.max(u,g.x),f=Math.max(f,g.y);return[new c.P(a,s),new c.P(u,s),new c.P(u,f),new c.P(a,f),new c.P(a,s)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:a}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(a),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.aq(new Float64Array(16));c.K(e,e,[this._width/2,-this._height/2,1]),c.J(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.aq(new Float64Array(16)),c.K(e,e,[1,-1,1]),c.J(e,e,[-1,-1,0]),c.K(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,a,s){const u=a!==void 0?a:this.bearing,f=s=s!==void 0?s:this.pitch,g=c.Y.fromLngLat(e,i),y=-Math.cos(c.aa(f)),v=Math.sin(c.aa(f)),A=v*Math.sin(c.aa(u)),E=-v*Math.cos(c.aa(u));let P=this.elevation;const R=i-P;let F;y*R>=0||Math.abs(y)<.1?(F=1e4,P=i+F*y):F=-R/y;let Y,Z,q=c.aK(1,g.y),W=0;do{if(W+=1,W>10)break;Z=F/q,Y=new c.Y(g.x+A*Z,g.y+E*Z),q=1/Y.meterInMercatorCoordinateUnits()}while(Math.abs(F-Z*q)>1e-12);return{center:Y.toLngLat(),elevation:P,zoom:c.a8(this.height/2/Math.tan(this.fovInRadians/2)/Z/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=c.aH(1,this.center.lat)*this.worldSize,a=this.cameraToCenterDistance/i,s=c.Y.fromLngLat(this.center,this.elevation),u=vt(this.center,this.elevation,this.pitch,this.bearing,a);this._elevation=e;const f=this.calculateCenterFromCameraLngLatAlt(u.toLngLat(),c.aK(u.z,s.y),this.bearing,this.pitch);this._elevation=f.elevation,this._center=f.center,this.setZoom(f.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.aH(1,this.center.lat)*this.worldSize;return vt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/c.X,1/i/c.X]}}class Vi{constructor(e,i){this.min=e,this.max=i,this.center=c.aL([],c.aM([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=c.aN(this.min),s=c.aN(this.max);for(let u=0;u<i.length;u++)a[u]=i[u]?this.min[u]:this.center[u],s[u]=i[u]?this.center[u]:this.max[u];return s[2]=this.max[2],new Vi(a,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let a=0;a<e.planes.length;a++){const s=this.intersectsPlane(e.planes[a]);if(s===0)return 0;s===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],a=e[3];for(let s=0;s<3;s++)e[s]>0?(i+=e[s]*this.min[s],a+=e[s]*this.max[s]):(a+=e[s]*this.min[s],i+=e[s]*this.max[s]);return i>=0?2:a<0?0:1}}class Kr{distanceToTile2d(e,i,a,s){const u=s.distanceX([e,i]),f=s.distanceY([e,i]);return Math.hypot(u,f)}getWrap(e,i,a){return a}getTileAABB(e,i,a,s){var u,f;let g=a,y=a;if(s.terrain){const A=new c.S(e.z,i,e.z,e.x,e.y),E=s.terrain.getMinMaxElevation(A);g=(u=E.minElevation)!==null&&u!==void 0?u:a,y=(f=E.maxElevation)!==null&&f!==void 0?f:a}const v=1<<e.z;return new Vi([i+e.x/v,e.y/v,g],[i+(e.x+1)/v,(e.y+1)/v,y])}allowVariableZoom(e,i){const a=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,s=c.ab(78.5-a/2,0,60);return!!i.terrain||e.pitch>s||e.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class ki{constructor(e,i,a){this.points=e,this.planes=i,this.aabb=a}static fromInvProjectionMatrix(e,i=1,a=0){const s=Math.pow(2,a),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const A=1/(v=c.al([],v,e))[3]/i*s;return c.aO(v,v,[A,A,1/v[3],A])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const A=c.aP([],u[v[0]],u[v[1]]),E=c.aP([],u[v[2]],u[v[1]]),P=c.aQ([],c.aR([],A,E)),R=-c.aS(P,u[v[1]]);return P.concat(R)}),g=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],y=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const v of u)for(let A=0;A<3;A++)g[A]=Math.min(g[A],v[A]),y[A]=Math.max(y[A],v[A]);return new ki(u,f,new Vi(g,y))}}class qt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,a,s,u){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new kt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(f,g)=>this.getConstrained(f,g)},e,i,a,s,u),this._coveringTilesDetailsProvider=new Kr}clone(){const e=new qt;return e.apply(this),e}apply(e,i,a){this._helper.apply(e,i,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new c.aT(0,e)];if(this._helper._renderWorldCopies){const a=this.screenPointToMercatorCoordinate(new c.P(0,0)),s=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),u=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),f=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),g=Math.floor(Math.min(a.x,s.x,u.x,f.x)),y=Math.floor(Math.max(a.x,s.x,u.x,f.x)),v=1;for(let A=g-v;A<=y+v;A++)A!==0&&i.push(new c.aT(A,e))}return i}getCameraFrustum(){return ki.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),a=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(e,i){const a=c.aH(this.elevation,this.center.lat),s=this.screenPointToMercatorCoordinateAtZ(i,a),u=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),f=c.Y.fromLngLat(e),g=new c.Y(f.x-(s.x-u.x),f.y-(s.y-u.y));this.setCenter(g==null?void 0:g.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(c.Y.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.Y.fromLngLat(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const a=i||0,s=[e.x,e.y,0,1],u=[e.x,e.y,1,1];c.al(s,s,this._pixelMatrixInverse),c.al(u,u,this._pixelMatrixInverse);const f=s[3],g=u[3],y=s[1]/f,v=u[1]/g,A=s[2]/f,E=u[2]/g,P=A===E?0:(a-A)/(E-A);return new c.Y(c.y.number(s[0]/f,u[0]/g,P)/this.worldSize,c.y.number(y,v,P)/this.worldSize,a)}coordinatePoint(e,i=0,a=this._pixelMatrix){const s=[e.x*this.worldSize,e.y*this.worldSize,i,1];return c.al(s,s,a),new c.P(s[0]/s[3],s[1]/s[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Xt(this));return new _i().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-Xt(this)}calculatePosMatrix(e,i=!1,a){var s;const u=(s=e.key)!==null&&s!==void 0?s:c.aU(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),f=i?this._alignedPosMatrixCache:this._posMatrixCache;if(f.has(u)){const v=f.get(u);return a?v.f32:v.f64}const g=Mt(e,this.worldSize);c.L(g,i?this._alignedProjMatrix:this._viewProjMatrix,g);const y={f64:g,f32:new Float32Array(g)};return f.set(u,y),a?y.f32:y.f64}calculateFogMatrix(e){const i=e.key,a=this._fogMatrixCacheF32;if(a.has(i))return a.get(i);const s=Mt(e,this.worldSize);return c.L(s,this._fogMatrix,s),a.set(i,new Float32Array(s)),a.get(i)}getConstrained(e,i){i=c.ab(+i,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:i};let s=this._helper._lngRange;this._helper._renderWorldCopies||s!==null||(s=[-179.9999999999,180-1e-10]);const u=this.tileSize*c.aG(a.zoom);let f=0,g=u,y=0,v=u,A=0,E=0;const{x:P,y:R}=this.size;if(this._helper._latRange){const ee=this._helper._latRange;f=c.Q(ee[1])*u,g=c.Q(ee[0])*u,g-f<R&&(A=R/(g-f))}s&&(y=c.aI(c.O(s[0])*u,0,u),v=c.aI(c.O(s[1])*u,0,u),v<y&&(v+=u),v-y<P&&(E=P/(v-y)));const{x:F,y:Y}=Re(u,e);let Z,q;const W=Math.max(E||0,A||0);if(W){const ee=new c.P(E?(v+y)/2:F,A?(g+f)/2:Y);return a.center=et(u,ee).wrap(),a.zoom+=c.a8(W),a}if(this._helper._latRange){const ee=R/2;Y-ee<f&&(q=f+ee),Y+ee>g&&(q=g-ee)}if(s){const ee=(y+v)/2;let ie=F;this._helper._renderWorldCopies&&(ie=c.aI(F,ee-u/2,ee+u/2));const re=P/2;ie-re<y&&(Z=y+re),ie+re>v&&(Z=v-re)}if(Z!==void 0||q!==void 0){const ee=new c.P(Z??F,q??Y);a.center=et(u,ee).wrap()}return a}calculateCenterFromCameraLngLatAlt(e,i,a,s){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,s)}_calculateNearFarZIfNeeded(e,i,a){if(!this._helper.autoCalculateNearFarZ)return;const s=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),u=e-s*this._helper._pixelPerMeter/Math.cos(i),f=s<0?u:e,g=Math.PI/2+this.pitchInRadians,y=c.aa(this.fov)*(Math.abs(Math.cos(c.aa(this.roll)))*this.height+Math.abs(Math.sin(c.aa(this.roll)))*this.width)/this.height*(.5+a.y/this.height),v=Math.sin(y)*f/Math.sin(c.ab(Math.PI-g-y,.01,Math.PI-.01)),A=Xt(this),E=Math.atan(A/this._helper.cameraToCenterDistance),P=c.aa(.75),R=E>P?2*E*(.5+a.y/(2*A)):P,F=Math.sin(R)*f/Math.sin(c.ab(Math.PI-g-R,.01,Math.PI-.01)),Y=Math.min(v,F);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*Y+f),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=Re(this.worldSize,this.center),a=i.x,s=i.y;this._helper._pixelPerMeter=c.aH(1,this.center.lat)*this.worldSize;const u=c.aa(Math.min(this.pitch,89.25)),f=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(u));let g;this._calculateNearFarZIfNeeded(f,u,e),g=new Float64Array(16),c.aV(g,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.an(this._invProjMatrix,g),g[8]=2*-e.x/this._helper._width,g[9]=2*e.y/this._helper._height,this._projectionMatrix=c.aW(g),c.K(g,g,[1,-1,1]),c.J(g,g,[0,0,-this._helper.cameraToCenterDistance]),c.aX(g,g,-this.rollInRadians),c.aY(g,g,this.pitchInRadians),c.aX(g,g,-this.bearingInRadians),c.J(g,g,[-a,-s,0]),this._mercatorMatrix=c.K([],g,[this.worldSize,this.worldSize,this.worldSize]),c.K(g,g,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,g),c.J(g,g,[0,0,-this.elevation]),this._viewProjMatrix=g,this._invViewProjMatrix=c.an([],g);const y=[0,0,-1,1];c.al(y,y,this._invViewProjMatrix),this._cameraPosition=[y[0]/y[3],y[1]/y[3],y[2]/y[3]],this._fogMatrix=new Float64Array(16),c.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,f,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.J(this._fogMatrix,this._fogMatrix,[-a,-s,0]),c.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,g);const v=this._helper._width%2/2,A=this._helper._height%2/2,E=Math.cos(this.bearingInRadians),P=Math.sin(-this.bearingInRadians),R=a-Math.round(a)+E*v+P*A,F=s-Math.round(s)+E*A+P*v,Y=new Float64Array(g);if(c.J(Y,Y,[R>.5?R-1:R,F>.5?F-1:F,0]),this._alignedProjMatrix=Y,g=c.an(new Float64Array(16),this._pixelMatrix),!g)throw new Error("failed to invert matrix");this._pixelMatrixInverse=g,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.al(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.aH(1,this.center.lat)*this.worldSize;return vt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const a=c.Y.fromLngLat(e),s=[a.x*this.worldSize,a.y*this.worldSize,i,1];return c.al(s,s,this._viewProjMatrix),s[2]/s[3]}getProjectionData(e){const{overscaledTileID:i,aligned:a,applyTerrainMatrix:s}=e,u=this._helper.getMercatorTileCoordinates(i),f=i?this.calculatePosMatrix(i,a,!0):null;let g;return g=i&&i.terrainRttPosMatrix32f&&s?i.terrainRttPosMatrix32f:f||c.aZ(),{mainMatrix:g,tileMercatorCoords:u,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,a){return 1}transformLightDirection(e){return c.aN(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,a,s){const u=this.calculatePosMatrix(a);let f;s?(f=[e,i,s(e,i),1],c.al(f,f,u)):(f=[e,i,0,1],xi(f,f,u));const g=f[3];return{point:new c.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const a=c.Y.fromLngLat(e,i),s=a.meterInMercatorCoordinateUnits(),u=c.a_();return c.J(u,u,[a.x,a.y,a.z]),c.aX(u,u,Math.PI),c.aY(u,u,Math.PI/2),c.K(u,u,[-s,s,s]),u}getProjectionDataForCustomLayer(e=!0){const i=new c.S(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),s=Mt(i,this.worldSize);c.L(s,this._viewProjMatrix,s),a.tileMercatorCoords=[0,0,1,1];const u=[c.X,c.X,this.worldSize/this._helper.pixelsPerMeter],f=c.a$();return c.K(f,s,u),a.fallbackMatrix=f,a.mainMatrix=f,a}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Ri(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function vi(h){if(h.useSlerp)if(h.k<1){const e=c.b0(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),i=c.b0(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),a=new Float64Array(4);c.b1(a,e,i,h.k);const s=c.b2(a);h.tr.setRoll(s.roll),h.tr.setPitch(s.pitch),h.tr.setBearing(s.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(c.y.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(c.y.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(c.y.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function ko(h,e,i,a,s){const u=s.padding,f=Re(s.worldSize,i.getNorthWest()),g=Re(s.worldSize,i.getNorthEast()),y=Re(s.worldSize,i.getSouthEast()),v=Re(s.worldSize,i.getSouthWest()),A=c.aa(-a),E=f.rotate(A),P=g.rotate(A),R=y.rotate(A),F=v.rotate(A),Y=new c.P(Math.max(E.x,P.x,F.x,R.x),Math.max(E.y,P.y,F.y,R.y)),Z=new c.P(Math.min(E.x,P.x,F.x,R.x),Math.min(E.y,P.y,F.y,R.y)),q=Y.sub(Z),W=(s.width-(u.left+u.right+e.left+e.right))/q.x,ee=(s.height-(u.top+u.bottom+e.top+e.bottom))/q.y;if(ee<0||W<0)return void Ri();const ie=Math.min(c.a8(s.scale*Math.min(W,ee)),h.maxZoom),re=c.P.convert(h.offset),le=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.aa(a)),oe=re.add(le).mult(s.scale/c.aG(ie));return{center:et(s.worldSize,f.add(y).div(2).sub(oe)),zoom:ie,bearing:a}}class uo{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,a){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(a,e.around)}cameraForBoxAndBearing(e,i,a,s,u){return ko(e,i,a,s,u)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(c.N.convert(i.center))}handleEaseTo(e,i){const a=e.zoom,s=e.padding,u={roll:e.roll,pitch:e.pitch,bearing:e.bearing},f={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},g=i.zoom!==void 0,y=!e.isPaddingEqual(i.padding);let v=!1;const A=g?+i.zoom:e.zoom;let E=e.centerPoint.add(i.offsetAsPoint);const P=e.screenPointToLocation(E),{center:R,zoom:F}=e.getConstrained(c.N.convert(i.center||P),A??a);Hi(e,R);const Y=Re(e.worldSize,P),Z=Re(e.worldSize,R).sub(Y),q=c.aG(F-a);return v=F!==a,{easeFunc:W=>{if(v&&e.setZoom(c.y.number(a,F,W)),c.b3(u,f)||vi({startEulerAngles:u,endEulerAngles:f,tr:e,k:W,useSlerp:u.roll!=f.roll}),y&&(e.interpolatePadding(s,i.padding,W),E=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const ee=c.aG(e.zoom-a),ie=F>a?Math.min(2,q):Math.max(.5,q),re=Math.pow(ie,1-W),le=et(e.worldSize,Y.add(Z.mult(W*re)).mult(ee));e.setLocationAtPoint(e.renderWorldCopies?le.wrap():le,E)}},isZooming:v,elevationCenter:R}}handleFlyTo(e,i){const a=i.zoom!==void 0,s=e.zoom,u=e.getConstrained(c.N.convert(i.center||i.locationAtOffset),a?+i.zoom:s),f=u.center,g=u.zoom;Hi(e,f);const y=Re(e.worldSize,i.locationAtOffset),v=Re(e.worldSize,f).sub(y),A=v.mag(),E=c.aG(g-s);let P;if(i.minZoom!==void 0){const R=Math.min(+i.minZoom,s,g),F=e.getConstrained(f,R).zoom;P=c.aG(F-s)}return{easeFunc:(R,F,Y,Z)=>{e.setZoom(R===1?g:s+c.a8(F));const q=R===1?f:et(e.worldSize,y.add(v.mult(Y)).mult(F));e.setLocationAtPoint(e.renderWorldCopies?q.wrap():q,Z)},scaleOfZoom:E,targetCenter:f,scaleOfMinZoom:P,pixelPathLength:A}}}class Jt{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}Jt.Replace=[1,0],Jt.disabled=new Jt(Jt.Replace,c.b4.transparent,[!1,!1,!1,!1]),Jt.unblended=new Jt(Jt.Replace,c.b4.transparent,[!0,!0,!0,!0]),Jt.alphaBlended=new Jt([1,771],c.b4.transparent,[!0,!0,!0,!0]);const sr=2305;class Ct{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Ct.disabled=new Ct(!1,1029,sr),Ct.backCCW=new Ct(!0,1029,sr),Ct.frontCCW=new Ct(!0,1028,sr);class _t{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}_t.ReadOnly=!1,_t.ReadWrite=!0,_t.disabled=new _t(519,_t.ReadOnly,[0,1]);const aa=7680;class Nt{constructor(e,i,a,s,u,f){this.test=e,this.ref=i,this.mask=a,this.fail=s,this.depthFail=u,this.pass=f}}Nt.disabled=new Nt({func:519,mask:0},0,0,aa,aa,aa);const sa=new WeakMap;function yn(h){var e;if(sa.has(h))return sa.get(h);{const i=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return sa.set(h,i),i}}class Ro{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,a=i.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;const s=new c.aC;s.emplaceBack(-1,-1),s.emplaceBack(2,-1),s.emplaceBack(-1,2);const u=new c.aE;u.emplaceBack(0,1,2),this._fullscreenTriangle=new Xr(i.createVertexBuffer(s,St.members),i.createIndexBuffer(u),c.aD.simpleSegment(0,0,s.length,u.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(a.TEXTURE1);const f=a.createTexture();a.bindTexture(a.TEXTURE_2D,f),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(f),yn(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const a=this._cachedRenderContext.context,s=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:c.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,s.TRIANGLES,_t.disabled,Nt.disabled,Jt.unblended,Ct.disabled,((u,f)=>({u_input:u,u_output_expected:f}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&yn(s)){s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.readBuffer(s.COLOR_ATTACHMENT0),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null);const u=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);s.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:u}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&yn(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ro._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const la=c.X/128;function Do(h,e){const i=h.granularity!==void 0?Math.max(h.granularity,1):1,a=i+(h.generateBorders?2:0),s=i+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),u=a+1,f=s+1,g=h.generateBorders?-1:0,y=h.generateBorders||h.extendToNorthPole?-1:0,v=i+(h.generateBorders?1:0),A=i+(h.generateBorders||h.extendToSouthPole?1:0),E=u*f,P=a*s*6,R=u*f>65536;if(R&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const F=R||e==="32bit",Y=new Int16Array(2*E);let Z=0;for(let ee=y;ee<=A;ee++)for(let ie=g;ie<=v;ie++){let re=ie/i*c.X;ie===-1&&(re=-64),ie===i+1&&(re=c.X+la);let le=ee/i*c.X;ee===-1&&(le=h.extendToNorthPole?c.b6:-64),ee===i+1&&(le=h.extendToSouthPole?c.b7:c.X+la),Y[Z++]=re,Y[Z++]=le}const q=F?new Uint32Array(P):new Uint16Array(P);let W=0;for(let ee=0;ee<s;ee++)for(let ie=0;ie<a;ie++){const re=ie+1+ee*u,le=ie+(ee+1)*u,oe=ie+1+(ee+1)*u;q[W++]=ie+ee*u,q[W++]=le,q[W++]=re,q[W++]=re,q[W++]=le,q[W++]=oe}return{vertices:Y.buffer.slice(0),indices:q.buffer.slice(0),uses32bitIndices:F}}const Ws=new c.aB({fill:new c.b8(128,2),line:new c.b8(512,0),tile:new c.b8(128,32),stencil:new c.b8(128,1),circle:3});class Ka{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zr.projectionGlobe}get vertexShaderPreludeCode(){return zr.projectionMercator.vertexSource}get subdivisionGranularity(){return Ws}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Ro(e));const i=c.Q(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,s=this._errorMeasurement.updateErrorLoop(i,a),u=fe.now();s!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=s,this._errorMeasurementLastChangeTime=u);const f=Math.min(Math.max((u-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.ba(f))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,a,s,u){const f=(u==="stencil"?Ws.stencil:Ws.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:f,generateBorders:a,extendToNorthPole:i.y===0&&s,extendToSouthPole:i.y===(1<<i.z)-1&&s})}_getMesh(e,i){const a=this._getMeshKey(i);if(a in this._tileMeshCache)return this._tileMeshCache[a];const s=function(u,f){const g=Do(f,"16bit"),y=c.aC.deserialize({arrayBuffer:g.vertices,length:g.vertices.byteLength/2/2}),v=c.aE.deserialize({arrayBuffer:g.indices,length:g.indices.byteLength/2/3});return new Xr(u.createVertexBuffer(y,St.members),u.createIndexBuffer(v),c.aD.simpleSegment(0,0,y.length,v.length))}(e,i);return this._tileMeshCache[a]=s,s}recalculate(e){}hasTransition(){const e=fe.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const T3=new c.q({type:new c.D(c.v.projection.type)});class S3 extends c.E{constructor(e){super(),this._transitionable=new c.T(T3),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0)),this._mercatorProjection=new ve,this._verticalPerspectiveProjection=new Ka}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.bb){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,a,s,u){return this.currentProjection.getMeshFromTileID(e,i,a,s,u)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function C3(h){const e=Jr(h.worldSize,h.center.lat);return 2*Math.PI*e}function lr(h,e,i,a,s){const u=1/(1<<s),f=e/c.X*u+a*u,g=c.bd((h/c.X*u+i*u)*Math.PI*2+Math.PI,2*Math.PI),y=2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI,v=Math.cos(y),A=new Float64Array(3);return A[0]=Math.sin(g)*v,A[1]=Math.sin(y),A[2]=Math.cos(g)*v,A}function Qi(h){return function(e,i){const a=Math.cos(i),s=new Float64Array(3);return s[0]=Math.sin(e)*a,s[1]=Math.sin(i),s[2]=Math.cos(e)*a,s}(h.lng*Math.PI/180,h.lat*Math.PI/180)}function Jr(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function ca(h){const e=Math.asin(h[1])/Math.PI*180,i=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(i>1e-6){const a=h[0]/i,s=Math.acos(h[2]/i),u=(a>0?s:-s)/Math.PI*180;return new c.N(c.aI(u,-180,180),e)}return new c.N(0,e)}function ha(h){return Math.cos(h*Math.PI/180)}function Zi(h,e){const i=ha(h),a=ha(e);return c.a8(a/i)}function po(h,e){const i=h.rotate(e.bearingInRadians),a=e.zoom+Zi(e.center.lat,0),s=c.b9(1/ha(e.center.lat),1/ha(Math.min(Math.abs(e.center.lat),60)),c.bc(a,7,3,0,1)),u=360/C3({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.N(e.center.lng-i.x*u*s,c.ab(e.center.lat+i.y*u,-85.051129,c.aF))}function Xs(h){const e=.5*h,i=Math.sin(e),a=Math.cos(e);return Math.log(i+a)-Math.log(a-i)}function A3(h,e,i,a){const s=h.lat+i*a;if(Math.abs(i)>1){const u=(Math.sign(h.lat+i)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,f=Math.abs(h.lat+i)*Math.PI/180,g=Xs(u+a*(f-u)),y=Xs(u),v=Xs(f);return new c.N(h.lng+e*((g-y)/(v-y)),s)}return new c.N(h.lng+e*a,s)}class Yl{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,i,a,s){const u=`${e.z}_${e.x}_${e.y}`,f=this._cache.get(u);if(f)return f;const g=this._cachePrevious.get(u);if(g)return this._cache.set(u,g),g;const y=this._aabbFactory(e,i,a,s);return this._cache.set(u,y),this._hadAnyChanges=!0,y}}function Ja(h,e,i){const a=h-e;return a<0?-a:Math.max(0,a-i)}function Ks(h,e,i,a,s){const u=h-i;let f;return f=u<0?Math.min(-u,1+u-s):u>1?Math.min(Math.max(u-s,0),1-u):0,Math.max(f,Ja(e,a,s))}class ql{constructor(){this._aabbCache=new Yl(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,i,a,s){const u=1<<a.z,f=1/u,g=a.x/u,y=a.y/u;let v=2;return v=Math.min(v,Ks(e,i,g,y,f)),v=Math.min(v,Ks(e,i,g+.5,-y-f,f)),v=Math.min(v,Ks(e,i,g+.5,2-y-f,f)),v}getWrap(e,i,a){const s=1<<i.z,u=1/s,f=i.x/s,g=Ja(e.x,f,u),y=Ja(e.x,f-1,u),v=Ja(e.x,f+1,u),A=Math.min(g,y,v);return A===v?1:A===y?-1:0}allowVariableZoom(e,i){return Dr(e,i)>4}allowWorldCopies(){return!1}getTileAABB(e,i,a,s){return this._aabbCache.getTileAABB(e,i,a,s)}_computeTileAABB(e,i,a,s){if(e.z<=0)return new Vi([-1,-1,-1],[1,1,1]);if(e.z===1)return new Vi([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const u=[lr(0,0,e.x,e.y,e.z),lr(c.X,0,e.x,e.y,e.z),lr(c.X,c.X,e.x,e.y,e.z),lr(0,c.X,e.x,e.y,e.z)],f=[1,1,1],g=[-1,-1,-1];for(const y of u)for(let v=0;v<3;v++)f[v]=Math.min(f[v],y[v]),g[v]=Math.max(g[v],y[v]);if(e.y===0||e.y===(1<<e.z)-1){const y=[0,e.y===0?1:-1,0];for(let v=0;v<3;v++)f[v]=Math.min(f[v],y[v]),g[v]=Math.max(g[v],y[v])}return new Vi(f,g)}}}class fo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=c.be(),this._projectionMatrix=c.a_(),this._globeViewProjMatrix32f=c.aZ(),this._globeViewProjMatrixNoCorrection=c.a_(),this._globeViewProjMatrixNoCorrectionInverted=c.a_(),this._globeProjMatrixInverted=c.a_(),this._cameraPosition=c.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new kt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new ql}clone(){const e=new fo;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bf();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:a}=e,s=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:s,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,a=this.cameraToCenterDistance/e,s=Math.sin(i)*a,u=Math.cos(i)*a+1,f=1/Math.sqrt(s*s+u*u)*1;let g=-s,y=u;const v=Math.sqrt(g*g+y*y);g/=v,y/=v;const A=[0,g,y];return c.bg(A,A,[0,0,0],-this.bearingInRadians),c.bh(A,A,[0,0,0],-1*this.center.lat*Math.PI/180),c.bi(A,A,[0,0,0],this.center.lng*Math.PI/180),c.aL(A,A,.25),[...A,.25*-f]}isLocationOccluded(e){return!this.isSurfacePointVisible(Qi(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,s=Math.cos(a),u=[Math.sin(i)*s,Math.sin(a),Math.cos(i)*s],f=[u[2],0,-u[0]],g=[0,0,0];c.aR(g,f,u),c.aQ(f,f),c.aQ(g,g);const y=[0,0,0];return c.aQ(y,[f[0]*e[0]+g[0]*e[1]+u[0]*e[2],f[1]*e[0]+g[1]*e[1]+u[1]*e[2],f[2]*e[0]+g[2]*e[1]+u[2]*e[2]]),y}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,a){const s=function(g,y,v){const A=1/(1<<v.z);return new c.Y(g/c.X*A+v.x*A,y/c.X*A+v.y*A)}(e,i,a.canonical),u=(f=s.y,[c.bd(s.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI]);var f;return this.getCircleRadiusCorrection()/Math.cos(u[1])}projectTileCoordinates(e,i,a,s){const u=a.canonical,f=lr(e,i,u.x,u.y,u.z),g=1+(s?s(e,i):0)/c.bo,y=[f[0]*g,f[1]*g,f[2]*g,1];c.al(y,y,this._globeViewProjMatrixNoCorrection);const v=this._cachedClippingPlane,A=v[0]*f[0]+v[1]*f[1]+v[2]*f[2]+v[3]<0;return{point:new c.P(y[0]/y[3],y[1]/y[3]),signedDistanceFromCamera:y[3],isOccluded:A}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Jr(this.worldSize,this.center.lat),i=c.a$(),a=c.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.aV(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const s=this.centerOffset;i[8]=2*-s.x/this._helper._width,i[9]=2*s.y/this._helper._height,this._projectionMatrix=c.aW(i),this._globeProjMatrixInverted=c.a$(),c.an(this._globeProjMatrixInverted,i),c.J(i,i,[0,0,-this.cameraToCenterDistance]),c.aX(i,i,this.rollInRadians),c.aY(i,i,-this.pitchInRadians),c.aX(i,i,this.bearingInRadians),c.J(i,i,[0,0,-e]);const u=c.bf();u[0]=e,u[1]=e,u[2]=e,c.aY(a,i,this.center.lat*Math.PI/180),c.bj(a,a,-this.center.lng*Math.PI/180),c.K(a,a,u),this._globeViewProjMatrixNoCorrection=a,c.aY(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bj(i,i,-this.center.lng*Math.PI/180),c.K(i,i,u),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=c.a$(),c.an(this._globeViewProjMatrixNoCorrectionInverted,a);const f=c.bf();this._cameraPosition=c.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bg(this._cameraPosition,this._cameraPosition,f,-this.rollInRadians),c.bh(this._cameraPosition,this._cameraPosition,f,this.pitchInRadians),c.bg(this._cameraPosition,this._cameraPosition,f,-this.bearingInRadians),c.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bh(this._cameraPosition,this._cameraPosition,f,-this.center.lat*Math.PI/180),c.bi(this._cameraPosition,this._cameraPosition,f,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const g=c.aW(this._globeViewProjMatrixNoCorrectionInverted);c.K(g,g,[1,1,-1]),this._cachedFrustum=ki.fromInvProjectionMatrix(g)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const i=c.a$();return c.aq(i),i}getVisibleUnwrappedCoordinates(e){return[new c.aT(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const a=Qi(e);c.aL(a,a,1+i/c.bo);const s=c.be();return c.al(s,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),s[2]/s[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,a=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,i),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,i)],s=[];for(const E of a)s.push(this.unprojectScreenPoint(E));let u=0,f=0,g=0,y=0;const v=this.center;for(const E of s){const P=c.bk(v.lng,E.lng),R=c.bk(v.lat,E.lat);P<f&&(f=P),P>u&&(u=P),R<y&&(y=R),R>g&&(g=R)}const A=[v.lng+f,v.lat+y,v.lng+u,v.lat+g];return this.isSurfacePointOnScreen([0,1,0])&&(A[3]=90,A[0]=-180,A[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(A[1]=-90,A[0]=-180,A[2]=180),new _i(A)}getConstrained(e,i){const a=c.ab(e.lat,-85.051129,c.aF),s=c.ab(+i,this.minZoom+Zi(0,a),this.maxZoom);return{center:new c.N(e.lng,a),zoom:s}}calculateCenterFromCameraLngLatAlt(e,i,a,s){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,s)}setLocationAtPoint(e,i){const a=Qi(this.unprojectScreenPoint(i)),s=Qi(e),u=c.bf();c.bl(u);const f=c.bf();c.bi(f,a,u,-this.center.lng*Math.PI/180),c.bh(f,f,u,this.center.lat*Math.PI/180);const g=s[0]*s[0]+s[2]*s[2],y=f[0]*f[0];if(g<y)return;const v=Math.sqrt(g-y),A=-v,E=c.bm(s[0],s[2],f[0],v),P=c.bm(s[0],s[2],f[0],A),R=c.bf();c.bi(R,s,u,-E);const F=c.bm(R[1],R[2],f[1],f[2]),Y=c.bf();c.bi(Y,s,u,-P);const Z=c.bm(Y[1],Y[2],f[1],f[2]),q=.5*Math.PI,W=F>=-q&&F<=q,ee=Z>=-q&&Z<=q;let ie,re;if(W&&ee){const xe=this.center.lng*Math.PI/180,Oe=this.center.lat*Math.PI/180;c.bp(E,xe)+c.bp(F,Oe)<c.bp(P,xe)+c.bp(Z,Oe)?(ie=E,re=F):(ie=P,re=Z)}else if(W)ie=E,re=F;else{if(!ee)return;ie=P,re=Z}const le=ie/Math.PI*180,oe=re/Math.PI*180,ge=this.center.lat;this.setCenter(new c.N(le,c.ab(oe,-90,90))),this.setZoom(this.zoom+Zi(ge,this.center.lat))}locationToScreenPoint(e,i){const a=Qi(e);if(i){const s=i.getElevationForLngLatZoom(e,this._helper._tileZoom);c.aL(a,a,1+s/c.bo)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(e){const i=c.be();return c.al(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new c.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a)return a}return c.Y.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(e,i){const a=this._cameraPosition,s=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(a,s)}getRayDirectionFromPixel(e){const i=c.be();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,c.al(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const a=c.bf();a[0]=i[0]-this._cameraPosition[0],a[1]=i[1]-this._cameraPosition[1],a[2]=i[2]-this._cameraPosition[2];const s=c.bf();return c.aQ(s,a),s}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=c.be();return c.al(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const a=c.aS(e,i),s=c.bf(),u=c.bf();c.aL(u,i,a),c.aP(s,e,u);const f=1-c.aS(s,s);if(f<0)return null;const g=c.aS(e,e)-1,y=-a+(a<0?1:-1)*Math.sqrt(f),v=g/y,A=y;return{tMin:Math.min(v,A),tMax:Math.max(v,A)}}unprojectScreenPoint(e){const i=this._cameraPosition,a=this.getRayDirectionFromPixel(e),s=this.rayPlanetIntersection(i,a);if(s){const v=c.bf();c.aM(v,i,[a[0]*s.tMin,a[1]*s.tMin,a[2]*s.tMin]);const A=c.bf();return c.aQ(A,v),ca(A)}const u=this._cachedClippingPlane[0]*a[0]+this._cachedClippingPlane[1]*a[1]+this._cachedClippingPlane[2]*a[2],f=-c.bn(this._cachedClippingPlane,i)/u,g=c.bf();if(f>0)c.aM(g,i,[a[0]*f,a[1]*f,a[2]*f]);else{const v=c.bf();c.aM(v,i,[2*a[0],2*a[1],2*a[2]]);const A=c.bn(this._cachedClippingPlane,v);c.aP(g,v,[this._cachedClippingPlane[0]*A,this._cachedClippingPlane[1]*A,this._cachedClippingPlane[2]*A])}const y=c.bf();return c.aQ(y,g),ca(y)}getMatrixForModel(e,i){const a=c.N.convert(e),s=1/c.bo,u=c.a_();return c.bj(u,u,a.lng/180*Math.PI),c.aY(u,u,-a.lat/180*Math.PI),c.J(u,u,[0,0,1+i/c.bo]),c.aY(u,u,.5*Math.PI),c.K(u,u,[s,s,s]),u}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new c.S(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class zo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new kt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new qt,this._verticalPerspectiveTransform=new fo}clone(){const e=new zo;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),a=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:i.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,a){const s=this._mercatorTransform.getPitchedTextCorrection(e,i,a),u=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,a);return c.b9(s,u,this._globeness)}projectTileCoordinates(e,i,a,s){return this.currentTransform.projectTileCoordinates(e,i,a,s)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,a,s){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,s)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return a.fallbackMatrix=i.mainMatrix,a}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Br{get useGlobeControls(){return!0}handlePanInertia(e,i){const a=po(e,i);return Math.abs(a.lng-i.center.lng)>180&&(a.lng=i.center.lng+179.5*Math.sign(a.lng-i.center.lng)),{easingCenter:a,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const a=e.around,s=i.screenPointToLocation(a);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const u=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const f=i.zoom-u;if(f===0)return;const g=c.bk(i.center.lng,s.lng),y=g/(Math.abs(g/180)+1),v=c.bk(i.center.lat,s.lat),A=i.getRayDirectionFromPixel(a),E=i.cameraPosition,P=-1*c.aS(E,A),R=c.bf();c.aM(R,E,[A[0]*P,A[1]*P,A[2]*P]);const F=c.bq(R)-1,Y=Math.exp(.5*-Math.max(F-.3,0)),Z=Jr(i.worldSize,i.center.lat)/Math.min(i.width,i.height),q=c.bc(Z,.9,.5,1,.25),W=(1-c.aG(-f))*Math.min(Y,q),ee=i.center.lat,ie=i.zoom,re=new c.N(i.center.lng+y*W,c.ab(i.center.lat+v*W,-85.051129,c.aF));i.setLocationAtPoint(s,a);const le=i.center,oe=c.bc(Math.abs(g),45,85,0,1),ge=c.bc(Z,.75,.35,0,1),xe=Math.pow(Math.max(oe,ge),.25),Oe=c.bk(le.lng,re.lng),Ie=c.bk(le.lat,re.lat);i.setCenter(new c.N(le.lng+Oe*xe,le.lat+Ie*xe).wrap()),i.setZoom(ie+Zi(ee,i.center.lat))}handleMapControlsPan(e,i,a){if(!e.panDelta)return;const s=i.center.lat,u=i.zoom;i.setCenter(po(e.panDelta,i).wrap()),i.setZoom(u+Zi(s,i.center.lat))}cameraForBoxAndBearing(e,i,a,s,u){const f=ko(e,i,a,s,u),g=i.left/u.width*2-1,y=(u.width-i.right)/u.width*2-1,v=i.top/u.height*-2+1,A=(u.height-i.bottom)/u.height*-2+1,E=c.bk(a.getWest(),a.getEast())<0,P=E?a.getEast():a.getWest(),R=E?a.getWest():a.getEast(),F=Math.max(a.getNorth(),a.getSouth()),Y=Math.min(a.getNorth(),a.getSouth()),Z=P+.5*c.bk(P,R),q=F+.5*c.bk(F,Y),W=u.clone();W.setCenter(f.center),W.setBearing(f.bearing),W.setPitch(0),W.setRoll(0),W.setZoom(f.zoom);const ee=W.modelViewProjectionMatrix,ie=[Qi(a.getNorthWest()),Qi(a.getNorthEast()),Qi(a.getSouthWest()),Qi(a.getSouthEast()),Qi(new c.N(R,q)),Qi(new c.N(P,q)),Qi(new c.N(Z,F)),Qi(new c.N(Z,Y))],re=Qi(f.center);let le=Number.POSITIVE_INFINITY;for(const oe of ie)g<0&&(le=Br.getLesserNonNegativeNonNull(le,Br.solveVectorScale(oe,re,ee,"x",g))),y>0&&(le=Br.getLesserNonNegativeNonNull(le,Br.solveVectorScale(oe,re,ee,"x",y))),v>0&&(le=Br.getLesserNonNegativeNonNull(le,Br.solveVectorScale(oe,re,ee,"y",v))),A<0&&(le=Br.getLesserNonNegativeNonNull(le,Br.solveVectorScale(oe,re,ee,"y",A)));if(Number.isFinite(le)&&le!==0)return f.zoom=W.zoom+c.a8(le),f;Ri()}handleJumpToCenterZoom(e,i){const a=e.center.lat,s=e.getConstrained(i.center?c.N.convert(i.center):e.center,e.zoom).center;e.setCenter(s.wrap());const u=i.zoom!==void 0?+i.zoom:e.zoom+Zi(a,s.lat);e.zoom!==u&&e.setZoom(u)}handleEaseTo(e,i){const a=e.zoom,s=e.center,u=e.padding,f={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},y=i.zoom!==void 0,v=!e.isPaddingEqual(i.padding);let A=!1;const E=i.center?c.N.convert(i.center):s,P=e.getConstrained(E,a).center;Hi(e,P);const R=e.clone();R.setCenter(P),R.setZoom(y?+i.zoom:a+Zi(s.lat,E.lat)),R.setBearing(i.bearing);const F=new c.P(c.ab(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),c.ab(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));R.setLocationAtPoint(P,F);const Y=(i.offset&&i.offsetAsPoint.mag())>0?R.center:P,Z=y?+i.zoom:a+Zi(s.lat,Y.lat),q=a+Zi(s.lat,0),W=Z+Zi(Y.lat,0),ee=c.bk(s.lng,Y.lng),ie=c.bk(s.lat,Y.lat),re=c.aG(W-q);return A=Z!==a,{easeFunc:le=>{if(c.b3(f,g)||vi({startEulerAngles:f,endEulerAngles:g,tr:e,k:le,useSlerp:f.roll!=g.roll}),v&&e.interpolatePadding(u,i.padding,le),i.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const oe=W>q?Math.min(2,re):Math.max(.5,re),ge=Math.pow(oe,1-le),xe=A3(s,ee,ie,le*ge);e.setCenter(xe.wrap())}if(A){const oe=c.y.number(q,W,le)+Zi(0,e.center.lat);e.setZoom(oe)}},isZooming:A,elevationCenter:Y}}handleFlyTo(e,i){const a=i.zoom!==void 0,s=e.center,u=e.zoom,f=!e.isPaddingEqual(i.padding),g=e.getConstrained(c.N.convert(i.center||i.locationAtOffset),u).center,y=a?+i.zoom:e.zoom+Zi(e.center.lat,g.lat),v=e.clone();v.setCenter(g),f&&v.setPadding(i.padding),v.setZoom(y),v.setBearing(i.bearing);const A=new c.P(c.ab(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),c.ab(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));v.setLocationAtPoint(g,A);const E=v.center;Hi(e,E);const P=function(ee,ie,re){const le=Qi(ie),oe=Qi(re),ge=c.aS(le,oe),xe=Math.acos(ge),Oe=C3(ee);return xe/(2*Math.PI)*Oe}(e,s,E),R=u+Zi(s.lat,0),F=y+Zi(E.lat,0),Y=c.aG(F-R);let Z;if(typeof i.minZoom=="number"){const ee=+i.minZoom+Zi(E.lat,0),ie=Math.min(ee,R,F)+Zi(0,E.lat),re=e.getConstrained(E,ie).zoom+Zi(E.lat,0);Z=c.aG(re-R)}const q=c.bk(s.lng,E.lng),W=c.bk(s.lat,E.lat);return{easeFunc:(ee,ie,re,le)=>{const oe=A3(s,q,W,re),ge=ee===1?E:oe;e.setCenter(ge.wrap());const xe=R+c.a8(ie);e.setZoom(ee===1?y:xe+Zi(0,ge.lat))},scaleOfZoom:Y,targetCenter:E,scaleOfMinZoom:Z,pixelPathLength:P}}static solveVectorScale(e,i,a,s,u){const f=s==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],g=[a[3],a[7],a[11],a[15]],y=e[0]*f[0]+e[1]*f[1]+e[2]*f[2],v=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],A=i[0]*f[0]+i[1]*f[1]+i[2]*f[2],E=i[0]*g[0]+i[1]*g[1]+i[2]*g[2];return A+u*v===y+u*E||g[3]*(y-A)+f[3]*(E-v)+y*E==A*v?null:(A+f[3]-u*E-u*g[3])/(A-y-u*E+u*v)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class Qa{constructor(e){this._globe=e,this._mercatorCameraHelper=new uo,this._verticalPerspectiveCameraHelper=new Br}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,a){this.currentHelper.handleMapControlsPan(e,i,a)}cameraForBoxAndBearing(e,i,a,s,u){return this.currentHelper.cameraForBoxAndBearing(e,i,a,s,u)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Bo=(h,e)=>c.t(h,e&&e.filter(i=>i.identifier!=="source.canvas")),kn=c.br();class Js extends c.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const s=this.sourceCaches[a].getSource().type;s!=="vector"&&s!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new nr(Tr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,s)=>this.getGlyphs(a,s)),this.dispatcher.registerMessageHandler("GI",(a,s)=>this.getImages(a,s)),this.imageManager=new Dt,this.imageManager.setEventedParent(this),this.glyphManager=new Zt(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new dr(256,512),this.crossTileSymbolIndex=new Ar,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.bt()),Ot().on(ji,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const s=this.sourceCaches[a.sourceId];if(!s)return;const u=s.getSource();if(u&&u.vectorLayerIds)for(const f in this._layers){const g=this._layers[f];g.source===u.id&&this._validateLayer(g)}})}loadURL(e,i={},a){this.fire(new c.k("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const s=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const u=this._loadStyleRequest;c.h(s,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,i,a)}).catch(f=>{this._loadStyleRequest=null,f&&!u.signal.aborted&&this.fire(new c.j(f))})}loadJSON(e,i={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,fe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(kn,{validate:!1})}_load(e,i,a){var s,u;const f=i.transformStyle?i.transformStyle(a,e):e;if(!i.validate||!Bo(this,c.u(f))){this._loaded=!0,this.stylesheet=f;for(const g in f.sources)this.addSource(g,f.sources[g],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new Ii(this.stylesheet.light),this._setProjectionInternal(((s=this.stylesheet.projection)===null||s===void 0?void 0:s.type)||"mercator"),this.sky=new li(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const a=c.bv(i);a.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=a}}_loadSprite(e,i=!1,a=void 0){let s;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(u,f,g,y){return c._(this,void 0,void 0,function*(){const v=mt(u),A=g>1?"@2x":"",E={},P={};for(const{id:R,url:F}of v){const Y=f.transformRequest(ot(F,A,".json"),"SpriteJSON");E[R]=c.h(Y,y);const Z=f.transformRequest(ot(F,A,".png"),"SpriteImage");P[R]=He.getImage(Z,y)}return yield Promise.all([...Object.values(E),...Object.values(P)]),function(R,F){return c._(this,void 0,void 0,function*(){const Y={};for(const Z in R){Y[Z]={};const q=fe.getImageCanvasContext((yield F[Z]).data),W=(yield R[Z]).data;for(const ee in W){const{width:ie,height:re,x:le,y:oe,sdf:ge,pixelRatio:xe,stretchX:Oe,stretchY:Ie,content:Le,textFitWidth:Ye,textFitHeight:Ue}=W[ee];Y[Z][ee]={data:null,pixelRatio:xe,sdf:ge,stretchX:Oe,stretchY:Ie,content:Le,textFitWidth:Ye,textFitHeight:Ue,spriteData:{width:ie,height:re,x:le,y:oe,context:q}}}}return Y})}(E,P)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(u=>{if(this._spriteRequest=null,u)for(const f in u){this._spritesImagesIds[f]=[];const g=this._spritesImagesIds[f]?this._spritesImagesIds[f].filter(y=>!(y in u)):[];for(const y of g)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(const y in u[f]){const v=f==="default"?y:`${f}:${y}`;this._spritesImagesIds[f].push(v),v in this.imageManager.images?this.imageManager.updateImage(v,u[f][y],!1):this.imageManager.addImage(v,u[f][y]),i&&(this._changedImages[v]=!0)}}}).catch(u=>{this._spriteRequest=null,s=u,this.fire(new c.j(s))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(s)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const a=e.sourceLayer;if(!a)return;const s=i.getSource();(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${s.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?c.bw(a):a);const s=[];for(const u of e)if(a[u]){const f=i?c.bw(a[u]):a[u];s.push(f)}return s}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const a of i){const s=this._layers[a];s.type!=="custom"&&(e[a]=s.serialize())}return e}hasTransitions(){var e,i,a;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const s=Object.keys(this._updatedLayers),u=Object.keys(this._removedLayers);(s.length||u.length)&&this._updateWorkerLayers(s,u);for(const f in this._updatedSources){const g=this._updatedSources[f];if(g==="reload")this._reloadSource(f);else{if(g!=="clear")throw new Error(`Invalid action ${g}`);this._clearSource(f)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const f in this._updatedPaintProps)this._layers[f].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const s in this.sourceCaches){const u=this.sourceCaches[s];a[s]=u.used,u.used=!1}for(const s of this._order){const u=this._layers[s];u.recalculate(e,this._availableImages),!u.isHidden(e.zoom)&&u.source&&(this.sourceCaches[u.source].used=!0)}for(const s in a){const u=this.sourceCaches[s];!!a[s]!=!!u.used&&u.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:s}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var a;this._checkLoaded();const s=this.serialize();if(e=i.transformStyle?i.transformStyle(s,e):e,((a=i.validate)===null||a===void 0||a)&&Bo(this,c.u(e)))return!1;(e=c.bw(e)).layers=c.bu(e.layers);const u=c.bx(s,e),f=this._getOperationsToPerform(u);if(f.unimplemented.length>0)throw new Error(`Unimplemented: ${f.unimplemented.join(", ")}.`);if(f.operations.length===0)return!1;for(const g of f.operations)g();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],a=[];for(const s of e)switch(s.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,s.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,s.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,s.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,s.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,s.args));break;case"addSource":i.push(()=>this.addSource.apply(this,s.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,s.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,s.args));break;case"setLight":i.push(()=>this.setLight.apply(this,s.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,s.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,s.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,s.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,s.args));break;case"setSky":i.push(()=>this.setSky.apply(this,s.args));break;case"setProjection":this.setProjection.apply(this,s.args);break;case"setTransition":i.push(()=>{});break;default:a.push(s.command)}return{operations:i,unimplemented:a}}addImage(e,i){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(c.u.source,`sources.${e}`,i,null,a))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const s=this.sourceCaches[e]=new B(e,i,this.dispatcher);s.style=this,s.setEventedParent(this,()=>({isSourceLoaded:s.loaded(),source:s.serialize(),sourceId:e})),s.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,a={}){this._checkLoaded();const s=e.id;if(this.getLayer(s))return void this.fire(new c.j(new Error(`Layer "${s}" already exists on this map.`)));let u;if(e.type==="custom"){if(Bo(this,c.by(e)))return;u=c.bv(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(s,e.source),e=c.bw(e),e=c.e(e,{source:s})),this._validate(c.u.layer,`layers.${s}`,e,{arrayIndex:-1},a))return;u=c.bv(e),this._validateLayer(u),u.setEventedParent(this,{layer:{id:s}})}const f=i?this._order.indexOf(i):this._order.length;if(i&&f===-1)this.fire(new c.j(new Error(`Cannot add layer "${s}" before non-existing layer "${i}".`)));else{if(this._order.splice(f,0,s),this._layerOrderChanged=!0,this._layers[s]=u,this._removedLayers[s]&&u.source&&u.type!=="custom"){const g=this._removedLayers[s];delete this._removedLayers[s],g.type!==u.type?this._updatedSources[u.source]="clear":(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const a=this._order.indexOf(e);this._order.splice(a,1);const s=i?this._order.indexOf(i):this._order.length;i&&s===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(s,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,a){this._checkLoaded();const s=this.getLayer(e);s?s.minzoom===i&&s.maxzoom===a||(i!=null&&(s.minzoom=i),a!=null&&(s.maxzoom=a),this._updateLayer(s)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,a={}){this._checkLoaded();const s=this.getLayer(e);if(s){if(!c.bz(s.filter,i))return i==null?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(c.u.filter,`layers.${s.id}.filter`,i,null,a)||(s.filter=c.bw(i),this._updateLayer(s)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bw(this.getLayer(e).filter)}setLayoutProperty(e,i,a,s={}){this._checkLoaded();const u=this.getLayer(e);u?c.bz(u.getLayoutProperty(i),a)||(u.setLayoutProperty(i,a,s),this._updateLayer(u)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const a=this.getLayer(e);if(a)return a.getLayoutProperty(i);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,a,s={}){this._checkLoaded();const u=this.getLayer(e);u?c.bz(u.getPaintProperty(i),a)||(u.setPaintProperty(i,a,s)&&this._updateLayer(u),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const a=e.source,s=e.sourceLayer,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const f=u.getSource().type;f==="geojson"&&s?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||s?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),u.setFeatureState(s,e.id,i)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const a=e.source,s=this.sourceCaches[a];if(s===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const u=s.getSource().type,f=u==="vector"?e.sourceLayer:void 0;u!=="vector"||f?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):s.removeFeatureState(f,e.id,i):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,a=e.sourceLayer,s=this.sourceCaches[i];if(s!==void 0)return s.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),s.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bA(this.sourceCaches,u=>u.serialize()),i=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,s=this.stylesheet;return c.bB({version:s.version,name:s.name,metadata:s.metadata,light:s.light,sky:s.sky,center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,sprite:s.sprite,glyphs:s.glyphs,transition:s.transition,projection:s.projection,sources:e,layers:i,terrain:a},u=>u!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=f=>this._layers[f].type==="fill-extrusion",a={},s=[];for(let f=this._order.length-1;f>=0;f--){const g=this._order[f];if(i(g)){a[g]=f;for(const y of e){const v=y[g];if(v)for(const A of v)s.push(A)}}}s.sort((f,g)=>g.intersectionZ-f.intersectionZ);const u=[];for(let f=this._order.length-1;f>=0;f--){const g=this._order[f];if(i(g))for(let y=s.length-1;y>=0;y--){const v=s[y].feature;if(a[v.layer.id]<f)break;u.push(v),s.pop()}else for(const y of e){const v=y[g];if(v)for(const A of v)u.push(A.feature)}}return u}queryRenderedFeatures(e,i,a){i&&i.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",i.filter,null,i);const s={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new c.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const v of i.layers){const A=this._layers[v];if(!A)return this.fire(new c.j(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];s[A.source]=!0}}const u=[];i.availableImages=this._availableImages;const f=this._serializedAllLayers(),g=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,y=Object.assign(Object.assign({},i),{layers:g});for(const v in this.sourceCaches)i.layers&&!s[v]||u.push(qr(this.sourceCaches[v],this._layers,f,e,y,a));return this.placement&&u.push(function(v,A,E,P,R,F,Y){const Z={},q=F.queryRenderedSymbols(P),W=[];for(const ee of Object.keys(q).map(Number))W.push(Y[ee]);W.sort(Kt);for(const ee of W){const ie=ee.featureIndex.lookupSymbolFeatures(q[ee.bucketInstanceId],A,ee.bucketIndex,ee.sourceLayerIndex,R.filter,R.layers,R.availableImages,v);for(const re in ie){const le=Z[re]=Z[re]||[],oe=ie[re];oe.sort((ge,xe)=>{const Oe=ee.featureSortOrder;if(Oe){const Ie=Oe.indexOf(ge.featureIndex);return Oe.indexOf(xe.featureIndex)-Ie}return xe.featureIndex-ge.featureIndex});for(const ge of oe)le.push(ge)}}return function(ee,ie,re){for(const le in ee)for(const oe of ee[le])at(oe,re[ie[le].source]);return ee}(Z,v,E)}(this._layers,f,this.sourceCaches,e,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(e,i){i&&i.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",i.filter,null,i);const a=this.sourceCaches[e];return a?function(s,u){const f=s.getRenderableIds().map(v=>s.getTileByID(v)),g=[],y={};for(let v=0;v<f.length;v++){const A=f[v],E=A.tileID.canonical.key;y[E]||(y[E]=!0,A.querySourceFeatures(g,u))}return g}(a,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const a=this.light.getLight();let s=!1;for(const f in e)if(!c.bz(e[f],a[f])){s=!0;break}if(!s)return;const u={now:fe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(u)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const a=this.getSky();let s=!1;if(!e&&!a)return;if(e&&!a)s=!0;else if(!e&&a)s=!0;else for(const f in e)if(!c.bz(e[f],a[f])){s=!0;break}if(!s)return;const u={now:fe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(u)}_setProjectionInternal(e){const i=function(a){if(Array.isArray(a)){const s=new S3({type:a});return{projection:s,transform:new zo,cameraHelper:new Qa(s)}}switch(a){case"mercator":return{projection:new ve,transform:new qt,cameraHelper:new uo};case"globe":{const s=new S3({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:s,transform:new zo,cameraHelper:new Qa(s)}}case"vertical-perspective":return{projection:new Ka,transform:new fo,cameraHelper:new Br};default:return c.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new ve,transform:new qt,cameraHelper:new uo}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const a in this.sourceCaches)this.sourceCaches[a].reload()}_validate(e,i,a,s,u={}){return(!u||u.validate!==!1)&&Bo(this,e.call(c.u,c.e({key:i,style:this.serialize(),value:a,styleSpec:c.v},s)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ot().off(ji,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const a=this.sourceCaches[i];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,a,s,u=!1){let f=!1,g=!1;const y={};for(const v of this._order){const A=this._layers[v];if(A.type!=="symbol")continue;if(!y[A.source]){const P=this.sourceCaches[A.source];y[A.source]=P.getRenderableIds(!0).map(R=>P.getTileByID(R)).sort((R,F)=>F.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(F.tileID)?-1:1))}const E=this.crossTileSymbolIndex.addLayer(A,y[A.source],e.center.lng);f=f||E}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((u=u||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(fe.now(),e.zoom))&&(this.pauseablePlacement=new Xa(e,this.map.terrain,this._order,u,i,a,s,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(fe.now()),g=!0),f&&this.pauseablePlacement.placement.setStale()),g||f)for(const v of this._order){const A=this._layers[v];A.type==="symbol"&&this.placement.updateLayerOpacities(A,y[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(fe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const s=this.sourceCaches[i.source];return s&&s.setDependencies(i.tileID.key,i.type,i.icons),a})}getGlyphs(e,i){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(i.stacks),s=this.sourceCaches[i.source];return s&&s.setDependencies(i.tileID.key,i.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,a={},s){this._checkLoaded();const u=[{id:e,url:i}],f=[...mt(this.stylesheet.sprite),...u];this._validate(c.u.sprite,"sprite",f,null,a)||(this.stylesheet.sprite=f,this._loadSprite(u,!0,s))}removeSprite(e){this._checkLoaded();const i=mt(this.stylesheet.sprite);if(i.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;i.splice(i.findIndex(a=>a.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return mt(this.stylesheet.sprite)}setSprite(e,i={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var Qs=c.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ua{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,a,s,u,f,g,y,v){this.context=e;let A=this.boundPaintVertexBuffers.length!==s.length;for(let E=0;!A&&E<s.length;E++)this.boundPaintVertexBuffers[E]!==s[E]&&(A=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==a||A||this.boundIndexBuffer!==u||this.boundVertexOffset!==f||this.boundDynamicVertexBuffer!==g||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==v?this.freshBind(i,a,s,u,f,g,y,v):(e.bindVertexArray.set(this.vao),g&&g.bind(),u&&u.dynamicDraw&&u.bind(),y&&y.bind(),v&&v.bind())}freshBind(e,i,a,s,u,f,g,y){const v=e.numAttributes,A=this.context,E=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=s,this.boundVertexOffset=u,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=g,this.boundDynamicVertexBuffer3=y,i.enableAttributes(E,e);for(const P of a)P.enableAttributes(E,e);f&&f.enableAttributes(E,e),g&&g.enableAttributes(E,e),y&&y.enableAttributes(E,e),i.bind(),i.setVertexAttribPointers(E,e,u);for(const P of a)P.bind(),P.setVertexAttribPointers(E,e,u);f&&(f.bind(),f.setVertexAttribPointers(E,e,u)),s&&s.bind(),g&&(g.bind(),g.setVertexAttribPointers(E,e,u)),y&&(y.bind(),y.setVertexAttribPointers(E,e,u)),A.currentNumAttributes=v}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const pa=(h,e,i,a,s)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):c.b4.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:s?0:i?i.calculateFogBlendOpacity(a):0,u_horizon_color:i?i.properties.get("horizon-color"):c.b4.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:s?1:0}),$l={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function mo(h){const e=[];for(let i=0;i<h.length;i++){if(h[i]===null)continue;const a=h[i].split(" ");e.push(a.pop())}return e}class Wl{constructor(e,i,a,s,u,f,g,y){const v=e.gl;this.program=v.createProgram();const A=mo(i.staticAttributes),E=a?a.getBinderAttributes():[],P=A.concat(E),R=zr.prelude.staticUniforms?mo(zr.prelude.staticUniforms):[],F=g.staticUniforms?mo(g.staticUniforms):[],Y=i.staticUniforms?mo(i.staticUniforms):[],Z=a?a.getBinderUniforms():[],q=R.concat(F).concat(Y).concat(Z),W=[];for(const xe of q)W.indexOf(xe)<0&&W.push(xe);const ee=a?a.defines():[];yn(v)&&ee.unshift("#version 300 es"),u&&ee.push("#define OVERDRAW_INSPECTOR;"),f&&ee.push("#define TERRAIN3D;"),y&&ee.push(y);let ie=ee.concat(zr.prelude.fragmentSource,g.fragmentSource,i.fragmentSource).join(`
`),re=ee.concat(zr.prelude.vertexSource,g.vertexSource,i.vertexSource).join(`
`);yn(v)||(ie=function(xe){return xe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ie),re=function(xe){return xe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(re));const le=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(le,ie),v.compileShader(le),!v.getShaderParameter(le,v.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${v.getShaderInfoLog(le)}`);v.attachShader(this.program,le);const oe=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(oe,re),v.compileShader(oe),!v.getShaderParameter(oe,v.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${v.getShaderInfoLog(oe)}`);v.attachShader(this.program,oe),this.attributes={};const ge={};this.numAttributes=P.length;for(let xe=0;xe<this.numAttributes;xe++)P[xe]&&(v.bindAttribLocation(this.program,xe,P[xe]),this.attributes[P[xe]]=xe);if(v.linkProgram(this.program),!v.getProgramParameter(this.program,v.LINK_STATUS))throw new Error(`Program failed to link: ${v.getProgramInfoLog(this.program)}`);v.deleteShader(oe),v.deleteShader(le);for(let xe=0;xe<W.length;xe++){const Oe=W[xe];if(Oe&&!ge[Oe]){const Ie=v.getUniformLocation(this.program,Oe);Ie&&(ge[Oe]=Ie)}}this.fixedUniforms=s(e,ge),this.terrainUniforms=((xe,Oe)=>({u_depth:new c.bC(xe,Oe.u_depth),u_terrain:new c.bC(xe,Oe.u_terrain),u_terrain_dim:new c.b5(xe,Oe.u_terrain_dim),u_terrain_matrix:new c.bD(xe,Oe.u_terrain_matrix),u_terrain_unpack:new c.bE(xe,Oe.u_terrain_unpack),u_terrain_exaggeration:new c.b5(xe,Oe.u_terrain_exaggeration)}))(e,ge),this.projectionUniforms=((xe,Oe)=>({u_projection_matrix:new c.bD(xe,Oe.u_projection_matrix),u_projection_tile_mercator_coords:new c.bE(xe,Oe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bE(xe,Oe.u_projection_clipping_plane),u_projection_transition:new c.b5(xe,Oe.u_projection_transition),u_projection_fallback_matrix:new c.bD(xe,Oe.u_projection_fallback_matrix)}))(e,ge),this.binderUniforms=a?a.getUniforms(e,ge):[]}draw(e,i,a,s,u,f,g,y,v,A,E,P,R,F,Y,Z,q,W,ee){const ie=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(s),e.setColorMode(u),e.setCullFace(f),y){e.activeTexture.set(ie.TEXTURE2),ie.bindTexture(ie.TEXTURE_2D,y.depthTexture),e.activeTexture.set(ie.TEXTURE3),ie.bindTexture(ie.TEXTURE_2D,y.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(y[le])}if(v)for(const le in v)this.projectionUniforms[$l[le]].set(v[le]);if(g)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(g[le]);Z&&Z.setUniforms(e,this.binderUniforms,F,{zoom:Y});let re=0;switch(i){case ie.LINES:re=2;break;case ie.TRIANGLES:re=3;break;case ie.LINE_STRIP:re=1}for(const le of R.get()){const oe=le.vaos||(le.vaos={});(oe[A]||(oe[A]=new ua)).bind(e,this,E,Z?Z.getPaintVertexBuffers():[],P,le.vertexOffset,q,W,ee),ie.drawElements(i,le.primitiveLength*re,ie.UNSIGNED_SHORT,le.primitiveOffset*re*2)}}}function go(h,e,i){const a=1/c.at(i,1,e.transform.tileZoom),s=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,e.transform.tileZoom)/s,f=u*(i.tileID.canonical.x+i.tileID.wrap*s),g=u*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[a,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[f>>16,g>>16],u_pixel_coord_lower:[65535&f,65535&g]}}const E3=(h,e,i,a)=>{const s=h.style.light,u=s.properties.get("position"),f=[u.x,u.y,u.z],g=c.bI();s.properties.get("anchor")==="viewport"&&c.bJ(g,h.transform.bearingInRadians),c.bK(f,f,g);const y=h.transform.transformLightDirection(f),v=s.properties.get("color");return{u_lightpos:f,u_lightpos_globe:y,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:a}},L3=(h,e,i,a,s,u,f)=>c.e(E3(h,e,i,a),go(u,h,f),{u_height_factor:-Math.pow(2,s.overscaledZ)/f.tileSize/8}),P3=(h,e,i,a)=>c.e(go(e,h,i),{u_fill_translate:a}),M3=(h,e)=>({u_world:h,u_fill_translate:e}),e4=(h,e,i,a,s)=>c.e(P3(h,e,i,s),{u_world:a}),I3=(h,e,i,a,s)=>{const u=h.transform;let f,g,y=0;if(i.paint.get("circle-pitch-alignment")==="map"){const v=c.at(e,1,u.zoom);f=!0,g=[v,v],y=v/(c.X*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*s}else f=!1,g=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+f,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:g,u_globe_extrude_scale:y,u_translate:a}},O3=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),N3=h=>({u_viewport_size:[h.width,h.height]}),t4=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),to=(h,e,i,a)=>{const s=c.at(h,1,e)/(c.X*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:c.at(h,1,e),u_intensity:i,u_globe_extrude_scale:s}},i4=(h,e,i,a)=>{const s=c.H();c.bL(s,0,h.width,h.height,0,0,1);const u=h.context.gl;return{u_matrix:s,u_world:[u.drawingBufferWidth,u.drawingBufferHeight],u_image:i,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}},k3=(h,e,i)=>{const a=i.paint.get("hillshade-shadow-color"),s=i.paint.get("hillshade-highlight-color"),u=i.paint.get("hillshade-accent-color");let f=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);return i.paint.get("hillshade-illumination-anchor")==="viewport"&&(f+=h.transform.bearingInRadians),{u_image:0,u_latrange:Xl(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),f],u_shadow:a,u_highlight:s,u_accent:u}},da=(h,e)=>{const i=e.stride,a=c.H();return c.bL(a,0,c.X,-8192,0,0,1),c.J(a,a,[0,-8192,0]),{u_matrix:a,u_image:1,u_dimension:[i,i],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function Xl(h,e){const i=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Y(0,a/i).toLngLat().lat,new c.Y(0,(a+1)/i).toLngLat().lat]}const Fo=(h,e,i,a)=>{const s=h.transform;return{u_translation:n4(h,e,i),u_ratio:a/c.at(e,1,s.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Kl=(h,e,i,a,s)=>c.e(Fo(h,e,i,a),{u_image:0,u_image_height:s}),Jl=(h,e,i,a,s)=>{const u=h.transform,f=r4(e,u);return{u_translation:n4(h,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:a/c.at(e,1,u.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[f,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},R3=(h,e,i,a,s,u)=>{const f=h.lineAtlas,g=r4(e,h.transform),y=i.layout.get("line-cap")==="round",v=f.getDash(s.from,y),A=f.getDash(s.to,y),E=v.width*u.fromScale,P=A.width*u.toScale;return c.e(Fo(h,e,i,a),{u_patternscale_a:[g/E,-v.height/2],u_patternscale_b:[g/P,-A.height/2],u_sdfgamma:f.width/(256*Math.min(E,P)*h.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:A.y,u_mix:u.t})};function r4(h,e){return 1/c.at(h,1,e.tileZoom)}function n4(h,e,i){return c.au(h.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const o4=(h,e,i,a,s)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(f=a.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(u=a.paint.get("raster-contrast"),u>0?1/(1-u):1+u),u_spin_weights:D3(a.paint.get("raster-hue-rotate")),u_coords_top:[s[0].x,s[0].y,s[1].x,s[1].y],u_coords_bottom:[s[3].x,s[3].y,s[2].x,s[2].y]};var u,f};function D3(h){h*=Math.PI/180;const e=Math.sin(h),i=Math.cos(h);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const fa=(h,e,i,a,s,u,f,g,y,v,A,E,P)=>{const R=f.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:R.width/R.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_label_plane_matrix:g,u_coord_matrix:y,u_is_text:+A,u_pitch_with_map:+a,u_is_along_line:s,u_is_variable_anchor:u,u_texsize:E,u_texture:0,u_translation:v,u_pitched_scale:P}},Rn=(h,e,i,a,s,u,f,g,y,v,A,E,P,R)=>{const F=f.transform;return c.e(fa(h,e,i,a,s,u,f,g,y,v,A,E,R),{u_gamma_scale:a?Math.cos(F.pitch*Math.PI/180)*F.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:1})},a4=(h,e,i,a,s,u,f,g,y,v,A,E,P)=>c.e(Rn(h,e,i,a,s,u,f,g,y,v,!0,A,0,P),{u_texsize_icon:E,u_texture_icon:1}),s4=(h,e)=>({u_opacity:h,u_color:e}),l4=(h,e,i,a,s)=>c.e(function(u,f,g,y){const v=g.imageManager.getPattern(u.from.toString()),A=g.imageManager.getPattern(u.to.toString()),{width:E,height:P}=g.imageManager.getPixelSize(),R=Math.pow(2,y.tileID.overscaledZ),F=y.tileSize*Math.pow(2,g.transform.tileZoom)/R,Y=F*(y.tileID.canonical.x+y.tileID.wrap*R),Z=F*y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:v.tl,u_pattern_br_a:v.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[E,P],u_mix:f.t,u_pattern_size_a:v.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:f.fromScale,u_scale_b:f.toScale,u_tile_units_to_pixels:1/c.at(y,1,g.transform.tileZoom),u_pixel_coord_upper:[Y>>16,Z>>16],u_pixel_coord_lower:[65535&Y,65535&Z]}}(i,s,e,a),{u_opacity:h}),c4=(h,e)=>{},h4={fillExtrusion:(h,e)=>({u_lightpos:new c.bG(h,e.u_lightpos),u_lightpos_globe:new c.bG(h,e.u_lightpos_globe),u_lightintensity:new c.b5(h,e.u_lightintensity),u_lightcolor:new c.bG(h,e.u_lightcolor),u_vertical_gradient:new c.b5(h,e.u_vertical_gradient),u_opacity:new c.b5(h,e.u_opacity),u_fill_translate:new c.bH(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new c.bG(h,e.u_lightpos),u_lightpos_globe:new c.bG(h,e.u_lightpos_globe),u_lightintensity:new c.b5(h,e.u_lightintensity),u_lightcolor:new c.bG(h,e.u_lightcolor),u_vertical_gradient:new c.b5(h,e.u_vertical_gradient),u_height_factor:new c.b5(h,e.u_height_factor),u_opacity:new c.b5(h,e.u_opacity),u_fill_translate:new c.bH(h,e.u_fill_translate),u_image:new c.bC(h,e.u_image),u_texsize:new c.bH(h,e.u_texsize),u_pixel_coord_upper:new c.bH(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bH(h,e.u_pixel_coord_lower),u_scale:new c.bG(h,e.u_scale),u_fade:new c.b5(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new c.bH(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new c.bC(h,e.u_image),u_texsize:new c.bH(h,e.u_texsize),u_pixel_coord_upper:new c.bH(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bH(h,e.u_pixel_coord_lower),u_scale:new c.bG(h,e.u_scale),u_fade:new c.b5(h,e.u_fade),u_fill_translate:new c.bH(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new c.bH(h,e.u_world),u_fill_translate:new c.bH(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new c.bH(h,e.u_world),u_image:new c.bC(h,e.u_image),u_texsize:new c.bH(h,e.u_texsize),u_pixel_coord_upper:new c.bH(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bH(h,e.u_pixel_coord_lower),u_scale:new c.bG(h,e.u_scale),u_fade:new c.b5(h,e.u_fade),u_fill_translate:new c.bH(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new c.b5(h,e.u_camera_to_center_distance),u_scale_with_map:new c.bC(h,e.u_scale_with_map),u_pitch_with_map:new c.bC(h,e.u_pitch_with_map),u_extrude_scale:new c.bH(h,e.u_extrude_scale),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.b5(h,e.u_globe_extrude_scale),u_translate:new c.bH(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new c.bH(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new c.bH(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new c.bF(h,e.u_color),u_overlay:new c.bC(h,e.u_overlay),u_overlay_scale:new c.b5(h,e.u_overlay_scale)}),depth:c4,clippingMask:c4,heatmap:(h,e)=>({u_extrude_scale:new c.b5(h,e.u_extrude_scale),u_intensity:new c.b5(h,e.u_intensity),u_globe_extrude_scale:new c.b5(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new c.bD(h,e.u_matrix),u_world:new c.bH(h,e.u_world),u_image:new c.bC(h,e.u_image),u_color_ramp:new c.bC(h,e.u_color_ramp),u_opacity:new c.b5(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new c.bC(h,e.u_image),u_latrange:new c.bH(h,e.u_latrange),u_light:new c.bH(h,e.u_light),u_shadow:new c.bF(h,e.u_shadow),u_highlight:new c.bF(h,e.u_highlight),u_accent:new c.bF(h,e.u_accent)}),hillshadePrepare:(h,e)=>({u_matrix:new c.bD(h,e.u_matrix),u_image:new c.bC(h,e.u_image),u_dimension:new c.bH(h,e.u_dimension),u_zoom:new c.b5(h,e.u_zoom),u_unpack:new c.bE(h,e.u_unpack)}),line:(h,e)=>({u_translation:new c.bH(h,e.u_translation),u_ratio:new c.b5(h,e.u_ratio),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.bH(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new c.bH(h,e.u_translation),u_ratio:new c.b5(h,e.u_ratio),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.bH(h,e.u_units_to_pixels),u_image:new c.bC(h,e.u_image),u_image_height:new c.b5(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new c.bH(h,e.u_translation),u_texsize:new c.bH(h,e.u_texsize),u_ratio:new c.b5(h,e.u_ratio),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_image:new c.bC(h,e.u_image),u_units_to_pixels:new c.bH(h,e.u_units_to_pixels),u_scale:new c.bG(h,e.u_scale),u_fade:new c.b5(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new c.bH(h,e.u_translation),u_ratio:new c.b5(h,e.u_ratio),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.bH(h,e.u_units_to_pixels),u_patternscale_a:new c.bH(h,e.u_patternscale_a),u_patternscale_b:new c.bH(h,e.u_patternscale_b),u_sdfgamma:new c.b5(h,e.u_sdfgamma),u_image:new c.bC(h,e.u_image),u_tex_y_a:new c.b5(h,e.u_tex_y_a),u_tex_y_b:new c.b5(h,e.u_tex_y_b),u_mix:new c.b5(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new c.bH(h,e.u_tl_parent),u_scale_parent:new c.b5(h,e.u_scale_parent),u_buffer_scale:new c.b5(h,e.u_buffer_scale),u_fade_t:new c.b5(h,e.u_fade_t),u_opacity:new c.b5(h,e.u_opacity),u_image0:new c.bC(h,e.u_image0),u_image1:new c.bC(h,e.u_image1),u_brightness_low:new c.b5(h,e.u_brightness_low),u_brightness_high:new c.b5(h,e.u_brightness_high),u_saturation_factor:new c.b5(h,e.u_saturation_factor),u_contrast_factor:new c.b5(h,e.u_contrast_factor),u_spin_weights:new c.bG(h,e.u_spin_weights),u_coords_top:new c.bE(h,e.u_coords_top),u_coords_bottom:new c.bE(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new c.bC(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bC(h,e.u_is_size_feature_constant),u_size_t:new c.b5(h,e.u_size_t),u_size:new c.b5(h,e.u_size),u_camera_to_center_distance:new c.b5(h,e.u_camera_to_center_distance),u_pitch:new c.b5(h,e.u_pitch),u_rotate_symbol:new c.bC(h,e.u_rotate_symbol),u_aspect_ratio:new c.b5(h,e.u_aspect_ratio),u_fade_change:new c.b5(h,e.u_fade_change),u_label_plane_matrix:new c.bD(h,e.u_label_plane_matrix),u_coord_matrix:new c.bD(h,e.u_coord_matrix),u_is_text:new c.bC(h,e.u_is_text),u_pitch_with_map:new c.bC(h,e.u_pitch_with_map),u_is_along_line:new c.bC(h,e.u_is_along_line),u_is_variable_anchor:new c.bC(h,e.u_is_variable_anchor),u_texsize:new c.bH(h,e.u_texsize),u_texture:new c.bC(h,e.u_texture),u_translation:new c.bH(h,e.u_translation),u_pitched_scale:new c.b5(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new c.bC(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bC(h,e.u_is_size_feature_constant),u_size_t:new c.b5(h,e.u_size_t),u_size:new c.b5(h,e.u_size),u_camera_to_center_distance:new c.b5(h,e.u_camera_to_center_distance),u_pitch:new c.b5(h,e.u_pitch),u_rotate_symbol:new c.bC(h,e.u_rotate_symbol),u_aspect_ratio:new c.b5(h,e.u_aspect_ratio),u_fade_change:new c.b5(h,e.u_fade_change),u_label_plane_matrix:new c.bD(h,e.u_label_plane_matrix),u_coord_matrix:new c.bD(h,e.u_coord_matrix),u_is_text:new c.bC(h,e.u_is_text),u_pitch_with_map:new c.bC(h,e.u_pitch_with_map),u_is_along_line:new c.bC(h,e.u_is_along_line),u_is_variable_anchor:new c.bC(h,e.u_is_variable_anchor),u_texsize:new c.bH(h,e.u_texsize),u_texture:new c.bC(h,e.u_texture),u_gamma_scale:new c.b5(h,e.u_gamma_scale),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_is_halo:new c.bC(h,e.u_is_halo),u_translation:new c.bH(h,e.u_translation),u_pitched_scale:new c.b5(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new c.bC(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bC(h,e.u_is_size_feature_constant),u_size_t:new c.b5(h,e.u_size_t),u_size:new c.b5(h,e.u_size),u_camera_to_center_distance:new c.b5(h,e.u_camera_to_center_distance),u_pitch:new c.b5(h,e.u_pitch),u_rotate_symbol:new c.bC(h,e.u_rotate_symbol),u_aspect_ratio:new c.b5(h,e.u_aspect_ratio),u_fade_change:new c.b5(h,e.u_fade_change),u_label_plane_matrix:new c.bD(h,e.u_label_plane_matrix),u_coord_matrix:new c.bD(h,e.u_coord_matrix),u_is_text:new c.bC(h,e.u_is_text),u_pitch_with_map:new c.bC(h,e.u_pitch_with_map),u_is_along_line:new c.bC(h,e.u_is_along_line),u_is_variable_anchor:new c.bC(h,e.u_is_variable_anchor),u_texsize:new c.bH(h,e.u_texsize),u_texsize_icon:new c.bH(h,e.u_texsize_icon),u_texture:new c.bC(h,e.u_texture),u_texture_icon:new c.bC(h,e.u_texture_icon),u_gamma_scale:new c.b5(h,e.u_gamma_scale),u_device_pixel_ratio:new c.b5(h,e.u_device_pixel_ratio),u_is_halo:new c.bC(h,e.u_is_halo),u_translation:new c.bH(h,e.u_translation),u_pitched_scale:new c.b5(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new c.b5(h,e.u_opacity),u_color:new c.bF(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new c.b5(h,e.u_opacity),u_image:new c.bC(h,e.u_image),u_pattern_tl_a:new c.bH(h,e.u_pattern_tl_a),u_pattern_br_a:new c.bH(h,e.u_pattern_br_a),u_pattern_tl_b:new c.bH(h,e.u_pattern_tl_b),u_pattern_br_b:new c.bH(h,e.u_pattern_br_b),u_texsize:new c.bH(h,e.u_texsize),u_mix:new c.b5(h,e.u_mix),u_pattern_size_a:new c.bH(h,e.u_pattern_size_a),u_pattern_size_b:new c.bH(h,e.u_pattern_size_b),u_scale_a:new c.b5(h,e.u_scale_a),u_scale_b:new c.b5(h,e.u_scale_b),u_pixel_coord_upper:new c.bH(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bH(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.b5(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new c.bC(h,e.u_texture),u_ele_delta:new c.b5(h,e.u_ele_delta),u_fog_matrix:new c.bD(h,e.u_fog_matrix),u_fog_color:new c.bF(h,e.u_fog_color),u_fog_ground_blend:new c.b5(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.b5(h,e.u_fog_ground_blend_opacity),u_horizon_color:new c.bF(h,e.u_horizon_color),u_horizon_fog_blend:new c.b5(h,e.u_horizon_fog_blend),u_is_globe_mode:new c.b5(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new c.b5(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new c.bC(h,e.u_texture),u_terrain_coords_id:new c.b5(h,e.u_terrain_coords_id),u_ele_delta:new c.b5(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new c.b5(h,e.u_input),u_output_expected:new c.b5(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new c.bG(h,e.u_sun_pos),u_atmosphere_blend:new c.b5(h,e.u_atmosphere_blend),u_globe_position:new c.bG(h,e.u_globe_position),u_globe_radius:new c.b5(h,e.u_globe_radius),u_inv_proj_matrix:new c.bD(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new c.bF(h,e.u_sky_color),u_horizon_color:new c.bF(h,e.u_horizon_color),u_horizon:new c.bH(h,e.u_horizon),u_horizon_normal:new c.bH(h,e.u_horizon_normal),u_sky_horizon_blend:new c.b5(h,e.u_sky_horizon_blend),u_sky_blend:new c.b5(h,e.u_sky_blend)})};class _o{constructor(e,i,a){this.context=e;const s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const u4={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ql{constructor(e,i,a,s){this.length=i.length,this.attributes=a,this.itemSize=i.bytesPerElement,this.dynamicDraw=s,this.context=e;const u=e.gl;this.buffer=u.createBuffer(),e.bindVertexBuffer.set(this.buffer),u.bufferData(u.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let a=0;a<this.attributes.length;a++){const s=i.attributes[this.attributes[a].name];s!==void 0&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,i,a){for(let s=0;s<this.attributes.length;s++){const u=this.attributes[s],f=i.attributes[u.name];f!==void 0&&e.vertexAttribPointer(f,u.components,e[u4[u.type]],!1,this.itemSize,u.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $t{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class e7 extends $t{getDefault(){return c.b4.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class t7 extends $t{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class z3 extends $t{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class i7 extends $t{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class B3 extends $t{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class es extends $t{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ts extends $t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class is extends $t{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class p4 extends $t{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class yo extends $t{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Go extends $t{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class cn extends $t{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class F3 extends $t{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class G3 extends $t{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class d4 extends $t{getDefault(){return c.b4.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class xo extends $t{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class rs extends $t{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class ns extends $t{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ma extends $t{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class os extends $t{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class U3 extends $t{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Uo extends $t{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jo extends $t{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class j3 extends $t{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class f4 extends $t{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Rt extends $t{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class as extends $t{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class r7 extends $t{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const a=this.gl;yn(a)?a.bindVertexArray(e):(i=a.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class H3 extends $t{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ga extends $t{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class n7 extends $t{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class m4 extends $t{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class V3 extends m4{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class o7 extends m4{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class g4 extends m4{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const _a="Framebuffer is not complete";class ss{constructor(e,i,a,s,u){this.context=e,this.width=i,this.height=a;const f=e.gl,g=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new V3(e,g),s)this.depthAttachment=u?new g4(e,g):new o7(e,g);else if(u)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error(_a)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class _4{constructor(e){var i,a;if(this.gl=e,this.clearColor=new e7(this),this.clearDepth=new t7(this),this.clearStencil=new z3(this),this.colorMask=new i7(this),this.depthMask=new B3(this),this.stencilMask=new es(this),this.stencilFunc=new ts(this),this.stencilOp=new is(this),this.stencilTest=new p4(this),this.depthRange=new yo(this),this.depthTest=new Go(this),this.depthFunc=new cn(this),this.blend=new F3(this),this.blendFunc=new G3(this),this.blendColor=new d4(this),this.blendEquation=new xo(this),this.cullFace=new rs(this),this.cullFaceSide=new ns(this),this.frontFace=new ma(this),this.program=new os(this),this.activeTexture=new U3(this),this.viewport=new Uo(this),this.bindFramebuffer=new jo(this),this.bindRenderbuffer=new j3(this),this.bindTexture=new f4(this),this.bindVertexBuffer=new Rt(this),this.bindElementBuffer=new as(this),this.bindVertexArray=new r7(this),this.pixelStoreUnpack=new H3(this),this.pixelStoreUnpackPremultiplyAlpha=new ga(this),this.pixelStoreUnpackFlipY=new n7(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),yn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const s=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:s==null?void 0:s.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:s==null?void 0:s.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const s=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=s==null?void 0:s.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new _o(this,e,i)}createVertexBuffer(e,i,a){return new Ql(this,e,i,a)}createRenderbuffer(e,i,a){const s=this.gl,u=s.createRenderbuffer();return this.bindRenderbuffer.set(u),s.renderbufferStorage(s.RENDERBUFFER,e,i,a),this.bindRenderbuffer.set(null),u}createFramebuffer(e,i,a,s){return new ss(this,e,i,a,s)}clear({color:e,depth:i,stencil:a}){const s=this.gl;let u=0;e&&(u|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(u|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),a!==void 0&&(u|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),s.clear(u)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bz(e.blendFunction,Jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return yn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return yn(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Ho;function y4(h,e,i,a,s){const u=h.context,f=h.transform,g=u.gl,y=h.useProgram("collisionBox"),v=[];let A=0,E=0;for(let q=0;q<a.length;q++){const W=a[q],ee=e.getTile(W).getBucket(i);if(!ee)continue;const ie=s?ee.textCollisionBox:ee.iconCollisionBox,re=ee.collisionCircleArray;re.length>0&&(v.push({circleArray:re,circleOffset:E,coord:W}),A+=re.length/4,E=A),ie&&y.draw(u,g.LINES,_t.disabled,Nt.disabled,h.colorModeForRenderPass(),Ct.disabled,O3(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(W),f.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,null,h.transform.zoom,null,null,ie.collisionVertexBuffer)}if(!s||!v.length)return;const P=h.useProgram("collisionCircle"),R=new c.bM;R.resize(4*A),R._trim();let F=0;for(const q of v)for(let W=0;W<q.circleArray.length/4;W++){const ee=4*W,ie=q.circleArray[ee+0],re=q.circleArray[ee+1],le=q.circleArray[ee+2],oe=q.circleArray[ee+3];R.emplace(F++,ie,re,le,oe,0),R.emplace(F++,ie,re,le,oe,1),R.emplace(F++,ie,re,le,oe,2),R.emplace(F++,ie,re,le,oe,3)}(!Ho||Ho.length<2*A)&&(Ho=function(q){const W=2*q,ee=new c.bO;ee.resize(W),ee._trim();for(let ie=0;ie<W;ie++){const re=6*ie;ee.uint16[re+0]=4*ie+0,ee.uint16[re+1]=4*ie+1,ee.uint16[re+2]=4*ie+2,ee.uint16[re+3]=4*ie+2,ee.uint16[re+4]=4*ie+3,ee.uint16[re+5]=4*ie+0}return ee}(A));const Y=u.createIndexBuffer(Ho,!0),Z=u.createVertexBuffer(R,c.bN.members,!0);for(const q of v){const W=N3(h.transform);P.draw(u,g.TRIANGLES,_t.disabled,Nt.disabled,h.colorModeForRenderPass(),Ct.disabled,W,h.style.map.terrain&&h.style.map.terrain.getTerrainData(q.coord),null,i.id,Z,Y,c.aD.simpleSegment(0,2*q.circleOffset,q.circleArray.length,q.circleArray.length/2),null,h.transform.zoom,null,null,null)}Z.destroy(),Y.destroy()}const ls=c.aq(new Float32Array(16));function cs(h,e,i,a,s,u){const{horizontalAlign:f,verticalAlign:g}=c.ay(h);return new c.P((-(f-.5)*e/s+a[0])*u,(-(g-.5)*i/s+a[1])*u)}function x4(h,e,i,a,s,u){const f=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let g=a.mult(u);i||(g=g.rotate(-s));const y=f.add(g);return Se(y.x,y.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const g=Xe(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),y=Math.atan(g.y/g.x)+(g.x<0?Math.PI:0);return h.add(a.rotate(y))}return h.add(a)}function a7(h,e,i,a,s,u,f,g,y,v,A,E){const P=h.text.placedSymbolArray,R=h.text.dynamicLayoutVertexArray,F=h.icon.dynamicLayoutVertexArray,Y={};R.clear();for(let Z=0;Z<P.length;Z++){const q=P.get(Z),W=q.hidden||!q.crossTileID||h.allowVerticalPlacement&&!q.placedOrientation?null:a[q.crossTileID];if(W){const ee=new c.P(q.anchorX,q.anchorY),ie={getElevation:E,width:s.width,height:s.height,pitchedLabelPlaneMatrix:u,lineVertexArray:null,pitchWithMap:i,transform:s,projectionCache:null,tileAnchorPoint:ee,translation:v,unwrappedTileID:A},re=i?Pt(ee.x,ee.y,ie):Xe(ee.x,ee.y,ie),le=pe(s.cameraToCenterDistance,re.signedDistanceFromCamera);let oe=c.aj(h.textSizeData,g,q)*le/c.as;i&&(oe*=h.tilePixelRatio/f);const{width:ge,height:xe,anchor:Oe,textOffset:Ie,textBoxScale:Le}=W,Ye=cs(Oe,ge,xe,Ie,Le,oe),Ue=s.getPitchedTextCorrection(ee.x+v[0],ee.y+v[1],A),Ne=x4(re.point,ie,e,Ye,-s.bearingInRadians,Ue),Qe=h.allowVerticalPlacement&&q.placedOrientation===c.ai.vertical?Math.PI/2:0;for(let yt=0;yt<q.numGlyphs;yt++)c.ak(R,Ne,Qe);y&&q.associatedIconIndex>=0&&(Y[q.associatedIconIndex]={shiftedAnchor:Ne,angle:Qe})}else Ni(q.numGlyphs,R)}if(y){F.clear();const Z=h.icon.placedSymbolArray;for(let q=0;q<Z.length;q++){const W=Z.get(q);if(W.hidden)Ni(W.numGlyphs,F);else{const ee=Y[q];if(ee)for(let ie=0;ie<W.numGlyphs;ie++)c.ak(F,ee.shiftedAnchor,ee.angle);else Ni(W.numGlyphs,F)}}h.icon.dynamicLayoutVertexBuffer.updateData(F)}h.text.dynamicLayoutVertexBuffer.updateData(R)}function v4(h,e,i){return i.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Z3(h,e,i,a,s,u,f,g,y,v,A,E,P){const R=h.context,F=R.gl,Y=h.transform,Z=g==="map",q=y==="map",W=g!=="viewport"&&i.layout.get("symbol-placement")!=="point",ee=Z&&!q&&!W,ie=!i.layout.get("symbol-sort-key").isConstant();let re=!1;const le=h.getDepthModeForSublayer(0,_t.ReadOnly),oe=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ge=[],xe=Y.getCircleRadiusCorrection();for(const Oe of a){const Ie=e.getTile(Oe),Le=Ie.getBucket(i);if(!Le)continue;const Ye=s?Le.text:Le.icon;if(!Ye||!Ye.segments.get().length||!Ye.hasVisibleVertices)continue;const Ue=Ye.programConfigurations.get(i.id),Ne=s||Le.sdfIcons,Qe=s?Le.textSizeData:Le.iconSizeData,yt=q||Y.pitch!==0,Bt=h.useProgram(v4(Ne,s,Le),Ue),yi=c.ah(Qe,Y.zoom),ii=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Oe);let oi,fi,Qt,ai,Yi=[0,0],Di=null;if(s)fi=Ie.glyphAtlasTexture,Qt=F.LINEAR,oi=Ie.glyphAtlasTexture.size,Le.iconsInText&&(Yi=Ie.imageAtlasTexture.size,Di=Ie.imageAtlasTexture,ai=yt||h.options.rotating||h.options.zooming||Qe.kind==="composite"||Qe.kind==="camera"?F.LINEAR:F.NEAREST);else{const mi=i.layout.get("icon-size").constantOr(0)!==1||Le.iconsNeedLinear;fi=Ie.imageAtlasTexture,Qt=Ne||h.options.rotating||h.options.zooming||mi||yt?F.LINEAR:F.NEAREST,oi=Ie.imageAtlasTexture.size}const er=c.at(Ie,1,h.transform.zoom),yr=ye(Z,h.transform,er),Bn=c.H();c.an(Bn,yr);const en=ce(q,Z,h.transform,er),Fn=c.au(Y,Ie,u,f),So=Y.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),ka=oe&&Le.hasTextData(),Ls=i.layout.get("icon-text-fit")!=="none"&&ka&&Le.hasIconData();if(W){const mi=h.style.map.terrain?(tr,ir)=>h.style.map.terrain.getElevation(Oe,tr,ir):null,qi=i.layout.get("text-rotation-alignment")==="map";Ve(Le,h,s,yr,Bn,q,v,qi,Oe.toUnwrapped(),Y.width,Y.height,Fn,mi)}const io=s&&oe||Ls,xr=W||io?ls:q?yr:h.transform.clipSpaceToPixelsMatrix,tn=Ne&&i.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mr;Mr=Ne?Le.iconsInText?a4(Qe.kind,yi,ee,q,W,io,h,xr,en,Fn,oi,Yi,xe):Rn(Qe.kind,yi,ee,q,W,io,h,xr,en,Fn,s,oi,0,xe):fa(Qe.kind,yi,ee,q,W,io,h,xr,en,Fn,s,oi,xe);const Ir={program:Bt,buffers:Ye,uniformValues:Mr,projectionData:So,atlasTexture:fi,atlasTextureIcon:Di,atlasInterpolation:Qt,atlasInterpolationIcon:ai,isSDF:Ne,hasHalo:tn};if(ie&&Le.canOverlap){re=!0;const mi=Ye.segments.get();for(const qi of mi)ge.push({segments:new c.aD([qi]),sortKey:qi.sortKey,state:Ir,terrainData:ii})}else ge.push({segments:Ye.segments,sortKey:0,state:Ir,terrainData:ii})}re&&ge.sort((Oe,Ie)=>Oe.sortKey-Ie.sortKey);for(const Oe of ge){const Ie=Oe.state;if(R.activeTexture.set(F.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,F.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(R.activeTexture.set(F.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),Ie.isSDF){const Le=Ie.uniformValues;Ie.hasHalo&&(Le.u_is_halo=1,b4(Ie.buffers,Oe.segments,i,h,Ie.program,le,A,E,Le,Ie.projectionData,Oe.terrainData)),Le.u_is_halo=0}b4(Ie.buffers,Oe.segments,i,h,Ie.program,le,A,E,Ie.uniformValues,Ie.projectionData,Oe.terrainData)}}function b4(h,e,i,a,s,u,f,g,y,v,A){const E=a.context;s.draw(E,E.gl.TRIANGLES,u,f,g,Ct.backCCW,y,A,v,i.id,h.layoutVertexBuffer,h.indexBuffer,e,i.paint,a.transform.zoom,h.programConfigurations.get(i.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function hs(h,e,i,a,s){const u=h.context,f=u.gl,g=Nt.disabled,y=new Jt([f.ONE,f.ONE],c.b4.transparent,[!0,!0,!0,!0]),v=e.getBucket(i);if(!v)return;const A=a.key;let E=i.heatmapFbos.get(A);E||(E=T4(u,e.tileSize,e.tileSize),i.heatmapFbos.set(A,E)),u.bindFramebuffer.set(E.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:c.b4.transparent});const P=v.programConfigurations.get(i.id),R=h.useProgram("heatmap",P,!s),F=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Y=h.style.map.terrain.getTerrainData(a);R.draw(u,f.TRIANGLES,_t.disabled,g,y,Ct.disabled,to(e,h.transform.zoom,i.paint.get("heatmap-intensity"),1),Y,F,i.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,i.paint,h.transform.zoom,P)}function w4(h,e,i,a,s){const u=h.context,f=u.gl,g=h.transform;u.setColorMode(h.colorModeForRenderPass());const y=S4(u,e),v=i.key,A=e.heatmapFbos.get(v);if(!A)return;u.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,A.colorAttachment.get()),u.activeTexture.set(f.TEXTURE1),y.bind(f.LINEAR,f.CLAMP_TO_EDGE);const E=g.getProjectionData({overscaledTileID:i,applyTerrainMatrix:s,applyGlobeMatrix:!a});h.useProgram("heatmapTexture").draw(u,f.TRIANGLES,_t.disabled,Nt.disabled,h.colorModeForRenderPass(),Ct.disabled,i4(h,e,0,1),null,E,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,g.zoom),A.destroy(),e.heatmapFbos.delete(v)}function T4(h,e,i){var a,s;const u=h.gl,f=u.createTexture();u.bindTexture(u.TEXTURE_2D,f),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR);const g=(a=h.HALF_FLOAT)!==null&&a!==void 0?a:u.UNSIGNED_BYTE,y=(s=h.RGBA16F)!==null&&s!==void 0?s:u.RGBA;u.texImage2D(u.TEXTURE_2D,0,y,e,i,0,u.RGBA,g,null);const v=h.createFramebuffer(e,i,!1,!1);return v.colorAttachment.set(f),v}function S4(h,e){return e.colorRampTexture||(e.colorRampTexture=new we(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function ya(h,e,i,a,s){if(!i||!a||!a.imageAtlas)return;const u=a.imageAtlas.patternPositions;let f=u[i.to.toString()],g=u[i.from.toString()];if(!f&&g&&(f=g),!g&&f&&(g=f),!f||!g){const y=s.getPaintProperty(e);f=u[y],g=u[y]}f&&g&&h.setConstantPatternPositions(f,g)}function us(h,e,i,a,s,u,f,g){const y=h.context.gl,v="fill-pattern",A=i.paint.get(v),E=A&&A.constantOr(1),P=i.getCrossfadeParameters();let R,F,Y,Z,q;const W=h.transform,ee=i.paint.get("fill-translate"),ie=i.paint.get("fill-translate-anchor");f?(F=E&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=y.LINES):(F=E?"fillPattern":"fill",R=y.TRIANGLES);const re=A.constantOr(null);for(const le of a){const oe=e.getTile(le);if(E&&!oe.patternsLoaded())continue;const ge=oe.getBucket(i);if(!ge)continue;const xe=ge.programConfigurations.get(i.id),Oe=h.useProgram(F,xe),Ie=h.style.map.terrain&&h.style.map.terrain.getTerrainData(le);E&&(h.context.activeTexture.set(y.TEXTURE0),oe.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),xe.updatePaintBuffers(P)),ya(xe,v,re,oe,i);const Le=W.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!g,applyTerrainMatrix:!0}),Ye=c.au(W,oe,ee,ie);if(f){Z=ge.indexBuffer2,q=ge.segments2;const Ne=[y.drawingBufferWidth,y.drawingBufferHeight];Y=F==="fillOutlinePattern"&&E?e4(h,P,oe,Ne,Ye):M3(Ne,Ye)}else Z=ge.indexBuffer,q=ge.segments,Y=E?P3(h,P,oe,Ye):{u_fill_translate:Ye};let Ue;if(h.renderPass==="translucent"&&g){const[Ne]=h.getStencilConfigForOverlapAndUpdateStencilID(a);Ue=Ne[le.overscaledZ]}else Ue=h.stencilModeForClipping(le);Oe.draw(h.context,R,s,Ue,u,Ct.backCCW,Y,Ie,Le,i.id,ge.layoutVertexBuffer,Z,q,i.paint,h.transform.zoom,xe)}}function C4(h,e,i,a,s,u,f,g){const y=h.context,v=y.gl,A="fill-extrusion-pattern",E=i.paint.get(A),P=E.constantOr(1),R=i.getCrossfadeParameters(),F=i.paint.get("fill-extrusion-opacity"),Y=E.constantOr(null),Z=h.transform;for(const q of a){const W=e.getTile(q),ee=W.getBucket(i);if(!ee)continue;const ie=h.style.map.terrain&&h.style.map.terrain.getTerrainData(q),re=ee.programConfigurations.get(i.id),le=h.useProgram(P?"fillExtrusionPattern":"fillExtrusion",re);P&&(h.context.activeTexture.set(v.TEXTURE0),W.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),re.updatePaintBuffers(R));const oe=Z.getProjectionData({overscaledTileID:q,applyGlobeMatrix:!g,applyTerrainMatrix:!0});ya(re,A,Y,W,i);const ge=c.au(Z,W,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),xe=i.paint.get("fill-extrusion-vertical-gradient"),Oe=P?L3(h,xe,F,ge,q,R,W):E3(h,xe,F,ge);le.draw(y,y.gl.TRIANGLES,s,u,f,Ct.backCCW,Oe,ie,oe,i.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,i.paint,h.transform.zoom,re,h.style.map.terrain&&ee.centroidVertexBuffer)}}function ps(h,e,i,a,s,u,f,g,y){var v;const A=h.style.projection,E=h.context,P=h.transform,R=E.gl,F=h.useProgram("hillshade"),Y=!h.options.moving;for(const Z of a){const q=e.getTile(Z),W=q.fbo;if(!W)continue;const ee=A.getMeshFromTileID(E,Z.canonical,g,!0,"raster"),ie=(v=h.style.map.terrain)===null||v===void 0?void 0:v.getTerrainData(Z);E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,W.colorAttachment.get());const re=P.getProjectionData({overscaledTileID:Z,aligned:Y,applyGlobeMatrix:!y,applyTerrainMatrix:!0});F.draw(E,R.TRIANGLES,u,s[Z.overscaledZ],f,Ct.backCCW,k3(h,q,i),ie,re,i.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}const bi=[new c.P(0,0),new c.P(c.X,0),new c.P(c.X,c.X),new c.P(0,c.X)];function Dn(h,e,i,a,s,u,f,g,y=!1,v=!1){const A=a[a.length-1].overscaledZ,E=h.context,P=E.gl,R=h.useProgram("raster"),F=h.transform,Y=h.style.projection,Z=h.colorModeForRenderPass(),q=!h.options.moving;for(const W of a){const ee=h.getDepthModeForSublayer(W.overscaledZ-A,i.paint.get("raster-opacity")===1?_t.ReadWrite:_t.ReadOnly,P.LESS),ie=e.getTile(W);ie.registerFadeDuration(i.paint.get("raster-fade-duration"));const re=e.findLoadedParent(W,0),le=e.findLoadedSibling(W),oe=hn(ie,re||le||null,e,i,h.transform,h.style.map.terrain);let ge,xe;const Oe=i.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;E.activeTexture.set(P.TEXTURE0),ie.texture.bind(Oe,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(P.TEXTURE1),re?(re.texture.bind(Oe,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),ge=Math.pow(2,re.tileID.overscaledZ-ie.tileID.overscaledZ),xe=[ie.tileID.canonical.x*ge%1,ie.tileID.canonical.y*ge%1]):ie.texture.bind(Oe,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),ie.texture.useMipmap&&E.extTextureFilterAnisotropic&&h.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const Ie=h.style.map.terrain&&h.style.map.terrain.getTerrainData(W),Le=F.getProjectionData({overscaledTileID:W,aligned:q,applyGlobeMatrix:!v,applyTerrainMatrix:!0}),Ye=o4(xe||[0,0],ge||1,oe,i,g),Ue=Y.getMeshFromTileID(E,W.canonical,u,f,"raster");R.draw(E,P.TRIANGLES,ee,s?s[W.overscaledZ]:Nt.disabled,Z,y?Ct.frontCCW:Ct.backCCW,Ye,Ie,Le,i.id,Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)}}function hn(h,e,i,a,s,u){const f=a.paint.get("raster-fade-duration");if(!u&&f>0){const g=fe.now(),y=(g-h.timeAdded)/f,v=e?(g-e.timeAdded)/f:-1,A=i.getSource(),E=Dr(s,{tileSize:A.tileSize,roundZoom:A.roundZoom}),P=!e||Math.abs(e.tileID.overscaledZ-E)>Math.abs(h.tileID.overscaledZ-E),R=P&&h.refreshedUponExpiration?1:c.ab(P?y:1-v,0,1);return h.refreshedUponExpiration&&y>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}const A4=new c.b4(1,0,0,1),E4=new c.b4(0,1,0,1),Y3=new c.b4(0,0,1,1),Vo=new c.b4(1,0,1,1),xa=new c.b4(0,1,1,1);function ds(h,e,i,a){va(h,0,e+i/2,h.transform.width,i,a)}function L4(h,e,i,a){va(h,e-i/2,0,i,h.transform.height,a)}function va(h,e,i,a,s,u){const f=h.context,g=f.gl;g.enable(g.SCISSOR_TEST),g.scissor(e*h.pixelRatio,i*h.pixelRatio,a*h.pixelRatio,s*h.pixelRatio),f.clear({color:u}),g.disable(g.SCISSOR_TEST)}function q3(h,e,i){const a=h.context,s=a.gl,u=h.useProgram("debug"),f=_t.disabled,g=Nt.disabled,y=h.colorModeForRenderPass(),v="$debug",A=h.style.map.terrain&&h.style.map.terrain.getTerrainData(i);a.activeTexture.set(s.TEXTURE0);const E=e.getTileByID(i.key).latestRawTileData,P=Math.floor((E&&E.byteLength||0)/1024),R=e.getTile(i).tileSize,F=512/Math.min(R,512)*(i.overscaledZ/h.transform.zoom)*.5;let Y=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(Y+=` => ${i.overscaledZ}`),function(q,W){q.initDebugOverlayCanvas();const ee=q.debugOverlayCanvas,ie=q.context.gl,re=q.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,ee.width,ee.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(W,5,5),re.strokeText(W,5,5),q.debugOverlayTexture.update(ee),q.debugOverlayTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}(h,`${Y} ${P}kB`);const Z=h.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});u.draw(a,s.TRIANGLES,f,g,Jt.alphaBlended,Ct.disabled,t4(c.b4.transparent,F),null,Z,v,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),u.draw(a,s.LINE_STRIP,f,g,y,Ct.disabled,t4(c.b4.red),A,Z,v,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function P4(h,e,i,a){const{isRenderingGlobe:s}=a,u=h.context,f=u.gl,g=h.transform,y=h.colorModeForRenderPass(),v=h.getDepthModeFor3D(),A=h.useProgram("terrain");u.bindFramebuffer.set(null),u.viewport.set([0,0,h.width,h.height]);for(const E of i){const P=e.getTerrainMesh(E.tileID),R=h.renderToTexture.getTexture(E),F=e.getTerrainData(E.tileID);u.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,R.texture);const Y=e.getMeshFrameDelta(g.zoom),Z=g.calculateFogMatrix(E.tileID.toUnwrapped()),q=pa(Y,Z,h.style.sky,g.pitch,s),W=g.getProjectionData({overscaledTileID:E.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});A.draw(u,f.TRIANGLES,v,Nt.disabled,y,Ct.backCCW,q,F,W,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}function M4(h,e){if(!e.mesh){const i=new c.aC;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const a=new c.aE;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),e.mesh=new Xr(h.createVertexBuffer(i,St.members),h.createIndexBuffer(a),c.aD.simpleSegment(0,0,i.length,a.length))}return e.mesh}class vo{constructor(e,i){this.context=new _4(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=B.maxUnderzooming+B.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ar}resize(e,i,a){if(this.width=Math.floor(e*a),this.height=Math.floor(i*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const s of this.style._order)this.style._layers[s].resize()}setup(){const e=this.context,i=new c.aC;i.emplaceBack(0,0),i.emplaceBack(c.X,0),i.emplaceBack(0,c.X),i.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(i,St.members),this.tileExtentSegments=c.aD.simpleSegment(0,0,4,2);const a=new c.aC;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,St.members),this.debugSegments=c.aD.simpleSegment(0,0,4,5);const s=new c.bT;s.emplaceBack(0,0,0,0),s.emplaceBack(c.X,0,c.X,0),s.emplaceBack(0,c.X,0,c.X),s.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(s,Qs.members),this.rasterBoundsSegments=c.aD.simpleSegment(0,0,4,2);const u=new c.aC;u.emplaceBack(0,0),u.emplaceBack(c.X,0),u.emplaceBack(0,c.X),u.emplaceBack(c.X,c.X),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(u,St.members),this.rasterBoundsSegmentsPosOnly=c.aD.simpleSegment(0,0,4,5);const f=new c.aC;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,St.members),this.viewportSegments=c.aD.simpleSegment(0,0,4,2);const g=new c.bU;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(g);const y=new c.aE;y.emplaceBack(1,0,2),y.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(y);const v=this.context.gl;this.stencilClearMode=new Nt({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO),this.tileExtentMesh=new Xr(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.bL(a,0,this.width,this.height,0,0,1),c.K(a,a,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const s={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,_t.disabled,this.stencilClearMode,Jt.disabled,Ct.disabled,null,null,s,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const s=this.context;s.setColorMode(Jt.disabled),s.setDepthMode(_t.disabled);const u={};for(const f of i)u[f.key]=this.nextStencilID++;this._renderTileMasks(u,i,a,!0),this._renderTileMasks(u,i,a,!1),this._tileClippingMaskIDs=u}_renderTileMasks(e,i,a,s){const u=this.context,f=u.gl,g=this.style.projection,y=this.transform,v=this.useProgram("clippingMask");for(const A of i){const E=e[A.key],P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),R=g.getMeshFromTileID(this.context,A.canonical,s,!0,"stencil"),F=y.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(u,f.TRIANGLES,_t.disabled,new Nt({func:f.ALWAYS,mask:0},E,255,f.KEEP,f.KEEP,f.REPLACE),Jt.disabled,a?Ct.disabled:Ct.backCCW,null,P,F,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,a=this.style.projection,s=this.transform,u=this.useProgram("depth"),f=this.getDepthModeFor3D(),g=V(s,{tileSize:s.tileSize});for(const y of g){const v=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y),A=a.getMeshFromTileID(this.context,y.canonical,!0,!0,"raster"),E=s.getProjectionData({overscaledTileID:y,applyGlobeMatrix:!0,applyTerrainMatrix:!0});u.draw(e,i.TRIANGLES,f,Nt.disabled,Jt.disabled,Ct.backCCW,null,v,E,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Nt({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new Nt({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,a=e.sort((f,g)=>g.overscaledZ-f.overscaledZ),s=a[a.length-1].overscaledZ,u=a[0].overscaledZ-s+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();const f={};for(let g=0;g<u;g++)f[g+s]=new Nt({func:i.GEQUAL,mask:255},g+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=u,[f,a]}return[{[s]:Nt.disabled},a]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,a=e.sort((f,g)=>g.overscaledZ-f.overscaledZ),s=a[a.length-1].overscaledZ,u=a[0].overscaledZ-s+1;if(this.clearStencil(),u>1){const f={},g={};for(let y=0;y<u;y++)f[y+s]=new Nt({func:i.GREATER,mask:255},u+1+y,255,i.KEEP,i.KEEP,i.REPLACE),g[y+s]=new Nt({func:i.GREATER,mask:255},1+y,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*u+1,[f,g,a]}return this.nextStencilID=3,[{[s]:new Nt({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[s]:new Nt({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Jt([e.CONSTANT_COLOR,e.ONE],new c.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jt.unblended:Jt.alphaBlended}getDepthModeForSublayer(e,i,a){if(!this.opaquePassEnabledForLayer())return _t.disabled;const s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new _t(a||this.context.gl.LEQUAL,i,[s,s])}getDepthModeFor3D(){return new _t(this.context.gl.LEQUAL,_t.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var a,s;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(fe.now()),this.imageManager.beginFrame();const u=this.style._order,f=this.style.sourceCaches,g={},y={},v={},A={isRenderingToTexture:!1,isRenderingGlobe:((a=e.projection)===null||a===void 0?void 0:a.transitionState)>0};for(const P in f){const R=f[P];R.used&&R.prepare(this.context),g[P]=R.getVisibleCoordinates(!1),y[P]=g[P].slice().reverse(),v[P]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<u.length;P++)if(this.style._layers[u[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of u){const R=this.style._layers[P];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const F=y[R.source];(R.type==="custom"||F.length)&&this.renderLayer(this,f[R.source],R,F,A)}if((s=this.style.projection)===null||s===void 0||s.updateGPUdependent({context:this.context,useProgram:P=>this.useProgram(P)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?c.b4.black:c.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(P,R){const F=P.context,Y=F.gl,Z=((le,oe,ge)=>{const xe=Math.cos(oe.rollInRadians),Oe=Math.sin(oe.rollInRadians),Ie=Xt(oe),Le=oe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(oe.width/2-Ie*Oe)*ge,(oe.height/2+Ie*xe)*ge],u_horizon_normal:[-Oe,xe],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*oe.height/2*ge,u_sky_blend:Le}})(R,P.style.map.transform,P.pixelRatio),q=new _t(Y.LEQUAL,_t.ReadWrite,[0,1]),W=Nt.disabled,ee=P.colorModeForRenderPass(),ie=P.useProgram("sky"),re=M4(F,R);ie.draw(F,Y.TRIANGLES,q,W,ee,Ct.disabled,Z,null,void 0,"sky",re.vertexBuffer,re.indexBuffer,re.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[u[this.currentLayer]],R=f[P.source],F=g[P.source];this._renderTileClippingMasks(P,F,!1),this.renderLayer(this,R,P,F,A)}this.renderPass="translucent";let E=!1;for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const P=this.style._layers[u[this.currentLayer]],R=f[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P,A))continue;this.opaquePassEnabledForLayer()||E||(E=!0,A.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const F=(P.type==="symbol"?v:y)[P.source];this._renderTileClippingMasks(P,g[P.source],!1),this.renderLayer(this,R,P,F,A)}if(A.isRenderingGlobe&&function(P,R,F){const Y=P.context,Z=Y.gl,q=P.useProgram("atmosphere"),W=new _t(Z.LEQUAL,_t.ReadOnly,[0,1]),ee=P.transform,ie=function(Le,Ye){const Ue=Le.properties.get("position"),Ne=[-Ue.x,-Ue.y,-Ue.z],Qe=c.aq(new Float64Array(16));return Le.properties.get("anchor")==="map"&&(c.aX(Qe,Qe,Ye.rollInRadians),c.aY(Qe,Qe,-Ye.pitchInRadians),c.aX(Qe,Qe,Ye.bearingInRadians),c.aY(Qe,Qe,Ye.center.lat*Math.PI/180),c.bj(Qe,Qe,-Ye.center.lng*Math.PI/180)),c.bS(Ne,Ne,Qe),Ne}(F,P.transform),re=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=R.properties.get("atmosphere-blend")*re.projectionTransition;if(le===0)return;const oe=Jr(ee.worldSize,ee.center.lat),ge=ee.inverseProjectionMatrix,xe=new Float64Array(4);xe[3]=1,c.al(xe,xe,ee.modelViewProjectionMatrix),xe[0]/=xe[3],xe[1]/=xe[3],xe[2]/=xe[3],xe[3]=1,c.al(xe,xe,ge),xe[0]/=xe[3],xe[1]/=xe[3],xe[2]/=xe[3],xe[3]=1;const Oe=((Le,Ye,Ue,Ne,Qe)=>({u_sun_pos:Le,u_atmosphere_blend:Ye,u_globe_position:Ue,u_globe_radius:Ne,u_inv_proj_matrix:Qe}))(ie,le,[xe[0],xe[1],xe[2]],oe,ge),Ie=M4(Y,R);q.draw(Y,Z.TRIANGLES,W,Nt.disabled,Jt.alphaBlended,Ct.disabled,Oe,null,null,"atmosphere",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const P=function(R,F){let Y=null;const Z=Object.values(R._layers).flatMap(ie=>ie.source&&!ie.isHidden(F)?[R.sourceCaches[ie.source]]:[]),q=Z.filter(ie=>ie.getSource().type==="vector"),W=Z.filter(ie=>ie.getSource().type!=="vector"),ee=ie=>{(!Y||Y.getSource().maxzoom<ie.getSource().maxzoom)&&(Y=ie)};return q.forEach(ie=>ee(ie)),Y||W.forEach(ie=>ee(ie)),Y}(this.style,this.transform.zoom);P&&function(R,F,Y){for(let Z=0;Z<Y.length;Z++)q3(R,F,Y[Z])}(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const R=P.transform.padding;ds(P,P.transform.height-(R.top||0),3,A4),ds(P,R.bottom||0,3,E4),L4(P,R.left||0,3,Y3),L4(P,P.transform.width-(R.right||0),3,Vo);const F=P.transform.centerPoint;(function(Y,Z,q,W){va(Y,Z-1,q-10,2,20,W),va(Y,Z-10,q-1,20,2,W)})(P,F.x,P.transform.height-F.y,xa)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let s=this.terrainFacilitator.dirty;s||(s=e?!c.bV(i,a):!c.bW(i,a)),s||(s=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),s&&(c.bX(i,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(u,f){const g=u.context,y=g.gl,v=u.transform,A=Jt.unblended,E=new _t(y.LEQUAL,_t.ReadWrite,[0,1]),P=f.sourceCache.getRenderableTiles(),R=u.useProgram("terrainDepth");g.bindFramebuffer.set(f.getFramebuffer("depth").framebuffer),g.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),g.clear({color:c.b4.transparent,depth:1});for(const F of P){const Y=f.getTerrainMesh(F.tileID),Z=f.getTerrainData(F.tileID),q=v.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),W={u_ele_delta:f.getMeshFrameDelta(v.zoom)};R.draw(g,y.TRIANGLES,E,Nt.disabled,A,Ct.backCCW,W,Z,q,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain),function(u,f){const g=u.context,y=g.gl,v=u.transform,A=Jt.unblended,E=new _t(y.LEQUAL,_t.ReadWrite,[0,1]),P=f.getCoordsTexture(),R=f.sourceCache.getRenderableTiles(),F=u.useProgram("terrainCoords");g.bindFramebuffer.set(f.getFramebuffer("coords").framebuffer),g.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),g.clear({color:c.b4.transparent,depth:1}),f.coordsIndex=[];for(const Y of R){const Z=f.getTerrainMesh(Y.tileID),q=f.getTerrainData(Y.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,P.texture);const W={u_terrain_coords_id:(255-f.coordsIndex.length)/255,u_texture:0,u_ele_delta:f.getMeshFrameDelta(v.zoom)},ee=v.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});F.draw(g,y.TRIANGLES,E,Nt.disabled,A,Ct.backCCW,W,q,ee,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),f.coordsIndex.push(Y.tileID.key)}g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain))}renderLayer(e,i,a,s,u){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(s||[]).length)&&(this.id=a.id,c.bY(a)?function(f,g,y,v,A,E){if(f.renderPass!=="translucent")return;const{isRenderingToTexture:P}=E,R=Nt.disabled,F=f.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Y,Z,q,W,ee,ie,re,le,oe){const ge=Z.transform,xe=Z.style.map.terrain,Oe=ee==="map",Ie=ie==="map";for(const Le of Y){const Ye=W.getTile(Le),Ue=Ye.getBucket(q);if(!Ue||!Ue.text||!Ue.text.segments.get().length)continue;const Ne=c.ah(Ue.textSizeData,ge.zoom),Qe=c.at(Ye,1,Z.transform.zoom),yt=ye(Oe,Z.transform,Qe),Bt=q.layout.get("icon-text-fit")!=="none"&&Ue.hasIconData();{const yi=Math.pow(2,ge.zoom-Ye.tileID.overscaledZ),ii=xe?(oi,fi)=>xe.getElevation(Le,oi,fi):null;a7(Ue,Oe,Ie,oe,ge,yt,yi,Ne,Bt,c.au(ge,Ye,re,le),Le.toUnwrapped(),ii)}}}(v,f,y,g,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),A),y.paint.get("icon-opacity").constantOr(1)!==0&&Z3(f,g,y,v,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),R,F,P),y.paint.get("text-opacity").constantOr(1)!==0&&Z3(f,g,y,v,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),R,F,P),g.map.showCollisionBoxes&&(y4(f,g,y,v,!0),y4(f,g,y,v,!1))}(e,i,a,s,this.style.placement.variableOffsets,u):c.bZ(a)?function(f,g,y,v,A){if(f.renderPass!=="translucent")return;const{isRenderingToTexture:E}=A,P=y.paint.get("circle-opacity"),R=y.paint.get("circle-stroke-width"),F=y.paint.get("circle-stroke-opacity"),Y=!y.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(R.constantOr(1)===0||F.constantOr(1)===0))return;const Z=f.context,q=Z.gl,W=f.transform,ee=f.getDepthModeForSublayer(0,_t.ReadOnly),ie=Nt.disabled,re=f.colorModeForRenderPass(),le=[],oe=W.getCircleRadiusCorrection();for(let ge=0;ge<v.length;ge++){const xe=v[ge],Oe=g.getTile(xe),Ie=Oe.getBucket(y);if(!Ie)continue;const Le=y.paint.get("circle-translate"),Ye=y.paint.get("circle-translate-anchor"),Ue=c.au(W,Oe,Le,Ye),Ne=Ie.programConfigurations.get(y.id),Qe=f.useProgram("circle",Ne),yt=Ie.layoutVertexBuffer,Bt=Ie.indexBuffer,yi=f.style.map.terrain&&f.style.map.terrain.getTerrainData(xe),ii={programConfiguration:Ne,program:Qe,layoutVertexBuffer:yt,indexBuffer:Bt,uniformValues:I3(f,Oe,y,Ue,oe),terrainData:yi,projectionData:W.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!E,applyTerrainMatrix:!0})};if(Y){const oi=Ie.segments.get();for(const fi of oi)le.push({segments:new c.aD([fi]),sortKey:fi.sortKey,state:ii})}else le.push({segments:Ie.segments,sortKey:0,state:ii})}Y&&le.sort((ge,xe)=>ge.sortKey-xe.sortKey);for(const ge of le){const{programConfiguration:xe,program:Oe,layoutVertexBuffer:Ie,indexBuffer:Le,uniformValues:Ye,terrainData:Ue,projectionData:Ne}=ge.state;Oe.draw(Z,q.TRIANGLES,ee,ie,re,Ct.backCCW,Ye,Ue,Ne,y.id,Ie,Le,ge.segments,y.paint,f.transform.zoom,xe)}}(e,i,a,s,u):c.b_(a)?function(f,g,y,v,A){if(y.paint.get("heatmap-opacity")===0)return;const E=f.context,{isRenderingToTexture:P,isRenderingGlobe:R}=A;if(f.style.map.terrain){for(const F of v){const Y=g.getTile(F);g.hasRenderableParent(F)||(f.renderPass==="offscreen"?hs(f,Y,y,F,R):f.renderPass==="translucent"&&w4(f,y,F,P,R))}E.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(F,Y,Z,q){const W=F.context,ee=W.gl,ie=F.transform,re=Nt.disabled,le=new Jt([ee.ONE,ee.ONE],c.b4.transparent,[!0,!0,!0,!0]);(function(oe,ge,xe){const Oe=oe.gl;oe.activeTexture.set(Oe.TEXTURE1),oe.viewport.set([0,0,ge.width/4,ge.height/4]);let Ie=xe.heatmapFbos.get(c.bP);Ie?(Oe.bindTexture(Oe.TEXTURE_2D,Ie.colorAttachment.get()),oe.bindFramebuffer.set(Ie.framebuffer)):(Ie=T4(oe,ge.width/4,ge.height/4),xe.heatmapFbos.set(c.bP,Ie))})(W,F,Z),W.clear({color:c.b4.transparent});for(let oe=0;oe<q.length;oe++){const ge=q[oe];if(Y.hasRenderableParent(ge))continue;const xe=Y.getTile(ge),Oe=xe.getBucket(Z);if(!Oe)continue;const Ie=Oe.programConfigurations.get(Z.id),Le=F.useProgram("heatmap",Ie),Ye=ie.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ue=ie.getCircleRadiusCorrection();Le.draw(W,ee.TRIANGLES,_t.disabled,re,le,Ct.backCCW,to(xe,ie.zoom,Z.paint.get("heatmap-intensity"),Ue),null,Ye,Z.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,Z.paint,ie.zoom,Ie)}W.viewport.set([0,0,F.width,F.height])}(f,g,y,v):f.renderPass==="translucent"&&function(F,Y){const Z=F.context,q=Z.gl;Z.setColorMode(F.colorModeForRenderPass());const W=Y.heatmapFbos.get(c.bP);W&&(Z.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,W.colorAttachment.get()),Z.activeTexture.set(q.TEXTURE1),S4(Z,Y).bind(q.LINEAR,q.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(Z,q.TRIANGLES,_t.disabled,Nt.disabled,F.colorModeForRenderPass(),Ct.disabled,i4(F,Y,0,1),null,null,Y.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,Y.paint,F.transform.zoom))}(f,y)}(e,i,a,s,u):c.b$(a)?function(f,g,y,v,A){if(f.renderPass!=="translucent")return;const{isRenderingToTexture:E}=A,P=y.paint.get("line-opacity"),R=y.paint.get("line-width");if(P.constantOr(1)===0||R.constantOr(1)===0)return;const F=f.getDepthModeForSublayer(0,_t.ReadOnly),Y=f.colorModeForRenderPass(),Z=y.paint.get("line-dasharray"),q=y.paint.get("line-pattern"),W=q.constantOr(1),ee=y.paint.get("line-gradient"),ie=y.getCrossfadeParameters(),re=W?"linePattern":Z?"lineSDF":ee?"lineGradient":"line",le=f.context,oe=le.gl,ge=f.transform;let xe=!0;for(const Oe of v){const Ie=g.getTile(Oe);if(W&&!Ie.patternsLoaded())continue;const Le=Ie.getBucket(y);if(!Le)continue;const Ye=Le.programConfigurations.get(y.id),Ue=f.context.program.get(),Ne=f.useProgram(re,Ye),Qe=xe||Ne.program!==Ue,yt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Oe),Bt=q.constantOr(null);if(Bt&&Ie.imageAtlas){const Qt=Ie.imageAtlas,ai=Qt.patternPositions[Bt.to.toString()],Yi=Qt.patternPositions[Bt.from.toString()];ai&&Yi&&Ye.setConstantPatternPositions(ai,Yi)}const yi=ge.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),ii=ge.getPixelScale(),oi=W?Jl(f,Ie,y,ii,ie):Z?R3(f,Ie,y,ii,Z,ie):ee?Kl(f,Ie,y,ii,Le.lineClipsArray.length):Fo(f,Ie,y,ii);if(W)le.activeTexture.set(oe.TEXTURE0),Ie.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ye.updatePaintBuffers(ie);else if(Z&&(Qe||f.lineAtlas.dirty))le.activeTexture.set(oe.TEXTURE0),f.lineAtlas.bind(le);else if(ee){const Qt=Le.gradients[y.id];let ai=Qt.texture;if(y.gradientVersion!==Qt.version){let Yi=256;if(y.stepInterpolant){const Di=g.getSource().maxzoom,er=Oe.canonical.z===Di?Math.ceil(1<<f.transform.maxZoom-Oe.canonical.z):1;Yi=c.ab(c.bQ(Le.maxLineLength/c.X*1024*er),256,le.maxTextureSize)}Qt.gradient=c.bR({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:Yi,image:Qt.gradient||void 0,clips:Le.lineClipsArray}),Qt.texture?Qt.texture.update(Qt.gradient):Qt.texture=new we(le,Qt.gradient,oe.RGBA),Qt.version=y.gradientVersion,ai=Qt.texture}le.activeTexture.set(oe.TEXTURE0),ai.bind(y.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}let fi;if(E){const[Qt]=f.getStencilConfigForOverlapAndUpdateStencilID(v);fi=Qt[Oe.overscaledZ]}else fi=f.stencilModeForClipping(Oe);Ne.draw(le,oe.TRIANGLES,F,fi,Y,Ct.disabled,oi,yt,yi,y.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,y.paint,f.transform.zoom,Ye,Le.layoutVertexBuffer2),xe=!1}}(e,i,a,s,u):c.c0(a)?function(f,g,y,v,A){const E=y.paint.get("fill-color"),P=y.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const{isRenderingToTexture:R}=A,F=f.colorModeForRenderPass(),Y=y.paint.get("fill-pattern"),Z=f.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&E.constantOr(c.b4.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Z){const q=f.getDepthModeForSublayer(1,f.renderPass==="opaque"?_t.ReadWrite:_t.ReadOnly);us(f,g,y,v,q,F,!1,R)}if(f.renderPass==="translucent"&&y.paint.get("fill-antialias")){const q=f.getDepthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,_t.ReadOnly);us(f,g,y,v,q,F,!0,R)}}(e,i,a,s,u):c.c1(a)?function(f,g,y,v,A){const E=y.paint.get("fill-extrusion-opacity");if(E===0)return;const{isRenderingToTexture:P}=A;if(f.renderPass==="translucent"){const R=new _t(f.context.gl.LEQUAL,_t.ReadWrite,f.depthRangeFor3D);if(E!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))C4(f,g,y,v,R,Nt.disabled,Jt.disabled,P),C4(f,g,y,v,R,f.stencilModeFor3D(),f.colorModeForRenderPass(),P);else{const F=f.colorModeForRenderPass();C4(f,g,y,v,R,Nt.disabled,F,P)}}}(e,i,a,s,u):c.c2(a)?function(f,g,y,v,A){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const{isRenderingToTexture:E}=A,P=f.context,R=f.style.projection.useSubdivision,F=f.getDepthModeForSublayer(0,_t.ReadOnly),Y=f.colorModeForRenderPass();if(f.renderPass==="offscreen")(function(Z,q,W,ee,ie,re,le){const oe=Z.context,ge=oe.gl;for(const xe of W){const Oe=q.getTile(xe),Ie=Oe.dem;if(!Ie||!Ie.data||!Oe.needsHillshadePrepare)continue;const Le=Ie.dim,Ye=Ie.stride,Ue=Ie.getPixels();if(oe.activeTexture.set(ge.TEXTURE1),oe.pixelStoreUnpackPremultiplyAlpha.set(!1),Oe.demTexture=Oe.demTexture||Z.getTileTexture(Ye),Oe.demTexture){const Qe=Oe.demTexture;Qe.update(Ue,{premultiply:!1}),Qe.bind(ge.NEAREST,ge.CLAMP_TO_EDGE)}else Oe.demTexture=new we(oe,Ue,ge.RGBA,{premultiply:!1}),Oe.demTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);oe.activeTexture.set(ge.TEXTURE0);let Ne=Oe.fbo;if(!Ne){const Qe=new we(oe,{width:Le,height:Le,data:null},ge.RGBA);Qe.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Ne=Oe.fbo=oe.createFramebuffer(Le,Le,!0,!1),Ne.colorAttachment.set(Qe.texture)}oe.bindFramebuffer.set(Ne.framebuffer),oe.viewport.set([0,0,Le,Le]),Z.useProgram("hillshadePrepare").draw(oe,ge.TRIANGLES,ie,re,le,Ct.disabled,da(Oe.tileID,Ie),null,null,ee.id,Z.rasterBoundsBuffer,Z.quadTriangleIndexBuffer,Z.rasterBoundsSegments),Oe.needsHillshadePrepare=!1}})(f,g,v,y,F,Nt.disabled,Y),P.viewport.set([0,0,f.width,f.height]);else if(f.renderPass==="translucent")if(R){const[Z,q,W]=f.stencilConfigForOverlapTwoPass(v);ps(f,g,y,W,Z,F,Y,!1,E),ps(f,g,y,W,q,F,Y,!0,E)}else{const[Z,q]=f.getStencilConfigForOverlapAndUpdateStencilID(v);ps(f,g,y,q,Z,F,Y,!1,E)}}(e,i,a,s,u):c.c3(a)?function(f,g,y,v,A){if(f.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!v.length)return;const{isRenderingToTexture:E}=A,P=g.getSource(),R=f.style.projection.useSubdivision;if(P instanceof Ui)Dn(f,g,y,v,null,!1,!1,P.tileCoords,P.flippedWindingOrder,E);else if(R){const[F,Y,Z]=f.stencilConfigForOverlapTwoPass(v);Dn(f,g,y,Z,F,!1,!0,bi,!1,E),Dn(f,g,y,Z,Y,!0,!0,bi,!1,E)}else{const[F,Y]=f.getStencilConfigForOverlapAndUpdateStencilID(v);Dn(f,g,y,Y,F,!1,!0,bi,!1,E)}}(e,i,a,s,u):c.c4(a)?function(f,g,y,v,A){const E=y.paint.get("background-color"),P=y.paint.get("background-opacity");if(P===0)return;const{isRenderingToTexture:R}=A,F=f.context,Y=F.gl,Z=f.style.projection,q=f.transform,W=q.tileSize,ee=y.paint.get("background-pattern");if(f.isPatternMissing(ee))return;const ie=!ee&&E.a===1&&P===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==ie)return;const re=Nt.disabled,le=f.getDepthModeForSublayer(0,ie==="opaque"?_t.ReadWrite:_t.ReadOnly),oe=f.colorModeForRenderPass(),ge=f.useProgram(ee?"backgroundPattern":"background"),xe=v||V(q,{tileSize:W,terrain:f.style.map.terrain});ee&&(F.activeTexture.set(Y.TEXTURE0),f.imageManager.bind(f.context));const Oe=y.getCrossfadeParameters();for(const Ie of xe){const Le=q.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ye=ee?l4(P,f,ee,{tileID:Ie,tileSize:W},Oe):s4(P,E),Ue=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Ie),Ne=Z.getMeshFromTileID(F,Ie.canonical,!1,!0,"raster");ge.draw(F,Y.TRIANGLES,le,re,oe,Ct.backCCW,Ye,Ue,Le,y.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)}}(e,0,a,s,u):c.c5(a)&&function(f,g,y,v){const{isRenderingGlobe:A}=v,E=f.context,P=y.implementation,R=f.style.projection,F=f.transform,Y=F.getProjectionDataForCustomLayer(A),Z={farZ:F.farZ,nearZ:F.nearZ,fov:F.fov*Math.PI/180,modelViewProjectionMatrix:F.modelViewProjectionMatrix,projectionMatrix:F.projectionMatrix,shaderData:{variantName:R.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${R.shaderPreludeCode.vertexSource}`,define:R.shaderDefine},defaultProjectionData:Y},q=P.renderingMode?P.renderingMode:"2d";if(f.renderPass==="offscreen"){const W=P.prerender;W&&(f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),W.call(P,E.gl,Z),E.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),E.setStencilMode(Nt.disabled);const W=q==="3d"?f.getDepthModeFor3D():f.getDepthModeForSublayer(0,_t.ReadOnly);E.setDepthMode(W),P.render(E.gl,Z),E.setDirty(),f.setBaseState(),E.bindFramebuffer.set(null)}}(e,0,a,u))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!i||!a}useProgram(e,i,a=!1){this.cache=this.cache||{};const s=!!this.style.map.terrain,u=this.style.projection,f=e+(i?i.cacheKey:"")+`/${a?No:u.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(s?"/terrain":"");return this.cache[f]||(this.cache[f]=new Wl(this.context,zr[e],i,h4[e],this._showOverdrawInspector,s,a?zr.projectionMercator:u.shaderPreludeCode,a?ho:u.shaderDefine)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function I4(h,e){let i,a=!1,s=null,u=null;const f=()=>{s=null,a&&(h.apply(u,i),s=setTimeout(f,e),a=!1)};return(...g)=>(a=!0,u=this,i=g,s||f(),s)}class O4{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(a=s)}),(a&&a[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const a=i.join("/");let s=a;s.split("&").length>0&&(s=s.split("&")[0]),this._hashName&&(s=`${this._hashName}=${a}`);let u=window.location.hash.replace(s,"");u.startsWith("#&")?u=u.slice(0,1)+u.slice(2):u==="#"&&(u="");let f=window.location.href.replace(/(#.+)?$/,u);f=f.replace("&&","&"),window.history.replaceState(window.history.state,null,f)},this._updateHash=I4(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,s=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,s),f=Math.round(i.lng*u)/u,g=Math.round(i.lat*u)/u,y=this._map.getBearing(),v=this._map.getPitch();let A="";if(A+=e?`/${f}/${g}/${a}`:`${a}/${g}/${f}`,(y||v)&&(A+="/"+Math.round(10*y)/10),v&&(A+=`/${Math.round(v)}`),this._hashName){const E=this._hashName;let P=!1;const R=window.location.hash.slice(1).split("&").map(F=>{const Y=F.split("=")[0];return Y===E?(P=!0,`${Y}=${A}`):F}).filter(F=>F);return P||R.push(`${E}=${A}`),`#${R.join("&")}`}return`#${A}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.N(+e[2],+e[1])}catch{return!1}const i=+e[0],a=+(e[3]||0),s=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&a>=0&&a<=180&&s>=this._map.getMinPitch()&&s<=this._map.getMaxPitch()}}const Zo={linearity:.3,easing:c.c6(0,0,.3,1)},$3=c.e({deceleration:2500,maxSpeed:1400},Zo),W3=c.e({deceleration:20,maxSpeed:1400},Zo),X3=c.e({deceleration:1e3,maxSpeed:360},Zo),K3=c.e({deceleration:1e3,maxSpeed:90},Zo),ba=c.e({deceleration:1e3,maxSpeed:360},Zo);class J3{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:fe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=fe.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)i.zoom+=u.zoomDelta||0,i.bearing+=u.bearingDelta||0,i.pitch+=u.pitchDelta||0,i.roll+=u.rollDelta||0,u.panDelta&&i.pan._add(u.panDelta),u.around&&(i.around=u.around),u.pinchAround&&(i.pinchAround=u.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(i.pan.mag()){const u=Fr(i.pan.mag(),a,c.e({},$3,e||{})),f=i.pan.mult(u.amount/i.pan.mag()),g=this._map.cameraHelper.handlePanInertia(f,this._map.transform);s.center=g.easingCenter,s.offset=g.easingOffset,Lr(s,u)}if(i.zoom){const u=Fr(i.zoom,a,W3);s.zoom=this._map.transform.zoom+u.amount,Lr(s,u)}if(i.bearing){const u=Fr(i.bearing,a,X3);s.bearing=this._map.transform.bearing+c.ab(u.amount,-179,179),Lr(s,u)}if(i.pitch){const u=Fr(i.pitch,a,K3);s.pitch=this._map.transform.pitch+u.amount,Lr(s,u)}if(i.roll){const u=Fr(i.roll,a,ba);s.roll=this._map.transform.roll+c.ab(u.amount,-179,179),Lr(s,u)}if(s.zoom||s.bearing){const u=i.pinchAround===void 0?i.around:i.pinchAround;s.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),c.e(s,{noMoveStart:!0})}}function Lr(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function Fr(h,e,i){const{maxSpeed:a,linearity:s,deceleration:u}=i,f=c.ab(h*s/(e/1e3),-a,a),g=Math.abs(f)/(u*s);return{easing:i.easing,duration:1e3*g,amount:f*(g/2)}}class Gr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a,s={}){const u=te.mousePos(i.getCanvas(),a),f=i.unproject(u);super(e,c.e({point:u,lngLat:f,originalEvent:a},s)),this._defaultPrevented=!1,this.target=i}}class Ur extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){const s=e==="touchend"?a.changedTouches:a.touches,u=te.touchPos(i.getCanvasContainer(),s),f=u.map(y=>i.unproject(y)),g=u.reduce((y,v,A,E)=>y.add(v.div(E.length)),new c.P(0,0));super(e,{points:u,point:g,lngLats:f,lngLat:i.unproject(g),originalEvent:a}),this._defaultPrevented=!1}}class bo extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class s7{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new bo(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new Gr(e.type,this._map,e))}mouseup(e){this._map.fire(new Gr(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new Gr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Gr(e.type,this._map,e))}mouseover(e){this._map.fire(new Gr(e.type,this._map,e))}mouseout(e){this._map.fire(new Gr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ur(e.type,this._map,e))}touchmove(e){this._map.fire(new Ur(e.type,this._map,e))}touchend(e){this._map.fire(new Ur(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ur(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class l7{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Gr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Gr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wa{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class Q3{constructor(e,i){this._map=e,this._tr=new wa(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(te.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const a=i;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const s=this._startPos;this._lastPos=a,this._box||(this._box=te.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const u=Math.min(s.x,a.x),f=Math.max(s.x,a.x),g=Math.min(s.y,a.y),y=Math.max(s.y,a.y);te.setTransform(this._box,`translate(${u}px,${g}px)`),this._box.style.width=f-u+"px",this._box.style.height=y-g+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const a=this._startPos,s=i;if(this.reset(),te.suppressClick(),a.x!==s.x||a.y!==s.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:u=>u.fitScreenCoordinates(a,s,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new c.k(e,{originalEvent:i}))}}function fs(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);const i={};for(let a=0;a<h.length;a++)i[h[a].identifier]=e[a];return i}class Ta{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(s){const u=new c.P(0,0);for(const f of s)u._add(f);return u.div(s.length)}(i),this.touches=fs(a,i)))}touchmove(e,i,a){if(this.aborted||!this.centroid)return;const s=fs(a,i);for(const u in this.touches){const f=s[u];(!f||f.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(e,i,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class xn{constructor(e){this.singleTap=new Ta(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,a){this.singleTap.touchstart(e,i,a)}touchmove(e,i,a){this.singleTap.touchmove(e,i,a)}touchend(e,i,a){const s=this.singleTap.touchend(e,i,a);if(s){const u=e.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(s)<30;if(u&&f||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class We{constructor(e){this._tr=new wa(e),this._zoomIn=new xn({numTouches:1,numTaps:2}),this._zoomOut=new xn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,a){this._zoomIn.touchstart(e,i,a),this._zoomOut.touchstart(e,i,a)}touchmove(e,i,a){this._zoomIn.touchmove(e,i,a),this._zoomOut.touchmove(e,i,a)}touchend(e,i,a){const s=this._zoomIn.touchend(e,i,a),u=this._zoomOut.touchend(e,i,a),f=this._tr;return s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:f.zoom+1,around:f.unproject(s)},{originalEvent:e})}):u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:f.zoom-1,around:f.unproject(u)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const s=Array.isArray(i)?i[0]:i;return!this._moved&&s.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=s,this._move(a,s))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&te.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const N4={0:1,2:2};class qo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=te.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,a){const s=N4[a];return i.buttons===void 0||(i.buttons&s)!==s}(e,this._eventButton)}isValidEndEvent(e){return te.mouseButton(e)===this._eventButton}}class Sa{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Ca{constructor(e=new qo({checkCorrectEvent:()=>!0}),i=new Sa){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,a){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?a(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const Aa=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class It{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,a){return this._calculateTransform(e,i,a)}touchmove(e,i,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,i,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,a){this._calculateTransform(e,i,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,a){a.length>0&&(this._active=!0);const s=fs(a,i),u=new c.P(0,0),f=new c.P(0,0);let g=0;for(const v in s){const A=s[v],E=this._touches[v];E&&(u._add(A),f._add(A.sub(E)),g++,s[v]=A)}if(this._touches=s,this._shouldBePrevented(g)||!f.mag())return;const y=f.div(g);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(g),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ea{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,a){if(!this._firstTwoTouches)return;e.preventDefault();const[s,u]=this._firstTwoTouches,f=ms(a,i,s),g=ms(a,i,u);if(!f||!g)return;const y=this._aroundCenter?null:f.add(g).div(2);return this._move([f,g],y,e)}touchend(e,i,a){if(!this._firstTwoTouches)return;const[s,u]=this._firstTwoTouches,f=ms(a,i,s),g=ms(a,i,u);f&&g||(this._active&&te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ms(h,e,i){for(let a=0;a<h.length;a++)if(h[a].identifier===i)return e[a]}function gs(h,e){return Math.log(h/e)/Math.LN2}class el extends Ea{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(gs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gs(this._distance,a),pinchAround:i}}}function tl(h,e){return 180*h.angleWith(e)/Math.PI}class k4 extends Ea{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,a){const s=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tl(this._vector,s),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,a=tl(e,this._startVector);return Math.abs(a)<i}}function La(h){return Math.abs(h.y)>Math.abs(h.x)}class R4 extends Ea{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,a){super.touchstart(e,i,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,La(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const s=e[0].sub(this._lastPoints[0]),u=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(s,u,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+u.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,a){if(this._valid!==void 0)return this._valid;const s=e.mag()>=2,u=i.mag()>=2;if(!s&&!u)return;if(!s||!u)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const f=e.y>0==i.y>0;return La(e)&&La(i)&&f}}const c7={panStep:100,bearingStep:15,pitchStep:10};class D4{constructor(e){this._tr=new wa(e);const i=c7;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,a=0,s=0,u=0,f=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),u=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),u=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),f=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(a=0,s=0),{cameraAnimation:g=>{const y=this._tr;g.easeTo({duration:300,easeId:"keyboardHandler",easing:h7,zoom:i?Math.round(y.zoom)+i*(e.shiftKey?2:1):y.zoom,bearing:y.bearing+a*this._bearingStep,pitch:y.pitch+s*this._pitchStep,offset:[-u*this._panStep,-f*this._panStep],center:y.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function h7(h){return h*(2-h)}const il=4.000244140625;class Zn{constructor(e,i){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new wa(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=fe.now(),s=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,i!==0&&i%il==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=te.mousePos(this._map.getCanvas(),e),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(c.N.convert(a.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const g=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=g),typeof this._targetZoom=="number"&&(this._targetZoom+=g)}if(this._delta!==0){const g=this._type==="wheel"&&Math.abs(this._delta)>il?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&y!==0&&(y=1/y);const v=typeof this._targetZoom!="number"?e.scale:c.aG(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,c.a8(v*y))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,a=this._startZoom,s=this._easing;let u,f=!1;if(this._type==="wheel"&&a&&s){const g=fe.now()-this._lastWheelEventTime,y=Math.min((g+5)/200,1),v=s(y);u=c.y.number(a,i,v),y<1?this._frameId||(this._frameId=!0):f=!0}else u=i,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=u,{noInertia:!0,needsRenderFrame:!f,zoomDelta:u-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=c.c8;if(this._prevEase){const a=this._prevEase,s=(fe.now()-a.start)/a.duration,u=a.easing(s+.01)-a.easing(s),f=.27/Math.sqrt(u*u+1e-4)*.01,g=Math.sqrt(.0729-f*f);i=c.c6(f,g,.25,1)}return this._prevEase={start:fe.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class pi{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _s{constructor(e){this._tr=new wa(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class z4{constructor(){this._tap=new xn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,a){if(!this._swipePoint)if(this._tapTime){const s=i[0],u=e.timeStamp-this._tapTime<500,f=this._tapPoint.dist(s)<30;u&&f?a.length>0&&(this._swipePoint=s,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,i,a)}touchmove(e,i,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const s=i[0],u=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(e,i,a)}touchend(e,i,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const s=this._tap.touchend(e,i,a);s&&(this._tapTime=e.timeStamp,this._tapPoint=s)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class B4{constructor(e,i,a){this._el=e,this._mousePan=i,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class F4{constructor(e,i,a,s){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=a,this._mouseRoll=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class G4{constructor(e,i,a,s){this._el=e,this._touchZoom=i,this._touchRotate=a,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class rl{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=te.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),s=document.createElement("div");s.className="maplibregl-desktop-message",s.textContent=i,this._container.appendChild(s);const u=document.createElement("div");u.className="maplibregl-mobile-message",u.textContent=a,this._container.appendChild(u),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(te.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Qr=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class ys extends c.k{}function rt(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class pt{constructor(e,i){this.handleWindowEvent=s=>{this.handleEvent(s,`${s.type}Window`)},this.handleEvent=(s,u)=>{if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=s.type==="renderFrame"?void 0:s,g={needsRenderFrame:!1},y={},v={},A=s.touches,E=A?this._getMapTouches(A):void 0,P=E?te.touchPos(this._map.getCanvas(),E):te.mousePos(this._map.getCanvas(),s);for(const{handlerName:Y,handler:Z,allowed:q}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(v,q,Y)?Z.reset():Z[u||s.type]&&(W=Z[u||s.type](s,P,E),this.mergeHandlerResult(g,y,W,Y,f),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(v[Y]=Z)}const R={};for(const Y in this._previousActiveHandlers)v[Y]||(R[Y]=f);this._previousActiveHandlers=v,(Object.keys(R).length||rt(g))&&(this._changes.push([g,y,R]),this._triggerRenderFrame()),(Object.keys(v).length||rt(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=g;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new J3(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[s,u,f]of this._listeners)te.addEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(const[e,i,a]of this._listeners)te.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const i=this._map,a=i.getCanvasContainer();this._add("mapEvent",new s7(i,e));const s=i.boxZoom=new Q3(i,e);this._add("boxZoom",s),e.interactive&&e.boxZoom&&s.enable();const u=i.cooperativeGestures=new rl(i,e.cooperativeGestures);this._add("cooperativeGestures",u),e.cooperativeGestures&&u.enable();const f=new We(i),g=new _s(i);i.doubleClickZoom=new pi(g,f),this._add("tapZoom",f),this._add("clickZoom",g),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const y=new z4;this._add("tapDragZoom",y);const v=i.touchPitch=new R4(i);this._add("touchPitch",v),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const A=()=>i.project(i.getCenter()),E=function({enable:ie,clickTolerance:re,aroundCenter:le=!0,minPixelCenterThreshold:oe=100,rotateDegreesPerPixelMoved:ge=.8},xe){const Oe=new qo({checkCorrectEvent:Ie=>te.mouseButton(Ie)===0&&Ie.ctrlKey||te.mouseButton(Ie)===2&&!Ie.ctrlKey});return new Yo({clickTolerance:re,move:(Ie,Le)=>{const Ye=xe();if(le&&Math.abs(Ye.y-Ie.y)>oe)return{bearingDelta:c.c7(new c.P(Ie.x,Le.y),Le,Ye)};let Ue=(Le.x-Ie.x)*ge;return le&&Le.y<Ye.y&&(Ue=-Ue),{bearingDelta:Ue}},moveStateManager:Oe,enable:ie,assignEvents:Aa})}(e,A),P=function({enable:ie,clickTolerance:re,pitchDegreesPerPixelMoved:le=-.5}){const oe=new qo({checkCorrectEvent:ge=>te.mouseButton(ge)===0&&ge.ctrlKey||te.mouseButton(ge)===2});return new Yo({clickTolerance:re,move:(ge,xe)=>({pitchDelta:(xe.y-ge.y)*le}),moveStateManager:oe,enable:ie,assignEvents:Aa})}(e),R=function({enable:ie,clickTolerance:re,rollDegreesPerPixelMoved:le=.3},oe){const ge=new qo({checkCorrectEvent:xe=>te.mouseButton(xe)===2&&xe.ctrlKey});return new Yo({clickTolerance:re,move:(xe,Oe)=>{const Ie=oe();let Le=(Oe.x-xe.x)*le;return Oe.y<Ie.y&&(Le=-Le),{rollDelta:Le}},moveStateManager:ge,enable:ie,assignEvents:Aa})}(e,A);i.dragRotate=new F4(e,E,P,R),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",P,["mouseRotate","mouseRoll"]),this._add("mouseRoll",R,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const F=function({enable:ie,clickTolerance:re}){const le=new qo({checkCorrectEvent:oe=>te.mouseButton(oe)===0&&!oe.ctrlKey});return new Yo({clickTolerance:re,move:(oe,ge)=>({around:ge,panDelta:ge.sub(oe)}),activateOnStart:!0,moveStateManager:le,enable:ie,assignEvents:Aa})}(e),Y=new It(e,i);i.dragPan=new B4(a,F,Y),this._add("mousePan",F),this._add("touchPan",Y,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const Z=new k4,q=new el;i.touchZoomRotate=new G4(a,q,Z,y),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const W=i.scrollZoom=new Zn(i,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const ee=i.keyboard=new D4(i);this._add("keyboard",ee),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new l7(i))}_add(e,i,a){this._handlers.push({handlerName:e,handler:i,allowed:a}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,a){for(const s in e)if(s!==a&&(!i||i.indexOf(s)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const a of e)this._el.contains(a.target)&&i.push(a);return i}mergeHandlerResult(e,i,a,s,u){if(!a)return;c.e(e,a);const f={handlerName:s,originalEvent:a.originalEvent||u};a.zoomDelta!==void 0&&(i.zoom=f),a.panDelta!==void 0&&(i.drag=f),a.rollDelta!==void 0&&(i.roll=f),a.pitchDelta!==void 0&&(i.pitch=f),a.bearingDelta!==void 0&&(i.rotate=f)}_applyChanges(){const e={},i={},a={};for(const[s,u,f]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),s.rollDelta&&(e.rollDelta=(e.rollDelta||0)+s.rollDelta),s.around!==void 0&&(e.around=s.around),s.pinchAround!==void 0&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),c.e(i,u),c.e(a,f);this._updateMapTransform(e,i,a),this._changes=[]}_updateMapTransform(e,i,a){const s=this._map,u=s._getTransformForUpdate(),f=s.terrain;if(!(rt(e)||f&&this._terrainMovement))return this._fireEvents(i,a,!0);s._stop(!0);let{panDelta:g,zoomDelta:y,bearingDelta:v,pitchDelta:A,rollDelta:E,around:P,pinchAround:R}=e;R!==void 0&&(P=R),P=P||s.transform.centerPoint,f&&!u.isPointOnMapSurface(P)&&(P=u.centerPoint);const F={panDelta:g,zoomDelta:y,rollDelta:E,pitchDelta:A,bearingDelta:v,around:P};this._map.cameraHelper.useGlobeControls&&!u.isPointOnMapSurface(P)&&(P=u.centerPoint);const Y=P.distSqr(u.centerPoint)<.01?u.center:u.screenPointToLocation(g?P.sub(g):P);f?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(F,u),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?u.setCenter(u.screenPointToLocation(u.centerPoint.sub(g))):this._map.cameraHelper.handleMapControlsPan(F,u,Y):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(F,u,Y))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(F,u),this._map.cameraHelper.handleMapControlsPan(F,u,Y)),s._applyUpdatedTransform(u),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,a,!0)}_fireEvents(e,i,a){const s=Qr(this._eventsInProgress),u=Qr(e),f={};for(const E in e){const{originalEvent:P}=e[E];this._eventsInProgress[E]||(f[`${E}start`]=P),this._eventsInProgress[E]=e[E]}!s&&u&&this._fireEvent("movestart",u.originalEvent);for(const E in f)this._fireEvent(E,f[E]);u&&this._fireEvent("move",u.originalEvent);for(const E in e){const{originalEvent:P}=e[E];this._fireEvent(E,P)}const g={};let y;for(const E in this._eventsInProgress){const{handlerName:P,originalEvent:R}=this._eventsInProgress[E];this._handlersById[P].isActive()||(delete this._eventsInProgress[E],y=i[P]||R,g[`${E}end`]=y)}for(const E in g)this._fireEvent(E,g[E]);const v=Qr(this._eventsInProgress),A=(s||u)&&!v;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const E=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&E.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(E)}if(a&&A){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;!E||!E.essential&&fe.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:y})),P(this._map.getBearing())&&this._map.resetNorth()):(P(E.bearing||this._map.getBearing())&&(E.bearing=0),E.freezeElevation=!0,this._map.easeTo(E,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new c.k(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new ys("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xs extends c.E{constructor(e,i,a){super(),this._renderFrameCallback=()=>{const s=Math.min((fe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},i),a)}panTo(e,i,a){return this.easeTo(c.e({center:e},i),a)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,a){return this.easeTo(c.e({zoom:e},i),a)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.k("movestart",i)).fire(new c.k("move",i)).fire(new c.k("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,a){return this.easeTo(c.e({bearing:e},i),a)}resetNorth(e,i){return this.rotateTo(0,c.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=_i.convert(e).adjustAntiMeridian();const a=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,i)}_cameraForBoxAndBearing(e,i,a,s){const u={top:0,bottom:0,right:0,left:0};if(typeof(s=c.e({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const v=s.padding;s.padding={top:v,bottom:v,right:v,left:v}}const f=c.e(u,s.padding);s.padding=f;const g=this.transform,y=new _i(e,i);return this.cameraHelper.cameraForBoxAndBearing(s,f,y,a,g)}fitBounds(e,i,a){return this._fitInternal(this.cameraForBounds(e,i),i,a)}fitScreenCoordinates(e,i,a,s,u){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(i)),a,s),s,u)}_fitInternal(e,i,a){return e?(delete(i=c.e(e,i)).padding,i.linear?this.easeTo(i,a):this.flyTo(i,a)):this}jumpTo(e,i){this.stop();const a=this._getTransformForUpdate();let s=!1,u=!1,f=!1;const g=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,e);const y=a.zoom!==g;return"elevation"in e&&a.elevation!==+e.elevation&&a.setElevation(+e.elevation),"bearing"in e&&a.bearing!==+e.bearing&&(s=!0,a.setBearing(+e.bearing)),"pitch"in e&&a.pitch!==+e.pitch&&(u=!0,a.setPitch(+e.pitch)),"roll"in e&&a.roll!==+e.roll&&(f=!0,a.setRoll(+e.roll)),e.padding==null||a.isPaddingEqual(e.padding)||a.setPadding(e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",i)).fire(new c.k("move",i)),y&&this.fire(new c.k("zoomstart",i)).fire(new c.k("zoom",i)).fire(new c.k("zoomend",i)),s&&this.fire(new c.k("rotatestart",i)).fire(new c.k("rotate",i)).fire(new c.k("rotateend",i)),u&&this.fire(new c.k("pitchstart",i)).fire(new c.k("pitch",i)).fire(new c.k("pitchend",i)),f&&this.fire(new c.k("rollstart",i)).fire(new c.k("roll",i)).fire(new c.k("rollend",i)),this.fire(new c.k("moveend",i))}calculateCameraOptionsFromTo(e,i,a,s=0){const u=c.Y.fromLngLat(e,i),f=c.Y.fromLngLat(a,s),g=f.x-u.x,y=f.y-u.y,v=f.z-u.z,A=Math.hypot(g,y,v);if(A===0)throw new Error("Can't calculate camera options with same From and To");const E=Math.hypot(g,y),P=c.a8(this.transform.cameraToCenterDistance/A/this.transform.tileSize),R=180*Math.atan2(g,-y)/Math.PI;let F=180*Math.acos(E/A)/Math.PI;return F=v<0?90-F:90+F,{center:f.toLngLat(),elevation:s,zoom:P,pitch:F,bearing:R}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,a,s,u){const f=this.transform.calculateCenterFromCameraLngLatAlt(e,i,a,s);return{center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:a,pitch:s,roll:u}}easeTo(e,i){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.c8},e)).animate===!1||!e.essential&&fe.prefersReducedMotion)&&(e.duration=0);const a=this._getTransformForUpdate(),s=this.getBearing(),u=a.pitch,f=a.roll,g="bearing"in e?this._normalizeBearing(e.bearing,s):s,y="pitch"in e?+e.pitch:u,v="roll"in e?this._normalizeBearing(e.roll,f):f,A="padding"in e?e.padding:a.padding,E=c.P.convert(e.offset);let P,R;e.around&&(P=c.N.convert(e.around),R=a.locationToScreenPoint(P));const F={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Y=this.cameraHelper.handleEaseTo(a,{bearing:g,pitch:y,roll:v,padding:A,around:P,aroundPoint:R,offsetAsPoint:E,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||s!==g,this._pitching=this._pitching||y!==u,this._rolling=this._rolling||v!==f,this._padding=!a.isPaddingEqual(A),this._zooming=this._zooming||Y.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,F),this.terrain&&this._prepareElevation(Y.elevationCenter),this._ease(Z=>{Y.easeFunc(Z),this.terrain&&!e.freezeElevation&&this._updateElevation(Z),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},Z=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,Z)},e),this}_prepareEase(e,i,a={}){this._moving=!0,i||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e)),this._rolling&&!a.rolling&&this.fire(new c.k("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(i-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(c.y.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),a=e.getCameraAltitude(),s=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(a<s){const u=this.calculateCameraOptionsFromTo(i,s,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(s=>this._elevateCameraIfInsideTerrain(s)),this.transformCameraUpdate&&i.push(s=>this.transformCameraUpdate(s)),!i.length)return;const a=e.clone();for(const s of i){const u=a.clone(),{center:f,zoom:g,roll:y,pitch:v,bearing:A,elevation:E}=s(u);f&&u.setCenter(f),E!==void 0&&u.setElevation(E),g!==void 0&&u.setZoom(g),y!==void 0&&u.setRoll(y),v!==void 0&&u.setPitch(v),A!==void 0&&u.setBearing(A),a.apply(u)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e)),this._rolling&&this.fire(new c.k("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const a=this._zooming,s=this._rotating,u=this._pitching,f=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),s&&this.fire(new c.k("rotateend",e)),u&&this.fire(new c.k("pitchend",e)),f&&this.fire(new c.k("rollend",e)),this.fire(new c.k("moveend",e))}flyTo(e,i){if(!e.essential&&fe.prefersReducedMotion){const Le=c.M(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Le,i)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.c8},e);const a=this._getTransformForUpdate(),s=a.bearing,u=a.pitch,f=a.roll,g=a.padding,y="bearing"in e?this._normalizeBearing(e.bearing,s):s,v="pitch"in e?+e.pitch:u,A="roll"in e?this._normalizeBearing(e.roll,f):f,E="padding"in e?e.padding:a.padding,P=c.P.convert(e.offset);let R=a.centerPoint.add(P);const F=a.screenPointToLocation(R),Y=this.cameraHelper.handleFlyTo(a,{bearing:y,pitch:v,roll:A,padding:E,locationAtOffset:F,offsetAsPoint:P,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let Z=e.curve;const q=Math.max(a.width,a.height),W=q/Y.scaleOfZoom,ee=Y.pixelPathLength;typeof Y.scaleOfMinZoom=="number"&&(Z=Math.sqrt(q/Y.scaleOfMinZoom/ee*2));const ie=Z*Z;function re(Le){const Ye=(W*W-q*q+(Le?-1:1)*ie*ie*ee*ee)/(2*(Le?W:q)*ie*ee);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function le(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function oe(Le){return(Math.exp(Le)+Math.exp(-Le))/2}const ge=re(!1);let xe=function(Le){return oe(ge)/oe(ge+Z*Le)},Oe=function(Le){return q*((oe(ge)*(le(Ye=ge+Z*Le)/oe(Ye))-le(ge))/ie)/ee;var Ye},Ie=(re(!0)-ge)/Z;if(Math.abs(ee)<2e-6||!isFinite(Ie)){if(Math.abs(q-W)<1e-6)return this.easeTo(e,i);const Le=W<q?-1:1;Ie=Math.abs(Math.log(W/q))/Z,Oe=()=>0,xe=Ye=>Math.exp(Le*Z*Ye)}return e.duration="duration"in e?+e.duration:1e3*Ie/("screenSpeed"in e?+e.screenSpeed/Z:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==y,this._pitching=v!==u,this._rolling=A!==f,this._padding=!a.isPaddingEqual(E),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(Y.targetCenter),this._ease(Le=>{const Ye=Le*Ie,Ue=1/xe(Ye),Ne=Oe(Ye);this._rotating&&a.setBearing(c.y.number(s,y,Le)),this._pitching&&a.setPitch(c.y.number(u,v,Le)),this._rolling&&a.setRoll(c.y.number(f,A,Le)),this._padding&&(a.interpolatePadding(g,E,Le),R=a.centerPoint.add(P)),Y.easeFunc(Le,Ue,Ne,R),this.terrain&&!e.freezeElevation&&this._updateElevation(Le),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const s=this._onEaseEnd;delete this._onEaseEnd,s.call(this,i)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,i,a){a.animate===!1||a.duration===0?(e(1),i()):(this._easeStart=fe.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=c.aI(e,-180,180);const a=Math.abs(e-i);return Math.abs(e-360-i)<a&&(e-=360),Math.abs(e+360-i)<a&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom):null}}const vs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class bs{constructor(e=vs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=te.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,i){const a=this._map._getUIString(`AttributionControl.${i}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(s=>typeof s!="string"?"":s)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}const i=this._map.style.sourceCaches;for(const s in i){const u=i[s];if(u.used||u.usedForTerrain){const f=u.getSource();f.attribution&&e.indexOf(f.attribution)<0&&e.push(f.attribution)}}e=e.filter(s=>String(s).trim()),e.sort((s,u)=>s.length-u.length),e=e.filter((s,u)=>{for(let f=u+1;f<e.length;f++)if(e[f].indexOf(s)>=0)return!1;return!0});const a=e.join(" | ");a!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=te.sanitize(a),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pr{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=te.create("div","maplibregl-ctrl");const i=te.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class nl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,a=i?this._queue.concat(i):this._queue;for(const s of a)if(s.id===e)return void(s.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const a of i)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zn=c.aA([{name:"a_pos3d",type:"Int16",components:3}]);class u7 extends c.E{constructor(e){super(),this._lastTilesetChange=fe.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const a={};for(const s of V(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))a[s.key]=!0,this._renderableTilesKeys.push(s.key),this._tiles[s.key]||(s.terrainRttPosMatrix32f=new Float64Array(16),c.bL(s.terrainRttPosMatrix32f,0,c.X,c.X,0,0,1),this._tiles[s.key]=new Yt(s,this.tileSize),this._lastTilesetChange=fe.now());for(const s in this._tiles)a[s]||delete this._tiles[s]}freeRtt(e){for(const i in this._tiles){const a=this._tiles[i];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const i={};for(const a of this._renderableTilesKeys){const s=this._tiles[a].tileID,u=e.clone(),f=c.a$();if(s.canonical.equals(e.canonical))c.bL(f,0,c.X,c.X,0,0,1);else if(s.canonical.isChildOf(e.canonical)){const g=s.canonical.z-e.canonical.z,y=s.canonical.x-(s.canonical.x>>g<<g),v=s.canonical.y-(s.canonical.y>>g<<g),A=c.X>>g;c.bL(f,0,A,A,0,0,1),c.J(f,f,[-y*A,-v*A,0])}else{if(!e.canonical.isChildOf(s.canonical))continue;{const g=e.canonical.z-s.canonical.z,y=e.canonical.x-(e.canonical.x>>g<<g),v=e.canonical.y-(e.canonical.y>>g<<g),A=c.X>>g;c.bL(f,0,c.X,c.X,0,0,1),c.J(f,f,[y*A,v*A,0]),c.K(f,f,[1/2**g,1/2**g,0])}}u.terrainRttPosMatrix32f=new Float32Array(f),i[a]=u}return i}getSourceTile(e,i){const a=this.sourceCache._source;let s=e.overscaledZ-this.deltaZoom;if(s>a.maxzoom&&(s=a.maxzoom),s<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(s).key);let u=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!u||!u.dem)&&i)for(;s>=a.minzoom&&(!u||!u.dem);)u=this.sourceCache.getTileByID(e.scaledTo(s--).key);return u}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class Pa{constructor(e,i,a){this._meshCache={},this.painter=e,this.sourceCache=new u7(i),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,a,s=c.X){var u;if(!(i>=0&&i<s&&a>=0&&a<s))return 0;const f=this.getTerrainData(e),g=(u=f.tile)===null||u===void 0?void 0:u.dem;if(!g)return 0;const y=c.c9([],[i/s*c.X,a/s*c.X],f.u_terrain_matrix),v=[y[0]*g.dim,y[1]*g.dim],A=Math.floor(v[0]),E=Math.floor(v[1]),P=v[0]-A,R=v[1]-E;return g.get(A,E)*(1-P)*(1-R)+g.get(A+1,E)*P*(1-R)+g.get(A,E+1)*(1-P)*R+g.get(A+1,E+1)*P*R}getElevationForLngLatZoom(e,i){if(!c.ca(i,e.wrap()))return 0;const{tileID:a,mercatorX:s,mercatorY:u}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(a,s%c.X,u%c.X,c.X)}getElevation(e,i,a,s=c.X){return this.getDEMElevation(e,i,a,s)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const s=this.painter.context,u=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(s,u,s.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(s,new c.R({width:1,height:1}),s.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.aq([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const s=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new we(s,i.dem.getPixels(),s.gl.RGBA,{premultiply:!1}),i.demTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const a=i&&i+i.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const s=this.sourceCache.sourceCache._source.maxzoom;let u=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=s?u=e.canonical.z-s:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const f=e.canonical.x-(e.canonical.x>>u<<u),g=e.canonical.y-(e.canonical.y>>u<<u),y=c.cb(new Float64Array(16),[1/(c.X<<u),1/(c.X<<u),0]);c.J(y,y,[f*c.X,g*c.X,0]),this._demMatrixCache[e.key]={matrix:y,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,a=i.width/devicePixelRatio,s=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===s||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(i.context,{width:a,height:s,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(i.context,{width:a,height:s,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(a,s,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,a,s))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let u=0,f=0;u<this._coordsTextureSize;u++)for(let g=0;g<this._coordsTextureSize;g++,f+=4)i[f+0]=255&g,i[f+1]=255&u,i[f+2]=g>>8<<4|u>>8,i[f+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),s=new we(e,a,e.gl.RGBA,{premultiply:!1});return s.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=s,s}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),a=this.painter.context,s=a.gl,u=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),f=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),g=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),s.readPixels(u,g-f-1,1,1,s.RGBA,s.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null);const y=i[0]+(i[2]>>4<<8),v=i[1]+((15&i[2])<<8),A=this.coordsIndex[255-i[3]],E=A&&this.sourceCache.getTileByID(A);if(!E)return null;const P=this._coordsTextureSize,R=(1<<E.tileID.canonical.z)*P;return new c.Y((E.tileID.canonical.x*P+y)/R+E.tileID.wrap,(E.tileID.canonical.y*P+v)/R,this.getElevation(E.tileID,y,v,P))}depthAtPoint(e){const i=new Uint8Array(4),a=this.painter.context,s=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),s.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,s.RGBA,s.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const a=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,s=a&&e.canonical.y===0,u=a&&e.canonical.y===(1<<e.canonical.z)-1,f=`m_${s?"n":""}_${u?"s":""}`;if(this._meshCache[f])return this._meshCache[f];const g=this.painter.context,y=new c.cc,v=new c.aE,A=this.meshSize,E=c.X/A,P=A*A;for(let oe=0;oe<=A;oe++)for(let ge=0;ge<=A;ge++)y.emplaceBack(ge*E,oe*E,0);for(let oe=0;oe<P;oe+=A+1)for(let ge=0;ge<A;ge++)v.emplaceBack(ge+oe,A+ge+oe+1,A+ge+oe+2),v.emplaceBack(ge+oe,A+ge+oe+2,ge+oe+1);const R=y.length,F=R+(A+1),Y=(A+1)*A,Z=s?c.b6:0,q=s?0:1,W=u?c.b7:c.X,ee=u?0:1;for(let oe=0;oe<=A;oe++)y.emplaceBack(oe*E,Z,q);for(let oe=0;oe<=A;oe++)y.emplaceBack(oe*E,W,ee);for(let oe=0;oe<A;oe++)v.emplaceBack(Y+oe,F+oe,F+oe+1),v.emplaceBack(Y+oe,F+oe+1,Y+oe+1),v.emplaceBack(0+oe,R+oe+1,R+oe),v.emplaceBack(0+oe,0+oe+1,R+oe+1);const ie=y.length,re=ie+2*(A+1);for(const oe of[0,1])for(let ge=0;ge<=A;ge++)for(const xe of[0,1])y.emplaceBack(oe*c.X,ge*E,xe);for(let oe=0;oe<2*A;oe+=2)v.emplaceBack(ie+oe,ie+oe+1,ie+oe+3),v.emplaceBack(ie+oe,ie+oe+3,ie+oe+2),v.emplaceBack(re+oe,re+oe+3,re+oe+1),v.emplaceBack(re+oe,re+oe+2,re+oe+3);const le=new Xr(g.createVertexBuffer(y,zn.members),g.createIndexBuffer(v),c.aD.simpleSegment(0,0,y.length,v.length));return this._meshCache[f]=le,le}getMeshFrameDelta(e){return 2*Math.PI*c.bo/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var a;const{tileID:s}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(a=this.getMinMaxElevation(s).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return i&&i.dem&&(a.minElevation=i.dem.min*this.exaggeration,a.maxElevation=i.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,i){const a=c.Y.fromLngLat(e.wrap()),s=(1<<i)*c.X,u=a.x*s,f=a.y*s,g=Math.floor(u/c.X),y=Math.floor(f/c.X);return{tileID:new c.S(i,0,i,g,y),mercatorX:u,mercatorY:f}}}class Si{constructor(e,i,a){this._context=e,this._size=i,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new we(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(a.texture),{id:e,fbo:i,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const di={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ol{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new Si(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(i)),this._coordsAscending={};for(const a in e.sourceCaches){this._coordsAscending[a]={};const s=e.sourceCaches[a].getVisibleCoordinates();for(const u of s){const f=this.terrain.sourceCache.getTerrainCoords(u);for(const g in f)this._coordsAscending[a][g]||(this._coordsAscending[a][g]=[]),this._coordsAscending[a][g].push(f[g])}}this._coordsAscendingStr={};for(const a of e._order){const s=e._layers[a],u=s.source;if(di[s.type]&&!this._coordsAscendingStr[u]){this._coordsAscendingStr[u]={};for(const f in this._coordsAscending[u])this._coordsAscendingStr[u][f]=this._coordsAscending[u][f].map(g=>g.key).sort().join()}}for(const a of this._renderableTiles)for(const s in this._coordsAscendingStr){const u=this._coordsAscendingStr[s][a.tileID.key];u&&u!==a.rttCoords[s]&&(a.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const a=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),s=e.type,u=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(di[s]&&(this._prevType&&di[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!f))return!0;if(di[this._prevType]||di[s]&&f){this._prevType=s;const g=this._stacks.length-1,y=this._stacks[g]||[];for(const v of this._renderableTiles){if(this.pool.isFull()&&(P4(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(v),v.rtt[g]){const E=this.pool.getObjectForId(v.rtt[g].id);if(E.stamp===v.rtt[g].stamp){this.pool.useObject(E);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),v.rtt[g]={id:A.id,stamp:A.stamp},u.context.bindFramebuffer.set(A.fbo.framebuffer),u.context.clear({color:c.b4.transparent,stencil:0}),u.currentStencilSource=void 0;for(let E=0;E<y.length;E++){const P=u.style._layers[y[E]],R=P.source?this._coordsAscending[P.source][v.tileID.key]:[v.tileID];u.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),u._renderTileClippingMasks(P,R,!0),u.renderLayer(u,u.style.sourceCaches[P.source],P,R,a),P.source&&(v.rttCoords[P.source]=this._coordsAscendingStr[P.source][v.tileID.key])}}return P4(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),di[s]}return!1}}const Ma={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ws=be,Ts={hash:!1,interactive:!0,bearingSnap:7,attributionControl:vs,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},U4={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class j4{constructor(e,i,a=!1){this.mousedown=u=>{this.startMove(u,te.mousePos(this.element,u)),te.addEventListener(window,"mousemove",this.mousemove),te.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=u=>{this.move(u,te.mousePos(this.element,u))},this.mouseup=u=>{this._rotatePitchHanlder.dragEnd(u),this.offTemp()},this.touchstart=u=>{u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,u.targetTouches)[0],this.startMove(u,this._startPos),te.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.addEventListener(window,"touchend",this.touchend))},this.touchmove=u=>{u.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,u.targetTouches)[0],this.move(u,this._lastPos))},this.touchend=u=>{u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const s=new Ca;this._rotatePitchHanlder=new Yo({clickTolerance:3,move:(u,f)=>{const g=i.getBoundingClientRect(),y=new c.P((g.bottom-g.top)/2,(g.right-g.left)/2);return{bearingDelta:c.c7(new c.P(u.x,f.y),f,y),pitchDelta:a?-.5*(f.y-u.y):void 0}},moveStateManager:s,enable:!0,assignEvents:()=>{}}),this.map=e,te.addEventListener(i,"mousedown",this.mousedown),te.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),te.disableDrag()}move(e,i){const a=this.map,{bearingDelta:s,pitchDelta:u}=this._rotatePitchHanlder.dragMove(e,i)||{};s&&a.setBearing(a.getBearing()+s),u&&a.setPitch(a.getPitch()+u)}off(){const e=this.element;te.removeEventListener(e,"mousedown",this.mousedown),te.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend),te.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){te.enableDrag(),te.removeEventListener(window,"mousemove",this.mousemove),te.removeEventListener(window,"mouseup",this.mouseup),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend)}}let vn;function Ss(h,e,i){const a=new c.N(h.lng,h.lat);if(h=new c.N(h.lng,h.lat),e){const s=new c.N(h.lng-360,h.lat),u=new c.N(h.lng+360,h.lat),f=i.locationToScreenPoint(h).distSqr(e);i.locationToScreenPoint(s).distSqr(e)<f?h=s:i.locationToScreenPoint(u).distSqr(e)<f&&(h=u)}for(;Math.abs(h.lng-i.center.lng)>180;){const s=i.locationToScreenPoint(h);if(s.x>=0&&s.y>=0&&s.x<=i.width&&s.y<=i.height)break;h.lng>i.center.lng?h.lng-=360:h.lng+=360}return h.lng!==a.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(h))?h:a}const Ia={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cs(h,e,i){const a=h.classList;for(const s in Ia)a.remove(`maplibregl-${i}-anchor-${s}`);a.add(`maplibregl-${i}-anchor-${e}`)}class Oa extends c.E{constructor(e){if(super(),this._onKeyPress=i=>{const a=i.code,s=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&s!==32&&s!==13||this.togglePopup()},this._onMapClick=i=>{const a=i.originalEvent.target,s=this._element;this._popup&&(a===s||s.contains(a))&&this.togglePopup()},this._update=i=>{var a;if(!this._map)return;const s=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!s)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ss(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,`${Ia[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${u}`),fe.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div");const i=te.createNS("http://www.w3.org/2000/svg","svg"),a=41,s=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${a}px`),i.setAttributeNS(null,"width",`${s}px`),i.setAttributeNS(null,"viewBox",`0 0 ${s} ${a}`);const u=te.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"stroke","none"),u.setAttributeNS(null,"stroke-width","1"),u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"fill-rule","evenodd");const f=te.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill-rule","nonzero");const g=te.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(3.0, 29.0)"),g.setAttributeNS(null,"fill","#000000");const y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const q of y){const W=te.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",q.rx),W.setAttributeNS(null,"ry",q.ry),g.appendChild(W)}const v=te.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill",this._color);const A=te.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),v.appendChild(A);const E=te.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"opacity","0.25"),E.setAttributeNS(null,"fill","#000000");const P=te.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),E.appendChild(P);const R=te.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(6.0, 7.0)"),R.setAttributeNS(null,"fill","#FFFFFF");const F=te.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=te.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const Z=te.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),F.appendChild(Y),F.appendChild(Z),f.appendChild(g),f.appendChild(v),f.appendChild(E),f.appendChild(R),f.appendChild(F),i.appendChild(f),i.setAttributeNS(null,"height",a*this._scale+"px"),i.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(i),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),Cs(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const s=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,a;if(!(!((i=this._map)===null||i===void 0)&&i.terrain)){const E=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==E&&(this._element.style.opacity=E))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const s=this._map,u=s.terrain.depthAtPoint(this._pos),f=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,f)-u<.006)return void(this._element.style.opacity=this._opacity);const g=-this._offset.y/s.transform.pixelsPerMeter,y=Math.sin(s.getPitch()*Math.PI/180)*g,v=s.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),A=s.transform.lngLatToCameraDepth(this._lngLat,f+y)-v>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return e===void 0&&i===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const H4={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $o=0,wo=!1;const V4={maxWidth:100,unit:"metric"};function Na(h,e,i){const a=i&&i.maxWidth||100,s=h._container.clientHeight/2,u=h._container.clientWidth/2,f=h.unproject([u-a/2,s]),g=h.unproject([u+a/2,s]),y=Math.round(h.project(g).x-h.project(f).x),v=Math.min(a,y,h._container.clientWidth),A=f.distanceTo(g);if(i&&i.unit==="imperial"){const E=3.2808*A;E>5280?To(e,v,E/5280,h._getUIString("ScaleControl.Miles")):To(e,v,E,h._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?To(e,v,A/1852,h._getUIString("ScaleControl.NauticalMiles")):A>=1e3?To(e,v,A/1e3,h._getUIString("ScaleControl.Kilometers")):To(e,v,A,h._getUIString("ScaleControl.Meters"))}function To(h,e,i,a){const s=function(u){const f=Math.pow(10,`${Math.floor(u)}`.length-1);let g=u/f;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(y){const v=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*v)/v}(g),f*g}(i);h.style.width=e*(s/i)+"px",h.innerHTML=`${s}&nbsp;${a}`}const Z4={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},As=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Es(h){if(h){if(typeof h=="number"){const e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,h),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-h),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(h,0),right:new c.P(-h,0)}}if(h instanceof c.P||Array.isArray(h)){const e=c.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(h.center||[0,0]),top:c.P.convert(h.top||[0,0]),"top-left":c.P.convert(h["top-left"]||[0,0]),"top-right":c.P.convert(h["top-right"]||[0,0]),bottom:c.P.convert(h.bottom||[0,0]),"bottom-left":c.P.convert(h["bottom-left"]||[0,0]),"bottom-right":c.P.convert(h["bottom-right"]||[0,0]),left:c.P.convert(h.left||[0,0]),right:c.P.convert(h.right||[0,0])}}return Es(new c.P(0,0))}const Y4=be;S.AJAXError=c.cg,S.Event=c.k,S.Evented=c.E,S.LngLat=c.N,S.MercatorCoordinate=c.Y,S.Point=c.P,S.addProtocol=c.ch,S.config=c.a,S.removeProtocol=c.ci,S.AttributionControl=bs,S.BoxZoomHandler=Q3,S.CanvasSource=ar,S.CooperativeGesturesHandler=rl,S.DoubleClickZoomHandler=pi,S.DragPanHandler=B4,S.DragRotateHandler=F4,S.EdgeInsets=jt,S.FullscreenControl=class extends c.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=te.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);te.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Rr,S.GeolocateControl=class extends c.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,s=this._map.getBearing(),u=c.e({bearing:s},this.options.fitBoundsOptions),f=_i.fromLngLat(i,a);this._map.fitBounds(f,u,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&wo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=te.create("button","maplibregl-ctrl-geolocate",this._container),te.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Oa({element:this._dotElement}),this._circleElement=te.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Oa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},H4,h)}onAdd(h){return this._map=h,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(vn!==void 0&&!e)return vn;if(window.navigator.permissions===void 0)return vn=!!window.navigator.geolocation,vn;try{vn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{vn=!!window.navigator.geolocation}return vn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$o=0,wo=!1}_isOutOfMapMaxBounds(h){const e=this._map.getMaxBounds(),i=h.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),e=h.getSouthEast(),i=h.getNorthEast(),a=e.distanceTo(i),s=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$o--,wo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$o++,$o>1?(h={maximumAge:6e5,timeout:0},wo=!0):(h=this.options.positionOptions,wo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;const e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=te.create("button","maplibregl-ctrl-globe",this._container),te.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=O4,S.ImageSource=Ui,S.KeyboardHandler=D4,S.LngLatBounds=_i,S.LogoControl=Pr,S.Map=class extends xs{constructor(h){var e,i;c.cd.mark(c.ce.create);const a=Object.assign(Object.assign(Object.assign({},Ts),h),{canvasContextAttributes:Object.assign(Object.assign({},Ts.canvasContextAttributes),h.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const s=new qt,u=new uo;if(a.minZoom!==void 0&&s.setMinZoom(a.minZoom),a.maxZoom!==void 0&&s.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&s.setMinPitch(a.minPitch),a.maxPitch!==void 0&&s.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&s.setRenderWorldCopies(a.renderWorldCopies),super(s,u,{bearingSnap:a.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new nl,this._controls=[],this._mapId=c.a1(),this._contextLost=g=>{g.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:g}))},this._contextRestored=g=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:g}))},this._onMapScroll=g=>{if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ma),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this.transformCameraUpdate=a.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=He.addThrottleControl(()=>this.isMoving()),this._requestManager=new ft(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let g=!1;const y=I4(v=>{this._trackResize&&!this._removed&&(this.resize(v),this.redraw())},50);this._resizeObserver=new ResizeObserver(v=>{g?y(v):g=!0}),this._resizeObserver.observe(this._container)}this.handlers=new pt(this,a),this._hash=a.hash&&new O4(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,c.e({},a.fitBoundsOptions,{duration:0}))));const f=typeof a.style=="string"||((i=(e=a.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,f),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new bs(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new Pr,a.logoPosition),this.on("style.load",()=>{if(f||this._resizeTransform(),this.transform.unmodified){const g=c.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(g)}}),this.on("data",g=>{this._update(g.dataType==="style"),this.fire(new c.k(`${g.dataType}data`,g))}),this.on("dataloading",g=>{this.fire(new c.k(`${g.dataType}dataloading`,g))}),this.on("dataabort",g=>{this.fire(new c.k("sourcedataabort",g))})}_getMapId(){return this._mapId}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=h.onAdd(this);this._controls.push(h);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(i,a.firstChild):a.appendChild(i),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,i,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,i,a)}resize(h,e=!0){const[i,a]=this._containerDimensions(),s=this._getClampedPixelRatio(i,a);if(this._resizeCanvas(i,a,s),this.painter.resize(i,a,s),this.painter.overLimit()){const f=this.painter.context.gl;this._maxCanvasSize=[f.drawingBufferWidth,f.drawingBufferHeight];const g=this._getClampedPixelRatio(i,a);this._resizeCanvas(i,a,g),this.painter.resize(i,a,g)}this._resizeTransform(e);const u=!this._moving;return u&&(this.stop(),this.fire(new c.k("movestart",h)).fire(new c.k("move",h))),this.fire(new c.k("resize",h)),u&&this.fire(new c.k("moveend",h)),this}_resizeTransform(h=!0){var e;const[i,a]=this._containerDimensions();this.transform.resize(i,a,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,a,h)}_getClampedPixelRatio(h,e){const{0:i,1:a}=this._maxCanvasSize,s=this.getPixelRatio(),u=h*s,f=e*s;return Math.min(u>i?i/u:1,f>a?a/f:1)*s}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(_i.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(c.N.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(c.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,i){if(h==="mouseenter"||h==="mouseover"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:u=>{const f=e.filter(y=>this.getLayer(y)),g=f.length!==0?this.queryRenderedFeatures(u.point,{layers:f}):[];g.length?a||(a=!0,i.call(this,new Gr(h,this,u.originalEvent,{features:g}))):a=!1},mouseout:()=>{a=!1}}}}if(h==="mouseleave"||h==="mouseout"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:f=>{const g=e.filter(y=>this.getLayer(y));(g.length!==0?this.queryRenderedFeatures(f.point,{layers:g}):[]).length?a=!0:a&&(a=!1,i.call(this,new Gr(h,this,f.originalEvent)))},mouseout:f=>{a&&(a=!1,i.call(this,new Gr(h,this,f.originalEvent)))}}}}{const a=s=>{const u=e.filter(g=>this.getLayer(g)),f=u.length!==0?this.queryRenderedFeatures(s.point,{layers:u}):[];f.length&&(s.features=f,i.call(this,s),delete s.features)};return{layers:e,listener:i,delegates:{[h]:a}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,i){if(!this._delegatedListeners||!this._delegatedListeners[h])return;const a=this._delegatedListeners[h];for(let s=0;s<a.length;s++){const u=a[s];if(u.listener===i&&u.layers.length===e.length&&u.layers.every(f=>e.includes(f))){for(const f in u.delegates)this.off(f,u.delegates[f]);return void a.splice(s,1)}}}on(h,e,i){if(i===void 0)return super.on(h,e);const a=typeof e=="string"?[e]:e,s=this._createDelegatedListener(h,a,i);this._saveDelegatedListener(h,s);for(const u in s.delegates)this.on(u,s.delegates[u]);return{unsubscribe:()=>{this._removeDelegatedListener(h,a,i)}}}once(h,e,i){if(i===void 0)return super.once(h,e);const a=typeof e=="string"?[e]:e,s=this._createDelegatedListener(h,a,i);for(const u in s.delegates){const f=s.delegates[u];s.delegates[u]=(...g)=>{this._removeDelegatedListener(h,a,i),f(...g)}}this._saveDelegatedListener(h,s);for(const u in s.delegates)this.once(u,s.delegates[u]);return this}off(h,e,i){return i===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let i;const a=h instanceof c.P||Array.isArray(h),s=a?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:h)||{},s instanceof c.P||typeof s[0]=="number")i=[c.P.convert(s)];else{const u=c.P.convert(s[0]),f=c.P.convert(s[1]);i=[u,new c.P(f.x,u.y),f,new c.P(u.x,f.y),u]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var i,a;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new Js(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,s):this.style.loadJSON(h,e,s),this):((a=(i=this.style)===null||i===void 0?void 0:i.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){const i=this._requestManager.transformRequest(h,"Style");c.h(i,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(i){c.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){const e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const a=this.style._layers[i];a.type==="hillshade"&&a.source===h.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pa(this.painter,e,h),this.painter.renderToTexture=new ol(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.k("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const e in h){const i=h[e]._tiles;for(const a in i){const s=i[a];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,e,i={}){const{pixelRatio:a=1,sdf:s=!1,stretchX:u,stretchY:f,content:g,textFitWidth:y,textFitHeight:v}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:E,data:P}=e,R=e;return this.style.addImage(h,{data:new c.R({width:A,height:E},new Uint8Array(P)),pixelRatio:a,stretchX:u,stretchY:f,content:g,textFitWidth:y,textFitHeight:v,sdf:s,version:0,userImage:R}),R.onAdd&&R.onAdd(this,h),this}}{const{width:A,height:E,data:P}=fe.getImageData(e);this.style.addImage(h,{data:new c.R({width:A,height:E},P),pixelRatio:a,stretchX:u,stretchY:f,content:g,textFitWidth:y,textFitHeight:v,sdf:s,version:0})}}updateImage(h,e){const i=this.style.getImage(h);if(!i)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?fe.getImageData(e):e,{width:s,height:u,data:f}=a;if(s===void 0||u===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==i.data.width||u!==i.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const g=!(e instanceof HTMLImageElement||c.b(e));return i.data.replace(f,g),this.style.updateImage(h,i),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return He.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,i){return this.style.setLayerZoomRange(h,e,i),this._update(!0)}setFilter(h,e,i={}){return this.style.setFilter(h,e,i),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,i,a={}){return this.style.setPaintProperty(h,e,i,a),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,i,a={}){return this.style.setLayoutProperty(h,e,i,a),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,i,a=>{a||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,i=>{i||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const e=this._canvasContainer=te.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=te.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),a=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],a);const s=this._controlContainer=te.create("div","maplibregl-control-container",h),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{u[f]=te.create("div",`maplibregl-ctrl-${f} `,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,i){this._canvas.width=Math.floor(i*h),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:h},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!i){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new vo(i,this.transform),Ce.testSupport(i)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new c.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,i,a,s,u;const f=this._idleTriggered?this._fadeDuration:0,g=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,P=fe.now();this.style.zoomHistory.update(E,P);const R=new c.z(E,{now:P,fadeDuration:f,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=R.crossFadingFactor();F===1&&F===this._crossFadingFactor||(y=!0,this._crossFadingFactor=F),this.style.update(R)}const v=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==g;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((s=this.style.projection)===null||s===void 0?void 0:s.transitionState,(u=this.style.projection)===null||u===void 0?void 0:u.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||v)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,f,this._crossSourceCollisions,v),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cd.mark(c.ce.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,c.cd.mark(c.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),He.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),te.remove(this._canvasContainer),te.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cd.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,fe.frameAsync(this._frameRequest).then(h=>{c.cd.frame(h),this._frameRequest=null,this._render(h)}).catch(h=>{if(!c.cf(h)&&!function(e){return e.message===_a}(h))throw h}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return ws}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},S.MapMouseEvent=Gr,S.MapTouchEvent=Ur,S.MapWheelEvent=bo,S.Marker=Oa,S.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const a=this._map._getUIString(`NavigationControl.${i}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},U4,h),this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),te.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),te.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=te.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new j4(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){const i=te.create("button",h,this._container);return i.type="button",i.addEventListener("click",e),i}},S.Popup=class extends c.E{constructor(h){super(),this.remove=()=>(this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var i;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=te.create("div","maplibregl-popup",this._map.getContainer()),this._tip=te.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ss(this._lngLat,this._flatPos,this._map.transform):(i=this._lngLat)===null||i===void 0?void 0:i.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let s=this.options.anchor;const u=Es(this.options.offset);if(!s){const g=this._container.offsetWidth,y=this._container.offsetHeight;let v;v=a.y+u.bottom.y<y?["top"]:a.y>this._map.transform.height-y?["bottom"]:[],a.x<g/2?v.push("left"):a.x>this._map.transform.width-g/2&&v.push("right"),s=v.length===0?"bottom":v.join("-")}let f=a.add(u[s]);this.options.subpixelPositioning||(f=f.round()),te.setTransform(this._container,`${Ia[s]} translate(${f.x}px,${f.y}px)`),Cs(this._container,s,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Z4),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=c.N.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const e=document.createDocumentFragment(),i=document.createElement("body");let a;for(i.innerHTML=h;a=i.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=te.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(As);h&&h.focus()}},S.RasterDEMTileSource=kr,S.RasterTileSource=Gi,S.ScaleControl=class{constructor(h){this._onMove=()=>{Na(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Na(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},V4),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Zn,S.Style=Js,S.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=te.create("button","maplibregl-ctrl-terrain",this._container),te.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=R4,S.TwoFingersTouchRotateHandler=k4,S.TwoFingersTouchZoomHandler=el,S.TwoFingersTouchZoomRotateHandler=G4,S.VectorTileSource=fn,S.VideoSource=Lt,S.addSourceType=(h,e)=>c._(void 0,void 0,void 0,function*(){if(zt(h))throw new Error(`A source type called "${h}" already exists.`);((i,a)=>{Wr[i]=a})(h,e)}),S.clearPrewarmedResources=function(){const h=Li;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(fr),Li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Do,S.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Ot().getRTLTextPluginStatus()},S.getVersion=function(){return Y4},S.getWorkerCount=function(){return Ei.workerCount},S.getWorkerUrl=function(){return c.a.WORKER_URL},S.importScriptInWorkers=function(h){return or().broadcast("IS",h)},S.prewarm=function(){Tr().acquire(fr)},S.setMaxParallelImageRequests=function(h){c.a.MAX_PARALLEL_IMAGE_REQUESTS=h},S.setRTLTextPlugin=function(h,e){return Ot().setRTLTextPlugin(h,e)},S.setWorkerCount=function(h){Ei.workerCount=h},S.setWorkerUrl=function(h){c.a.WORKER_URL=h}});var J=L;return J})})(F1);var I5=F1.exports;const Nl=M5(I5);var js=Math.pow,Nr=(b,T,L)=>new Promise((k,D)=>{var J=be=>{try{c(L.next(be))}catch(me){D(me)}},S=be=>{try{c(L.throw(be))}catch(me){D(me)}},c=be=>be.done?k(be.value):Promise.resolve(be.value).then(J,S);c((L=L.apply(b,T)).next())}),Mn=Uint8Array,y3=Uint16Array,O5=Int32Array,U1=new Mn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),j1=new Mn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),N5=new Mn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H1=function(b,T){for(var L=new y3(31),k=0;k<31;++k)L[k]=T+=1<<b[k-1];for(var D=new O5(L[30]),k=1;k<30;++k)for(var J=L[k];J<L[k+1];++J)D[J]=J-L[k]<<5|k;return{b:L,r:D}},V1=H1(U1,2),Z1=V1.b,k5=V1.r;Z1[28]=258,k5[258]=28;var R5=H1(j1,0),D5=R5.b,Y1=new y3(32768);for(ni=0;ni<32768;++ni)Mo=(ni&43690)>>1|(ni&21845)<<1,Mo=(Mo&52428)>>2|(Mo&13107)<<2,Mo=(Mo&61680)>>4|(Mo&3855)<<4,Y1[ni]=((Mo&65280)>>8|(Mo&255)<<8)>>1;var Mo,ni,x3=function(b,T,L){for(var k=b.length,D=0,J=new y3(T);D<k;++D)b[D]&&++J[b[D]-1];var S=new y3(T);for(D=1;D<T;++D)S[D]=S[D-1]+J[D-1]<<1;var c;{c=new y3(1<<T);var be=15-T;for(D=0;D<k;++D)if(b[D])for(var me=D<<4|b[D],de=T-b[D],Ae=S[b[D]-1]++<<de,fe=Ae|(1<<de)-1;Ae<=fe;++Ae)c[Y1[Ae]>>be]=me}return c},b3=new Mn(288);for(ni=0;ni<144;++ni)b3[ni]=8;var ni;for(ni=144;ni<256;++ni)b3[ni]=9;var ni;for(ni=256;ni<280;++ni)b3[ni]=7;var ni;for(ni=280;ni<288;++ni)b3[ni]=8;var ni,q1=new Mn(32);for(ni=0;ni<32;++ni)q1[ni]=5;var ni,z5=x3(b3,9),B5=x3(q1,5),r9=function(b){for(var T=b[0],L=1;L<b.length;++L)b[L]>T&&(T=b[L]);return T},Wn=function(b,T,L){var k=T/8|0;return(b[k]|b[k+1]<<8)>>(T&7)&L},n9=function(b,T){var L=T/8|0;return(b[L]|b[L+1]<<8|b[L+2]<<16)>>(T&7)},F5=function(b){return(b+7)/8|0},G5=function(b,T,L){(L==null||L>b.length)&&(L=b.length);var k=new Mn(L-T);return k.set(b.subarray(T,L)),k},U5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ln=function(b,T,L){var k=new Error(T||U5[b]);if(k.code=b,Error.captureStackTrace&&Error.captureStackTrace(k,Ln),!L)throw k;return k},d9=function(b,T,L,k){var D=b.length,J=0;if(!D||T.f&&!T.l)return L||new Mn(0);var S=!L||T.i!=2,c=T.i;L||(L=new Mn(D*3));var be=function(qr){var Kt=L.length;if(qr>Kt){var at=new Mn(Math.max(Kt*2,qr));at.set(L),L=at}},me=T.f||0,de=T.p||0,Ae=T.b||0,fe=T.l,te=T.d,Ce=T.m,Je=T.n,it=D*8;do{if(!fe){me=Wn(b,de,1);var je=Wn(b,de+1,3);if(de+=3,je)if(je==1)fe=z5,te=B5,Ce=9,Je=5;else if(je==2){var ft=Wn(b,de,31)+257,mt=Wn(b,de+10,15)+4,ot=ft+Wn(b,de+5,31)+1;de+=14;for(var we=new Mn(ot),Et=new Mn(19),Dt=0;Dt<mt;++Dt)Et[N5[Dt]]=Wn(b,de+Dt*3,7);de+=mt*3;for(var Bi=r9(Et),si=(1<<Bi)-1,Wt=x3(Et,Bi),Dt=0;Dt<ot;){var Zt=Wt[Wn(b,de,si)];de+=Zt&15;var Fe=Zt>>4;if(Fe<16)we[Dt++]=Fe;else{var gi=0,xt=0;for(Fe==16?(xt=3+Wn(b,de,3),de+=2,gi=we[Dt-1]):Fe==17?(xt=3+Wn(b,de,7),de+=3):Fe==18&&(xt=11+Wn(b,de,127),de+=7);xt--;)we[Dt++]=gi}}var Ii=we.subarray(0,ft),ct=we.subarray(ft);Ce=r9(Ii),Je=r9(ct),fe=x3(Ii,Ce),te=x3(ct,Je)}else Ln(1);else{var Fe=F5(de)+4,dt=b[Fe-4]|b[Fe-3]<<8,He=Fe+dt;if(He>D){c&&Ln(0);break}S&&be(Ae+dt),L.set(b.subarray(Fe,He),Ae),T.b=Ae+=dt,T.p=de=He*8,T.f=me;continue}if(de>it){c&&Ln(0);break}}S&&be(Ae+131072);for(var li=(1<<Ce)-1,dr=(1<<Je)-1,fr=de;;fr=de){var gi=fe[n9(b,de)&li],Ei=gi>>4;if(de+=gi&15,de>it){c&&Ln(0);break}if(gi||Ln(2),Ei<256)L[Ae++]=Ei;else if(Ei==256){fr=de,fe=null;break}else{var Fi=Ei-254;if(Ei>264){var Dt=Ei-257,Li=U1[Dt];Fi=Wn(b,de,(1<<Li)-1)+Z1[Dt],de+=Li}var ci=te[n9(b,de)&dr],Tr=ci>>4;ci||Ln(3),de+=ci&15;var ct=D5[Tr];if(Tr>3){var Li=j1[Tr];ct+=n9(b,de)&(1<<Li)-1,de+=Li}if(de>it){c&&Ln(0);break}S&&be(Ae+131072);var nr=Ae+Fi;if(Ae<ct){var or=J-ct,Oi=Math.min(ct,nr);for(or+Ae<0&&Ln(3);Ae<Oi;++Ae)L[Ae]=k[or+Ae]}for(;Ae<nr;Ae+=4)L[Ae]=L[Ae-ct],L[Ae+1]=L[Ae+1-ct],L[Ae+2]=L[Ae+2-ct],L[Ae+3]=L[Ae+3-ct];Ae=nr}}T.l=fe,T.p=fr,T.b=Ae,T.f=me,fe&&(me=1,T.m=Ce,T.d=te,T.n=Je)}while(!me);return Ae==L.length?L:G5(L,0,Ae)},j5=new Mn(0),H5=function(b){(b[0]!=31||b[1]!=139||b[2]!=8)&&Ln(6,"invalid gzip data");var T=b[3],L=10;T&4&&(L+=(b[10]|b[11]<<8)+2);for(var k=(T>>3&1)+(T>>4&1);k>0;k-=!b[L++]);return L+(T&2)},V5=function(b){var T=b.length;return(b[T-4]|b[T-3]<<8|b[T-2]<<16|b[T-1]<<24)>>>0},Z5=function(b,T){return((b[0]&15)!=8||b[0]>>4>7||(b[0]<<8|b[1])%31)&&Ln(6,"invalid zlib data"),(b[1]>>5&1)==+!T&&Ln(6,"invalid zlib data: "+(b[1]&32?"need":"unexpected")+" dictionary"),(b[1]>>3&4)+2};function Y5(b,T){return d9(b,{i:2},T,T)}function q5(b,T){var L=H5(b);return L+8>b.length&&Ln(6,"invalid gzip data"),d9(b.subarray(L,-8),{i:2},new Mn(V5(b)),T)}function $5(b,T){return d9(b.subarray(Z5(b,T),-4),{i:2},T,T)}function s9(b,T){return b[0]==31&&b[1]==139&&b[2]==8?q5(b,T):(b[0]&15)!=8||b[0]>>4>7||(b[0]<<8|b[1])%31?Y5(b,T):$5(b,T)}var W5=typeof TextDecoder<"u"&&new TextDecoder,X5=0;try{W5.decode(j5,{stream:!0}),X5=1}catch{}var $1=(b,T)=>b*js(2,T),m3=(b,T)=>Math.floor(b/js(2,T)),Dl=(b,T)=>$1(b.getUint16(T+1,!0),8)+b.getUint8(T),W1=(b,T)=>$1(b.getUint32(T+2,!0),16)+b.getUint16(T,!0),K5=(b,T,L,k,D)=>{if(b!==k.getUint8(D))return b-k.getUint8(D);const J=Dl(k,D+1);if(T!==J)return T-J;const S=Dl(k,D+4);return L!==S?L-S:0},J5=(b,T,L,k)=>{const D=X1(b,T|128,L,k);return D?{z:T,x:L,y:k,offset:D[0],length:D[1],isDir:!0}:null},f1=(b,T,L,k)=>{const D=X1(b,T,L,k);return D?{z:T,x:L,y:k,offset:D[0],length:D[1],isDir:!1}:null},X1=(b,T,L,k)=>{let D=0,J=b.byteLength/17-1;for(;D<=J;){const S=J+D>>1,c=K5(T,L,k,b,S*17);if(c>0)D=S+1;else if(c<0)J=S-1;else return[W1(b,S*17+7),b.getUint32(S*17+13,!0)]}return null},Q5=(b,T)=>b.isDir&&!T.isDir?1:!b.isDir&&T.isDir?-1:b.z!==T.z?b.z-T.z:b.x!==T.x?b.x-T.x:b.y-T.y,K1=(b,T)=>{const L=b.getUint8(T*17);return{z:L&127,x:Dl(b,T*17+1),y:Dl(b,T*17+4),offset:W1(b,T*17+7),length:b.getUint32(T*17+13,!0),isDir:L>>7===1}},m1=b=>{const T=[],L=new DataView(b);for(let k=0;k<L.byteLength/17;k++)T.push(K1(L,k));return ec(T)},ec=b=>{b.sort(Q5);const T=new ArrayBuffer(17*b.length),L=new Uint8Array(T);for(let k=0;k<b.length;k++){const D=b[k];let J=D.z;D.isDir&&(J=J|128),L[k*17]=J,L[k*17+1]=D.x&255,L[k*17+2]=D.x>>8&255,L[k*17+3]=D.x>>16&255,L[k*17+4]=D.y&255,L[k*17+5]=D.y>>8&255,L[k*17+6]=D.y>>16&255,L[k*17+7]=D.offset&255,L[k*17+8]=m3(D.offset,8)&255,L[k*17+9]=m3(D.offset,16)&255,L[k*17+10]=m3(D.offset,24)&255,L[k*17+11]=m3(D.offset,32)&255,L[k*17+12]=m3(D.offset,48)&255,L[k*17+13]=D.length&255,L[k*17+14]=D.length>>8&255,L[k*17+15]=D.length>>16&255,L[k*17+16]=D.length>>24&255}return T},tc=(b,T)=>{if(b.byteLength<17)return null;const L=b.byteLength/17,k=K1(b,L-1);if(k.isDir){const D=k.z,J=T.z-D,S=Math.trunc(T.x/(1<<J)),c=Math.trunc(T.y/(1<<J));return{z:D,x:S,y:c}}return null};function ic(b){return Nr(this,null,function*(){const T=yield b.getBytes(0,512e3),L=new DataView(T.data),k=L.getUint32(4,!0),D=L.getUint16(8,!0),J=new TextDecoder("utf-8"),S=JSON.parse(J.decode(new DataView(T.data,10,k)));let c=0;S.compression==="gzip"&&(c=2);let be=0;"minzoom"in S&&(be=+S.minzoom);let me=0;"maxzoom"in S&&(me=+S.maxzoom);let de=0,Ae=0,fe=0,te=-180,Ce=-85,Je=180,it=85;if(S.bounds){const Fe=S.bounds.split(",");te=+Fe[0],Ce=+Fe[1],Je=+Fe[2],it=+Fe[3]}if(S.center){const Fe=S.center.split(",");de=+Fe[0],Ae=+Fe[1],fe=+Fe[2]}return{specVersion:L.getUint16(2,!0),rootDirectoryOffset:10+k,rootDirectoryLength:D*17,jsonMetadataOffset:10,jsonMetadataLength:k,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:be,maxZoom:me,minLon:te,minLat:Ce,maxLon:Je,maxLat:it,centerZoom:fe,centerLon:de,centerLat:Ae,etag:T.etag}})}function rc(b,T,L,k,D,J,S){return Nr(this,null,function*(){let c=yield L.getArrayBuffer(T,b.rootDirectoryOffset,b.rootDirectoryLength,b);b.specVersion===1&&(c=m1(c));const be=f1(new DataView(c),k,D,J);if(be){let Ae=(yield T.getBytes(be.offset,be.length,S)).data;const fe=new DataView(Ae);return fe.getUint8(0)===31&&fe.getUint8(1)===139&&(Ae=s9(new Uint8Array(Ae))),{data:Ae}}const me=tc(new DataView(c),{z:k,x:D,y:J});if(me){const de=J5(new DataView(c),me.z,me.x,me.y);if(de){let Ae=yield L.getArrayBuffer(T,de.offset,de.length,b);b.specVersion===1&&(Ae=m1(Ae));const fe=f1(new DataView(Ae),k,D,J);if(fe){let Ce=(yield T.getBytes(fe.offset,fe.length,S)).data;const Je=new DataView(Ce);return Je.getUint8(0)===31&&Je.getUint8(1)===139&&(Ce=s9(new Uint8Array(Ce))),{data:Ce}}}}})}var J1={getHeader:ic,getZxy:rc},nc=b=>(T,L)=>{if(L instanceof AbortController)return b(T,L);const k=new AbortController;return b(T,k).then(D=>L(void 0,D.data,D.cacheControl||"",D.expires||""),D=>L(D)).catch(D=>L(D)),{cancel:()=>k.abort()}},oc=class{constructor(b){this.tilev4=(T,L)=>Nr(this,null,function*(){if(T.type==="json"){const fe=T.url.substr(10);let te=this.tiles.get(fe);if(te||(te=new g1(fe),this.tiles.set(fe,te)),this.metadata)return{data:yield te.getTileJson(T.url)};const Ce=yield te.getHeader();return{data:{tiles:[`${T.url}/{z}/{x}/{y}`],minzoom:Ce.minZoom,maxzoom:Ce.maxZoom,bounds:[Ce.minLon,Ce.minLat,Ce.maxLon,Ce.maxLat]}}}const k=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),D=T.url.match(k);if(!D)throw new Error("Invalid PMTiles protocol URL");const J=D[1];let S=this.tiles.get(J);S||(S=new g1(J),this.tiles.set(J,S));const c=D[2],be=D[3],me=D[4],de=yield S.getHeader(),Ae=yield S==null?void 0:S.getZxy(+c,+be,+me,L.signal);return Ae?{data:new Uint8Array(Ae.data),cacheControl:Ae.cacheControl,expires:Ae.expires}:de.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=nc(this.tilev4),this.tiles=new Map,this.metadata=(b==null?void 0:b.metadata)||!1}add(b){this.tiles.set(b.source.getKey(),b)}get(b){return this.tiles.get(b)}};function Gs(b,T){return(T>>>0)*4294967296+(b>>>0)}function ac(b,T){const L=T.buf;let k=L[T.pos++],D=(k&112)>>4;if(k<128||(k=L[T.pos++],D|=(k&127)<<3,k<128)||(k=L[T.pos++],D|=(k&127)<<10,k<128)||(k=L[T.pos++],D|=(k&127)<<17,k<128)||(k=L[T.pos++],D|=(k&127)<<24,k<128)||(k=L[T.pos++],D|=(k&1)<<31,k<128))return Gs(b,D);throw new Error("Expected varint not more than 10 bytes")}function g3(b){const T=b.buf;let L=T[b.pos++],k=L&127;return L<128||(L=T[b.pos++],k|=(L&127)<<7,L<128)||(L=T[b.pos++],k|=(L&127)<<14,L<128)||(L=T[b.pos++],k|=(L&127)<<21,L<128)?k:(L=T[b.pos],k|=(L&15)<<28,ac(k,b))}function sc(b,T,L,k){if(k===0){L===1&&(T[0]=b-1-T[0],T[1]=b-1-T[1]);const D=T[0];T[0]=T[1],T[1]=D}}var lc=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function cc(b,T,L){if(b>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(T>js(2,b)-1||L>js(2,b)-1)throw Error("tile x/y outside zoom level bounds");const k=lc[b],D=js(2,b);let J=0,S=0,c=0;const be=[T,L];let me=D/2;for(;me>0;)J=(be[0]&me)>0?1:0,S=(be[1]&me)>0?1:0,c+=me*me*(3*J^S),sc(me,be,J,S),me=me/2;return k+c}function Q1(b,T){return Nr(this,null,function*(){if(T===1||T===0)return b;if(T===2){if(typeof globalThis.DecompressionStream>"u")return s9(new Uint8Array(b));const L=new Response(b).body;if(!L)throw Error("Failed to read response stream");const k=L.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(k).arrayBuffer()}throw Error("Compression method not supported")})}function hc(b){return b===1?".mvt":b===2?".png":b===3?".jpg":b===4?".webp":b===5?".avif":""}var uc=127;function pc(b,T){let L=0,k=b.length-1;for(;L<=k;){const D=k+L>>1,J=T-b[D].tileId;if(J>0)L=D+1;else if(J<0)k=D-1;else return b[D]}return k>=0&&(b[k].runLength===0||T-b[k].tileId<b[k].runLength)?b[k]:null}var dc=class{constructor(b,T=new Headers){this.url=b,this.customHeaders=T,this.mustReload=!1;let L="";"navigator"in globalThis&&(L=globalThis.navigator.userAgent||"");const k=L.indexOf("Windows")>-1,D=/Chrome|Chromium|Edg|OPR|Brave/.test(L);this.chromeWindowsNoCache=!1,k&&D&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(b){this.customHeaders=b}getBytes(b,T,L,k){return Nr(this,null,function*(){let D,J;L?J=L:(D=new AbortController,J=D.signal);const S=new Headers(this.customHeaders);S.set("range",`bytes=${b}-${b+T-1}`);let c;this.mustReload?c="reload":this.chromeWindowsNoCache&&(c="no-store");let be=yield fetch(this.url,{signal:J,cache:c,headers:S});if(b===0&&be.status===416){const fe=be.headers.get("Content-Range");if(!fe||!fe.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const te=+fe.substr(8);be=yield fetch(this.url,{signal:J,cache:"reload",headers:{range:`bytes=0-${te-1}`}})}let me=be.headers.get("Etag");if(me!=null&&me.startsWith("W/")&&(me=null),be.status===416||k&&me&&me!==k)throw this.mustReload=!0,new l9(`Server returned non-matching ETag ${k} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(be.status>=300)throw Error(`Bad response code: ${be.status}`);const de=be.headers.get("Content-Length");if(be.status===200&&(!de||+de>T))throw D&&D.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield be.arrayBuffer(),etag:me||void 0,cacheControl:be.headers.get("Cache-Control")||void 0,expires:be.headers.get("Expires")||void 0}})}};function Xn(b,T){const L=b.getUint32(T+4,!0),k=b.getUint32(T+0,!0);return L*js(2,32)+k}function fc(b,T){const L=new DataView(b),k=L.getUint8(7);if(k>3)throw Error(`Archive is spec version ${k} but this library supports up to spec version 3`);return{specVersion:k,rootDirectoryOffset:Xn(L,8),rootDirectoryLength:Xn(L,16),jsonMetadataOffset:Xn(L,24),jsonMetadataLength:Xn(L,32),leafDirectoryOffset:Xn(L,40),leafDirectoryLength:Xn(L,48),tileDataOffset:Xn(L,56),tileDataLength:Xn(L,64),numAddressedTiles:Xn(L,72),numTileEntries:Xn(L,80),numTileContents:Xn(L,88),clustered:L.getUint8(96)===1,internalCompression:L.getUint8(97),tileCompression:L.getUint8(98),tileType:L.getUint8(99),minZoom:L.getUint8(100),maxZoom:L.getUint8(101),minLon:L.getInt32(102,!0)/1e7,minLat:L.getInt32(106,!0)/1e7,maxLon:L.getInt32(110,!0)/1e7,maxLat:L.getInt32(114,!0)/1e7,centerZoom:L.getUint8(118),centerLon:L.getInt32(119,!0)/1e7,centerLat:L.getInt32(123,!0)/1e7,etag:T}}function e2(b){const T={buf:new Uint8Array(b),pos:0},L=g3(T),k=[];let D=0;for(let J=0;J<L;J++){const S=g3(T);k.push({tileId:D+S,offset:0,length:0,runLength:1}),D+=S}for(let J=0;J<L;J++)k[J].runLength=g3(T);for(let J=0;J<L;J++)k[J].length=g3(T);for(let J=0;J<L;J++){const S=g3(T);S===0&&J>0?k[J].offset=k[J-1].offset+k[J-1].length:k[J].offset=S-1}return k}function mc(b){const T=new DataView(b);return T.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):T.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var l9=class extends Error{};function gc(b,T){return Nr(this,null,function*(){const L=yield b.getBytes(0,16384);if(new DataView(L.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(mc(L.data)<3)return[yield J1.getHeader(b)];const D=L.data.slice(0,uc),J=fc(D,L.etag),S=L.data.slice(J.rootDirectoryOffset,J.rootDirectoryOffset+J.rootDirectoryLength),c=`${b.getKey()}|${J.etag||""}|${J.rootDirectoryOffset}|${J.rootDirectoryLength}`,be=e2(yield T(S,J.internalCompression));return[J,[c,be.length,be]]})}function _c(b,T,L,k,D){return Nr(this,null,function*(){const J=yield b.getBytes(L,k,void 0,D.etag),S=yield T(J.data,D.internalCompression),c=e2(S);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var yc=class{constructor(b=100,T=!0,L=Q1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=b,this.counter=1,this.decompress=L}getHeader(b){return Nr(this,null,function*(){const T=b.getKey(),L=this.cache.get(T);if(L)return L.lastUsed=this.counter++,yield L.data;const k=new Promise((D,J)=>{gc(b,this.decompress).then(S=>{S[1]&&this.cache.set(S[1][0],{lastUsed:this.counter++,data:Promise.resolve(S[1][2])}),D(S[0]),this.prune()}).catch(S=>{J(S)})});return this.cache.set(T,{lastUsed:this.counter++,data:k}),k})}getDirectory(b,T,L,k){return Nr(this,null,function*(){const D=`${b.getKey()}|${k.etag||""}|${T}|${L}`,J=this.cache.get(D);if(J)return J.lastUsed=this.counter++,yield J.data;const S=new Promise((c,be)=>{_c(b,this.decompress,T,L,k).then(me=>{c(me),this.prune()}).catch(me=>{be(me)})});return this.cache.set(D,{lastUsed:this.counter++,data:S}),S})}getArrayBuffer(b,T,L,k){return Nr(this,null,function*(){const D=`${b.getKey()}|${k.etag||""}|${T}|${L}`,J=this.cache.get(D);if(J)return J.lastUsed=this.counter++,yield J.data;const S=new Promise((c,be)=>{b.getBytes(T,L,void 0,k.etag).then(me=>{c(me.data),this.cache.has(D),this.prune()}).catch(me=>{be(me)})});return this.cache.set(D,{lastUsed:this.counter++,data:S}),S})}prune(){if(this.cache.size>=this.maxCacheEntries){let b=1/0,T;this.cache.forEach((L,k)=>{L.lastUsed<b&&(b=L.lastUsed,T=k)}),T&&this.cache.delete(T)}}invalidate(b){return Nr(this,null,function*(){const T=b.getKey();if(this.invalidations.get(T))return yield this.invalidations.get(T);this.cache.delete(b.getKey());const L=new Promise((k,D)=>{this.getHeader(b).then(J=>{k(),this.invalidations.delete(T)}).catch(J=>{D(J)})});this.invalidations.set(T,L)})}},g1=class{constructor(b,T,L){typeof b=="string"?this.source=new dc(b):this.source=b,L?this.decompress=L:this.decompress=Q1,T?this.cache=T:this.cache=new yc}getHeader(){return Nr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(b,T,L,k){return Nr(this,null,function*(){const D=cc(b,T,L),J=yield this.cache.getHeader(this.source);if(J.specVersion<3)return J1.getZxy(J,this.source,this.cache,b,T,L,k);if(b<J.minZoom||b>J.maxZoom)return;let S=J.rootDirectoryOffset,c=J.rootDirectoryLength;for(let be=0;be<=3;be++){const me=yield this.cache.getDirectory(this.source,S,c,J),de=pc(me,D);if(de){if(de.runLength>0){const Ae=yield this.source.getBytes(J.tileDataOffset+de.offset,de.length,k,J.etag);return{data:yield this.decompress(Ae.data,J.tileCompression),cacheControl:Ae.cacheControl,expires:Ae.expires}}S=J.leafDirectoryOffset+de.offset,c=de.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(b,T,L,k){return Nr(this,null,function*(){try{return yield this.getZxyAttempt(b,T,L,k)}catch(D){if(D instanceof l9)return this.cache.invalidate(this.source),yield this.getZxyAttempt(b,T,L,k);throw D}})}getMetadataAttempt(){return Nr(this,null,function*(){const b=yield this.cache.getHeader(this.source),T=yield this.source.getBytes(b.jsonMetadataOffset,b.jsonMetadataLength,void 0,b.etag),L=yield this.decompress(T.data,b.internalCompression),k=new TextDecoder("utf-8");return JSON.parse(k.decode(L))})}getMetadata(){return Nr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(b){if(b instanceof l9)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw b}})}getTileJson(b){return Nr(this,null,function*(){const T=yield this.getHeader(),L=yield this.getMetadata(),k=hc(T.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${b}/{z}/{x}/{y}${k}`],vector_layers:L.vector_layers,attribution:L.attribution,description:L.description,name:L.name,version:L.version,bounds:[T.minLon,T.minLat,T.maxLon,T.maxLat],center:[T.centerLon,T.centerLat,T.centerZoom],minzoom:T.minZoom,maxzoom:T.maxZoom}})}};const xc=""+new URL("../assets/sofc-long-city._9pG-RjY.svg",import.meta.url).href,vc=""+new URL("../assets/top-logo-full.CLxZkqM-.svg",import.meta.url).href,bc="FeatureCollection",wc="current-lines",Tc={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},Sc=[{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 4: Sheppard Subway",Shape_Leng:5364.85343725},geometry:{type:"MultiLineString",coordinates:[[[-79.41092375281919,43.7615218049132],[-79.40963055213436,43.76181000509604],[-79.40826265344609,43.76212200544782],[-79.4071697527289,43.762355405008904],[-79.40495935280303,43.76284058492405],[-79.40413140516124,43.763022565315154],[-79.40307142670252,43.76325062725713],[-79.40250643012322,43.76338658037046],[-79.39988841193566,43.763948576262685],[-79.39725538446311,43.764537576892394],[-79.39491742525415,43.765054595387134],[-79.39332638817442,43.76540959441584],[-79.39222435458395,43.765655598872854],[-79.39024041724267,43.76608658395856],[-79.38910939695296,43.76632764827105],[-79.38864540329645,43.76644263188453],[-79.3877555923701,43.7666634425473],[-79.38673731075237,43.76691612272663],[-79.38334143371412,43.76775859548131],[-79.38225738494785,43.767995575814034],[-79.38136935204051,43.7681856328149],[-79.38052735763078,43.768362651433335],[-79.37948335250886,43.768595581447094],[-79.37857941614597,43.768789621704386],[-79.37769443854488,43.768975642446],[-79.37685037534051,43.76915260473273],[-79.3766522195657,43.769193806360455],[-79.37551344364853,43.769430578079614],[-79.3744024140522,43.76966665064114],[-79.3729544075479,43.76997460964342],[-79.37146937753708,43.77031361940643],[-79.36977337074535,43.77069064894933],[-79.3684878485548,43.77098012099659],[-79.36827546162036,43.77101308894415],[-79.36774068057211,43.771090119972165],[-79.36704425856333,43.771144262329656],[-79.36444080397557,43.77139544587651],[-79.36371033619075,43.771540630176524],[-79.36308084508366,43.771687346695366],[-79.36245334845525,43.771809602364634],[-79.36198039263392,43.771866647809766],[-79.36176135922788,43.77190356603644],[-79.36155533991814,43.77193661830315],[-79.36128435043534,43.771977651913254],[-79.36088842914445,43.77205758086588],[-79.35981441032685,43.77230763526958],[-79.35900634520341,43.772494613622705],[-79.35886842852551,43.77252864064826],[-79.35738737697797,43.772840609102886],[-79.3555673392673,43.773232566716274],[-79.35412042999558,43.773553626212376],[-79.35352636650059,43.77368459672367],[-79.35187835656542,43.774048638520675],[-79.34864439020984,43.774753602647024],[-79.34704151840144,43.77510795723926]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway",Shape_Leng:38405.0453957},geometry:{type:"MultiLineString",coordinates:[[[-79.52727349088153,43.793513825172326],[-79.52617099978977,43.78976899953646],[-79.5243569754248,43.78592846773078],[-79.52369416882507,43.784525085703265],[-79.52286151397485,43.782761982694026],[-79.52249500038332,43.782259999858475],[-79.52198455686704,43.78148220677475],[-79.5211478672689,43.78062414311663],[-79.51906099914154,43.77952099978487],[-79.51606292552397,43.778733503516264],[-79.51194724628076,43.77761209870842],[-79.51163515682028,43.777522526144516],[-79.5054068580706,43.77573469796502],[-79.49964457728832,43.77412869423889],[-79.4973749996726,43.77348499927757],[-79.49519499962918,43.7724859994138],[-79.49374800010708,43.77130800023049],[-79.4930116465944,43.770332014464785],[-79.49215416095949,43.76787848780395],[-79.49098663177287,43.7634904944869],[-79.48918792317782,43.756344901570166],[-79.48867083281066,43.75569498765384],[-79.48789074971641,43.755009030877275],[-79.48705698686152,43.754448530334585],[-79.48608893300737,43.75386996538773],[-79.48499196769755,43.75350539776455],[-79.48381899954093,43.753171999816786],[-79.48260449981765,43.75305725056932],[-79.48181899997557,43.753033999749775],[-79.47833374248796,43.75360650949653],[-79.47248800003902,43.75481999975972],[-79.47105999982108,43.754888000431926],[-79.46961028178676,43.7547896398582],[-79.46787350960444,43.75453889110641],[-79.46594400009326,43.75420700019748],[-79.4642528373622,43.75339950109558],[-79.46353645937727,43.75260630324519],[-79.46247531392282,43.75043844764172],[-79.46212208243938,43.74953831051291],[-79.46194011739122,43.74901725843812],[-79.4617221039932,43.74822827300634],[-79.46129710168191,43.74701232758011],[-79.4611380898345,43.74647529021603],[-79.4609200996387,43.74565425589502],[-79.46057409911124,43.74478531750631],[-79.46011507500215,43.74407130887103],[-79.4596091253966,43.74351428903642],[-79.45905604220873,43.743082300332865],[-79.45843704367306,43.74268128516275],[-79.45782010458532,43.74223231338594],[-79.45711805927532,43.74168830118832],[-79.45635104651751,43.74119030557402],[-79.4554981182329,43.740597251773146],[-79.45492410047395,43.74018125417677],[-79.45437108165423,43.739749241677956],[-79.45366506613551,43.73926231650688],[-79.45317413619473,43.73891323716384],[-79.45241411272971,43.73852027283344],[-79.45189906741356,43.738082280038036],[-79.45146410737348,43.73763628172844],[-79.45113910664261,43.73717124528679],[-79.45084308037217,43.73659929747971],[-79.45021014379246,43.73492526233063],[-79.44995607605625,43.73418824500932],[-79.44992083049014,43.734093177480865],[-79.449455067304,43.73273627085936],[-79.44943713681855,43.73267328400509],[-79.44937807244435,43.732478308262586],[-79.44933412455663,43.73235222562203],[-79.44928712883568,43.732225290993114],[-79.44923614121231,43.73209830056187],[-79.44914312873438,43.73188576259141],[-79.44910160335196,43.73179076848829],[-79.44905260177488,43.731666236186804],[-79.44901911507812,43.731573239406124],[-79.44898808423858,43.73147829764325],[-79.44895910641658,43.73137924322286],[-79.44891761146886,43.731209757538345],[-79.44889307836206,43.73108524148869],[-79.44887710236176,43.73098627296413],[-79.44885710964277,43.730812759806575],[-79.44878716248463,43.730373278249466],[-79.44876614816646,43.73025128677735],[-79.4486976013672,43.7298407654301],[-79.44865839163604,43.729606530229816],[-79.44864907211695,43.72955123414163],[-79.44828911742788,43.72738127902991],[-79.44827216751408,43.727304263042946],[-79.4482341583951,43.727079237306434],[-79.44818913800536,43.726848264850645],[-79.44815418312278,43.726699257744094],[-79.44811615859552,43.726546247277305],[-79.44805411761688,43.72632026540993],[-79.44800810534652,43.72617128742412],[-79.44798717068423,43.72605829789836],[-79.4479490983249,43.72589124539742],[-79.44793513680146,43.72583722347744],[-79.44788714860279,43.7256717443505],[-79.44786833958788,43.72561565532486],[-79.4478511501587,43.72556125206738],[-79.44781209099206,43.72545224717914],[-79.44774811712146,43.725289251327425],[-79.44770217626444,43.72518123428751],[-79.44765216404592,43.725072261230736],[-79.44760018034812,43.72496830273985],[-79.44754614234816,43.72480922325671],[-79.44748616077311,43.72464425689911],[-79.44740116098276,43.72444528399146],[-79.4473421046346,43.72428622639131],[-79.44722109498639,43.723969243005584],[-79.4471591479851,43.72381122630728],[-79.44706811061705,43.72359430184528],[-79.44642713220838,43.72205426051522],[-79.44534416787008,43.71914025957623],[-79.44525911323994,43.718914232487926],[-79.4445051364048,43.71684323439805],[-79.4441892836164,43.71606460679904],[-79.4439721616066,43.715525287345976],[-79.44359515907287,43.71462022412809],[-79.44357219576021,43.71456625743479],[-79.44297016737293,43.712928245552405],[-79.4428801827974,43.71271529102506],[-79.44259214009972,43.71203621553636],[-79.44254012762194,43.71192226128787],[-79.44243318648225,43.71169629371762],[-79.44232320574126,43.711469204747246],[-79.44226717768872,43.71135627628165],[-79.44219919172511,43.711224730721796],[-79.44215215276434,43.71113424869809],[-79.44203418635577,43.710907230096275],[-79.44197416858913,43.71079820780292],[-79.44191322916787,43.71068521184822],[-79.44185218306609,43.710576265474806],[-79.44118227736207,43.709540529342064],[-79.44093322835573,43.709196235585246],[-79.43884344944547,43.70599539768711],[-79.4384841019514,43.705404906640126],[-79.43824284923994,43.704680907420325],[-79.43612024621847,43.699093222674485],[-79.43599448729368,43.69883624212788],[-79.4357252544111,43.69828222570034],[-79.4350953200559,43.697160590143724],[-79.43431410899734,43.696167047844135],[-79.4335846345151,43.695404121593256],[-79.4328042299904,43.6946642579758],[-79.4319652211804,43.69397921695605],[-79.43113127002572,43.69328919682823],[-79.43023423644394,43.69278626808869],[-79.42950426384841,43.69237519732939],[-79.42858418779252,43.69196420940031],[-79.42744822315686,43.69147525560089],[-79.42612227585406,43.691162185533145],[-79.42444527312009,43.69083021698452],[-79.42293027323912,43.69059524923987],[-79.42149723007854,43.69030216212496],[-79.4201982730992,43.68991017782252],[-79.41919725065786,43.68951924034429],[-79.41827823429182,43.6888932153337],[-79.41771026150998,43.68824818682715],[-79.41722324225071,43.68758321407947],[-79.41668225395956,43.686761215300116],[-79.4162491868066,43.68597923895922],[-79.4153387367155,43.68382386131445],[-79.41530821134782,43.68375016208332],[-79.41524222582926,43.68357523752964],[-79.4151562612323,43.68340921840402],[-79.41506529145266,43.683270225525426],[-79.41493728718874,43.68313116901348],[-79.41483621831411,43.68304919893568],[-79.41472325149105,43.682980206083364],[-79.41457428680387,43.68292619770934],[-79.41439719835991,43.68289115364899],[-79.4141252703875,43.68286019491268],[-79.41359521972757,43.68284518546618],[-79.41297026060504,43.68285622224894],[-79.41228022225077,43.682887146297894],[-79.41200225935955,43.68288715499191],[-79.41172420735909,43.68287518849716],[-79.41144623714746,43.68282118346638],[-79.41121625047231,43.68276721413684],[-79.41103425421088,43.682705181423614],[-79.41083127038758,43.68262422119553],[-79.41063923118912,43.68252018619873],[-79.41047328713664,43.682408143947725],[-79.41031829509745,43.68228815108636],[-79.4102062621637,43.68217622723672],[-79.41012627518191,43.682071141567775],[-79.41001321453219,43.681936158054505],[-79.4099212620757,43.68176122973363],[-79.40941329399824,43.680570211956756],[-79.40901421587178,43.67956020755638],[-79.40874525624676,43.678926140242666],[-79.40874125644787,43.678860684871005],[-79.40811927996948,43.67741416803154],[-79.40748221395683,43.675870172517406],[-79.40733026154207,43.675446671337085],[-79.4071103533823,43.674856390409055],[-79.40603127105747,43.67218520847359],[-79.40529425075243,43.670306189340295],[-79.40476228853227,43.66896213928132],[-79.404572266675,43.668471214617085],[-79.40446030723135,43.668184195479824],[-79.40433631470228,43.66799621143384],[-79.40416423979038,43.667820158722655],[-79.40392831881957,43.667672201982676],[-79.40360330418387,43.66756314813952],[-79.40315827249081,43.66755621092361],[-79.4027853180741,43.66760816151889],[-79.40245529850039,43.667653149003335],[-79.40213936167547,43.66769405468421],[-79.40198216146449,43.66772697380442],[-79.40176788786809,43.66776925457408],[-79.4002301335722,43.668087050730044],[-79.40001682007886,43.66813210416375],[-79.3993077092544,43.668283545789635],[-79.3988433661159,43.66838261407731],[-79.3986297060879,43.66842676628029],[-79.39784961679875,43.66858531625297],[-79.39763559855521,43.668628526536885],[-79.39683724470649,43.66878263358354],[-79.3961242328041,43.6688681477629],[-79.39567529368892,43.668919189655405],[-79.39534023783726,43.66893014765577],[-79.39500928317047,43.66888319116454],[-79.39469632156946,43.668798135946545],[-79.39444623145914,43.668672194476834],[-79.394240231149,43.668492141233855],[-79.39396623600365,43.66810813354831],[-79.39370228579335,43.66763919702592],[-79.39356619470021,43.66736898713825],[-79.39351527519699,43.66726514261887],[-79.39292732993239,43.66593717353641],[-79.39265431191589,43.6655671308276],[-79.3923363128131,43.665158194409614],[-79.39208928933068,43.66486818318496],[-79.39185230392864,43.66457012200952],[-79.39161530807891,43.66425711539237],[-79.39144028197154,43.66395218192728],[-79.39128630951765,43.66364016344349],[-79.39116332735107,43.66330517581664],[-79.39106032548113,43.66300710808282],[-79.39098828384145,43.66268714969909],[-79.3909263085863,43.66241918631436],[-79.39090530047515,43.662233177813064],[-79.3908952877033,43.66198016929306],[-79.3908853171699,43.661779192171004],[-79.39088529260438,43.66146618930042],[-79.3908642924036,43.66105017839862],[-79.39077529121424,43.66058811013298],[-79.39046606700207,43.659857997683886],[-79.38997333421982,43.658701141119295],[-79.3899253263202,43.65858811987082],[-79.38963726398462,43.657918177723325],[-79.38947934259116,43.65752913260745],[-79.38931626788965,43.65713011416099],[-79.38895880126334,43.65635062666345],[-79.38858827937662,43.655463108071764],[-79.38830561847277,43.65479389927823],[-79.3879273096429,43.65396412249784],[-79.38757136251671,43.6531081354836],[-79.38754028651704,43.65303513991016],[-79.3872342973562,43.6523111049596],[-79.38698634217874,43.65175316737305],[-79.38661850573622,43.650856326131816],[-79.3862803321309,43.65008717670408],[-79.38612331163331,43.64978816075108],[-79.38580434953495,43.64924416022333],[-79.38554528709557,43.648865114739],[-79.38517633833077,43.64827917716117],[-79.38479549607777,43.64766236336328],[-79.38467737198727,43.64744411324734],[-79.38454332792087,43.64721914720613],[-79.38432233113885,43.64688915690338],[-79.38407133883348,43.64657215531908],[-79.38382037826169,43.64629215332379],[-79.38356532894082,43.64605413168454],[-79.38325430413677,43.6458181073286],[-79.38301929229297,43.64568317149395],[-79.38277530759639,43.6455741247131],[-79.38247935604025,43.6454851375593],[-79.38229236999665,43.64545809409592],[-79.38204934990088,43.64543115905102],[-79.38179033216558,43.64544414512603],[-79.38155138995853,43.64547109903919],[-79.38127436054229,43.645534150702225],[-79.3800043554825,43.64580314119995],[-79.37964531702065,43.64587808002133],[-79.37921034779191,43.64599713063056],[-79.3791354098123,43.64602190060444],[-79.3788323329247,43.646135081628174],[-79.37844338089398,43.64630312481964],[-79.37820728367637,43.646433095423056],[-79.37803529013038,43.646544079849726],[-79.37788134181734,43.646672156187755],[-79.3777243466623,43.64684510717474],[-79.3775962909808,43.6470480877874],[-79.37751432283919,43.64725208168543],[-79.3774803393428,43.64748511315534],[-79.3774773173032,43.64769607943961],[-79.37750336258794,43.64792114060066],[-79.37755229257769,43.64814310728833],[-79.37759329017129,43.64829510414261],[-79.37764927556005,43.648498085448814],[-79.37772030294956,43.648693088699176],[-79.37780734319816,43.648916135663654],[-79.37790745522221,43.64914935005327],[-79.37846033012912,43.650404084683224],[-79.37872928664898,43.6510561399909],[-79.37897432542896,43.65168913319707],[-79.3792564842527,43.65243923759359],[-79.37996327546311,43.654063140909614],[-79.38066426405683,43.65577410793273],[-79.38091439934809,43.65632739930464],[-79.38121429648352,43.65703814032812],[-79.38135932102931,43.657414141448626],[-79.3815763455112,43.65790809775214],[-79.38191433140824,43.658669147828306],[-79.38210731364302,43.659095157605535],[-79.38247924772897,43.65991015802796],[-79.38259930206223,43.6601541035651],[-79.38314238206564,43.66145339484877],[-79.38324529923912,43.66172816342767],[-79.38327225668894,43.66200409834882],[-79.3832173194766,43.662279143997],[-79.3831632818489,43.66247111443144],[-79.3830752917072,43.6627811612269],[-79.383020252857,43.66317413231853],[-79.38306125201417,43.66356315193581],[-79.38314930751025,43.664104160448076],[-79.38323130125958,43.664448120624876],[-79.38339429618456,43.664891166404445],[-79.38352740739313,43.665268425796086],[-79.38534230888776,43.66997210328042],[-79.38565329336626,43.67082115922328],[-79.38572119042006,43.671003936107965],[-79.38579821336027,43.67120714427942],[-79.38593126002706,43.67155911385982],[-79.386244303362,43.67237011690332],[-79.38654727884749,43.673160185400924],[-79.38672721211685,43.67353009779464],[-79.38701529841619,43.67391414269305],[-79.38737621486126,43.674493116581104],[-79.38766822128834,43.67515510738822],[-79.3878722456521,43.67559611506296],[-79.38852420185245,43.677095900215555],[-79.38855924787285,43.67717414055338],[-79.39076447528414,43.68223447659616],[-79.39124584005688,43.68334261618884],[-79.39337622616146,43.68823417318279],[-79.39340079461981,43.68830258259041],[-79.39412618200606,43.6902431657601],[-79.39440821735795,43.69059415684255],[-79.39487024130324,43.69086413647562],[-79.39516523912958,43.69120117476038],[-79.39532717049438,43.69159017559955],[-79.39661719359196,43.69641716342949],[-79.39676013425498,43.69678618074898],[-79.39686219673575,43.696988178088866],[-79.39726724653543,43.69798651470894],[-79.39739213168706,43.69829118181442],[-79.3975082248998,43.69882716942981],[-79.3979191770207,43.70071417211413],[-79.39825218788171,43.70246216949431],[-79.39833717893974,43.703175150039606],[-79.39840516527431,43.70385413369694],[-79.39837116472671,43.704316180445154],[-79.39832417607589,43.70472412422399],[-79.39834313388336,43.70518817216372],[-79.39848011742215,43.70651617722922],[-79.3984641874877,43.70665314535905],[-79.39843801831495,43.70672687584333],[-79.39840911260922,43.70681116868284],[-79.39840414969805,43.706982137149886],[-79.39861614019009,43.707984150738],[-79.3986671277717,43.70821018546002],[-79.39885709637949,43.70908613138642],[-79.39898510564257,43.7095831254351],[-79.39927717256685,43.710911139449166],[-79.39930517062179,43.71107815921199],[-79.39946510375431,43.71184115815635],[-79.3995520791743,43.712288154615536],[-79.39970608086226,43.71300119983906],[-79.39981012031387,43.71353017287787],[-79.3998280913854,43.71365114129058],[-79.40002610938996,43.7145681570462],[-79.40009709165385,43.71494714426935],[-79.40021914934529,43.715453145085874],[-79.40043109804334,43.71637413436407],[-79.40047009435327,43.716605131599096],[-79.40061415186597,43.71725016010813],[-79.40083907490244,43.71833417774896],[-79.40093712790235,43.718750180135956],[-79.4011301274438,43.71954919678856],[-79.40117706330179,43.71998221922964],[-79.40139006304025,43.720980189205356],[-79.40158306552142,43.72196815450806],[-79.40179504796093,43.72310113941776],[-79.40183110872485,43.72345821115886],[-79.40192808853685,43.723788139684764],[-79.40205611010857,43.72432518726911],[-79.4021781778105,43.724957383520135],[-79.40218310602566,43.725101134908556],[-79.40235209128355,43.72568016287931],[-79.4025030591642,43.72629017725381],[-79.40282711599721,43.72743318780096],[-79.40293212275006,43.727835153591684],[-79.4030540968996,43.728319183545175],[-79.40311606974973,43.7285761557515],[-79.4032821005986,43.729159192243124],[-79.40333704690536,43.72943019937642],[-79.40345506876129,43.7299321783909],[-79.40354304943354,43.730266211136694],[-79.40370410749003,43.730867181207984],[-79.40375007683748,43.73113320191576],[-79.4039670511915,43.731884206151676],[-79.40399210030431,43.73197421432473],[-79.40419501405911,43.73290020185859],[-79.40420907484186,43.73299914888203],[-79.40438403680172,43.73366314697542],[-79.40444209692744,43.733898188852656],[-79.40451906627584,43.7341691424924],[-79.40456203889691,43.73436319538664],[-79.40482207884362,43.73552915773397],[-79.40492106943911,43.73601214516429],[-79.40512806694305,43.73697815503296],[-79.40515302923274,43.737488194160996],[-79.40499504989441,43.73797722549339],[-79.40505604717214,43.73873820178552],[-79.40563202064526,43.74189116349851],[-79.4060030057459,43.74358618489129],[-79.40620116045555,43.74427146701154],[-79.40689000729392,43.746947191272916],[-79.40704398722703,43.74727718932458],[-79.40736798050378,43.747661226995945],[-79.40759900290016,43.74782819107803],[-79.40774704012955,43.748027217552995],[-79.40796299312579,43.74875119313741],[-79.40832799066347,43.74996118732262],[-79.4084099768914,43.75030323311742],[-79.4084630503259,43.75067719285337],[-79.40848298037837,43.750953198316815],[-79.40852099664413,43.751215235771205],[-79.40850404761609,43.751870160497454],[-79.40854404441347,43.75238220785436],[-79.40861502854113,43.752776221085746],[-79.40865304735965,43.75293728925171],[-79.40868795712862,43.75308519246205],[-79.40875502967357,43.7533021731413],[-79.40880295193249,43.753519157397605],[-79.4088760058387,43.75383515234919],[-79.40893000403412,43.75420921408762],[-79.40898398161438,43.754557170486095],[-79.40907402867691,43.754912200773894],[-79.40918401505108,43.755195222837955],[-79.40932002022078,43.755505161901596],[-79.40944700054608,43.75585422363506],[-79.40957694903534,43.75633115493006],[-79.40962800177981,43.75648417871302],[-79.4096829592001,43.75665615936958],[-79.40983799614283,43.75722615996091],[-79.409867986267,43.75733919089657],[-79.40992994333753,43.75758715599803],[-79.41005294436123,43.758017180420374],[-79.41011097026596,43.7582242219822],[-79.41032702320811,43.75905117360972],[-79.41054701434797,43.75994623438971],[-79.41073595764715,43.760714206894356],[-79.4107900056512,43.76096719416965],[-79.41092375281919,43.7615218049132],[-79.41114401595365,43.76234922946229],[-79.41136593877934,43.76326124068076],[-79.41152695064179,43.76388920157301],[-79.41155295517355,43.76399821792259],[-79.41162699436906,43.76430117038587],[-79.4117519691942,43.76481619665897],[-79.41197899153136,43.7656561710855],[-79.41219991534216,43.76656420536709],[-79.41230493938464,43.76693924448526],[-79.41243590725632,43.76747217681234],[-79.4126579074005,43.76839417606896],[-79.41277542810697,43.76884010123739],[-79.41289196139292,43.76927520518584],[-79.41309794046497,43.77013720816859],[-79.41320192843591,43.770571194118865],[-79.41330290728983,43.770991185337614],[-79.41356193235526,43.77199021265969],[-79.41362497943763,43.772256194488364],[-79.4138189767617,43.77297922032613],[-79.41401791059509,43.77377919143599],[-79.41437093937188,43.775157241582406],[-79.41474092875748,43.77658422607996],[-79.41483690260321,43.77694617497349],[-79.41507396368853,43.77789025097591],[-79.41527296302401,43.778681217202546],[-79.41557005612061,43.7797706087645]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - 15-min",NAME:"UP Express",Shape_Leng:24584.7561911},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.38896668448932,43.6428347821212],[-79.39356540400317,43.6418841724241],[-79.39566764062788,43.64144954271135],[-79.39875653782256,43.64090088489534],[-79.39909563886147,43.64082928530636],[-79.39932353826936,43.6407831858509],[-79.39990213769336,43.64069168455643],[-79.40178503765942,43.6404791839412],[-79.40220403829885,43.64043848336318],[-79.4038009385715,43.64028348526098],[-79.40489144022357,43.640214484904895],[-79.40589713989041,43.64016718500682],[-79.40642583997958,43.640150484863504],[-79.40750704056985,43.640153284742055],[-79.40798323991275,43.640165684070894],[-79.4088414405955,43.64018358315855],[-79.40981464187051,43.64022098435758],[-79.41128054150656,43.640277184720524],[-79.41664264362261,43.64048268465344],[-79.41832914380898,43.64054718252954],[-79.41965897059258,43.64059809418227],[-79.42096514459317,43.64064808377894],[-79.42198674562145,43.640693083977524],[-79.42249964614962,43.64073068413838],[-79.42318024590425,43.640808183599766],[-79.42364914561132,43.640878484336596],[-79.4243176458737,43.64101368397455],[-79.42494434637247,43.641159284860755],[-79.42544004784438,43.641297984702625],[-79.42587044648022,43.64142648471231],[-79.42630964593708,43.641567184737156],[-79.42664254622996,43.641682384221696],[-79.42698494679561,43.641815283707864],[-79.42721154777959,43.64190508371685],[-79.42757824645277,43.64206648444312],[-79.42794094753032,43.64223388358606],[-79.42835894753546,43.64242778388468],[-79.42877454667583,43.642621828775205],[-79.42930604767004,43.64286998453135],[-79.42974414751237,43.64308098398085],[-79.43039924861766,43.64337808438584],[-79.43102204877155,43.64365948294463],[-79.43413494858689,43.645129483110004],[-79.43440494901085,43.64525728409082],[-79.43650904980538,43.64620388322246],[-79.43885735100227,43.64731688451022],[-79.43897895031796,43.64738028490352],[-79.43923635188091,43.6475155829396],[-79.43931525191557,43.647556483855574],[-79.43989925126114,43.647861984615986],[-79.44038945119615,43.648150285001975],[-79.44123915127741,43.64869078435432],[-79.44195695302042,43.649199783984095],[-79.44316305372412,43.65016808520824],[-79.44383205349939,43.65076018344082],[-79.44428645416767,43.651200385158376],[-79.44775835488606,43.65477218563099],[-79.44971695571395,43.65676768568385],[-79.45056650123823,43.65763325084943],[-79.45193458365357,43.65902697411834],[-79.45395075810904,43.66108078637148],[-79.45447355708815,43.661655984610306],[-79.45551755844953,43.662698586536216],[-79.45726245932754,43.66446958570159],[-79.45773955884357,43.66487488548724],[-79.45811445784177,43.6652239864971],[-79.45860994181524,43.66572654879516],[-79.4600468642213,43.66718390847331],[-79.46008735866522,43.66722548628857],[-79.4608454593628,43.66801218704334],[-79.46133176134282,43.668596887529986],[-79.46300106092039,43.67030138686198],[-79.46341606020728,43.67069898679642],[-79.46509086143074,43.67239298820157],[-79.46569716244386,43.67301188789032],[-79.46592622560229,43.673245699250714],[-79.4663003612489,43.67362758791116],[-79.46666376221611,43.67399118689911],[-79.46684126267293,43.67416408737311],[-79.46730196334168,43.67463588769778],[-79.46832916343206,43.675671086978895],[-79.46954216562445,43.67684328789876],[-79.47036736413678,43.67756808767192],[-79.47124636411127,43.67830788753772],[-79.47246896393142,43.67925808679545],[-79.47331696526496,43.67988108897701],[-79.47414986551848,43.68045998844334],[-79.47589566646536,43.68156128824581],[-79.47664396672864,43.68200118923341],[-79.47828616775661,43.68288918725199],[-79.47980416803343,43.683641389107464],[-79.48071156695272,43.684099088692925],[-79.4870351696517,43.6872885884326],[-79.48726361240753,43.687386017226224],[-79.48760917039128,43.687572287685065],[-79.490214370932,43.688852389734755],[-79.4932110722399,43.69032458788521],[-79.49783507317461,43.692595989917656],[-79.49964947519499,43.69348718941152],[-79.50153924791516,43.6944272630014],[-79.50171017499343,43.694512289485296],[-79.50613237700821,43.696711990323756],[-79.5069699777601,43.697126690214105],[-79.50911707880923,43.6981890898547],[-79.51107375458658,43.69915724391705],[-79.51367107987792,43.700442290403316],[-79.51438327955526,43.70079468965487],[-79.5169956803438,43.70208698987233],[-79.51892588118274,43.7030417908123],[-79.51900048236148,43.70307859006805],[-79.52103518307541,43.70410849037298],[-79.52220728287797,43.704657690426465],[-79.52377448362459,43.705295090425],[-79.52426368352843,43.70546749077404],[-79.52546898412412,43.70582459089074],[-79.52607168452778,43.70598899020953],[-79.52723758472514,43.70627239079117],[-79.52777918497478,43.706394690376996],[-79.52852338530927,43.706534090742345],[-79.5292350851962,43.706631090475305],[-79.52984708589233,43.70670669062208],[-79.53082458551363,43.70680139102337],[-79.53139428559518,43.70684159047475],[-79.53225078685566,43.70688409095956],[-79.53296338636765,43.70690148966102],[-79.53326328735449,43.70690579089846],[-79.5335380875232,43.706907290319684],[-79.53502598714876,43.70687858905474],[-79.53729778891787,43.70683459038559],[-79.54250448912089,43.706733689460926],[-79.54283769072525,43.70672718946714],[-79.54912139117238,43.70660498981189],[-79.55104329206584,43.70657308881754],[-79.55526669318445,43.706492088179914],[-79.55534870568539,43.706490587589485],[-79.5566665842237,43.70646646291042],[-79.55685629340984,43.70646298962426],[-79.55773419461356,43.706446789235876],[-79.56185613751319,43.7063689078992],[-79.56387299635816,43.70633078902031],[-79.56444819557854,43.70631968802252],[-79.56574409672537,43.706294189292876],[-79.56935949770478,43.706226388331466],[-79.57247929907108,43.70616318727339],[-79.57553090163941,43.706103787894506],[-79.57765980163336,43.706063288571585],[-79.58389980302384,43.70594428704698],[-79.58580360325915,43.70590718643173],[-79.58859010406897,43.70585098738217],[-79.59028435593322,43.70581854520243],[-79.5925259050589,43.70577558717416],[-79.59572290646862,43.70571608632091],[-79.5991296073918,43.70564788738863],[-79.60065880799662,43.705616486707434],[-79.60271080869961,43.7055778874376],[-79.60396630880916,43.70555188635752],[-79.60652730962067,43.705501987149624],[-79.60885700560894,43.7054554915382],[-79.60901406025462,43.70545027594227],[-79.60950183842486,43.70543407456866],[-79.61050886047641,43.70536728359374],[-79.61163836089122,43.70531258342132],[-79.6120685608403,43.70529028394498],[-79.61251523345862,43.70526881815646],[-79.61276356301586,43.705256882587165],[-79.61305786171921,43.70523868383873],[-79.61318956140973,43.70523158291145],[-79.61358726216659,43.705148482877824],[-79.61380616246088,43.70507048331844],[-79.61394346229338,43.70499248279928],[-79.61410456351138,43.704892183799586],[-79.61425036135834,43.70476818330608],[-79.61433606344468,43.704684882614416],[-79.61447086210609,43.70449958244259],[-79.6145440615179,43.70431918293729],[-79.61457076153683,43.70419408343565],[-79.61457566259062,43.70402928314147],[-79.61456406206875,43.70389928391927],[-79.6145074624386,43.7037056826462],[-79.61433946219994,43.703443383457],[-79.61423456139023,43.703333983290975],[-79.61390506145482,43.70304758358603],[-79.61180846114814,43.70128408311707],[-79.61154716127149,43.701059083134524],[-79.61121436004606,43.7007342820074],[-79.61103296053562,43.70051288278371],[-79.61091986078749,43.70033728304518],[-79.61072345987584,43.699988382987016],[-79.61053046150852,43.69949878290415],[-79.61002296040016,43.6981104821705],[-79.60992806176615,43.697692982167126],[-79.60991815987842,43.697378982672085],[-79.60995805993426,43.69708658246017],[-79.61003295945889,43.69688088135072],[-79.61014605934997,43.696642682032525],[-79.61032075971728,43.696380381612286],[-79.6117701607469,43.694756182162216],[-79.61188166108293,43.694612982241416],[-79.61205636040825,43.694344681516164],[-79.61221446094765,43.69405118148552],[-79.6123259608733,43.69377078160009],[-79.61239256077646,43.693542181389056],[-79.61260886061324,43.692815482132964],[-79.6128118600266,43.69207918121822],[-79.61310135980015,43.69108168105322],[-79.61334266164022,43.69022858161816],[-79.61345566733276,43.689836168578545],[-79.61380696093906,43.68861627994068],[-79.6139150610413,43.688239680207566],[-79.61405316049625,43.68793888099359],[-79.61417136188456,43.687706580686886],[-79.61439096006109,43.687408180365196],[-79.61481696097833,43.68688958059554],[-79.61565326212447,43.68587937975611],[-79.61572226206616,43.685774080155085],[-79.61578376079805,43.6856814799506],[-79.61584166074806,43.6855139798873],[-79.6158557612727,43.68542627936874],[-79.61586486110248,43.68534208002358],[-79.61586676049583,43.6852552793966],[-79.61585206087726,43.68515798026584],[-79.6158274606821,43.68505487992023],[-79.61577686079607,43.68492188015771],[-79.61570306102307,43.68478417906872],[-79.61557346103031,43.684622979737995],[-79.61543356088238,43.68449557976827],[-79.61534416098088,43.68442247947688],[-79.61506056067803,43.684208778992534],[-79.61482056161577,43.684023579858724],[-79.61454566003626,43.683812579637674],[-79.61318556008385,43.68276547988443]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak Only",NAME:"Stouffville Line",Shape_Leng:11715.0413332},geometry:{type:"MultiLineString",coordinates:[[[-79.26311009999094,43.89934925159068],[-79.26240181955458,43.90475613691971],[-79.26233601927358,43.905529337113315],[-79.2623414193221,43.905727536798636],[-79.26238791905268,43.90605993798173],[-79.26250191899575,43.906675536057655],[-79.26269272001493,43.907403937699684],[-79.26289631987859,43.90810393687942],[-79.26311302030473,43.909214637454674],[-79.26311501925694,43.909574837126996],[-79.26304312058616,43.909906837510476],[-79.26295792008536,43.91017303760314],[-79.26284781998724,43.91042933711087],[-79.26256382066533,43.91097103831],[-79.26217412049375,43.911523337056146],[-79.2616072194877,43.91217193865077],[-79.25897681991985,43.91524713789311],[-79.25867921808943,43.91562973926427],[-79.25848381915192,43.91592383902035],[-79.25831071804149,43.916308338817956],[-79.2582019188797,43.91662183818588],[-79.25804441923341,43.91732174000482],[-79.25778111934981,43.91951453927419],[-79.25772301949043,43.92022494080798],[-79.25753961924389,43.920960439261506],[-79.25741841910626,43.92127374029527],[-79.25719521955614,43.921666440436816],[-79.25676511955935,43.92231714090835],[-79.25576141954677,43.92384144055165],[-79.25529001981457,43.92462653967772],[-79.255168419715,43.92494884088958],[-79.25510971879609,43.92525404089434],[-79.25510181898397,43.92552404090861],[-79.25515251955287,43.92592094090066],[-79.25520891917678,43.926119941644615],[-79.25530221964425,43.92633744176698],[-79.25576311931323,43.92719084036488],[-79.2563850199225,43.92850584148844],[-79.25658651923722,43.92928314203142],[-79.25672582058684,43.930059640949636],[-79.25675701919995,43.930367040983874],[-79.25674572033864,43.930590442190734],[-79.25672751941745,43.930851941274014],[-79.25665342095893,43.93125594173014],[-79.25654411974138,43.93158744215286],[-79.25631902037561,43.9320431413182],[-79.25580082023123,43.93271954198413],[-79.25405661884362,43.93442154252486],[-79.25348041863082,43.93495304320212],[-79.25293991862435,43.93553894219856],[-79.25277141996175,43.93576144296946],[-79.25258801884836,43.936057943686535],[-79.2524967184882,43.93620744187134],[-79.25231131969876,43.93658274343625],[-79.25221701923466,43.936824442870005],[-79.25203531800793,43.9374969429737],[-79.25198531876046,43.937928343266904],[-79.25197001891037,43.938873443705624],[-79.25197251851503,43.93963884360658],[-79.25200471903632,43.940665743532364],[-79.25199241992249,43.94151184464151],[-79.2520240187489,43.943412044148864],[-79.25201061887029,43.943871043660735],[-79.25189901924819,43.94512974483753],[-79.25175891982626,43.94736044482369],[-79.25171281945255,43.94765684477761],[-79.25164212036917,43.94794384471321],[-79.25149141938209,43.94840974511187],[-79.25121272029361,43.948990745445826],[-79.25100231934437,43.94936564576593],[-79.25063171983632,43.950107246017794],[-79.25043081956832,43.950581344895554],[-79.25026522078281,43.95112804606071],[-79.25018841945351,43.95162204560264],[-79.2501776204623,43.951991045595804],[-79.25020312016642,43.952396545189416],[-79.2504020192695,43.95368704549699],[-79.25049002019541,43.95450774704852],[-79.25062532024693,43.95541914637861],[-79.2506873210377,43.955852246353956],[-79.25082162143885,43.9567997473672],[-79.25094542124481,43.95767494636369],[-79.250976520635,43.95831464769912],[-79.2508275210783,43.96084234795392],[-79.25073032127568,43.96202934772453],[-79.25065542165257,43.96330674831066],[-79.25050662088896,43.96582544730252],[-79.25043722178434,43.966490648352945],[-79.25038222154947,43.96751614910092],[-79.25037342090046,43.96759524831873],[-79.25036452174305,43.96771184849403],[-79.25034242126682,43.968018548538794],[-79.25024552178027,43.96909144860922],[-79.25019422243612,43.97035474774629],[-79.2501752658453,43.970619191882804],[-79.2500599048941,43.97224657628012],[-79.25003952147537,43.972533849642126],[-79.24996042245601,43.97367104911459],[-79.24991082304203,43.97419684932135],[-79.249800922853,43.97490965044134],[-79.24978732198696,43.974972949715614],[-79.24975772279826,43.97519554963216],[-79.24960902162313,43.97601255015022],[-79.24948632198202,43.976370849655396],[-79.24940652152925,43.97654064931513],[-79.24917032083239,43.97694225005565],[-79.2486416220072,43.97753734999831],[-79.24827922135455,43.97799094983335],[-79.24753202097959,43.97880775052208],[-79.24698952058642,43.97944774971537],[-79.2468318202439,43.97963915069833],[-79.2466018213983,43.97990995136171],[-79.2460087212067,43.980576051188045],[-79.24573732166053,43.9808805498743],[-79.24550512117256,43.98116255031197],[-79.24502812087638,43.98169545073064],[-79.24482071971524,43.981962351264414],[-79.24457622096384,43.98221965100583],[-79.24372442163857,43.9831969507929],[-79.24349322041606,43.98342755090944],[-79.24307211991075,43.9837541514315],[-79.24270372038774,43.98398255117625],[-79.24091952062051,43.98486445169639],[-79.2405896192113,43.985057451487975],[-79.24027161988795,43.985268652750605],[-79.23993791956958,43.985587552814934],[-79.23969311938122,43.98585395099062],[-79.23945872006631,43.98619245277991],[-79.23930091965536,43.98646915185559],[-79.2387746195577,43.98782055273733],[-79.23850961891941,43.98834765239406],[-79.23555594372914,43.993448524576614],[-79.23538091817922,43.99378235390003],[-79.23520361793634,43.99403735391899],[-79.23509651950194,43.994186352705036],[-79.23496631903743,43.9943257542394],[-79.23486751794005,43.99441375372127],[-79.23477371902442,43.99452435407324],[-79.23468181984735,43.99461285455568],[-79.23453941937976,43.99477645295697],[-79.23436911888226,43.99496425431562],[-79.2343042186398,43.99504535377383],[-79.23425141911656,43.99511765423942],[-79.23418841962116,43.995210554517236],[-79.23410221895627,43.9953554542775],[-79.23391951874419,43.99567095483428],[-79.23373041806703,43.99598585421327],[-79.23342981895998,43.996512054585985],[-79.23315348411927,43.99699436522631],[-79.2330563175482,43.99716395476835],[-79.23294301801896,43.99737565461369],[-79.23281791929585,43.99759165433882],[-79.2326544179508,43.99789585481726],[-79.23258591782455,43.998044053970375],[-79.23251911848783,43.998204654774675],[-79.23241791777153,43.99847755457938]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak & Limited Off-Peak",NAME:"Kitchener Line",Shape_Leng:39039.5103073},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.38896668448932,43.6428347821212],[-79.39356540400317,43.6418841724241],[-79.39566764062788,43.64144954271135],[-79.39875653782256,43.64090088489534],[-79.39909563886147,43.64082928530636],[-79.39932353826936,43.6407831858509],[-79.39990213769336,43.64069168455643],[-79.40178503765942,43.6404791839412],[-79.40220403829885,43.64043848336318],[-79.4038009385715,43.64028348526098],[-79.40489144022357,43.640214484904895],[-79.40589713989041,43.64016718500682],[-79.40642583997958,43.640150484863504],[-79.40750704056985,43.640153284742055],[-79.40798323991275,43.640165684070894],[-79.4088414405955,43.64018358315855],[-79.40981464187051,43.64022098435758],[-79.41128054150656,43.640277184720524],[-79.41664264362261,43.64048268465344],[-79.41832914380898,43.64054718252954],[-79.41965897059258,43.64059809418227],[-79.42096514459317,43.64064808377894],[-79.42198674562145,43.640693083977524],[-79.42249964614962,43.64073068413838],[-79.42318024590425,43.640808183599766],[-79.42364914561132,43.640878484336596],[-79.4243176458737,43.64101368397455],[-79.42494434637247,43.641159284860755],[-79.42544004784438,43.641297984702625],[-79.42587044648022,43.64142648471231],[-79.42630964593708,43.641567184737156],[-79.42664254622996,43.641682384221696],[-79.42698494679561,43.641815283707864],[-79.42721154777959,43.64190508371685],[-79.42757824645277,43.64206648444312],[-79.42794094753032,43.64223388358606],[-79.42835894753546,43.64242778388468],[-79.42877454667583,43.642621828775205],[-79.42930604767004,43.64286998453135],[-79.42974414751237,43.64308098398085],[-79.43039924861766,43.64337808438584],[-79.43102204877155,43.64365948294463],[-79.43413494858689,43.645129483110004],[-79.43440494901085,43.64525728409082],[-79.43650904980538,43.64620388322246],[-79.43885735100227,43.64731688451022],[-79.43897895031796,43.64738028490352],[-79.43923635188091,43.6475155829396],[-79.43931525191557,43.647556483855574],[-79.43989925126114,43.647861984615986],[-79.44038945119615,43.648150285001975],[-79.44123915127741,43.64869078435432],[-79.44195695302042,43.649199783984095],[-79.44316305372412,43.65016808520824],[-79.44383205349939,43.65076018344082],[-79.44428645416767,43.651200385158376],[-79.44775835488606,43.65477218563099],[-79.44971695571395,43.65676768568385],[-79.45056650123823,43.65763325084943],[-79.45193458365357,43.65902697411834],[-79.45395075810904,43.66108078637148],[-79.45447355708815,43.661655984610306],[-79.45551755844953,43.662698586536216],[-79.45726245932754,43.66446958570159],[-79.45773955884357,43.66487488548724],[-79.45811445784177,43.6652239864971],[-79.45860994181524,43.66572654879516],[-79.4600468642213,43.66718390847331],[-79.46008735866522,43.66722548628857],[-79.4608454593628,43.66801218704334],[-79.46133176134282,43.668596887529986],[-79.46300106092039,43.67030138686198],[-79.46341606020728,43.67069898679642],[-79.46509086143074,43.67239298820157],[-79.46569716244386,43.67301188789032],[-79.46592622560229,43.673245699250714],[-79.4663003612489,43.67362758791116],[-79.46666376221611,43.67399118689911],[-79.46684126267293,43.67416408737311],[-79.46730196334168,43.67463588769778],[-79.46832916343206,43.675671086978895],[-79.46954216562445,43.67684328789876],[-79.47036736413678,43.67756808767192],[-79.47124636411127,43.67830788753772],[-79.47246896393142,43.67925808679545],[-79.47331696526496,43.67988108897701],[-79.47414986551848,43.68045998844334],[-79.47589566646536,43.68156128824581],[-79.47664396672864,43.68200118923341],[-79.47828616775661,43.68288918725199],[-79.47980416803343,43.683641389107464],[-79.48071156695272,43.684099088692925],[-79.4870351696517,43.6872885884326],[-79.48726361240753,43.687386017226224],[-79.48760917039128,43.687572287685065],[-79.490214370932,43.688852389734755],[-79.4932110722399,43.69032458788521],[-79.49783507317461,43.692595989917656],[-79.49964947519499,43.69348718941152],[-79.50153924791516,43.6944272630014],[-79.50171017499343,43.694512289485296],[-79.50613237700821,43.696711990323756],[-79.5069699777601,43.697126690214105],[-79.50911707880923,43.6981890898547],[-79.51107375458658,43.69915724391705],[-79.51367107987792,43.700442290403316],[-79.51438327955526,43.70079468965487],[-79.5169956803438,43.70208698987233],[-79.51892588118274,43.7030417908123],[-79.51900048236148,43.70307859006805],[-79.52103518307541,43.70410849037298],[-79.52220728287797,43.704657690426465],[-79.52377448362459,43.705295090425],[-79.52426368352843,43.70546749077404],[-79.52546898412412,43.70582459089074],[-79.52607168452778,43.70598899020953],[-79.52723758472514,43.70627239079117],[-79.52777918497478,43.706394690376996],[-79.52852338530927,43.706534090742345],[-79.5292350851962,43.706631090475305],[-79.52984708589233,43.70670669062208],[-79.53082458551363,43.70680139102337],[-79.53139428559518,43.70684159047475],[-79.53225078685566,43.70688409095956],[-79.53296338636765,43.70690148966102],[-79.53326328735449,43.70690579089846],[-79.5335380875232,43.706907290319684],[-79.53502598714876,43.70687858905474],[-79.53729778891787,43.70683459038559],[-79.54250448912089,43.706733689460926],[-79.54283769072525,43.70672718946714],[-79.54912139117238,43.70660498981189],[-79.55104329206584,43.70657308881754],[-79.5513734916574,43.70656668949991],[-79.55526669318445,43.706492088179914],[-79.55534870568539,43.706490587589485],[-79.5566665842237,43.70646646291042],[-79.55685629340984,43.70646298962426],[-79.55773419461356,43.706446789235876],[-79.56185613751319,43.7063689078992],[-79.56387299635816,43.70633078902031],[-79.56444819557854,43.70631968802252],[-79.56574409672537,43.706294189292876],[-79.56935949770478,43.706226388331466],[-79.57247929907108,43.70616318727339],[-79.57553090163941,43.706103787894506],[-79.57765980163336,43.706063288571585],[-79.58389980302384,43.70594428704698],[-79.58580360325915,43.70590718643173],[-79.58859010406897,43.70585098738217],[-79.59028435593322,43.70581854520243],[-79.5925259050589,43.70577558717416],[-79.59572290646862,43.70571608632091],[-79.5991296073918,43.70564788738863],[-79.60065880799662,43.705616486707434],[-79.60271080869961,43.7055778874376],[-79.60396630880916,43.70555188635752],[-79.60652730962067,43.705501987149624],[-79.60885700560894,43.7054554915382],[-79.60901406025462,43.70545027594227],[-79.60950183842486,43.70543407456866],[-79.60997941102261,43.70543018657661],[-79.61150951121384,43.705397485003566],[-79.61221081113123,43.70539358524281],[-79.61258826939108,43.705385265947875],[-79.61297741279752,43.70537668632248],[-79.6136880121133,43.70536098653781],[-79.61621481252608,43.70531018599192],[-79.62106161333935,43.70521448467156],[-79.62265861588773,43.705179184842045],[-79.62469841663597,43.70513878534328],[-79.627046716836,43.705092085931],[-79.63292281806565,43.70497858560348],[-79.63626751921886,43.70491058508975],[-79.6370992194513,43.70489388513073],[-79.63803259636202,43.70487519131765],[-79.64140225015599,43.704807627008506],[-79.64186842119072,43.70479828483132],[-79.6440749215726,43.70475378333303],[-79.64415430376516,43.70475218543609],[-79.64803352310985,43.704673984882376],[-79.65155102420134,43.70460578490394],[-79.65343342372356,43.704569183988596],[-79.65563342624914,43.704526484378356],[-79.66172572669844,43.704404483054375],[-79.66485732836212,43.70434048392458],[-79.66619293007993,43.70431528333612],[-79.66728232858853,43.70429338373874],[-79.66966973034833,43.704245583122415],[-79.67204193067101,43.704197083128136],[-79.67337043030636,43.70416458313923],[-79.67441943095785,43.70413858300666],[-79.67532813234432,43.70410518245533],[-79.6764739323093,43.70403418229451],[-79.67703643230136,43.70399588336645],[-79.67797103310023,43.70392128315553],[-79.67901833202215,43.703831283098395],[-79.68008123330789,43.703724882744105],[-79.68033233373295,43.703693982446914],[-79.68061173297579,43.703650682634745],[-79.68112519822945,43.70357315858126],[-79.68184053365725,43.70348058336681],[-79.68282973375258,43.70328858251532],[-79.68431563455219,43.70298888218185],[-79.68491853523759,43.70286248191749],[-79.68536033487857,43.70277378244609],[-79.68651403483642,43.70254758220048],[-79.68776603544427,43.7022992826548],[-79.68867273617508,43.70213528235997],[-79.6892871366064,43.702019881924244],[-79.690644136178,43.70174808159963],[-79.69109433703885,43.70165848181605],[-79.69134799436176,43.70160743157633],[-79.69440792372332,43.70099155572637],[-79.69462352941358,43.70094815730421],[-79.72434942705375,43.69496020948196],[-79.7573150826395,43.688305703920236],[-79.76191360846298,43.6873617737344],[-79.76382444536902,43.68699463965382],[-79.81735300052678,43.676167359460706],[-79.82243206339777,43.6751392852407]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway",Shape_Leng:26304.8527828},geometry:{type:"MultiLineString",coordinates:[[[-79.26453221184322,43.732266098722796],[-79.26698131129733,43.73131322297664],[-79.26773199164836,43.73077833414625],[-79.26992324802656,43.72846373019236],[-79.2701992539812,43.72823620399774],[-79.27205817319242,43.726184685155346],[-79.27366061163501,43.72442529144082],[-79.27409162796923,43.72395159138032],[-79.27413265633992,43.72382170170648],[-79.27451159599877,43.72328599643612],[-79.27462215537253,43.723120901227944],[-79.27470475472965,43.72296740201281],[-79.2748606548855,43.72263750211016],[-79.27505929233676,43.722205970206296],[-79.27528685039327,43.721845095162536],[-79.27670065515922,43.71910370190708],[-79.27723185595498,43.717928200950894],[-79.2772393128298,43.71778564643619],[-79.27733134879729,43.71760663511183],[-79.2773763184861,43.717512612799254],[-79.27742032624485,43.71742361579451],[-79.27746437486257,43.717329579048915],[-79.27750735855508,43.717240568312434],[-79.2775903245625,43.717056557812995],[-79.27770932194692,43.71677956145265],[-79.27778533802646,43.71659157582832],[-79.27789338159191,43.71631459306296],[-79.27792831698909,43.71622059872003],[-79.2779944010182,43.71603264314842],[-79.27803439887444,43.715915591081576],[-79.27808931030837,43.715749611919186],[-79.27816040386821,43.7155796459715],[-79.27826132811492,43.71532956184997],[-79.27829334245693,43.715244615177006],[-79.27835532616324,43.71507460171875],[-79.27838532366653,43.71498863576352],[-79.27844137122698,43.71481862244336],[-79.27849538307363,43.71464461758833],[-79.27854531688493,43.71447361212214],[-79.27860536727671,43.71424955750266],[-79.27896135902373,43.712540585809606],[-79.27920482088315,43.71118674888005],[-79.2793023130052,43.71064459389265],[-79.27950932578423,43.70957656660313],[-79.27973436401676,43.70838260162784],[-79.27983631912643,43.70783456678652],[-79.28004135556668,43.70652363400275],[-79.28033032215534,43.70485757621046],[-79.28045235390977,43.70411161852535],[-79.28059637930726,43.703240593191815],[-79.28068132231968,43.70272857815992],[-79.2808723778327,43.70157955788949],[-79.28094039924535,43.70117963271401],[-79.28094931776734,43.701089567699576],[-79.28096935104611,43.70091856106938],[-79.28098133598621,43.70082863154243],[-79.28102130831415,43.700568625132405],[-79.28106038369368,43.70034362295976],[-79.28107439078033,43.700236620056764],[-79.28109737208347,43.70010562701927],[-79.28113938188272,43.699917577981026],[-79.28116835592208,43.69980962887544],[-79.28120036281824,43.69970658766383],[-79.2812353358811,43.69960359082367],[-79.2812733903068,43.69949658979592],[-79.28131532195484,43.69939360714255],[-79.28136032425581,43.69929058083825],[-79.28140835250076,43.699192641525],[-79.28145436607032,43.69909359208032],[-79.28150239805267,43.69899556271842],[-79.28155532698226,43.6989015671666],[-79.28160935378817,43.69880857912958],[-79.28166740011334,43.69871457079642],[-79.28172739024428,43.69862059224772],[-79.28179132960723,43.698531623218265],[-79.2818233274825,43.69848259399522],[-79.28189135953832,43.69839359761418],[-79.28196133661721,43.698304629204756],[-79.28201586654043,43.69824058915516],[-79.28214940195915,43.69808663732624],[-79.28222936869052,43.698002590785585],[-79.28231034277067,43.69792261018618],[-79.28240934461058,43.69782057559357],[-79.28250738258727,43.69772356719717],[-79.28258936879615,43.697647562389214],[-79.28267233648168,43.697576613609094],[-79.282736896246,43.69751956647177],[-79.2828923958049,43.69739555957039],[-79.2829613194728,43.69734510323297],[-79.28310082593997,43.69724363280017],[-79.28317232427312,43.69719262944069],[-79.28331739384235,43.69710055943469],[-79.28341739719681,43.69703859687772],[-79.28359634272493,43.69693362164252],[-79.2836753183321,43.69688961711918],[-79.28394531166606,43.696758642363285],[-79.28401230989144,43.69672364055659],[-79.28414533720972,43.69666262457966],[-79.28431932518097,43.69658435376287],[-79.2844873528399,43.696510584688134],[-79.2845573687276,43.69648463004249],[-79.28462732320435,43.69645363271712],[-79.28483931735234,43.69637561723484],[-79.28528339468599,43.69620764391094],[-79.28643640326702,43.695769618430404],[-79.28756131930254,43.6953365625977],[-79.28795540050204,43.69518457213624],[-79.28944988696027,43.69462148390246],[-79.28966731572957,43.694539559288344],[-79.28981132940858,43.69448761220506],[-79.28988333249481,43.69446357521591],[-79.2924433368194,43.69345159509642],[-79.29954636179967,43.68972455228197],[-79.30084736290566,43.68929857604615],[-79.30201568614244,43.68898228361567],[-79.30262041128852,43.68881856331492],[-79.30351133018218,43.68860557292536],[-79.30573331974087,43.6881025597259],[-79.30787339065887,43.68761161369865],[-79.30907241007723,43.68733760674547],[-79.31115435871048,43.6869216260964],[-79.31142340844741,43.686871590056604],[-79.31216638521022,43.686707566505824],[-79.31244632245452,43.68665957934038],[-79.31298838252019,43.68654993413321],[-79.31428039762443,43.68628858141543],[-79.31575832987181,43.68590960490028],[-79.31671232118111,43.68570257110266],[-79.31766239070086,43.68549655282835],[-79.31815531532114,43.68538660307714],[-79.31870733952435,43.685281570543296],[-79.319725372491,43.68504457846591],[-79.32068932489837,43.684842610187864],[-79.32137740469939,43.68470463617738],[-79.32167533280219,43.684623582801265],[-79.32310023725358,43.68433270882061],[-79.3241243632649,43.684123635110005],[-79.32525338616536,43.683874627994676],[-79.32610233288572,43.683697574308404],[-79.32669040867665,43.6835716074798],[-79.32765638580901,43.68334656441237],[-79.32875439190057,43.68311561174974],[-79.32981733101576,43.68290556217844],[-79.33028496843181,43.6828108390438],[-79.33043122884992,43.682781212257574],[-79.33183435122925,43.68246655954101],[-79.3328673454465,43.68224362055807],[-79.33534541953517,43.68170757745174],[-79.33585236446102,43.6816026158334],[-79.33778279540728,43.68118438831076],[-79.33830334250885,43.68107160487173],[-79.33992032701161,43.68077058416862],[-79.3405974220294,43.68064556777799],[-79.34109338600592,43.68054861565578],[-79.3422633419124,43.680327579551644],[-79.34356840773866,43.680062580292024],[-79.34475706388767,43.679822975420166],[-79.34517705220624,43.679740991262804],[-79.34660139334488,43.67945862837263],[-79.34675034743856,43.67942855583818],[-79.34782939459588,43.6792195609915],[-79.3487943372829,43.67903060222885],[-79.34898037008226,43.67899309573205],[-79.35021538202506,43.67874955900722],[-79.35123433418806,43.67855262661266],[-79.35225797931253,43.678349974456424],[-79.35250159815755,43.678301742256636],[-79.35327339901893,43.67814560941997],[-79.35374234297309,43.678062616040236],[-79.35454135111048,43.677902634375236],[-79.35554435402436,43.67770057368989],[-79.35685435191975,43.67744557602741],[-79.3578883824858,43.677260593806224],[-79.35803975805366,43.677235043522614],[-79.35818899451917,43.67718668554256],[-79.35832153688224,43.677112793338274],[-79.35878746541634,43.67683851006695],[-79.35979831386265,43.67624342675586],[-79.35998868850939,43.676123011784156],[-79.36018732236616,43.67601846782264],[-79.36039861535443,43.67592994782419],[-79.36065059885128,43.67585713664245],[-79.36153332456745,43.675686374069066],[-79.3642627591332,43.67515831850602],[-79.3666333619731,43.67469962450547],[-79.36709183161119,43.67453599233784],[-79.36832954763126,43.673966749751806],[-79.36946694010294,43.673290976321574],[-79.37008453873719,43.6729508833863],[-79.37038718715792,43.6727597039226],[-79.37088545412784,43.67255971103434],[-79.37140555205617,43.67239528856803],[-79.37191682165768,43.672296016247024],[-79.37261515318012,43.67223949231599],[-79.3732187214517,43.67222274844052],[-79.37399840226456,43.67226256824625],[-79.37590463292771,43.67245689123612],[-79.3761722340802,43.67245789162827],[-79.37641603296457,43.67242909197437],[-79.37684683414754,43.67236249161371],[-79.37905443510134,43.67191659060214],[-79.37945913496124,43.67183419054571],[-79.38055753571878,43.67161279016723],[-79.38150433742821,43.67141859432072],[-79.38252342152049,43.67120455128988],[-79.38318141623238,43.671124561986424],[-79.38376435555772,43.67106655305938],[-79.38412037755025,43.67104863281318],[-79.3844773595092,43.67105962109758],[-79.38486942203046,43.67107461499033],[-79.38524143030314,43.67107456058865],[-79.38572119042006,43.671003936107965],[-79.38744388281033,43.670742501323005],[-79.38917221845479,43.67039357830688],[-79.38986892801687,43.670215066658955],[-79.38999911373666,43.67018170975688],[-79.39100836696133,43.66997762435616],[-79.39145043033358,43.66988959610202],[-79.3945353513255,43.66928761954287],[-79.39626934947616,43.66890255391181],[-79.39683724470649,43.66878263358354],[-79.39763559855521,43.668628526536885],[-79.39784961679875,43.66858531625297],[-79.3986297060879,43.66842676628029],[-79.3988433661159,43.66838261407731],[-79.3993077092544,43.668283545789635],[-79.40001682007886,43.66813210416375],[-79.4002301335722,43.668087050730044],[-79.40176788786809,43.66776925457408],[-79.40198216146449,43.66772697380442],[-79.40213936167547,43.66769405468421],[-79.4031013493027,43.66747255738532],[-79.40397290797851,43.667288967992114],[-79.40426440008757,43.66722756413342],[-79.4049124260699,43.6670925772894],[-79.40574838367904,43.66692861264702],[-79.40666841169916,43.666733586634805],[-79.40706637300119,43.666644612195405],[-79.40786744399217,43.6664805955746],[-79.40907437490593,43.66624561708538],[-79.4098581805013,43.66607270284949],[-79.41051518250009,43.665937720096395],[-79.41149035828344,43.66572523759914],[-79.41295919307052,43.66543174351566],[-79.4141722454472,43.66516474846113],[-79.4151202829832,43.66485544568828],[-79.415887178061,43.66463589557723],[-79.41653714430171,43.66446396210458],[-79.41764106770495,43.664226923942685],[-79.4183463568356,43.66407775740112],[-79.41876082851032,43.66399009519683],[-79.41929411097345,43.663867934077054],[-79.42146064192008,43.66340735742934],[-79.42260556831866,43.66316129629906],[-79.42381454216127,43.66289432206805],[-79.42497860828126,43.662631306672345],[-79.42519153638521,43.66258031858127],[-79.42593834687263,43.66242489258555],[-79.42639196169185,43.662330483331615],[-79.42740459790225,43.662120270801104],[-79.42807646749932,43.66198062017378],[-79.42877168950105,43.66180032647446],[-79.42935352939688,43.66161072944938],[-79.4301474426299,43.661375071536966],[-79.4315190274561,43.66103841216162],[-79.43205905983113,43.66090638130109],[-79.4328219986606,43.66073635389207],[-79.43330404902436,43.66063934960034],[-79.43413204694748,43.660464354730955],[-79.43440902600148,43.660423409337376],[-79.43546823908665,43.6602019381381],[-79.4356620447695,43.66016141349547],[-79.4367369721792,43.659928386142994],[-79.43790397805235,43.659705338014234],[-79.43880534280929,43.6595237502052],[-79.43950674107714,43.659418462988725],[-79.43985657137756,43.65939938378719],[-79.44013305626981,43.65941270058719],[-79.44066730776332,43.659396046684634],[-79.44138336172445,43.65935261192386],[-79.44262372664221,43.65912663494231],[-79.44548046778587,43.65860611861638],[-79.45015591695513,43.65775405072766],[-79.45056650123823,43.65763325084943],[-79.45127861996959,43.657464730818255],[-79.45241178664325,43.65718086444376],[-79.4526656710118,43.657117262778684],[-79.45346044258596,43.65689986888678],[-79.4542305099547,43.65672259480442],[-79.45537338647473,43.65646654410672],[-79.45731745876448,43.656018573507914],[-79.45747345496278,43.65598061982708],[-79.45907743764255,43.655646585309135],[-79.45923841574245,43.65561760895148],[-79.45985406029854,43.655475280454176],[-79.4604713647147,43.65533256485369],[-79.46145844855609,43.655120625639604],[-79.46276438550787,43.654827626870194],[-79.46412839268731,43.65452657158783],[-79.46572145561814,43.654164571229956],[-79.46622416348103,43.65405869927624],[-79.46732636545475,43.653826562255254],[-79.46902780505349,43.653387861428925],[-79.47034481015017,43.65309492118853],[-79.47149388624364,43.65282690908247],[-79.47210380189016,43.65269490158245],[-79.47318484466007,43.65244783620769],[-79.47433273859141,43.652076344426085],[-79.47461874680361,43.652007335443265],[-79.47542480295257,43.65182940343705],[-79.47576374730187,43.651753357588404],[-79.47620737244918,43.65166364959874],[-79.47655975858774,43.651592389307815],[-79.47748777806905,43.65137033760959],[-79.47793479140952,43.651282400446064],[-79.47841676480968,43.65116638929112],[-79.47933879460194,43.65095837884542],[-79.48072479987817,43.6506663268914],[-79.48122206556367,43.6505455825582],[-79.48252176640572,43.65026565182865],[-79.48304577794288,43.65013217481171],[-79.48446270911083,43.64979582237103],[-79.48463942846367,43.64975385848866],[-79.48483435526614,43.64970759679785],[-79.4850747512127,43.64961356147859],[-79.48537640133974,43.64945012038264],[-79.48570152007692,43.649243690005655],[-79.4859810195355,43.64907455296817],[-79.48618838724894,43.64892759401636],[-79.4862704562758,43.64884757186242],[-79.48640139965974,43.64876756717376],[-79.48655343520096,43.64870260519834],[-79.48670044339197,43.648650539592],[-79.48707336575312,43.648551592544536],[-79.48744841015842,43.648453572552626],[-79.48776644594702,43.64839854656891],[-79.48812436841935,43.64836754489539],[-79.48851046549271,43.64835059696849],[-79.48927241497283,43.64837858513447],[-79.49004442636053,43.648388607772475],[-79.49089622257445,43.6485594859862],[-79.49141013122663,43.64874002923421],[-79.49402942667334,43.64972876548288],[-79.49424636055008,43.64980382007433],[-79.4949164213159,43.65002374703758],[-79.49509364397973,43.65008319438172],[-79.49526837784084,43.650141806021004],[-79.4964204221444,43.650370391590926],[-79.49711343151328,43.65049861849046],[-79.49749140534117,43.6505945999323],[-79.49787040439942,43.65065359444369],[-79.49840640977634,43.65066955087764],[-79.49872937708436,43.6506875666447],[-79.49911042026649,43.65070562427142],[-79.49952145999164,43.65069760831079],[-79.49971942541224,43.65067257167528],[-79.50007444447868,43.65061061651161],[-79.50235237888916,43.650095591915495],[-79.50351238575466,43.6498405436092],[-79.50461546867763,43.64957159672889],[-79.50576142657904,43.64932561392157],[-79.50643646255341,43.64916060718476],[-79.51072645314055,43.648262547383126],[-79.51128934331189,43.64812285587491],[-79.511846451437,43.64796854487163],[-79.51275944034991,43.647755556170736],[-79.51389645970896,43.64750856559255],[-79.5140603949552,43.64746559641931],[-79.51454140698861,43.647355543125535],[-79.51487840776034,43.647305549365896],[-79.51611247547358,43.64701559742882],[-79.5173499224301,43.6467415649649],[-79.51931840067759,43.64640056361515],[-79.52055843765115,43.64621155439442],[-79.521558449063,43.64602059693634],[-79.52282941430961,43.645749594355756],[-79.52397038566659,43.645471586597004],[-79.52459729578054,43.64533327517238],[-79.52506742442067,43.64522955015907],[-79.5261748169198,43.64501883098614],[-79.52709703347445,43.64479284549291],[-79.52766176772974,43.644449107155545],[-79.52801234511863,43.64414811760098],[-79.5281549525222,43.64394602334712],[-79.52833321334917,43.643700929517216],[-79.528511473172,43.64345153454266],[-79.5287313265364,43.643193538821],[-79.53127450098225,43.64102203198282],[-79.53389492031236,43.63891064970329],[-79.53627981377508,43.6369438357019]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak & Limited Off-Peak",NAME:"Barrie Line",Shape_Leng:101276.553781},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.38896668448932,43.6428347821212],[-79.39356540400317,43.6418841724241],[-79.39566764062788,43.64144954271135],[-79.39875653782256,43.64090088489534],[-79.39909563886147,43.64082928530636],[-79.39932353826936,43.6407831858509],[-79.39990213769336,43.64069168455643],[-79.40178503765942,43.6404791839412],[-79.40220403829885,43.64043848336318],[-79.4038009385715,43.64028348526098],[-79.40489144022357,43.640214484904895],[-79.40589713989041,43.64016718500682],[-79.40642583997958,43.640150484863504],[-79.40750704056985,43.640153284742055],[-79.40798323991275,43.640165684070894],[-79.4088414405955,43.64018358315855],[-79.40981464187051,43.64022098435758],[-79.41128054150656,43.640277184720524],[-79.41664264362261,43.64048268465344],[-79.41832914380898,43.64054718252954],[-79.41965897059258,43.64059809418227],[-79.42096514459317,43.64064808377894],[-79.42198674562145,43.640693083977524],[-79.42249964614962,43.64073068413838],[-79.42318024590425,43.640808183599766],[-79.42364914561132,43.640878484336596],[-79.4243176458737,43.64101368397455],[-79.42494434637247,43.641159284860755],[-79.42544004784438,43.641297984702625],[-79.42587044648022,43.64142648471231],[-79.42630964593708,43.641567184737156],[-79.42664254622996,43.641682384221696],[-79.42698494679561,43.641815283707864],[-79.42721154777959,43.64190508371685],[-79.42757824645277,43.64206648444312],[-79.42794094753032,43.64223388358606],[-79.42835894753546,43.64242778388468],[-79.42877454667583,43.642621828775205],[-79.42930604767004,43.64286998453135],[-79.42974414751237,43.64308098398085],[-79.43039924861766,43.64337808438584],[-79.43102204877155,43.64365948294463],[-79.43413494858689,43.645129483110004],[-79.43440494901085,43.64525728409082],[-79.43650904980538,43.64620388322246],[-79.43885735100227,43.64731688451022],[-79.43897895031796,43.64738028490352],[-79.43923635188091,43.6475155829396],[-79.43931525191557,43.647556483855574],[-79.43989925126114,43.647861984615986],[-79.44038945119615,43.648150285001975],[-79.44098135187176,43.64892298488955],[-79.44131225185659,43.64930048344817],[-79.44164055207528,43.64974268420011],[-79.44181325143755,43.6499970850545],[-79.44207315284638,43.65040528483427],[-79.44235625235632,43.65091928509996],[-79.44261715245055,43.65149098480332],[-79.44514914064203,43.657742789128015],[-79.44519165366884,43.657847686059014],[-79.44548046778587,43.65860611861638],[-79.44570235484608,43.65918878614478],[-79.44678425537242,43.661851085830044],[-79.4489885569241,43.6672743873944],[-79.44924485642693,43.66787678803917],[-79.44944485690975,43.66829088675343],[-79.44980465642048,43.668939188153914],[-79.45010575632563,43.66941638791832],[-79.45049005672612,43.66996108699602],[-79.45201145738388,43.67187008801878],[-79.45233785785605,43.67220778789364],[-79.45291415886616,43.672703088051115],[-79.45350015749314,43.67311288830295],[-79.45433255856351,43.67363528819543],[-79.45494845837433,43.67407658853501],[-79.45519325855717,43.67428368732234],[-79.45546505819745,43.674544886859536],[-79.45586425830847,43.67500858737598],[-79.45598019616949,43.675167978012446],[-79.45618366011576,43.67544078817707],[-79.45637915877819,43.67573788859731],[-79.4572036614957,43.67711548885969],[-79.45794006112479,43.6781643889153],[-79.45882746037894,43.679532888872345],[-79.4610549617132,43.68288218978281],[-79.46125976050641,43.68322888996189],[-79.46141036212714,43.68352598955242],[-79.46154196153422,43.68382758949386],[-79.46167426225766,43.68419669032225],[-79.4618057622304,43.684573389610996],[-79.4624892627224,43.68737528970258],[-79.46279316259141,43.68862118920665],[-79.4629053626416,43.68899029075726],[-79.46306636313113,43.6894269906203],[-79.46331526302858,43.68997159094805],[-79.46373306255478,43.69075939108537],[-79.46407736284945,43.69134009075513],[-79.46462152259826,43.69217341784832],[-79.46470176271073,43.692311190396076],[-79.46493186359884,43.69270579163025],[-79.46519456369477,43.69324429160826],[-79.46540586322683,43.69379469130158],[-79.46575756398289,43.69500459170946],[-79.46651766410241,43.69777329055973],[-79.46677666424094,43.69866579244741],[-79.46805756637002,43.70307879261351],[-79.46847976650437,43.704689792969916],[-79.46880816553444,43.70610469369087],[-79.4697203671622,43.71063699438535],[-79.4697400665264,43.710735394257256],[-79.47008146649107,43.7124312947503],[-79.47203866833378,43.72238619654034],[-79.47245199405711,43.724541546554775],[-79.473183568783,43.7281168962417],[-79.47339107039502,43.729155797545296],[-79.4735870693877,43.73013639731556],[-79.47375157069979,43.730942197963486],[-79.47591297232992,43.741530599500855],[-79.47611637128142,43.7425528997029],[-79.47709747262805,43.74748565013513],[-79.47762277245124,43.74992090033077],[-79.47833374248796,43.75360650949653],[-79.47852307281237,43.75458790093742],[-79.4788220736301,43.75602350182715],[-79.47929357474867,43.758496802156],[-79.47996717509767,43.7618192017666],[-79.48001757542409,43.7620749027928],[-79.48071907511505,43.76562080188036],[-79.4807537520682,43.76576213076007],[-79.48079597555105,43.7660091032449],[-79.48188357512947,43.77150580375126],[-79.48230777580771,43.773558004586526],[-79.48256117649643,43.774626803427516],[-79.4830126765313,43.77696800502379],[-79.4833874315956,43.77886526456533],[-79.48347867731005,43.77932720558866],[-79.48432847703704,43.78362430683383],[-79.4843893916038,43.783855661879024],[-79.48457747834956,43.7845921058023],[-79.4849581779133,43.786086305949404],[-79.48526437821045,43.7874998067834],[-79.48536607905514,43.7879697057597],[-79.48568527918349,43.789945706971345],[-79.48626157877497,43.79296140707379],[-79.48640808024285,43.793727607659065],[-79.48669417988765,43.795060307994646],[-79.48702332697549,43.796721110652015],[-79.48709228020664,43.797069408232026],[-79.48717387988528,43.79748150898121],[-79.48769758107227,43.80012460833542],[-79.48808998210029,43.80230870792823],[-79.48819666993063,43.80278688291527],[-79.48849058092682,43.804168809065],[-79.48904098159558,43.80699420863657],[-79.48920378149853,43.8079327082351],[-79.48942948203123,43.80884510915504],[-79.48960818251977,43.80946300956548],[-79.48989148217595,43.81024480844278],[-79.49026738364134,43.811116109757265],[-79.49053508277699,43.81162230956563],[-79.49075978232028,43.81201680959414],[-79.49112098211533,43.81263261024184],[-79.49220258289974,43.81425690974611],[-79.49274248354422,43.81503830946286],[-79.49368828393676,43.81649140979713],[-79.49396168535377,43.81699021061359],[-79.4940904848689,43.81726991030176],[-79.49453888474756,43.818357610903796],[-79.4947237843104,43.81882801061266],[-79.49484428445302,43.81922581055882],[-79.49509218404097,43.82031061094773],[-79.49553838505985,43.82284551142586],[-79.49639648576844,43.82773991300372],[-79.49810871285223,43.83750288618258],[-79.49845913715201,43.83950021436658],[-79.49936938883349,43.84434341438961],[-79.499480388731,43.84487901557189],[-79.49960588884083,43.84532791488816],[-79.49971058837656,43.84560611529037],[-79.49986518836694,43.845936114916206],[-79.5000776883664,43.846360615444766],[-79.50093858892656,43.8477495144238],[-79.50343659014685,43.85133871547247],[-79.5047918908279,43.85336431551138],[-79.505921091705,43.85498171717577],[-79.50630249175734,43.85565301675497],[-79.50645629188966,43.85597021735132],[-79.50659029266082,43.856396815673484],[-79.50665672285793,43.856755922590764],[-79.50670169177013,43.856999017253045],[-79.5067432915508,43.857432516394695],[-79.50680429207938,43.85798251742763],[-79.50690299239123,43.85851501719343],[-79.50708449236521,43.85921971768021],[-79.50719755400512,43.85958649368376],[-79.50731859157018,43.8599274171784],[-79.507891192849,43.861301018229916],[-79.50812809284191,43.86178131813454],[-79.50842609277417,43.862307417448505],[-79.50913219274543,43.86343301812147],[-79.50972929456415,43.86444021776705],[-79.51169119393906,43.86761701837132],[-79.51188359345133,43.867889618692914],[-79.51310319439735,43.869895218957325],[-79.51451579607867,43.872146418773625],[-79.51586779688178,43.87434281952866],[-79.51652459674114,43.8753190189675],[-79.51816919810234,43.87740691978801],[-79.51943579834872,43.879034919842915],[-79.52012329803304,43.879926120427704],[-79.52111119924227,43.88125342030125],[-79.52210109929403,43.88249971997765],[-79.52307789926903,43.88377282111231],[-79.5233052996728,43.884144920138866],[-79.52373350015985,43.88495182049946],[-79.5240042001686,43.885585521065494],[-79.52405000054269,43.885748120635725],[-79.5241264001094,43.8861813203977],[-79.52444733661392,43.8893782733372],[-79.52460519946146,43.89095052139351],[-79.52468430103438,43.89182462208051],[-79.5247181002844,43.89247332264724],[-79.52472150035149,43.89284252230098],[-79.52472910098314,43.89327722204505],[-79.52468990154173,43.893754622616086],[-79.52458590133119,43.89429932209978],[-79.52444900140007,43.895069122192425],[-79.52440660060438,43.89551242210607],[-79.5244144008436,43.896205822230044],[-79.52441920148296,43.89625982254865],[-79.5246422018911,43.89873932377777],[-79.52550980308418,43.90838692490749],[-79.52628070394006,43.91695592736955],[-79.52647530418848,43.91815592562741],[-79.52665670394005,43.918878527433186],[-79.52674389658114,43.919151224682686],[-79.5269689047597,43.91985492718568],[-79.52754000448189,43.92195112766047],[-79.52823860535486,43.924436127838455],[-79.52837760458296,43.924861028170334],[-79.52871900490149,43.92617092710879],[-79.52877730559881,43.926333727502936],[-79.52883290530902,43.92660462786756],[-79.52888480600802,43.927028427849784],[-79.52890010509965,43.92741582739917],[-79.52887930551614,43.92775762836626],[-79.52873720560014,43.92846712780086],[-79.52853880554194,43.92893272865464],[-79.52825270609948,43.92942422759356],[-79.52781550547923,43.92997682940372],[-79.52744390437503,43.93039522893551],[-79.52723970634376,43.930590628363404],[-79.52678200606077,43.930962929081225],[-79.5260991040053,43.93137722928322],[-79.52544320496742,43.93170192962749],[-79.52458740515206,43.932051029461746],[-79.51990330315401,43.933548029602065],[-79.51440640213356,43.93554073007766],[-79.51292580098712,43.93607742990909],[-79.50989100036361,43.93716862976793],[-79.50453999806254,43.93909213052566],[-79.50441429773164,43.939135531522524],[-79.50397259749424,43.9392967314668],[-79.50338189796929,43.93956313139412],[-79.50315519766797,43.93965923155019],[-79.502877498057,43.93979963140692],[-79.5024986985838,43.94000173224604],[-79.50222029926998,43.940169131426494],[-79.50166119797055,43.940603031325736],[-79.50153369795885,43.94071843099905],[-79.50130409790383,43.940931432137994],[-79.50115029876886,43.94110053196337],[-79.50065999790806,43.94176933172811],[-79.5000783983188,43.942599032217316],[-79.49983269826122,43.942955931334694],[-79.49913399724952,43.943982232347516],[-79.49884949846937,43.94439263300246],[-79.49813109747679,43.945435332457954],[-79.4956029960518,43.94910383294293],[-79.49515099690659,43.94972813350072],[-79.4944049962461,43.95081383342307],[-79.4924469963148,43.95366303395592],[-79.49198209633161,43.954305134271515],[-79.48878629532744,43.95893573556269],[-79.48860069618821,43.959201134997286],[-79.48839859492911,43.95947983483599],[-79.4881794953494,43.95976503567796],[-79.48794289578906,43.9600403359803],[-79.48767999588792,43.96028963572623],[-79.48742879563777,43.96049823599863],[-79.48724739421871,43.960632736639404],[-79.48693529595596,43.96087443600995],[-79.48645729644907,43.96117963682927],[-79.486063496318,43.96139983540483],[-79.48551429656882,43.96163853681492],[-79.48460939611954,43.96193263538712],[-79.48174959585974,43.96263303658074],[-79.4808599951217,43.962842737308215],[-79.47991279433315,43.96309243705301],[-79.47905649359708,43.9634258366007],[-79.47848229440092,43.963688135821386],[-79.47785479358363,43.964040136169395],[-79.47729269308977,43.964365436892734],[-79.47651969381964,43.96485933731501],[-79.47583349331514,43.965372337187546],[-79.4751951932159,43.96595803697758],[-79.47480609350455,43.96641853684378],[-79.47444999304095,43.96694203796603],[-79.47425099331949,43.96729603770774],[-79.47346089316484,43.96942823810553],[-79.47297599267921,43.970835337391165],[-79.47277089296858,43.97154393776666],[-79.47260279259972,43.97226193895335],[-79.47249739308583,43.972971838840664],[-79.47232309383423,43.9744190391922],[-79.47216519243682,43.97504723946705],[-79.47202179412422,43.97544013831936],[-79.47184139366418,43.9758213393511],[-79.47163099331779,43.9761295393541],[-79.47134029405669,43.97648693997542],[-79.47111609285514,43.976739539101764],[-79.4708623936526,43.976972938654534],[-79.47047259315416,43.977289139133774],[-79.46966049295177,43.97785413989987],[-79.46924869274065,43.97810534061335],[-79.46504639042108,43.980542940515264],[-79.46336586763516,43.9815316550351],[-79.46321869059705,43.981618240833605],[-79.46296929041472,43.98176484065693],[-79.46191919163307,43.982382641610954],[-79.45861199045906,43.98434594034581],[-79.4579672895651,43.98477204124224],[-79.45750828860689,43.98515034214113],[-79.45716288972564,43.9854877408255],[-79.45687998932462,43.985817041495814],[-79.45664378914744,43.98616014124887],[-79.45642508837977,43.98653124245295],[-79.45613148957332,43.987274541125615],[-79.4560205884264,43.987812641900895],[-79.4559693896613,43.98823574125042],[-79.4559606894305,43.9887193415955],[-79.45603168937097,43.98919994201507],[-79.45612188970918,43.98957034180599],[-79.45616529181844,43.9896994429149],[-79.45899369031234,43.9981085446544],[-79.45945345614324,43.999503014587184],[-79.45955584523834,43.99981351312992],[-79.46005549206343,44.001328643862166],[-79.4607978912583,44.003579944071944],[-79.46253739252828,44.00867234514441],[-79.4635150927533,44.01165014573399],[-79.46375529327412,44.01236344575596],[-79.4639500947675,44.013125746468084],[-79.464046094857,44.013886845598726],[-79.46408099505258,44.01452374690015],[-79.46414059309758,44.01579694660372],[-79.46432329536397,44.019703847194386],[-79.46445809475055,44.02174424748937],[-79.46447849449838,44.02240184596066],[-79.46438989476184,44.023418047145626],[-79.46416799579933,44.02427934808428],[-79.46183289452125,44.03013614889873],[-79.4617520947352,44.030342048518605],[-79.45982879537901,44.035241150145225],[-79.45890969425876,44.03747964979338],[-79.45782730212999,44.04038746384106],[-79.45732259457237,44.04179115144489],[-79.45637649503668,44.0443804524931],[-79.45447839425213,44.049574952889394],[-79.45425529465848,44.05021985257542],[-79.45418889439487,44.05066325234557],[-79.45421239376346,44.051030952367476],[-79.4542917936822,44.051471253011705],[-79.45441839428568,44.05181535282423],[-79.45469059420579,44.0523862530263],[-79.455095994216,44.05312105416479],[-79.45725119614535,44.05666145480516],[-79.45779699590923,44.0575373539209],[-79.4582609966018,44.05816065400169],[-79.45945322000077,44.05952750553179],[-79.46016309749994,44.06033885468426],[-79.46027379717123,44.0604656547879],[-79.46056279752185,44.060874754548024],[-79.46074089759855,44.06122825499534],[-79.46090279703678,44.06172565479202],[-79.46094649762988,44.061969254210226],[-79.46095909791292,44.06244665535937],[-79.46089889815829,44.06284195499818],[-79.4607350981467,44.063379954980356],[-79.45975149715836,44.06568055551214],[-79.45778129790504,44.069903555695284],[-79.45754559728891,44.07032355618931],[-79.45706739620854,44.07094735631447],[-79.45547499668977,44.072636457517795],[-79.4550859966832,44.0731894564585],[-79.45492799669222,44.07350235737072],[-79.45480649463389,44.07385185760684],[-79.45472749643521,44.07411955734496],[-79.45467839667968,44.07445335736219],[-79.45467619721158,44.07477025645236],[-79.45471099775722,44.075120057822176],[-79.45474289767125,44.075336557781654],[-79.45518138348868,44.07722850180242],[-79.45526071424075,44.077577786571624],[-79.45538939626327,44.07812612182529],[-79.45564729800113,44.07925965785246],[-79.45578589734323,44.0798883580511],[-79.45684439902008,44.08433225810939],[-79.45696019883444,44.08467555878139],[-79.45708969850617,44.08498385903393],[-79.45725389777932,44.08531735869912],[-79.45745969933634,44.08564605824487],[-79.45759529859579,44.08585485949063],[-79.45778559912067,44.086082658711994],[-79.45800069890869,44.086307759323226],[-79.45823639904235,44.08652085925434],[-79.4586161986752,44.086805058684924],[-79.45892459946633,44.08698755869888],[-79.45928189983351,44.087147159600164],[-79.45964079918495,44.087295859230714],[-79.46004899974962,44.08742765911676],[-79.46048790032646,44.08754415891989],[-79.46094290036368,44.087637759430734],[-79.46141579970951,44.08770715866877],[-79.46311080145152,44.08785365986956],[-79.47148820370334,44.08857715876928],[-79.47215640384553,44.0886721582123],[-79.47270190374374,44.08878675945786],[-79.47312320454552,44.08891025851368],[-79.47376450374705,44.08913205894351],[-79.4747555042789,44.08953605849057],[-79.47835670554416,44.09100415815949],[-79.47883300657708,44.09118165861347],[-79.47945220673918,44.09135125957733],[-79.48019000534013,44.09149615837639],[-79.48831100914896,44.09303455874278],[-79.4895492364895,44.09325803104026],[-79.49058330988171,44.09346485804628],[-79.49110251112052,44.093601358689256],[-79.49157641048554,44.09374605954262],[-79.49195551008415,44.09389555904596],[-79.49239831121358,44.094092259210136],[-79.49262811101175,44.0942058590083],[-79.49304101050579,44.09445735886105],[-79.49350070983427,44.0947881583981],[-79.4939523109003,44.095184858467356],[-79.49431781199846,44.09553555910863],[-79.49471971241498,44.09598355826301],[-79.49732181231643,44.099167659613755],[-79.49759251356319,44.099460659390225],[-79.49799461299538,44.099862159251934],[-79.4984472123258,44.100246159300156],[-79.49887711320412,44.100539959985596],[-79.4992493140807,44.10076505940863],[-79.4995685130405,44.10093075943121],[-79.49999951358996,44.10111285959519],[-79.5005316141621,44.1013179597608],[-79.5011644138293,44.10152555953792],[-79.50217301445844,44.1018166599893],[-79.50822951650403,44.10344685960457],[-79.51462746810196,44.105168309333926],[-79.52078632043882,44.10683665885403],[-79.52735712369449,44.10861605987832],[-79.53549722582515,44.11081965970116],[-79.53704272634141,44.11123285979641],[-79.5435978288469,44.11298485961694],[-79.54536812923158,44.11347035920135],[-79.54627553036393,44.113730759717455],[-79.54667613020298,44.1138392595557],[-79.54771763026417,44.11413915960164],[-79.54803913260463,44.11423346036799],[-79.54832083060174,44.11431425902561],[-79.54887843136409,44.11448105909676],[-79.54909553099158,44.114538059695825],[-79.54945163050624,44.114634359548575],[-79.55064463114644,44.114953959572155],[-79.55170813083512,44.1152443591669],[-79.55305843156582,44.11561575846278],[-79.55319083225528,44.11565545896585],[-79.55336443259966,44.11571035923816],[-79.55353083125351,44.1157657594554],[-79.55365223269762,44.11580885961239],[-79.55378873262349,44.11585605951835],[-79.5539837326378,44.1159353602697],[-79.55413303236365,44.11599725983792],[-79.55426533216612,44.11605605937009],[-79.55442353281742,44.11613015917833],[-79.55462143197505,44.11622995998247],[-79.55482783272629,44.11633955984408],[-79.5549650332016,44.11641775975954],[-79.55507053345312,44.116479159825325],[-79.55528803222097,44.11661635931897],[-79.55536803275363,44.116672759897206],[-79.55545163266702,44.11672895975803],[-79.55554373375735,44.116794859898434],[-79.55567623349522,44.116891559323385],[-79.55577103270568,44.11696966011092],[-79.55590103316722,44.117074260340544],[-79.55602610634931,44.11718260349635],[-79.5561024333251,44.11725155942714],[-79.55617848276225,44.117324096790995],[-79.55622108003087,44.11736472535605],[-79.556323332811,44.11746865920221],[-79.55641463314277,44.11756525925509],[-79.55651733435674,44.11767886027249],[-79.55661353415817,44.11779245901687],[-79.55666863364384,44.117859460243025],[-79.55674043392166,44.117951359673505],[-79.55685103278762,44.11810295979161],[-79.55692743428436,44.118209559328456],[-79.55699453275945,44.118314560442734],[-79.55706163330443,44.11842535971571],[-79.55711603370686,44.118520360204144],[-79.55717383356073,44.118626659245216],[-79.55722463338633,44.118730560395505],[-79.55727193378311,44.11883185849566],[-79.55731733331578,44.11893245997994],[-79.55738473407615,44.11910166033361],[-79.5574592330102,44.119311960209664],[-79.55750743634619,44.119487960201724],[-79.55752743297737,44.11957386016023],[-79.55755233402077,44.11968716003289],[-79.55757693375834,44.119819460359416],[-79.55759653355317,44.119931359692416],[-79.55760393393454,44.12000465971205],[-79.55761323419553,44.12007355926911],[-79.55762373386355,44.12019765992114],[-79.55763493382872,44.12046886004058],[-79.55763433466133,44.12057226035722],[-79.55761783360114,44.12081046016201],[-79.55759573302069,44.1210017605546],[-79.5575848338937,44.121072360599584],[-79.55756483394926,44.121177960532606],[-79.55747593379947,44.12154266082846],[-79.55745023425678,44.12163105891961],[-79.55741253486642,44.12173635899356],[-79.55737473436567,44.12183286010051],[-79.55734333463964,44.121904660287505],[-79.55729823387418,44.12201216018398],[-79.55725553419813,44.122109059730974],[-79.55721323284467,44.12219935980882],[-79.55716913402259,44.122286460149816],[-79.55693693391846,44.1226984605058],[-79.55676303453998,44.122985060937566],[-79.5565610330989,44.123321061380636],[-79.5560656331983,44.1242078606669],[-79.55561713418959,44.125048560711065],[-79.55490513313339,44.12618296142742],[-79.5538782335366,44.12796156113291],[-79.5536919342766,44.12832836148195],[-79.55337083320252,44.12904656231686],[-79.55320443223367,44.12958816225595],[-79.55307513272655,44.130103262193195],[-79.55302013294461,44.130440861680654],[-79.55301183297158,44.13084066243022],[-79.55300843328162,44.131236762529966],[-79.55342213376072,44.135959663653296],[-79.55350603386078,44.136823963151066],[-79.553824934319,44.14010626405189],[-79.55401313427743,44.142323364421564],[-79.55400183521182,44.14335726414675],[-79.55384663510628,44.144374063890226],[-79.55368163548698,44.1452452645625],[-79.5531114347515,44.147574064399066],[-79.55263563527495,44.14951746554426],[-79.5521458343266,44.15141346533265],[-79.55152443552696,44.15381826627018],[-79.55095233519971,44.15603256642169],[-79.55060823430932,44.15758546661537],[-79.55032163605725,44.15864856563663],[-79.54994143545521,44.15958496604896],[-79.54963893449181,44.16019336723622],[-79.54898713518332,44.16143156790741],[-79.54689393453843,44.16540736706257],[-79.54657473491561,44.166087569135044],[-79.5463791342262,44.16657126789769],[-79.54602423424433,44.16784526853278],[-79.54534343364264,44.169970370025794],[-79.54352653436194,44.176195470452775],[-79.54346413427417,44.17657276946832],[-79.54341553514057,44.18286537228791],[-79.54342233553886,44.18376337228667],[-79.54344583476518,44.1868451727304],[-79.54338603468587,44.18892417260369],[-79.54344543549934,44.19013137315923],[-79.54344083615833,44.19123867324979],[-79.54349523675505,44.19243587382782],[-79.54346243635837,44.19354367383216],[-79.54336503615521,44.19431677397021],[-79.54325943574028,44.194792674161754],[-79.54246993580797,44.19699737469458],[-79.54086043681285,44.20092017415848],[-79.54027563574377,44.20229917516749],[-79.5399951365289,44.20301587468576],[-79.53973653636352,44.20385887505296],[-79.53953603636182,44.204882676181555],[-79.53945993496549,44.20593507431204],[-79.53939543636544,44.20694987588068],[-79.53915273550308,44.210765775662466],[-79.53912223586792,44.211494677062575],[-79.53913813608963,44.21236817759238],[-79.53927023732693,44.2130990778096],[-79.53950073575496,44.21390327784121],[-79.54035123698445,44.21545367792967],[-79.54083463696746,44.216153078378724],[-79.54177693767772,44.217579378267175],[-79.54217633789943,44.218183776558654],[-79.54461824034917,44.22187917749055],[-79.54500513950211,44.22246457754936],[-79.54727724135516,44.22591987785702],[-79.5489447415714,44.22845538013898],[-79.55184084267476,44.23289468004255],[-79.55336254281481,44.23518268045684],[-79.55389334418837,44.236095880238416],[-79.55412984351464,44.23656478024275],[-79.55426944361865,44.23701278088205],[-79.55527424420498,44.24052273229645],[-79.55650394536228,44.24498178140961],[-79.5566784444953,44.24561678183301],[-79.55679914546596,44.2462279827684],[-79.55684934508743,44.24673278145665],[-79.5568367450679,44.24726588255702],[-79.55679214611781,44.247720480772536],[-79.55661074511832,44.24888938118739],[-79.55538894567432,44.25676178284638],[-79.55531094586624,44.25739098393198],[-79.5552961460598,44.25799398295051],[-79.55532534643885,44.25833648449348],[-79.55542214642884,44.25898598299325],[-79.55559504676138,44.25960038506965],[-79.55574704652126,44.26004338353108],[-79.55699724636142,44.26322668547826],[-79.55763394752577,44.264847885683146],[-79.5577765477794,44.26516478580732],[-79.5579771469669,44.26567148443545],[-79.55817644888874,44.26623218475971],[-79.5582920478974,44.26662978459174],[-79.55841594827992,44.26719858540309],[-79.5584967477218,44.267991885834775],[-79.55850094869679,44.268333986545144],[-79.55847674840224,44.26881088614029],[-79.55838974593159,44.26929598565782],[-79.55829184819966,44.269708886853756],[-79.55816944756495,44.27010348643746],[-79.55776854859363,44.2711246860016],[-79.55621174826392,44.274832287331606],[-79.55598424792532,44.275423686774644],[-79.55583274812159,44.275979886822704],[-79.55574354854429,44.276554986713755],[-79.55576234797607,44.277024687157265],[-79.55582784722134,44.27744298792675],[-79.55591334804987,44.277808587970505],[-79.55825064891636,44.287273288058216],[-79.5584293915136,44.28798589437535],[-79.55895375042343,44.29007628988878],[-79.55940735054295,44.291884788547605],[-79.5596439512081,44.29282779006194],[-79.55980585147236,44.29339418990557],[-79.5599293507058,44.293785690610534],[-79.56005175048578,44.29414068993542],[-79.5602180507107,44.29446448968037],[-79.56051995107036,44.294936490860884],[-79.56093855224013,44.295407789081885],[-79.56141185168673,44.29588399032309],[-79.56203925244164,44.2963690910127],[-79.56260805115997,44.29669139068991],[-79.5631823526055,44.296963490476095],[-79.56382315321135,44.29723779041041],[-79.56507875393868,44.29766769060068],[-79.57072255513256,44.29962009109427],[-79.57109015492797,44.29978588850377],[-79.57137905565064,44.29994339061911],[-79.5717479554368,44.30012999026457],[-79.57213925592546,44.30038539022733],[-79.57253945616324,44.300687190710285],[-79.57296955594987,44.30104369090775],[-79.57337315585771,44.30146289110777],[-79.57373735628406,44.3019535896295],[-79.5740010569105,44.302451990680254],[-79.57422715604623,44.30294999070303],[-79.5747084568065,44.30481959161723],[-79.57490735692045,44.3054072907281],[-79.57512155733998,44.305878190241685],[-79.57537505722308,44.30628649132747],[-79.57572805680866,44.30672299052032],[-79.57605885791564,44.30704219224797],[-79.57655055802667,44.30744449237692],[-79.57691035741199,44.30771929156797],[-79.57721395868268,44.30791499137673],[-79.57788445735277,44.30830819227929],[-79.58417916019346,44.31177579270353],[-79.58540726041187,44.31245219265052],[-79.58871196235977,44.31424869093081],[-79.58942846227689,44.314698691467704],[-79.59019256189015,44.31525729265619],[-79.5934478635629,44.31784549138196],[-79.5989020657889,44.322181192924894],[-79.60129336692142,44.32408169393179],[-79.60559966882148,44.327533993464755],[-79.61637227245296,44.33616729460022],[-79.618572574053,44.337919395352756],[-79.61993097515295,44.33900129428795],[-79.6202998749018,44.33932089487668],[-79.62065237421957,44.33965469510922],[-79.62091187459414,44.33996749427712],[-79.62128777464055,44.34052119476123],[-79.62164607516998,44.34129079407044],[-79.62331487633877,44.34610049639837],[-79.62375947618558,44.347474296002076],[-79.62398347655225,44.34808919651397],[-79.62421207681265,44.34850609574056],[-79.62457537662546,44.34906859692319],[-79.62483137747775,44.349386795136795],[-79.6251620764772,44.34973289633001],[-79.62555547755538,44.35007969716219],[-79.62717421296759,44.351170465333716],[-79.62756887752593,44.35143639585858],[-79.63005017865379,44.35318579744319],[-79.63150877927227,44.354130596447284],[-79.63228857996639,44.354590096525364],[-79.63502578178006,44.35613529531829],[-79.63990338237542,44.358939896393714],[-79.65287518631469,44.36639589750505],[-79.65754398912071,44.369024296299365],[-79.65936808956563,44.369936996896755],[-79.66023889108347,44.370280297281546],[-79.66121069069989,44.37059779787171],[-79.66214679175752,44.37082479771854],[-79.66328439093084,44.371027196918725],[-79.66459759136572,44.371231698032645],[-79.66888679344012,44.3717415976443],[-79.66949759355467,44.371814097811935],[-79.6721010937723,44.37212349798171],[-79.67702789485969,44.372708696920995],[-79.67928159671094,44.372959896139506],[-79.68188579661418,44.37325109688398],[-79.68241953013582,44.373303217427576],[-79.68286405966938,44.37334341082745],[-79.68317182902238,44.3733657008504],[-79.68348262481499,44.37335852926804],[-79.68374489432553,44.37335085259727],[-79.6849030593914,44.373255111383074],[-79.68538673300736,44.37323177555326],[-79.68686748184057,44.373376509057955]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - All-day",NAME:"Lakeshore East Line",Shape_Leng:50931.9506551},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.37865680600008,43.64495230361534],[-79.37809213128509,43.64507278567933],[-79.37746723052324,43.64520318743342],[-79.37727093248476,43.64524368645725],[-79.37710213140899,43.64527188643137],[-79.37687693121232,43.64530768739293],[-79.37656963133738,43.645355086674726],[-79.37645363106617,43.64537228540543],[-79.37614063106487,43.64542028766584],[-79.37550923110852,43.64551638724968],[-79.37522153060213,43.64556478719691],[-79.37413293022051,43.645759487001314],[-79.37348883047288,43.64583428670019],[-79.37314904321896,43.64587074736801],[-79.37277863102608,43.645919486820624],[-79.372195729298,43.64599118784009],[-79.37148463008191,43.646137386588286],[-79.37113632960973,43.64621358714425],[-79.37047942946698,43.64635678745183],[-79.36980822954357,43.64649798739515],[-79.36893232873841,43.64668308708908],[-79.36805642860386,43.646869387149174],[-79.36663192903649,43.6471716877992],[-79.36632792836716,43.64723658814182],[-79.36489962699719,43.64754108697589],[-79.36339712750983,43.647862388372964],[-79.36267922734179,43.648017488626785],[-79.3623782266526,43.64808348652636],[-79.36213242704952,43.64814158671106],[-79.36189772580494,43.64820158826105],[-79.36140042744432,43.64833968844488],[-79.3610526264986,43.648445187097046],[-79.3604867256637,43.64863118796979],[-79.35978732586706,43.6488674876201],[-79.35804262553108,43.64945818759166],[-79.35706582565597,43.64979488879862],[-79.35685162597296,43.64986818711164],[-79.35658012455983,43.64996328735728],[-79.35640632785027,43.6500296882641],[-79.35625662467783,43.650091889463916],[-79.35608752396064,43.65016828730086],[-79.35572122566266,43.650355288843144],[-79.35531292518758,43.650576488932074],[-79.3534453235593,43.65157908839407],[-79.35278412401937,43.6519293899461],[-79.35202872380978,43.652339689429816],[-79.35151615899085,43.6526160965206],[-79.35120982394506,43.652781289893824],[-79.35076312276476,43.65302048846992],[-79.35030952347336,43.65326188969116],[-79.35001062412904,43.65342298944966],[-79.3492143964408,43.653858712988736],[-79.34901862237193,43.65397309045715],[-79.34882372373286,43.654096489904106],[-79.3486236222798,43.654230290393706],[-79.34840142276005,43.654387788798815],[-79.34818682271735,43.65455668987473],[-79.34798942274634,43.654718289013374],[-79.34773982192242,43.6549476903017],[-79.34757972282152,43.65510029023642],[-79.34744975757684,43.65523479423184],[-79.34717502344611,43.65555529042361],[-79.34700912249781,43.655765190699476],[-79.34688002325647,43.65594618987663],[-79.3467209232687,43.6561919899205],[-79.34659752261913,43.65639738916895],[-79.34649362309251,43.65659639110061],[-79.34639400013562,43.65675259545191],[-79.34635802237182,43.6568859903336],[-79.34627362228706,43.65709019043006],[-79.34618212199598,43.65735629039085],[-79.34611452281271,43.65759918995866],[-79.34605132165824,43.65789169103451],[-79.34600632310622,43.65815159119286],[-79.34596402294939,43.658454289169185],[-79.34592242229955,43.658809088759206],[-79.34586612265885,43.659268189609186],[-79.34581672182327,43.6596812911165],[-79.34578762302323,43.659918991827304],[-79.34569662235386,43.66063088987644],[-79.34566012160055,43.66092579127025],[-79.34562282267899,43.6612305912376],[-79.34558442192744,43.66147798991923],[-79.34554702231186,43.66168539156021],[-79.34550392233497,43.661911291338804],[-79.34544452226086,43.662161391668526],[-79.34538482262236,43.66240869123356],[-79.34533852245073,43.66257039172167],[-79.34524292182748,43.66287359045581],[-79.34515232235304,43.66314339189134],[-79.34507312268141,43.66335359011228],[-79.34495402308065,43.663646091924804],[-79.3447664216547,43.664082191683406],[-79.34457622225626,43.66445919197727],[-79.34439172202403,43.66480489213205],[-79.34422782335365,43.66508469244287],[-79.34401392251293,43.66542449201156],[-79.34370262324069,43.66588949264618],[-79.34343112312527,43.666300392173646],[-79.34320602191276,43.66661709269096],[-79.34304272184399,43.666849692631885],[-79.34274012210727,43.667239292891004],[-79.34249386620688,43.667531971592645],[-79.34241812290472,43.667621993062795],[-79.34219312212406,43.66787939266382],[-79.34212058299237,43.667961045314016],[-79.34189402271716,43.668191792810084],[-79.34156372230406,43.66851929275837],[-79.34131122220047,43.6687623916546],[-79.34099862170844,43.66904209133065],[-79.34072252126833,43.669289993390265],[-79.33994312241181,43.66992609367119],[-79.33877912182929,43.67076409388364],[-79.33780162071844,43.6713875932129],[-79.33686302021498,43.671918493475715],[-79.33664792026984,43.672027293187],[-79.33602092047711,43.67234249417804],[-79.33566051945884,43.67250379346514],[-79.33456712041298,43.67297919388277],[-79.3334597201548,43.673436293413744],[-79.329864019003,43.67484859336011],[-79.32943001910324,43.67501899421944],[-79.3261905176957,43.676291193135896],[-79.32324181723217,43.67744899486907],[-79.32128141679206,43.67818809544687],[-79.31483671586643,43.68074829473384],[-79.31111641414523,43.68219329678819],[-79.30610241278535,43.68414029751815],[-79.3038539117234,43.68502419814487],[-79.30323611298452,43.68527729814766],[-79.3022851118819,43.68565819827388],[-79.30155371223091,43.68592579803915],[-79.3009107110376,43.686145096687774],[-79.30028461143775,43.68632859785328],[-79.29964701104217,43.68650679796179],[-79.2990496070492,43.6866456169677],[-79.2972972108071,43.68705279869078],[-79.29693571051163,43.687136698209535],[-79.29524731006778,43.687533998592656],[-79.29296760942582,43.6880266985415],[-79.29029560838876,43.68863189911495],[-79.28732450783534,43.689307499508246],[-79.28555570714275,43.689683699550564],[-79.28025910549789,43.690897100248534],[-79.27908840502396,43.6911904985172],[-79.2778454046907,43.69155029986236],[-79.27720020518292,43.69176289957568],[-79.27626330521868,43.69210319980232],[-79.27530000414109,43.69250920027974],[-79.27442470382613,43.69290180045355],[-79.27364690376447,43.69328110037112],[-79.27252740291034,43.69390950042193],[-79.27204750183392,43.69419610054229],[-79.27101650331146,43.694899399848566],[-79.27093911525894,43.69495838236687],[-79.27003230264968,43.695649499707045],[-79.26980580337083,43.69583510132421],[-79.26904400228962,43.696534000717605],[-79.26836420189346,43.697220701477164],[-79.26732470284571,43.69844510169767],[-79.26668270229936,43.69930590174472],[-79.26556920186914,43.70099160127443],[-79.26135530118276,43.707371302601274],[-79.25916500079546,43.71068660447986],[-79.25893560142467,43.711033904539306],[-79.25870390174121,43.711368704607956],[-79.25776600100158,43.71283040521609],[-79.2571681001437,43.71377250550596],[-79.25667430143643,43.71452960528617],[-79.25539329950814,43.71644050583837],[-79.25482910404263,43.71726201890729],[-79.25452040015423,43.71771150541354],[-79.25406049931627,43.71838340450504],[-79.25359539989451,43.719061204279896],[-79.25302001571107,43.71992185104662],[-79.25200999949453,43.72143250663905],[-79.2478878992734,43.72774500615806],[-79.24735439935185,43.72850630759169],[-79.24686869893021,43.72914760702775],[-79.2461938983171,43.729917406550804],[-79.24564519906909,43.730481207730215],[-79.24535019902228,43.73076130831596],[-79.2447668988726,43.73129400895909],[-79.24430539754775,43.73167740836301],[-79.243729398325,43.73212360823753],[-79.2431319979312,43.732554808739444],[-79.24251349732577,43.73297000927797],[-79.23997389617927,43.73457370828029],[-79.23730279517312,43.73622890967118],[-79.23700009618192,43.736418109674254],[-79.23596969627827,43.73705740965361],[-79.2307029953156,43.74035350959492],[-79.23061206527439,43.74041097241542],[-79.23032052620248,43.7405952095109],[-79.2296683940652,43.74100730996461],[-79.22784199336127,43.74218720967516],[-79.22647339243413,43.74317271149588],[-79.22488989268717,43.74440591146744],[-79.22427629331442,43.74491671154801],[-79.22368429220093,43.74544081207979],[-79.22251099265351,43.74657211270933],[-79.2220269919802,43.74700711257967],[-79.22120739174375,43.74765351277767],[-79.22097109089944,43.74782201207814],[-79.22057809172071,43.74806281263795],[-79.21994189126062,43.74840991178435],[-79.21928629111098,43.74872241220807],[-79.21863629146915,43.74898961328847],[-79.2180477917368,43.74919631318617],[-79.21726779140313,43.74942351290463],[-79.21359268982044,43.75034961292955],[-79.21301698883619,43.75051811334673],[-79.21245328897999,43.75070671372502],[-79.21112028913808,43.75122741304297],[-79.20931408930454,43.75203341319567],[-79.207806588366,43.7526665138021],[-79.20753068728455,43.75277611420542],[-79.20702428846592,43.75295921398715],[-79.20645238789487,43.753154014087556],[-79.20565448747314,43.7533977136047],[-79.20452358709177,43.75368011282165],[-79.20290898654564,43.75400461503955],[-79.20212705385096,43.754174395590816],[-79.20115008648291,43.75438651478297],[-79.19830838600309,43.75493261460508],[-79.19808692355141,43.754975183348996],[-79.19713258520825,43.755158615034425],[-79.19554688444785,43.75546321509246],[-79.19215288334163,43.756097314998094],[-79.191695683904,43.75618281543352],[-79.190437784139,43.75641771386015],[-79.18887368236423,43.75672381535046],[-79.18583668187766,43.757303215424905],[-79.18189857896013,43.75808401529913],[-79.17866557863759,43.75869811665899],[-79.17402647903413,43.759602717494],[-79.17179447806623,43.76003771656673],[-79.1687974767583,43.76060901748547],[-79.16621147545014,43.7611017163987],[-79.16450597450799,43.76143901626457],[-79.16331737521367,43.76169671833252],[-79.16189807346777,43.7620528179958],[-79.15802667363108,43.763031418278956],[-79.15191437183965,43.764603119117055],[-79.1502748701412,43.765024518818606],[-79.149218671536,43.7653366184724],[-79.14880616999652,43.76546951872178],[-79.14805567043562,43.765753217985576],[-79.14742066989237,43.76601701961819],[-79.1468969704133,43.76626801990455],[-79.14630246979648,43.76658181950266],[-79.14564496990013,43.76696771989219],[-79.14486556961043,43.767451519747176],[-79.14121766884197,43.769744619447195],[-79.13970836771676,43.77074882037459],[-79.13862146754387,43.771538521126935],[-79.13785406700761,43.77217631967634],[-79.1374254668321,43.772562720994486],[-79.13618116726218,43.77379282067016],[-79.13506326678704,43.77497792183936],[-79.13087126473637,43.779472823063394],[-79.13065876890217,43.77970064247769],[-79.1294893657927,43.78095432256882],[-79.12624396445045,43.78443342316449],[-79.12550456502163,43.7852259224457],[-79.1232733631984,43.787640622641526],[-79.12279386375997,43.788179222744105],[-79.12176666379811,43.78950792399991],[-79.1215180634894,43.78983962361173],[-79.12044826428021,43.791266224463506],[-79.11761106309717,43.79520422452986],[-79.11716976355032,43.79589182468712],[-79.11687646277339,43.79638952661534],[-79.11658766313214,43.796935025304535],[-79.11633686273416,43.79746742452913],[-79.11607316547078,43.79810782568077],[-79.11590486258577,43.798581525607624],[-79.11574766237732,43.79910422596208],[-79.11558626236295,43.79973532679172],[-79.11543536240532,43.80047612686092],[-79.11534956333806,43.80109802678979],[-79.11527316424255,43.80187192674835],[-79.11504446396005,43.80545322827603],[-79.11496086263114,43.80676152771558],[-79.11473076335592,43.809505728257804],[-79.11461506465335,43.81041922904057],[-79.11440766372662,43.81146222866161],[-79.11425946385418,43.81200632925142],[-79.1140288631818,43.81272422806935],[-79.11386136353494,43.813168628801556],[-79.11363366302695,43.81369552872044],[-79.11341293007891,43.814142748807654],[-79.11337676352156,43.8142160276957],[-79.11305976302332,43.8147958297117],[-79.11270596246477,43.815365129626336],[-79.1122593632172,43.81601802987063],[-79.11190886389547,43.81648183029939],[-79.11136926341464,43.81712922915753],[-79.11087786277204,43.81767192951999],[-79.11031546238071,43.818248830114825],[-79.10977816309959,43.818754428662764],[-79.10921106291181,43.819243429148926],[-79.10870176182013,43.81964782995274],[-79.10800566314646,43.82016013019746],[-79.10755856227186,43.82046443107247],[-79.10700296324723,43.82081563083482],[-79.10588666197839,43.82144492929291],[-79.10502416156812,43.821874531174615],[-79.1040454605015,43.82232662993579],[-79.10191846098952,43.823309331071904],[-79.10169586045346,43.823431931496835],[-79.10118636100007,43.823685430701325],[-79.10019016035348,43.82418663061251],[-79.09947696069676,43.82456613194578],[-79.09834815889715,43.82516383213229],[-79.09794736034031,43.825410532125865],[-79.09740506028643,43.82579483133259],[-79.09679495978722,43.826203631811005],[-79.09661685850561,43.82631503070548],[-79.0965342588886,43.82636143220886],[-79.09629296004763,43.82648483092921],[-79.09596445848685,43.8266472321746],[-79.09147135814418,43.828456631918414],[-79.09079655778316,43.82875143223165],[-79.09031035832919,43.828977232908585],[-79.08933855701157,43.82942693274851],[-79.08827925657623,43.82991483367147],[-79.08730535746889,43.83036573182598],[-79.08682495671644,43.830583633804004],[-79.08614245624624,43.83090383189136],[-79.08459709358691,43.83161520522687],[-79.08426595660139,43.83176763312467],[-79.08410308562425,43.83184376291758],[-79.08346175568259,43.83214353359947],[-79.0825919551677,43.83255803290751],[-79.08170415413875,43.83300223249798],[-79.08045695458654,43.83362743458305],[-79.0795126543589,43.8341001329193],[-79.07796045410585,43.83484043462567],[-79.0771691533942,43.835184733706],[-79.07653635330628,43.83544433505474],[-79.07497145261826,43.83609823505284],[-79.0747213533564,43.83619953506911],[-79.07320675198153,43.836831035017134],[-79.0727319532866,43.837032535371065],[-79.07014265195063,43.83818823546312],[-79.06994331512935,43.83828562132288],[-79.0690518522366,43.83872113483387],[-79.06834075221155,43.83906203578891],[-79.06589385093721,43.84030703619925],[-79.06350635051601,43.841474934992206],[-79.06220065021753,43.84207643662177],[-79.06102754998939,43.84261693661056],[-79.0569249478526,43.84450683741999],[-79.0559218474102,43.84491943759868],[-79.05558564791609,43.84504213808154],[-79.05494264669973,43.845269137214316],[-79.05416784720637,43.845521836867476],[-79.05379894799945,43.845632336809494],[-79.05344484807979,43.845732237952745],[-79.0526788464746,43.84592853613003],[-79.05247534731998,43.84597403717652],[-79.0522790456323,43.84601963806609],[-79.05035574650492,43.846412036592504],[-79.05010464596573,43.84646333810733],[-79.0472319446167,43.84702803800457],[-79.04569304422236,43.84732183819572],[-79.04343284395539,43.84779863851164],[-79.04227497333439,43.84806189934497],[-79.04034891982354,43.848492047708675],[-79.04027084294854,43.84851753872415],[-79.03741244244833,43.849163839652626],[-79.0365990424181,43.84934393769586],[-79.03587314177204,43.84950333911182],[-79.03418344235085,43.84988453764428],[-79.02985363943111,43.85086133857388],[-79.0268518397271,43.85153133979175],[-79.02536523935406,43.851850939714495],[-79.023855138732,43.852146738852035],[-79.0221768373842,43.852516839355445],[-79.02209033817326,43.85253654005434],[-79.01938903726496,43.8531542395377],[-79.01711943577223,43.85370064135047],[-79.01492613619371,43.85420303956204],[-79.01194173568169,43.8548730410917],[-79.00899263425511,43.85551324004446],[-78.99938213053531,43.85766654076184],[-78.99569682953386,43.858508642248516],[-78.99404032914137,43.85888714266812],[-78.99109482741582,43.85952854315256],[-78.98265232559051,43.8614422428095],[-78.9821774256059,43.86154844432811],[-78.97731752421714,43.862635743149674],[-78.97642682438469,43.86283504459774],[-78.96336522078573,43.86575564557635],[-78.96247402207521,43.86595484568064],[-78.96125101920998,43.86621344516897],[-78.95993771928569,43.86643944516616],[-78.95865321947862,43.866598244377435],[-78.95755501763486,43.866680045911],[-78.95670261820693,43.866728645307184],[-78.95546321828725,43.86674654581534],[-78.95475561682113,43.8667338459476],[-78.95360181688453,43.86667714638618],[-78.95249701650623,43.86658524558987],[-78.94557161444679,43.86583894613676],[-78.94187121298494,43.86543074616716],[-78.94124051350613,43.86533194652553],[-78.93967781222834,43.86505214694504],[-78.93821885459212,43.864805380966025],[-78.93589241101154,43.86441184686818],[-78.93564734344746,43.864373617545084],[-78.93510521129257,43.86428904692559],[-78.93367191042988,43.86410074643066],[-78.93323731009835,43.864037946669555],[-78.93179050959694,43.8637998466587],[-78.92969760896288,43.86352294642027],[-78.92944020864567,43.863488946517194],[-78.92905861060797,43.863435247065276],[-78.92724720787372,43.86318064612122],[-78.92465810729765,43.862844446625495],[-78.92236780692488,43.86255114701532],[-78.91941860601847,43.86217404628689],[-78.91823470548476,43.86205604748294],[-78.91744890516034,43.861995746728645],[-78.916667504828,43.8619602464088],[-78.91586840475067,43.86193844612155],[-78.91507550389217,43.86194594685819],[-78.91416120298473,43.861982046083746],[-78.91357730352689,43.86201704722802],[-78.91240410380826,43.862129446248716],[-78.91176670210851,43.86220254782817],[-78.9110562028807,43.8623124460217],[-78.91041120277927,43.862434647279905],[-78.9097237036271,43.86257134743042],[-78.90929920264736,43.8626641470118],[-78.90823010205253,43.86292474772171],[-78.90718020183033,43.86323754664374],[-78.9035693008133,43.864436448106545],[-78.90257420021739,43.86476854752266],[-78.90121840050881,43.86523144794195],[-78.89886180011015,43.8660361488767],[-78.89424829764536,43.867611148677305],[-78.88923689599454,43.869321548282684],[-78.88691387838755,43.87011436056653],[-78.88505499546247,43.870748650277136]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak & Limited Off-Peak",NAME:"Stouffville Line",Shape_Leng:37806.8933954},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.37865680600008,43.64495230361534],[-79.37809213128509,43.64507278567933],[-79.37746723052324,43.64520318743342],[-79.37727093248476,43.64524368645725],[-79.37710213140899,43.64527188643137],[-79.37687693121232,43.64530768739293],[-79.37656963133738,43.645355086674726],[-79.37645363106617,43.64537228540543],[-79.37614063106487,43.64542028766584],[-79.37550923110852,43.64551638724968],[-79.37522153060213,43.64556478719691],[-79.37413293022051,43.645759487001314],[-79.37348883047288,43.64583428670019],[-79.37314904321896,43.64587074736801],[-79.37277863102608,43.645919486820624],[-79.372195729298,43.64599118784009],[-79.37148463008191,43.646137386588286],[-79.37113632960973,43.64621358714425],[-79.37047942946698,43.64635678745183],[-79.36980822954357,43.64649798739515],[-79.36893232873841,43.64668308708908],[-79.36805642860386,43.646869387149174],[-79.36663192903649,43.6471716877992],[-79.36632792836716,43.64723658814182],[-79.36489962699719,43.64754108697589],[-79.36339712750983,43.647862388372964],[-79.36267922734179,43.648017488626785],[-79.3623782266526,43.64808348652636],[-79.36213242704952,43.64814158671106],[-79.36189772580494,43.64820158826105],[-79.36140042744432,43.64833968844488],[-79.3610526264986,43.648445187097046],[-79.3604867256637,43.64863118796979],[-79.35978732586706,43.6488674876201],[-79.35804262553108,43.64945818759166],[-79.35706582565597,43.64979488879862],[-79.35685162597296,43.64986818711164],[-79.35658012455983,43.64996328735728],[-79.35640632785027,43.6500296882641],[-79.35625662467783,43.650091889463916],[-79.35608752396064,43.65016828730086],[-79.35572122566266,43.650355288843144],[-79.35531292518758,43.650576488932074],[-79.3534453235593,43.65157908839407],[-79.35278412401937,43.6519293899461],[-79.35202872380978,43.652339689429816],[-79.35151615899085,43.6526160965206],[-79.35120982394506,43.652781289893824],[-79.35076312276476,43.65302048846992],[-79.35030952347336,43.65326188969116],[-79.35001062412904,43.65342298944966],[-79.3492143964408,43.653858712988736],[-79.34901862237193,43.65397309045715],[-79.34882372373286,43.654096489904106],[-79.3486236222798,43.654230290393706],[-79.34840142276005,43.654387788798815],[-79.34818682271735,43.65455668987473],[-79.34798942274634,43.654718289013374],[-79.34773982192242,43.6549476903017],[-79.34757972282152,43.65510029023642],[-79.34744975757684,43.65523479423184],[-79.34717502344611,43.65555529042361],[-79.34700912249781,43.655765190699476],[-79.34688002325647,43.65594618987663],[-79.3467209232687,43.6561919899205],[-79.34659752261913,43.65639738916895],[-79.34649362309251,43.65659639110061],[-79.34639400013562,43.65675259545191],[-79.34635802237182,43.6568859903336],[-79.34627362228706,43.65709019043006],[-79.34618212199598,43.65735629039085],[-79.34611452281271,43.65759918995866],[-79.34605132165824,43.65789169103451],[-79.34600632310622,43.65815159119286],[-79.34596402294939,43.658454289169185],[-79.34592242229955,43.658809088759206],[-79.34586612265885,43.659268189609186],[-79.34581672182327,43.6596812911165],[-79.34578762302323,43.659918991827304],[-79.34569662235386,43.66063088987644],[-79.34566012160055,43.66092579127025],[-79.34562282267899,43.6612305912376],[-79.34558442192744,43.66147798991923],[-79.34554702231186,43.66168539156021],[-79.34550392233497,43.661911291338804],[-79.34544452226086,43.662161391668526],[-79.34538482262236,43.66240869123356],[-79.34533852245073,43.66257039172167],[-79.34524292182748,43.66287359045581],[-79.34515232235304,43.66314339189134],[-79.34507312268141,43.66335359011228],[-79.34495402308065,43.663646091924804],[-79.3447664216547,43.664082191683406],[-79.34457622225626,43.66445919197727],[-79.34439172202403,43.66480489213205],[-79.34422782335365,43.66508469244287],[-79.34401392251293,43.66542449201156],[-79.34370262324069,43.66588949264618],[-79.34343112312527,43.666300392173646],[-79.34320602191276,43.66661709269096],[-79.34304272184399,43.666849692631885],[-79.34274012210727,43.667239292891004],[-79.34249386620688,43.667531971592645],[-79.34241812290472,43.667621993062795],[-79.34219312212406,43.66787939266382],[-79.34212058299237,43.667961045314016],[-79.34189402271716,43.668191792810084],[-79.34156372230406,43.66851929275837],[-79.34131122220047,43.6687623916546],[-79.34099862170844,43.66904209133065],[-79.34072252126833,43.669289993390265],[-79.33994312241181,43.66992609367119],[-79.33877912182929,43.67076409388364],[-79.33780162071844,43.6713875932129],[-79.33686302021498,43.671918493475715],[-79.33664792026984,43.672027293187],[-79.33602092047711,43.67234249417804],[-79.33566051945884,43.67250379346514],[-79.33456712041298,43.67297919388277],[-79.3334597201548,43.673436293413744],[-79.329864019003,43.67484859336011],[-79.32943001910324,43.67501899421944],[-79.3261905176957,43.676291193135896],[-79.32324181723217,43.67744899486907],[-79.32128141679206,43.67818809544687],[-79.31483671586643,43.68074829473384],[-79.31111641414523,43.68219329678819],[-79.30610241278535,43.68414029751815],[-79.3038539117234,43.68502419814487],[-79.30323611298452,43.68527729814766],[-79.3022851118819,43.68565819827388],[-79.30155371223091,43.68592579803915],[-79.3009107110376,43.686145096687774],[-79.30028461143775,43.68632859785328],[-79.29964701104217,43.68650679796179],[-79.2990496070492,43.6866456169677],[-79.2972972108071,43.68705279869078],[-79.29693571051163,43.687136698209535],[-79.29524731006778,43.687533998592656],[-79.29296760942582,43.6880266985415],[-79.29029560838876,43.68863189911495],[-79.28732450783534,43.689307499508246],[-79.28555570714275,43.689683699550564],[-79.28025910549789,43.690897100248534],[-79.27908840502396,43.6911904985172],[-79.2778454046907,43.69155029986236],[-79.27720020518292,43.69176289957568],[-79.27626330521868,43.69210319980232],[-79.27530000414109,43.69250920027974],[-79.27442470382613,43.69290180045355],[-79.27364690376447,43.69328110037112],[-79.27252740291034,43.69390950042193],[-79.27204750183392,43.69419610054229],[-79.27101650331146,43.694899399848566],[-79.27093911525894,43.69495838236687],[-79.27003230264968,43.695649499707045],[-79.26980580337083,43.69583510132421],[-79.26904400228962,43.696534000717605],[-79.26836420189346,43.697220701477164],[-79.26732470284571,43.69844510169767],[-79.26668270229936,43.69930590174472],[-79.26556920186914,43.70099160127443],[-79.26135530118276,43.707371302601274],[-79.25916500079546,43.71068660447986],[-79.25893560142467,43.711033904539306],[-79.25870390174121,43.711368704607956],[-79.25776600100158,43.71283040521609],[-79.2571681001437,43.71377250550596],[-79.25667430143643,43.71452960528617],[-79.25539329950814,43.71644050583837],[-79.25482910404263,43.71726201890729],[-79.25452040015423,43.71771150541354],[-79.25406049931627,43.71838340450504],[-79.25359539989451,43.719061204279896],[-79.25302001571107,43.71992185104662],[-79.25292040031141,43.72173680485972],[-79.25298390036423,43.7220113054834],[-79.25311330005424,43.72237020637269],[-79.25330149997941,43.72281030642554],[-79.25347589937206,43.723194805392154],[-79.25369710117708,43.72366360705775],[-79.25423030291932,43.724621205189194],[-79.25441190001915,43.72488780722491],[-79.25458330069002,43.725102206874354],[-79.25489420058598,43.725428106805246],[-79.2554021002322,43.72588290680106],[-79.25582890100526,43.72619720647463],[-79.25633220094801,43.726503706947106],[-79.25689330094129,43.72678300577667],[-79.25747960191667,43.72703370707173],[-79.25808990100494,43.72725200757986],[-79.258753603035,43.72745200641534],[-79.2591361015297,43.727597406249224],[-79.25954800176973,43.7277947074781],[-79.25988260241641,43.72799280709009],[-79.26031370254921,43.728313707648056],[-79.26068750262864,43.72867770604197],[-79.26096490381279,43.7290332069994],[-79.26120230404686,43.729453107642875],[-79.262109003592,43.73167110626149],[-79.26269946340406,43.73291262659512],[-79.26295330408885,43.733448708400026],[-79.26588080535402,43.74026860927068],[-79.26661370550198,43.74202400944214],[-79.2682628911128,43.74584963227533],[-79.26979530367304,43.74954860147061],[-79.26990331409004,43.74984487211238],[-79.26997430699642,43.75013191122282],[-79.2700273080155,43.75039951108622],[-79.27004673880164,43.750502867769875],[-79.27008370824326,43.75069951037244],[-79.27017410783198,43.75111951087923],[-79.27028070794358,43.751541909360256],[-79.2703990084113,43.751888210774524],[-79.27131460856167,43.75425941170995],[-79.27157850838465,43.754939311795994],[-79.27577291168022,43.76580231292106],[-79.27614198656079,43.76687470744936],[-79.27633541105324,43.76743671174914],[-79.27669307516172,43.76847566050822],[-79.27673041268854,43.768584113875],[-79.27844251255556,43.773049112808614],[-79.27949296006058,43.77578700117597],[-79.27973941401336,43.776430913593714],[-79.2802051135546,43.7776450152164],[-79.28119861476044,43.78002821441741],[-79.28171111475018,43.78117411508345],[-79.2819409146627,43.781703816128804],[-79.28246351511639,43.78291651549564],[-79.28280091471147,43.78359941553633],[-79.2830435155853,43.78399371528601],[-79.28328189931804,43.784349101734875],[-79.28351621522823,43.78469841498679],[-79.28379191638736,43.78511611483821],[-79.28398441615649,43.78548791564794],[-79.28423091581178,43.78606611532518],[-79.28437194766751,43.7863970349579],[-79.285188115554,43.78831201693634],[-79.28607141674502,43.79038401698175],[-79.28683991665064,43.79216121703608],[-79.28829681778846,43.79552981774828],[-79.28911221862313,43.79747561772303],[-79.28987001917024,43.79917961793654],[-79.29008861867923,43.799738318884486],[-79.2906041186946,43.800925518933],[-79.29082191948775,43.80135251873709],[-79.29106521954985,43.801755117668],[-79.29156791939805,43.80247181904162],[-79.29160092121752,43.80251883086329],[-79.29166401880795,43.802608718565885],[-79.29181291866853,43.80278151884986],[-79.29245901933135,43.803666717199036],[-79.29267031939435,43.80399351813746],[-79.29293432105183,43.80449211946555],[-79.29402762135092,43.80683641913582],[-79.29476522149952,43.80849401811367],[-79.2970055220932,43.81336351962313],[-79.2991368238828,43.81799502036827],[-79.30037272441955,43.820749920866504],[-79.30058532465578,43.821175721376264],[-79.30146044566055,43.823048600192834],[-79.30179222370163,43.823758621949665],[-79.30227849714137,43.824799409185154],[-79.30252982529849,43.8253373218687],[-79.3028234251222,43.825860322784024],[-79.30305312621488,43.8261855220263],[-79.3032271244347,43.826402722622994],[-79.3036180265616,43.82683012278087],[-79.30673242596424,43.830070523236806],[-79.30679372676204,43.83013442291474],[-79.30780262767945,43.831194522732645],[-79.30837642717728,43.831769122929906],[-79.31020942831056,43.83369492230443],[-79.31083882858627,43.8343136237469],[-79.31116962888291,43.834642522616235],[-79.31214832791417,43.83561512217839],[-79.31242712956153,43.83589132241365],[-79.31301772907196,43.83648842278515],[-79.31319282986357,43.836662323502225],[-79.31344402982609,43.836959823915514],[-79.31368652919333,43.83726682280379],[-79.31386913048628,43.837547424312994],[-79.31409983098102,43.8379673232297],[-79.3142002291543,43.83819242398858],[-79.31440822963363,43.83876322415772],[-79.3147675298353,43.83987692432619],[-79.31489543063684,43.84027612338548],[-79.31504613043562,43.84085572331162],[-79.31517213063866,43.84148472495377],[-79.31524972991183,43.84182822460504],[-79.31532733126384,43.84216972415137],[-79.31545413043466,43.84276972432451],[-79.31556963060268,43.843296424864434],[-79.3156980309726,43.84390262445933],[-79.3157384307866,43.844131425307516],[-79.31577473074316,43.84434682505462],[-79.31579273145041,43.84459582412588],[-79.31580093124042,43.844903724682624],[-79.31579783179322,43.84504242501806],[-79.31579193116562,43.84517842411956],[-79.31577323096941,43.84533892505342],[-79.31575383052379,43.84547112464166],[-79.31572873031973,43.84562872500401],[-79.31568133195667,43.845884825711764],[-79.31554513085068,43.846548025752114],[-79.31539803223203,43.847257424740334],[-79.31526523205227,43.847934925245276],[-79.31518885345267,43.848384263700964],[-79.31512583181797,43.84875502563336],[-79.31483289061286,43.8509346559189],[-79.31455188456033,43.85302528369431],[-79.31454506548594,43.853075961088265],[-79.31451993064421,43.85326272608807],[-79.31354503269004,43.86051342613683],[-79.31337883250832,43.86174952702113],[-79.31329063236772,43.86209152727529],[-79.31319013184971,43.86234612717734],[-79.31295543178243,43.86280682711516],[-79.31277833269931,43.86310302637867],[-79.31260033203404,43.86334572808684],[-79.31242233218364,43.86353612815936],[-79.31225243185617,43.86368552719045],[-79.31199303132307,43.86390372750102],[-79.31154733136162,43.864208327909196],[-79.31118283221016,43.86441902797051],[-79.3108056316999,43.86461372722012],[-79.30900643064038,43.86537142790164],[-79.306333830382,43.86649672819291],[-79.30410752939902,43.867434127909405],[-79.30250712827048,43.868107828649975],[-79.30178452912074,43.86843692931699],[-79.30099012936775,43.86885732819647],[-79.30029592894105,43.86927912800003],[-79.29944332902221,43.869883228544964],[-79.29804922703939,43.87093152919654],[-79.29766482796174,43.87118182897122],[-79.29721602737241,43.87142612922234],[-79.29692512752482,43.87156302840348],[-79.29650102795001,43.87173233009538],[-79.29598182698264,43.871909130230016],[-79.29188592642896,43.8730116294382],[-79.29045692501538,43.873419530755335],[-79.28887602571588,43.873836429893096],[-79.28857714927891,43.873918011540994],[-79.28848512438505,43.873943129583594],[-79.28617512332568,43.87457393009989],[-79.28400332463572,43.87516683128431],[-79.28318662281721,43.87540663048713],[-79.28077932279209,43.876042831150116],[-79.27043002016882,43.87851463130879],[-79.26607491764871,43.87953753183022],[-79.26553041794115,43.87969633218527],[-79.26503411812328,43.879881832399896],[-79.26452391804229,43.880154132625194],[-79.26417051826994,43.88037153223213],[-79.26373521801608,43.8807565328013],[-79.26355401714238,43.880959033271466],[-79.26337281820277,43.88119123313351],[-79.26325631808747,43.881381433093445],[-79.26306491768655,43.88172563228718],[-79.26279131370836,43.882347859636745],[-79.26268231733225,43.88259573310614],[-79.26249611801164,43.88301443338297],[-79.26236281703171,43.88330083335323],[-79.26225051715429,43.88352983342188],[-79.26212290902743,43.88371823404149],[-79.26201531691507,43.88387399900116],[-79.26191731779204,43.883985133528405],[-79.26156961687418,43.88435913333506],[-79.26105011696475,43.88490083403292],[-79.26080481735899,43.88517663321333],[-79.26056081819775,43.88552583313462],[-79.26045811775334,43.88570133339108],[-79.26038761746388,43.885863832536096],[-79.26031711642973,43.88612543429887],[-79.26025191702198,43.886559434020384],[-79.26024941650425,43.886919433110236],[-79.26028361676593,43.88718693403587],[-79.26051761733716,43.88795003397661],[-79.26166111845525,43.891502434118635],[-79.26285041820456,43.89505393457372],[-79.26319591946582,43.896067334214344],[-79.26327091933472,43.896503935886564],[-79.26331071953479,43.89684663486442],[-79.26332411889274,43.89724303652323],[-79.26329051845471,43.897971835688764],[-79.26311009999094,43.89934925159068]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak Only",NAME:"Richmond Hill Line",Shape_Leng:46220.5904199},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.37865680600008,43.64495230361534],[-79.37809213128509,43.64507278567933],[-79.37746723052324,43.64520318743342],[-79.37727093248476,43.64524368645725],[-79.37710213140899,43.64527188643137],[-79.37687693121232,43.64530768739293],[-79.37656963133738,43.645355086674726],[-79.37645363106617,43.64537228540543],[-79.37614063106487,43.64542028766584],[-79.37550923110852,43.64551638724968],[-79.37522153060213,43.64556478719691],[-79.37413293022051,43.645759487001314],[-79.37348883047288,43.64583428670019],[-79.37314904321896,43.64587074736801],[-79.37277863102608,43.645919486820624],[-79.372195729298,43.64599118784009],[-79.37148463008191,43.646137386588286],[-79.37113632960973,43.64621358714425],[-79.37047942946698,43.64635678745183],[-79.36980822954357,43.64649798739515],[-79.36893232873841,43.64668308708908],[-79.36805642860386,43.646869387149174],[-79.36663192903649,43.6471716877992],[-79.36632792836716,43.64723658814182],[-79.36489962699719,43.64754108697589],[-79.36339712750983,43.647862388372964],[-79.36267922734179,43.648017488626785],[-79.3623782266526,43.64808348652636],[-79.36213242704952,43.64814158671106],[-79.36189772580494,43.64820158826105],[-79.36140042744432,43.64833968844488],[-79.3610526264986,43.648445187097046],[-79.3604867256637,43.64863118796979],[-79.35978732586706,43.6488674876201],[-79.35804262553108,43.64945818759166],[-79.35706582565597,43.64979488879862],[-79.35685162597296,43.64986818711164],[-79.35658012455983,43.64996328735728],[-79.35640632785027,43.6500296882641],[-79.35625662467783,43.650091889463916],[-79.35608752396064,43.65016828730086],[-79.35572122566266,43.650355288843144],[-79.35531292518758,43.650576488932074],[-79.3534453235593,43.65157908839407],[-79.35278412401937,43.6519293899461],[-79.35202872380978,43.652339689429816],[-79.35151615899085,43.6526160965206],[-79.35105706843753,43.65339693952317],[-79.35098802396199,43.65357028948186],[-79.35096812336067,43.65370488962441],[-79.35096152353675,43.65385409019862],[-79.35097382349606,43.65398668990448],[-79.35098502421648,43.65406148956878],[-79.35100222451912,43.6541355895444],[-79.35105192445775,43.65426888967388],[-79.35108652397555,43.65435628840183],[-79.35114662363232,43.65445528976674],[-79.35123802452345,43.654581889483445],[-79.35131652391671,43.65467928995318],[-79.35138202344429,43.65474709051584],[-79.35167512460707,43.6550157898612],[-79.35182432456754,43.65514598900681],[-79.35218552603286,43.65546465537635],[-79.3523584248498,43.65561718980915],[-79.35367562527591,43.65679218988328],[-79.35407172539934,43.657136490209645],[-79.35428982532635,43.65733119038807],[-79.35444552540619,43.65749439059596],[-79.35459282493335,43.65767268866814],[-79.35473292499228,43.65789759088576],[-79.35479322528654,43.658020690741175],[-79.35487742556612,43.65821799022256],[-79.35493122587141,43.65836539078935],[-79.35506242527808,43.658819290885226],[-79.35534802549552,43.65977029033737],[-79.35581322601372,43.66135329117087],[-79.35630862625857,43.6629374915125],[-79.35660992625054,43.663979489708396],[-79.3567420267666,43.66441839143129],[-79.35737662706748,43.66652769159716],[-79.35766832613682,43.66752239216282],[-79.35782792741388,43.668003690474876],[-79.35792192722205,43.66825119189332],[-79.35799972759466,43.668417892439265],[-79.35814162705373,43.668668190455406],[-79.35823582730093,43.66879779238438],[-79.35832802793115,43.66891889179663],[-79.35847522768647,43.66908409195249],[-79.35867422806207,43.66929919184006],[-79.35915762744301,43.66973179204082],[-79.36210282849387,43.67209379225917],[-79.36247052920744,43.6724497912489],[-79.36292702965817,43.672985892365986],[-79.36365982942041,43.674008492934725],[-79.36395163022857,43.67446939243281],[-79.36407503067544,43.67470819311872],[-79.36417402980294,43.674939692501766],[-79.3642627591332,43.67515831850602],[-79.36463682944576,43.676079993352815],[-79.36482442984311,43.676404192685744],[-79.36515713094907,43.676872692980815],[-79.36546583030925,43.67725689277423],[-79.3668116311961,43.6789002938208],[-79.36718913124204,43.67939899189565],[-79.36733923054773,43.67964769341321],[-79.36746493253636,43.67994039367119],[-79.36754063084398,43.68024649371031],[-79.3675633312731,43.68047609223443],[-79.36754933093648,43.68069659380466],[-79.36749753176744,43.680953093716234],[-79.36740793080205,43.681200493530945],[-79.36728133234747,43.68144339376564],[-79.3671196311917,43.68166829363193],[-79.36703203123649,43.68177729397354],[-79.36689433132179,43.681915493784096],[-79.36655643029421,43.68218969294261],[-79.36624713175834,43.6823783932012],[-79.36378052992875,43.683638592923366],[-79.3633652298582,43.683854293413056],[-79.36301323111252,43.68408879458328],[-79.36283722937331,43.68420799308852],[-79.36265543107092,43.684371094536324],[-79.36249703010594,43.684546595234245],[-79.36236362952715,43.68473269514675],[-79.36225663026529,43.68492759488697],[-79.36214532978994,43.68519839465222],[-79.3621159297477,43.68531569482433],[-79.3620757304159,43.68560589434709],[-79.36208003016041,43.6858286935555],[-79.36209852998509,43.68598269490721],[-79.362205530479,43.686343194790375],[-79.36237933035585,43.68678619363283],[-79.36267793038418,43.68746209516742],[-79.36272262991187,43.68761719449953],[-79.36276323107369,43.687804495550225],[-79.36277523031542,43.68804799428342],[-79.36274763010893,43.68829089548525],[-79.36270853049179,43.68848389494651],[-79.36262713066019,43.68867019610029],[-79.36255753066673,43.68879349417068],[-79.3624653303925,43.68894079487873],[-79.36233663139704,43.68910239423125],[-79.36129273013195,43.69022359525343],[-79.36107293052704,43.69050349554499],[-79.36087933011665,43.69079319549696],[-79.36071252941412,43.6910916959286],[-79.36055302986324,43.69144909599207],[-79.36044683000478,43.69176179564661],[-79.36035272976056,43.692111595305725],[-79.36025412995407,43.69241719480607],[-79.36014933037725,43.69268589481348],[-79.35994192991325,43.69307849517897],[-79.35965143037485,43.69350189548299],[-79.35839142929191,43.69507149636612],[-79.35781232933176,43.69582259677319],[-79.35742672948514,43.696282095869535],[-79.35694052938804,43.69682279710817],[-79.35655753018753,43.69722619592057],[-79.35611832870654,43.69762509675902],[-79.35564072918196,43.69799999587259],[-79.35519292827335,43.69830659745754],[-79.35464972929485,43.69863119739396],[-79.35388032907875,43.69903409781882],[-79.35331012806296,43.69929059631668],[-79.35271482835813,43.699515197776975],[-79.35217622923994,43.69968469789998],[-79.35129112765011,43.69992359788188],[-79.35091004326063,43.69999461667039],[-79.35028982794614,43.700110198042054],[-79.3497702279595,43.700179696638884],[-79.34930972854677,43.70021029794581],[-79.34888142668946,43.70021329702893],[-79.34850042777826,43.70018839652617],[-79.34807222722497,43.700124298050184],[-79.34755702683889,43.69999239863167],[-79.34670292654347,43.69969479733779],[-79.34598522595928,43.69944709660105],[-79.34563752679415,43.69935189808328],[-79.34524372555535,43.69926979777801],[-79.34489552492316,43.699217898799475],[-79.34439782627064,43.69917669770874],[-79.34399442609363,43.699173198147264],[-79.34374322510718,43.69918929858315],[-79.34330742514439,43.699239596184185],[-79.34287932538307,43.69931739712955],[-79.34252602547816,43.69940749808095],[-79.34213902502223,43.699541298541405],[-79.34156892396926,43.69980119777098],[-79.34109942377673,43.7000862990069],[-79.33547632450141,43.7042277978273],[-79.33499542298594,43.7045819997485],[-79.33406672401017,43.705229399770054],[-79.33365712413263,43.70547959974545],[-79.33335702349794,43.70563259835144],[-79.33158492331142,43.70644439943602],[-79.33139529459837,43.706537623304776],[-79.33011922280112,43.707147898745895],[-79.32623612264138,43.70918270092097],[-79.32547842200049,43.70954850126462],[-79.32486412181728,43.709803999708676],[-79.32432202140593,43.71000200132027],[-79.32150262140028,43.71089660152171],[-79.32103751998142,43.71108480183681],[-79.32081061980203,43.711195801013545],[-79.32060942125224,43.7113182014724],[-79.32038822016185,43.71150690136209],[-79.32015052068328,43.71177659973628],[-79.32002972029095,43.71195760144088],[-79.31990662134302,43.712213902157735],[-79.31983682048417,43.71248850170373],[-79.31976962001713,43.71286620214992],[-79.31964632111139,43.714211102107186],[-79.3196330205613,43.71456440216457],[-79.31965572015247,43.7149593025127],[-79.31971192007862,43.71527740202988],[-79.31981251972684,43.71562410278742],[-79.32003192117894,43.71614650245513],[-79.32077342145676,43.71768940257928],[-79.32243492192755,43.721146002818266],[-79.32258122115769,43.721492803272795],[-79.3226604213278,43.721727403294494],[-79.32275132178977,43.7220072031586],[-79.32279462312226,43.722253702849876],[-79.32283152339366,43.72252660315132],[-79.3228415211964,43.722807401734684],[-79.32280412247464,43.723159603031796],[-79.3227453213057,43.72341520304655],[-79.32264322225566,43.723734103710356],[-79.32250622221096,43.7240490039296],[-79.32193655869196,43.72524824381596],[-79.32080292275512,43.72763460305815],[-79.32059432170146,43.7281098040588],[-79.32053592191102,43.72834840450557],[-79.32050492202374,43.72860050479264],[-79.3205127224297,43.72887060365854],[-79.32057972202044,43.729167704646876],[-79.32067002195396,43.729393404730175],[-79.32083222177629,43.7296274040815],[-79.3209700222223,43.72978490488656],[-79.32116812193344,43.72996070487599],[-79.32134662248086,43.73008980428293],[-79.32150812287333,43.730190504070734],[-79.32158832319844,43.73023150478792],[-79.32187382307634,43.730361104273314],[-79.32217752347835,43.73045990483199],[-79.32242362255982,43.73051860462352],[-79.32286142308008,43.73059850469708],[-79.32370802295891,43.73074270365342],[-79.32434822251528,43.73086690444551],[-79.32483642376909,43.73099000470195],[-79.32526062407207,43.73111030467775],[-79.32555322469058,43.73121870520502],[-79.3259142245595,43.73139480483473],[-79.32628212557718,43.73162940471736],[-79.32729762412256,43.73244790347877],[-79.32764642536405,43.73272960321386],[-79.32796082498687,43.732932604546725],[-79.32840772384868,43.73317630502949],[-79.32888392469944,43.73339310334395],[-79.32925712444882,43.73353320479644],[-79.32970822574795,43.73367330409832],[-79.33144074728088,43.7341429855229],[-79.33193402605353,43.73427670503926],[-79.33225542550412,43.734379404112836],[-79.33255872616249,43.734508104621014],[-79.3328399263802,43.73466090519544],[-79.33309512590026,43.73483600365715],[-79.3333211273691,43.73503100478983],[-79.33348942616358,43.73521210364129],[-79.33365652742245,43.73544050554354],[-79.33377172664721,43.73564640426814],[-79.33387132786775,43.7358951035327],[-79.33392102623274,43.73614190475405],[-79.3339493276522,43.736289905316106],[-79.33406392700981,43.737463405650004],[-79.33409792684257,43.73773760526163],[-79.33415582739204,43.73795250527106],[-79.33423972724201,43.73815970549949],[-79.33442582608055,43.738540105839746],[-79.33471732755714,43.739005405712426],[-79.33677642769308,43.741724405988464],[-79.3369503287835,43.741900505559244],[-79.3371749288152,43.742090106008],[-79.3373987292209,43.74223300476285],[-79.33764582870589,43.74234960491597],[-79.3379296286442,43.74245730666827],[-79.33827082904776,43.74255030445018],[-79.33858032850536,43.74260220640434],[-79.33885102802647,43.742623305572174],[-79.3423336310567,43.74276320505037],[-79.34277442961645,43.74278400646268],[-79.34314402962684,43.74282490541772],[-79.34360453098638,43.74289350461462],[-79.34406263091842,43.742984606217455],[-79.34452353148264,43.74309940459051],[-79.34493923012063,43.743220706176984],[-79.34512173670174,43.743276708943235],[-79.34529803198573,43.74333080465483],[-79.34571913088575,43.74347580550569],[-79.34619373119828,43.74366840591734],[-79.34664813084729,43.7438851050049],[-79.34713943210086,43.744161005807676],[-79.3476708317491,43.744511206235465],[-79.34808063380196,43.74481670642147],[-79.34846083185963,43.74514170570768],[-79.34880963172142,43.74548470601164],[-79.34912533243556,43.745844105857174],[-79.35270723389547,43.7503378066637],[-79.35297643453886,43.75070190627779],[-79.35552423469629,43.75392800702933],[-79.36008303785299,43.759699408247705],[-79.36134233796291,43.761319808257575],[-79.36305983911576,43.763529809168425],[-79.36485113934313,43.76576340789753],[-79.36497480785195,43.76592175428577],[-79.36548309826065,43.766572564561926],[-79.36730464076332,43.76890490843894],[-79.36756824042546,43.769282709007804],[-79.367839241222,43.769756509613494],[-79.36803553993552,43.770182208358925],[-79.36821184116806,43.77067890832526],[-79.36827546162036,43.77101308894415],[-79.36870364117448,43.773262109720335],[-79.3687404415274,43.773738409145956],[-79.36869244158038,43.77421421057802],[-79.36865494195621,43.77440140974471],[-79.36858134072156,43.7746062105732],[-79.36811854219314,43.77572831085279],[-79.36719454161926,43.77780690993103],[-79.36709084071846,43.77812321077157],[-79.36702414169037,43.778389109357974],[-79.36697614151412,43.77869241057053],[-79.36695424064413,43.77931780987321],[-79.36698924098577,43.78028481162612],[-79.3670626411163,43.780758410938496],[-79.36716334175911,43.78110751091681],[-79.37029564427819,43.78981591195145],[-79.37085664344333,43.791294213108614],[-79.37135878424756,43.792617548834784],[-79.37142984422135,43.79280481283538],[-79.3716858446754,43.79347921361993],[-79.37203004449526,43.79453751280561],[-79.37331404577412,43.79827121453875],[-79.37355314526606,43.798841113880044],[-79.37369574617543,43.79911721460706],[-79.37409964474858,43.79980721492017],[-79.37657734718144,43.80333641426694],[-79.3768787475803,43.80368281530675],[-79.37747254748689,43.804249514920265],[-79.37811584758329,43.804825915191074],[-79.37875994813433,43.80537521477032],[-79.38031104846864,43.80665121504554],[-79.38040144761807,43.80672691544303],[-79.38062604782431,43.80691481539271],[-79.38207904849351,43.80814981567911],[-79.38352615018425,43.80934971569092],[-79.38408234949998,43.80979991542795],[-79.38609974975692,43.81165511628041],[-79.39013165194645,43.81558571573941],[-79.39216380337201,43.81756641599907],[-79.39345305304327,43.81887901657999],[-79.39412585452415,43.819536717278076],[-79.39445375433704,43.81985401661038],[-79.39663075447093,43.821965216170945],[-79.39688325510002,43.82220761591431],[-79.39776895440426,43.8230591172104],[-79.39803985493268,43.823315616613726],[-79.39845925519062,43.82367441784942],[-79.3987497560565,43.823898617249135],[-79.39895555611113,43.824039216355175],[-79.39920705662385,43.824209217847674],[-79.39952775594776,43.82441371689521],[-79.40010925639888,43.82474341706666],[-79.4003963569943,43.82488991729102],[-79.40070195643676,43.82503331668833],[-79.40116965739693,43.825236716377404],[-79.4015430572552,43.82538011722018],[-79.40195395646386,43.825524017071935],[-79.40234445603826,43.825652318035594],[-79.40257815688854,43.82571901750221],[-79.40307265740857,43.825840916596256],[-79.40358115756771,43.82595771634406],[-79.40444125831183,43.826122816530805],[-79.40793575807763,43.82679331601182],[-79.40858765799535,43.826916916497105],[-79.40939085828789,43.827071016469475],[-79.4099361582051,43.82718041639693],[-79.41025905835245,43.8272547169055],[-79.41061605845174,43.82734811646924],[-79.41090655900342,43.82743201646021],[-79.41131885878939,43.827566615270115],[-79.41170775983478,43.82772151715876],[-79.41211235911734,43.82790741691709],[-79.41254045844633,43.82813681564726],[-79.4128639594302,43.82833461577954],[-79.41315045990677,43.82852621573723],[-79.413488460161,43.82878751512683],[-79.41395825904576,43.82920311660489],[-79.41411745958122,43.82934741564083],[-79.41453525998372,43.82973941709673],[-79.41663306056634,43.831707217718154],[-79.41719306084539,43.83223291679345],[-79.4188407609528,43.833779916153226],[-79.41965276289852,43.834541816761764],[-79.42000316296381,43.83486931720636],[-79.42027786201332,43.83513021796409],[-79.4204767629045,43.83531851670862],[-79.4207274635557,43.83555091667928],[-79.42101066282176,43.835830917309046],[-79.4211908627387,43.836012417755555],[-79.4213664619738,43.83619171758602],[-79.42145566293689,43.83628551785371],[-79.42200949719717,43.83686659204549],[-79.4221713641757,43.83703641751857],[-79.42245047395733,43.837354548343924],[-79.42263916380168,43.83756961629662],[-79.42295735236122,43.83794315135903],[-79.42336646273233,43.83842341723865],[-79.42385466326384,43.83900151739895],[-79.42464076423877,43.83992851792169],[-79.42511036465385,43.84048931826139],[-79.42538916550843,43.840820318434865],[-79.42579896452165,43.8413043184569],[-79.42616836531279,43.841737818334046],[-79.4263160650884,43.84191271873913],[-79.4265122641002,43.84214251790177],[-79.42670386543136,43.8423715180762],[-79.42685256517251,43.84256111803899],[-79.42700706446952,43.84276841848719],[-79.42716596494299,43.84300321885628],[-79.42728006600414,43.84318351789699],[-79.42739246509578,43.8433967191024],[-79.42753836616055,43.84372931795401],[-79.42762096485681,43.843943017576834],[-79.4277009658894,43.844215618400376],[-79.4277974653627,43.84460641884011],[-79.42794826571713,43.84525191845879],[-79.4281412653785,43.8460736192632],[-79.4282810659799,43.84667781903302],[-79.42855996662558,43.84786751864776],[-79.42863486594185,43.848204318129675],[-79.42875696629879,43.848728319292945],[-79.42889456711654,43.84935931998074],[-79.42894806744448,43.84967711904393],[-79.42898276681396,43.849925118564826],[-79.42900786682006,43.85024451920536],[-79.4290119667986,43.85045701935681],[-79.42900876688061,43.85064861903773],[-79.42899706620969,43.850916218260316],[-79.42894626536173,43.85150211961926],[-79.42887566588809,43.85224681938805],[-79.42880866647815,43.85292802070495],[-79.42876506651741,43.85338952016598],[-79.42871646723088,43.85386632002456],[-79.42867646698399,43.85427971916192],[-79.42866346720105,43.85444361998859],[-79.42862526655163,43.85482222037102],[-79.42857286708494,43.85527112075594],[-79.4285183664544,43.855643520845206],[-79.42835406672951,43.856408621361666],[-79.42804486712873,43.857550321029656],[-79.42739496731198,43.85979762102506],[-79.42679206819352,43.861902321661994],[-79.42665626785814,43.862385021818035],[-79.42636946795552,43.863373821599446],[-79.42614726812612,43.86415342173858],[-79.42594696905473,43.86486622093496],[-79.42568916889091,43.86573922211423],[-79.42551226830392,43.866371221694486],[-79.42537646804703,43.866832422812855],[-79.42525636862695,43.867247322855796],[-79.42515376814737,43.867640023289205],[-79.42510546836586,43.867883021856976],[-79.42507146797519,43.868120522947045],[-79.4250456684665,43.86835832282924],[-79.42504096810531,43.86862432322301],[-79.42504446808638,43.86883172246013],[-79.42506626845666,43.869024422428346],[-79.42509306827833,43.869209022947686],[-79.42516796889994,43.86956532324159],[-79.42519086865076,43.869686322689375],[-79.42531506780402,43.870135523091385],[-79.4257326178198,43.87164657398663],[-79.4257804700826,43.87195812291565],[-79.42585186861218,43.872238822617696],[-79.42609786970736,43.87312772379679],[-79.426242669278,43.87364552303295]],[[-79.42625902661531,43.87368781313078],[-79.4265302682394,43.874684677626504],[-79.42667076505151,43.875192311275725],[-79.42684823817977,43.875829888905635],[-79.42720957860752,43.87635730493221],[-79.42747102825788,43.87667661709571],[-79.42957957142389,43.87879562433815],[-79.43071157081448,43.880275624368444],[-79.4336295733275,43.88457462518129],[-79.43433557352812,43.88636962539318],[-79.43449057339402,43.88750862564313],[-79.4343615738428,43.88916962516224],[-79.42778857328163,43.90951762940203],[-79.42749157229622,43.9101986298162],[-79.42665857276995,43.91143062994772],[-79.42589057291634,43.912240630349125],[-79.4176985703999,43.9189176313445],[-79.4169025695667,43.91981663146226],[-79.413522569646,43.92431363242301],[-79.41274556990552,43.9251376330702],[-79.41212156946835,43.92567963362001],[-79.40817756792622,43.928283634342996],[-79.40745856850064,43.92883263357942],[-79.40680256883236,43.92973963456272],[-79.40585456780474,43.931709634832224],[-79.40528656664641,43.93240863573327],[-79.40437356721141,43.933066635303874],[-79.39972856657312,43.93465263475472],[-79.39924756519487,43.934881635042295],[-79.39839356542268,43.93548863577961],[-79.3979205668069,43.936037635247374],[-79.39768656656803,43.93653263535869],[-79.3975115652387,43.937396636029554],[-79.39770956574057,43.93837563605441],[-79.3979987819044,43.93908535322226],[-79.39838295891157,43.940025965149125],[-79.39855896658047,43.94050583550794],[-79.39882456634359,43.94109873634295],[-79.40012276611486,43.944405638049915],[-79.40026886707962,43.944962537740885],[-79.40035106778217,43.945566337358066],[-79.40036996647308,43.94580483706208],[-79.40039096788601,43.94966623812668],[-79.4003778676565,43.95066053774278],[-79.4004071679265,43.95318103807013],[-79.40041516912667,43.95387653877577],[-79.40044146816102,43.95614033899503],[-79.40041806819372,43.95696043902931],[-79.40039256864597,43.95729083901255],[-79.40037036941168,43.95745873912029],[-79.4003182685883,43.957668739941035],[-79.40022026900422,43.95797903972747],[-79.40009596879491,43.95825704018223],[-79.40000996899957,43.95843283936776],[-79.39989636787945,43.958622540460766],[-79.399730169086,43.9588507397387],[-79.3995899684399,43.95902464043688],[-79.39934306829309,43.959301139790846],[-79.399126368451,43.959524339586395],[-79.39883091742726,43.95984548967522],[-79.39803026745501,43.96069464038302],[-79.39598396758365,43.96286444042297],[-79.39495326793673,43.96395254130695],[-79.39460666703431,43.964363340317796],[-79.39440166787318,43.96471434143087],[-79.3942548678966,43.9650920412867],[-79.39417706683048,43.965542440921084],[-79.39417176631295,43.96577084193211],[-79.3941958671332,43.96605834102594],[-79.39423596657188,43.966217541309035],[-79.39436386823192,43.96656144216758],[-79.3944948670107,43.96678844162716],[-79.39551206743573,43.96836034152212],[-79.39613236790042,43.96928014135286],[-79.39660366783741,43.96995124248076],[-79.39684736837408,43.970322841683675],[-79.39704576793001,43.97065394158912],[-79.39727046819803,43.97109914161918],[-79.39741306824526,43.97149584289756],[-79.39750206783876,43.97185224228454],[-79.39757386920529,43.97235074153932],[-79.39755466899771,43.97295424230721],[-79.39742496920076,43.97427944189494],[-79.39729748090761,43.97565744558933]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak Only",NAME:"Milton Line",Shape_Leng:50436.2806414},geometry:{type:"MultiLineString",coordinates:[[[-79.3805194330646,43.64455588646084],[-79.38896668448932,43.6428347821212],[-79.39356540400317,43.6418841724241],[-79.39566764062788,43.64144954271135],[-79.39875653782256,43.64090088489534],[-79.39909563886147,43.64082928530636],[-79.39932353826936,43.6407831858509],[-79.39990213769336,43.64069168455643],[-79.40178503765942,43.6404791839412],[-79.40220403829885,43.64043848336318],[-79.4038009385715,43.64028348526098],[-79.40489144022357,43.640214484904895],[-79.40589713989041,43.64016718500682],[-79.40642583997958,43.640150484863504],[-79.40750704056985,43.640153284742055],[-79.40798323991275,43.640165684070894],[-79.4088414405955,43.64018358315855],[-79.40981464187051,43.64022098435758],[-79.41128054150656,43.640277184720524],[-79.41664264362261,43.64048268465344],[-79.41832914380898,43.64054718252954],[-79.41965897059258,43.64059809418227],[-79.42096514459317,43.64064808377894],[-79.42198674562145,43.640693083977524],[-79.42249964614962,43.64073068413838],[-79.42318024590425,43.640808183599766],[-79.42364914561132,43.640878484336596],[-79.4243176458737,43.64101368397455],[-79.42494434637247,43.641159284860755],[-79.42544004784438,43.641297984702625],[-79.42587044648022,43.64142648471231],[-79.42630964593708,43.641567184737156],[-79.42664254622996,43.641682384221696],[-79.42698494679561,43.641815283707864],[-79.42721154777959,43.64190508371685],[-79.42757824645277,43.64206648444312],[-79.42794094753032,43.64223388358606],[-79.42835894753546,43.64242778388468],[-79.42877454667583,43.642621828775205],[-79.42930604767004,43.64286998453135],[-79.42974414751237,43.64308098398085],[-79.43039924861766,43.64337808438584],[-79.43102204877155,43.64365948294463],[-79.43413494858689,43.645129483110004],[-79.43440494901085,43.64525728409082],[-79.43650904980538,43.64620388322246],[-79.43885735100227,43.64731688451022],[-79.43897895031796,43.64738028490352],[-79.43923635188091,43.6475155829396],[-79.43931525191557,43.647556483855574],[-79.43989925126114,43.647861984615986],[-79.44038945119615,43.648150285001975],[-79.44123915127741,43.64869078435432],[-79.44195695302042,43.649199783984095],[-79.44316305372412,43.65016808520824],[-79.44383205349939,43.65076018344082],[-79.44428645416767,43.651200385158376],[-79.44775835488606,43.65477218563099],[-79.44971695571395,43.65676768568385],[-79.45056650123823,43.65763325084943],[-79.45193458365357,43.65902697411834],[-79.45395075810904,43.66108078637148],[-79.45447355708815,43.661655984610306],[-79.45551755844953,43.662698586536216],[-79.45726245932754,43.66446958570159],[-79.45773955884357,43.66487488548724],[-79.45811445784177,43.6652239864971],[-79.45860994181524,43.66572654879516]],[[-79.86617584319973,43.523685364498654],[-79.86476387518223,43.52423494160394],[-79.86372047608897,43.52463514310463],[-79.86259787548681,43.5250800413232],[-79.86206147029499,43.52528210220845],[-79.86156087508398,43.525476242991964],[-79.86071047487954,43.52584184182711],[-79.86048544542007,43.52595533555644],[-79.86023519999372,43.52606688384221],[-79.85991507320564,43.5262429433456],[-79.85914797332251,43.52666984246503],[-79.85838687386317,43.52718534324588],[-79.85778637426257,43.52768724372224],[-79.85619257383888,43.52912254235346],[-79.85489217217288,43.530293643574375],[-79.8544082726555,43.53072924397637],[-79.85243765036482,43.5325036657276],[-79.85205703560634,43.53282463965026],[-79.85101899101262,43.53378438610121],[-79.84081097552416,43.543059358525305],[-79.84039221156524,43.543435005518624],[-79.84024776932294,43.54360844744241],[-79.83988152961527,43.54393534779073],[-79.83622066884402,43.5472684476935],[-79.83499886935921,43.54837844750409],[-79.83452226715528,43.54881124782324],[-79.83146016762873,43.55161614873058],[-79.8312709683353,43.551785048744485],[-79.82821006672171,43.55451804825008],[-79.82810526656895,43.554614049470125],[-79.8244641667547,43.557950850192285],[-79.82354576637998,43.558792350454596],[-79.81894386515961,43.5629038515611],[-79.8184252638044,43.56337055102091],[-79.81771976523238,43.564008851795236],[-79.81735146428078,43.56433565220459],[-79.81688216415148,43.56476725130527],[-79.81643266386699,43.565173551670334],[-79.81557656313922,43.56594805042771],[-79.81465956292824,43.56677305202413],[-79.81297706331756,43.56829555230865],[-79.81210696210158,43.56908065236049],[-79.81120356264714,43.569893752632545],[-79.81031686236932,43.57070015273817],[-79.80943186230654,43.57149165280884],[-79.8086064618134,43.57224375391469],[-79.8078614617586,43.572927052029314],[-79.80707046147165,43.573647152494445],[-79.80614076086522,43.57446425424063],[-79.80537756080932,43.57516095274409],[-79.80451786100612,43.575944853786176],[-79.80364576092343,43.57673805451473],[-79.80287455998447,43.57743015484529],[-79.80242456050156,43.57784575404012],[-79.80179765998578,43.57840425511926],[-79.80083116056618,43.57925211149391],[-79.80072133232385,43.57937492482965],[-79.80057272922132,43.57947877939614],[-79.80039966051514,43.57963055526226],[-79.79790225906348,43.581909255584804],[-79.79762725994031,43.58215805579458],[-79.79282535823903,43.586502857360024],[-79.79164565820159,43.58757005754366],[-79.78892837869252,43.59000253760953],[-79.78695395715651,43.59176985776649],[-79.78343205654802,43.594992657991945],[-79.78309935689785,43.59528895926022],[-79.7825777555613,43.59569235772117],[-79.78233275629736,43.595858359158925],[-79.78186015602999,43.596178059387334],[-79.7812801552166,43.59649885907715],[-79.78082775501363,43.59672665818744],[-79.78041255476795,43.596900758874185],[-79.78003635613109,43.59704425843425],[-79.77980535398686,43.5971207593054],[-79.77887185546182,43.59738215931844],[-79.77819545486972,43.597536758867705],[-79.77781215371999,43.59761995962425],[-79.77734855515578,43.59770025922929],[-79.77670325445077,43.59781415999018],[-79.77180545281922,43.598590658372935],[-79.76552385065798,43.599658460075474],[-79.76465825124414,43.59977406086846],[-79.76400065021242,43.59983315902576],[-79.76331815044702,43.599851360510065],[-79.76298695025477,43.599846460073785],[-79.76222994894458,43.599809160626705],[-79.76146574941427,43.59974776047721],[-79.76126004897229,43.59971856110502],[-79.76079704968367,43.59963615961502],[-79.76017374902932,43.5994987605234],[-79.75939794841689,43.59929866077439],[-79.75905744803444,43.599202159708405],[-79.75886074816776,43.59914646058675],[-79.75345709632393,43.59761489596569],[-79.74545754466295,43.59534696115216],[-79.73999694296889,43.593798160305255],[-79.73988354058075,43.593766093012995],[-79.73970944231736,43.593716861105946],[-79.73474614027845,43.592313660733105],[-79.73403394008578,43.59211226059857],[-79.73324133910121,43.5918835611507],[-79.73211514017667,43.59156836033183],[-79.73177683919779,43.59147106138196],[-79.73076213955487,43.59118366063078],[-79.72952873896664,43.59083836073297],[-79.7285169389317,43.590551660613514],[-79.72810643812754,43.590427460108714],[-79.72764213807932,43.59026245995525],[-79.7272060370839,43.59009456101315],[-79.726771338101,43.58990625942415],[-79.72646313838081,43.58976136002356],[-79.72623673812788,43.58965216064329],[-79.72584883785565,43.589449460498564],[-79.72549503720361,43.58924216044383],[-79.7252683369025,43.58910066070172],[-79.72504183700254,43.58894385943612],[-79.72469513769153,43.58868586020463],[-79.724491436659,43.588528960816795],[-79.72420833650416,43.58829396083145],[-79.72400293625367,43.5881042607817],[-79.723768937683,43.58789366004067],[-79.72349173699988,43.587599160566974],[-79.7233368627983,43.58743725603437],[-79.72289983501479,43.586980560265346],[-79.72239683619173,43.58644046028738],[-79.7215804363099,43.58558276062202],[-79.72066653530946,43.584611759977726],[-79.72008473461693,43.583980360290894],[-79.71968743384998,43.583560860439796],[-79.71943433473508,43.58330815959512],[-79.71917143391926,43.583054660536526],[-79.71893263423728,43.582849960267865],[-79.7187391344275,43.582699659607314],[-79.71799023344978,43.58214145981431],[-79.71601773303199,43.580713757893],[-79.71412133212237,43.579327858327595],[-79.71182283187491,43.57766755969505],[-79.711350330542,43.57732025890716],[-79.71108423197394,43.57714785828112],[-79.71084083132615,43.577006659295726],[-79.7105314321403,43.576838359078735],[-79.71012233041243,43.57663325874053],[-79.70905432750877,43.57611720955057],[-79.70791873010958,43.57556545730116],[-79.70760283012297,43.575414058510546],[-79.70733403017064,43.575293158660116],[-79.70705452973229,43.575178958452206],[-79.7067118293328,43.57505555801542],[-79.70644842999383,43.57497135884241],[-79.70598842991251,43.574853658889786],[-79.70563472982947,43.574781357530426],[-79.70534463013273,43.574738059746494],[-79.7049536291048,43.57468885805499],[-79.70449602889504,43.57466235888252],[-79.70408522893698,43.57466325856309],[-79.70382212949784,43.57467225951925],[-79.70353402842976,43.57468255918856],[-79.70319962892452,43.57470845898044],[-79.70284142824956,43.57476545963021],[-79.70223092879385,43.57490835946436],[-79.69938762802377,43.575750058997436],[-79.6988914279751,43.575904659538466],[-79.69791132643151,43.57620905937589],[-79.6954013269613,43.576937460169084],[-79.69497052578997,43.57703946046495],[-79.6946048261894,43.5770952598827],[-79.69425712697776,43.57712936009364],[-79.693933325539,43.57715245851444],[-79.69358012633886,43.57716625956603],[-79.69334042574224,43.57716956005338],[-79.6931249268679,43.57716266009259],[-79.69286092537921,43.577140458933556],[-79.69257402520581,43.57710916013973],[-79.69230842570572,43.577058559838726],[-79.69198082529762,43.57697605920137],[-79.69152892461952,43.57685255986889],[-79.69112782427338,43.57671926033886],[-79.69071312474719,43.576535358677496],[-79.69025142498568,43.57629775980195],[-79.68841862476273,43.575305359383854],[-79.68814179518017,43.57518017893501],[-79.68298132158642,43.57236075908785],[-79.68160092175617,43.57164055944083],[-79.6794307214289,43.570458258978846],[-79.67812402135664,43.569748560068355],[-79.67648212803628,43.56886594314325],[-79.67627031926561,43.568751759252784],[-79.67593821906131,43.568594459377515],[-79.67549951878723,43.56842225912448],[-79.67509371839527,43.5682802590107],[-79.67479471961497,43.56819015973849],[-79.67424251860656,43.56804915896092],[-79.67355051762952,43.5679057582811],[-79.66857592289658,43.566886339150706],[-79.6669991170522,43.56656315925368],[-79.66626601709433,43.56641285771769],[-79.6615804144638,43.56545225905262],[-79.66055461369126,43.565259759783366],[-79.65977331478987,43.56514195984909],[-79.65884121425077,43.565067659581075],[-79.65778431402825,43.56505535979232],[-79.65681301336612,43.56509815973624],[-79.65576491293861,43.56521256037055],[-79.65477651293065,43.56540916046181],[-79.65387601281624,43.56565176009332],[-79.65297391101937,43.56595745974502],[-79.65031221101279,43.56698016000167],[-79.64479050922807,43.56912486053801],[-79.64059310881377,43.570754761744666],[-79.64024490809379,43.57089296167205],[-79.63972560848501,43.57110096206732],[-79.63905110869344,43.57141416120503],[-79.638197808426,43.57183646179172],[-79.63724370761683,43.57235086140447],[-79.6367775072512,43.5726204618761],[-79.63579440978714,43.57325216254336],[-79.63521260750018,43.573688162035076],[-79.63244530620811,43.57599866280079],[-79.63127245481157,43.57700241294967],[-79.62700540447771,43.58056166235438],[-79.62353488255066,43.58345595500671],[-79.62301610397596,43.5838885650249],[-79.62230583004437,43.58448881665244],[-79.62218530405457,43.584590664793815],[-79.61989670491324,43.58652486509438],[-79.61931690328251,43.58699426514885],[-79.61901390229608,43.587212665698566],[-79.61845200376749,43.587575265540515],[-79.61784860294516,43.587928265723285],[-79.61701570344535,43.58834326495026],[-79.61620220323864,43.58868756610575],[-79.6157934013434,43.58884646598541],[-79.61533250290806,43.589009866388054],[-79.61440530268649,43.58927316442347],[-79.60911449985173,43.590464466730836],[-79.60447349852598,43.591509165131],[-79.60319862266923,43.591796419897705],[-79.60262439917142,43.59194926751695],[-79.60213179822293,43.592097666452865],[-79.60165859784051,43.59225416712486],[-79.60116599794709,43.592439367035375],[-79.6007782975394,43.592632267653805],[-79.60042169746058,43.59282876632236],[-79.59862279760627,43.59395106714501],[-79.59507339574736,43.59625886817611],[-79.58890839487617,43.600315568198724],[-79.58569279437545,43.60240546936886],[-79.57984949283303,43.60622637071835],[-79.57971540400068,43.60630475155298],[-79.57951359219726,43.606441370010025],[-79.57700090392439,43.60804929634356],[-79.57472829163692,43.60950347208544],[-79.57185349004926,43.61136777222094],[-79.56737958965623,43.61426847207496],[-79.56603508857941,43.61513997288231],[-79.56239588821497,43.61749897321055],[-79.55823228633513,43.62022557434406],[-79.5545432953,43.62273691641889],[-79.55406518536807,43.62306237334355],[-79.55019098428544,43.62571807607523],[-79.54990508483858,43.625911975315695],[-79.54529318382669,43.62907317514177],[-79.54401338277115,43.63002827667115],[-79.54369678231996,43.630274276629486],[-79.5433182821231,43.63058687618505],[-79.54251458353201,43.6312651772787],[-79.5417500819721,43.63190687667602],[-79.54100988187987,43.6325327764341],[-79.54017738236888,43.633222675787216],[-79.53943588193313,43.633850375846734],[-79.53870638221952,43.63446397799278],[-79.53786828046815,43.63518037758038],[-79.53759721477574,43.63542228840738],[-79.53682458126961,43.63605447771611],[-79.53607848162436,43.63669527668822],[-79.53567548157977,43.637021578228726],[-79.53396948023713,43.63843797853835],[-79.53317437989796,43.639130977248584],[-79.52986257890947,43.64201707880176],[-79.52822617949327,43.643335078059735],[-79.52769197976383,43.643768378224834],[-79.52751577964995,43.64391507924798],[-79.5261748169198,43.64501883098614],[-79.52442287820536,43.64648898045592],[-79.52412447755977,43.64673937999108],[-79.52260907856042,43.64802588078828],[-79.52152637726769,43.6489450806616],[-79.52112437737753,43.64931168043625],[-79.52091617779811,43.64953828036473],[-79.52070107635332,43.649806879718604],[-79.52053177746464,43.65003018097722],[-79.52036017823033,43.6502878810951],[-79.52014257713363,43.650685380219336],[-79.51772507694834,43.65703988205487],[-79.51757587719914,43.657343582810896],[-79.51743077679856,43.657628683238514],[-79.5171909772132,43.65801418261528],[-79.51697557757718,43.658305982786544],[-79.51670227695175,43.65861888297552],[-79.51634307704651,43.65896488286844],[-79.51605867637316,43.659232382965826],[-79.51567057721984,43.65957438276547],[-79.51521867727831,43.65999068236355],[-79.51476407662366,43.66039078346979],[-79.51384157746826,43.66117738345264],[-79.51214647790927,43.66262248371479],[-79.51163147607947,43.66305158270899],[-79.5110682758085,43.663526883417155],[-79.51069917530471,43.66380938337448],[-79.51039697481718,43.664021084111155],[-79.51012157483709,43.66419638474825],[-79.50979717492302,43.66438238342029],[-79.50948167589044,43.66453728259646],[-79.50908377462866,43.664710284671294],[-79.50865527560306,43.664877283783404],[-79.50814067533867,43.665044484579205],[-79.50781547509561,43.665126983855664],[-79.50742367443952,43.66520938393613],[-79.5070810741576,43.66526858498337],[-79.5066424747541,43.665322983008046],[-79.50617847408357,43.6653670840936],[-79.50490327472264,43.6654465845429],[-79.5036579733167,43.66551818463957],[-79.50220547322131,43.6656026850782],[-79.50084927248719,43.66568098426367],[-79.49936547130065,43.66577098556594],[-79.49850877223906,43.66582088463564],[-79.49809547116901,43.66584408485436],[-79.49775247155998,43.66586138460403],[-79.49623757155696,43.665948784706934],[-79.49417717087067,43.66606688502736],[-79.49220286943482,43.666180284217745],[-79.4913049474347,43.66623298710256],[-79.49120956972786,43.666238584042475],[-79.48979226824447,43.66631978527706],[-79.48804586854529,43.666419385043696],[-79.48693786889838,43.666486485812385],[-79.48608506819053,43.66653438573029],[-79.48559516740386,43.66656148568965],[-79.48480176672665,43.66660748602001],[-79.48288206784007,43.666720285898684],[-79.48244726686583,43.666747384203795],[-79.48188996592084,43.66678098568446],[-79.48057096670826,43.66685908616498],[-79.47853766628279,43.66697028599446],[-79.47715676597016,43.667053186259835],[-79.47616366569503,43.66710778454622],[-79.47477836441556,43.66718768651989],[-79.47394026390525,43.66723048532624],[-79.47345846393992,43.667249486120255],[-79.47299516378027,43.66725628704372],[-79.472478163299,43.667253684780455],[-79.47064516281043,43.66723668524593],[-79.46917086229496,43.66722468634682],[-79.46754606175865,43.66720878673738],[-79.46606046139874,43.667191987308456],[-79.46512206055226,43.66718808632243],[-79.46416696067476,43.66718428581675],[-79.46357816029915,43.66717738654472],[-79.46326966057006,43.667167086626016],[-79.46300466123188,43.66714898590041],[-79.46275216054701,43.6671179870181],[-79.46198925952434,43.666988186864835],[-79.46144056071168,43.66686058738503],[-79.4608096593659,43.66666948689014],[-79.4601420592556,43.66640778703029],[-79.45954546031645,43.666117885612614],[-79.45860994181524,43.66572654879516]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - All-day",NAME:"Lakeshore West Line",Shape_Leng:63281.1092691},geometry:{type:"MultiLineString",coordinates:[[[-79.86480104407582,43.266455179834104],[-79.8660969911167,43.26676884384204],[-79.86723685284194,43.26703699704311],[-79.86786945389763,43.267178097325186],[-79.86849585375799,43.26732319744654],[-79.86923965344494,43.2674967962163],[-79.86974145381024,43.26761689711275],[-79.87042945331727,43.26778029642837],[-79.87087495452593,43.2678820963292],[-79.87155325369642,43.268043797351034],[-79.87210965521314,43.26817329666126],[-79.87318975470858,43.26842069670816],[-79.87376355518454,43.26855509577571],[-79.87404265650557,43.26862869626464],[-79.87454115585201,43.26874279606716],[-79.8752861553814,43.26887669702668],[-79.8759100564875,43.268983196716604],[-79.87740115621392,43.26923269563456],[-79.8776395558355,43.26927679618557],[-79.87784025553509,43.26931939681926],[-79.87815655786044,43.269389096155216],[-79.87846605638278,43.269471197511926],[-79.87891615692106,43.26959139673717],[-79.87980395734202,43.26983009636235],[-79.88064565778143,43.270055896868094],[-79.88154455847628,43.27029649674327],[-79.88217605884772,43.27046679581111],[-79.88253115840216,43.27056669627882],[-79.88273415936393,43.27062459653591],[-79.88292185760001,43.270691897084916],[-79.88313245814284,43.27076889583701],[-79.88331445824623,43.27084559665719],[-79.88346195814037,43.27091199668845],[-79.88365915886543,43.27100619620226],[-79.88387585974085,43.27111969673081],[-79.88409725872928,43.271251996045635],[-79.88428075863978,43.271373396665645],[-79.88445975827581,43.27149389661551],[-79.88460675922948,43.27161149722373],[-79.88499655913853,43.271969297087104],[-79.88554235910217,43.27252879686681],[-79.88614746029269,43.273157896706174],[-79.88644906017336,43.27351459752008],[-79.88673626010691,43.27387999706982],[-79.88714396041604,43.27445909665667],[-79.88753266023132,43.275030296881994],[-79.8878399604348,43.27547869718647],[-79.88938816099598,43.27776159756291],[-79.88968146157819,43.27823509724407],[-79.88990716093507,43.27869659744835],[-79.89011916162798,43.27923889756141],[-79.8902342617608,43.279559198034725],[-79.8903329073159,43.279882614281966],[-79.89039416732736,43.28001476788156],[-79.89065538774935,43.28053432832845]],[[-79.89065538774935,43.28053432832845],[-79.89066486278608,43.280395297997224],[-79.8906870621223,43.28027749757561],[-79.890711561701,43.280169898385005],[-79.89075036169213,43.280041797940655]],[[-79.3805194330646,43.64455588646084],[-79.38896668448932,43.6428347821212],[-79.39356540400317,43.6418841724241],[-79.39566764062788,43.64144954271135],[-79.39875653782256,43.64090088489534],[-79.39909563886147,43.64082928530636],[-79.39932353826936,43.6407831858509],[-79.39990213769336,43.64069168455643],[-79.40178503765942,43.6404791839412],[-79.40220403829885,43.64043848336318],[-79.40435563965332,43.639894384530265],[-79.40518954045359,43.639720384901004],[-79.40643774003279,43.6393859840724],[-79.40758284035074,43.6390775848961],[-79.40920374082914,43.638631784282985],[-79.41271464238498,43.63767038443707],[-79.4132655423966,43.63755708386424],[-79.41417174188807,43.63730818376055],[-79.41539404269703,43.63697208310055],[-79.41697554313106,43.63655608335625],[-79.41848214366641,43.636169983829205],[-79.4190313685767,43.63601678981005],[-79.41958134451005,43.63586338214365],[-79.42308404524645,43.63488598255792],[-79.42553712123923,43.63420143451145],[-79.42573904528966,43.63414508304541],[-79.42688534529138,43.633844882094216],[-79.42781804621447,43.63364838219204],[-79.42852754693646,43.63354588267917],[-79.42972554684584,43.633416582306964],[-79.43079284695952,43.63335438210223],[-79.43154954890299,43.63335258283669],[-79.43223534711296,43.633386582789214],[-79.43326024724537,43.63348588144354],[-79.43386664754019,43.633571081840685],[-79.43460454820537,43.63371888066646],[-79.4356370481602,43.633953382115266],[-79.43656934881395,43.63424038318505],[-79.43747494968666,43.63457268222483],[-79.44260035065118,43.63673578237006],[-79.4440272510799,43.63734498254114],[-79.44470575149764,43.63760408088819],[-79.44556535266503,43.63788618269232],[-79.44602325251093,43.63801448137599],[-79.44670005367075,43.63819088216025],[-79.44711365352465,43.63828908309062],[-79.44742675227597,43.638357482282295],[-79.44803505358506,43.638487081454095],[-79.44881045468615,43.63863628262724],[-79.44928235372707,43.63872358221807],[-79.45000715360219,43.6388406826882],[-79.45055795436339,43.63892568282963],[-79.45112075508627,43.63899898185206],[-79.45176795454486,43.639073682851595],[-79.45235565476618,43.639135582445995],[-79.45300435461702,43.63919098261039],[-79.45367435569904,43.63923928113711],[-79.45409355516009,43.63926108235412],[-79.45477035564268,43.63928858219811],[-79.45543125566984,43.63930328267625],[-79.45600245572588,43.639303282498865],[-79.45645995588374,43.639292681202356],[-79.45694155588947,43.639277782694364],[-79.45745225551585,43.63924798130446],[-79.45782745651081,43.639222282766134],[-79.4583620561358,43.63917298193422],[-79.45859495674092,43.6391472811681],[-79.45885535669522,43.63911728266705],[-79.4594428569317,43.63904018154008],[-79.46001005748874,43.63895028203193],[-79.46038215675976,43.63889098176882],[-79.46135035750778,43.63870518173338],[-79.4625623579929,43.63842578161109],[-79.46389025811649,43.638056381567424],[-79.4644828584552,43.63786668034412],[-79.4652977587065,43.637582682238325],[-79.46598295930062,43.63731648143299],[-79.46619325913366,43.63722678111709],[-79.46886115936664,43.63608798072885],[-79.47232526174113,43.63455808064743],[-79.47277926059792,43.63434098075029],[-79.47356486050455,43.63391648048787],[-79.47468246099311,43.6332208801304],[-79.47542426187144,43.632721380214164],[-79.47595126134856,43.632328778691694],[-79.4778248620954,43.630888880631076],[-79.47844878348941,43.63041685882219],[-79.48214266331128,43.627622077507354],[-79.48267762976427,43.62721011356204],[-79.48525726301293,43.62522347901243],[-79.48625079427215,43.624466765717976],[-79.4866631643993,43.62415267816115],[-79.48711136554307,43.62380837812836],[-79.48766836465478,43.623403378123975],[-79.4881347647271,43.62306277647286],[-79.48867686510057,43.62265697603047],[-79.48885246428496,43.62251767761145],[-79.48922416603273,43.622244177584896],[-79.4899448660394,43.62168907780603],[-79.49042286465921,43.62132627746354],[-79.49078366528083,43.621055077556534],[-79.49121996551379,43.62072227757193],[-79.49220116480312,43.61998217712931],[-79.49346906584941,43.619021376573414],[-79.49436016612026,43.61834507672095],[-79.49499156582384,43.61785887673899],[-79.49572306739229,43.617369477012346],[-79.49614206671701,43.61710347578674],[-79.4968097300495,43.61667702997719],[-79.49698046579404,43.61656797615221],[-79.49784196820532,43.61601407636069],[-79.49851356720471,43.61558437558171],[-79.4995377679121,43.6149595760384],[-79.50051096774254,43.614384875694874],[-79.50148596862356,43.613845673989374],[-79.50243856786742,43.613339874974095],[-79.5044138699098,43.61236557471041],[-79.50534406944838,43.61189917485205],[-79.50635677101158,43.61139737552767],[-79.50735206938924,43.61090237428687],[-79.50840316910768,43.61037727478258],[-79.50938037096385,43.60989257455939],[-79.51172707149237,43.60873177409014],[-79.51284217093541,43.60817977392483],[-79.51377927043035,43.60771667445084],[-79.51475777213247,43.60723157322442],[-79.51556627220545,43.60682927392698],[-79.51643587321949,43.60640097387936],[-79.5173971719021,43.60591997327895],[-79.51842007222832,43.605414473445265],[-79.51922947235558,43.60500807211922],[-79.52005817259405,43.6045962715896],[-79.52090957398035,43.604161672838046],[-79.52184307355876,43.60369547141477],[-79.52271957350023,43.603260372739925],[-79.52388407519248,43.6026796722498],[-79.52462747379883,43.60231267258592],[-79.52540377537342,43.60192697196888],[-79.52617367486754,43.601542471013126],[-79.52676297537226,43.60125057268451],[-79.52718487555494,43.601044271730665],[-79.52778767513476,43.6007448720841],[-79.52807507483871,43.60060437127504],[-79.52863607468693,43.60032657184954],[-79.52966167599467,43.599788570470594],[-79.52971957604308,43.599757772298446],[-79.53083687570815,43.59920087122184],[-79.5311662758133,43.599036871900424],[-79.53151467637076,43.598862772169234],[-79.53207897598995,43.59858257127277],[-79.53314107679375,43.59805697096745],[-79.53414357783524,43.59755787072001],[-79.53521777779153,43.5970275711622],[-79.53613957820582,43.596566270734705],[-79.53703957763318,43.59611347087157],[-79.53796027800176,43.59566066961793],[-79.53887067807858,43.595212769306904],[-79.53974437879808,43.594776370228864],[-79.540459379256,43.594420470288135],[-79.54133987896307,43.59398087003662],[-79.54200787871768,43.59365377029499],[-79.5429777804607,43.59316536991328],[-79.54360107892548,43.59286156977446],[-79.54430037958909,43.592512169633665],[-79.54497423124859,43.592182086029844],[-79.54597817994488,43.59167746925436],[-79.54675328011668,43.59127476911299],[-79.54739358137283,43.590930469794124],[-79.54814498139835,43.59049676986899],[-79.5488219810463,43.59009476930063],[-79.54896828141344,43.590009168572365],[-79.55086398105914,43.58875346903907],[-79.55105688098192,43.588615369062445],[-79.55178668277757,43.588085969140785],[-79.55234348257906,43.5876614685779],[-79.55280758222608,43.58730076728846],[-79.55342668199133,43.58680266904038],[-79.55386778147609,43.58643946813226],[-79.554145882488,43.58621046823323],[-79.55449368281086,43.58591076844914],[-79.55525368310938,43.58521396839964],[-79.55603338350942,43.58451196781464],[-79.55676608317079,43.583836867157686],[-79.55735448262077,43.58329346808989],[-79.55795278349008,43.582744566426726],[-79.55862828272473,43.582090067172764],[-79.55925358269907,43.581522667417985],[-79.5598900848759,43.580937067243866],[-79.56065998404982,43.58022696719735],[-79.56141338481753,43.57953526615622],[-79.56192558382443,43.57906886648348],[-79.56262568409939,43.578434265435156],[-79.56327698467676,43.57783626635353],[-79.56396498583578,43.577205265155705],[-79.56462198588713,43.576601065678375],[-79.56529558466055,43.57598186541875],[-79.5660980846977,43.57524496611589],[-79.56669638480173,43.574690265982724],[-79.56736508545002,43.574084563808135],[-79.56822018582305,43.573299764670026],[-79.56883488526879,43.572743163861794],[-79.56943098622207,43.57219166493238],[-79.56970118583206,43.57194376521237],[-79.57029568649372,43.571399865330065],[-79.57101948695436,43.570738165093545],[-79.5718201867003,43.57002456423716],[-79.57266478596641,43.56927136463914],[-79.57357578664195,43.56843996413627],[-79.57425708673036,43.567827264634104],[-79.57514178840667,43.567008963897806],[-79.57595728704159,43.566256663356874],[-79.57670728782138,43.56557216233142],[-79.57742528773703,43.56490776302275],[-79.57829688811407,43.56411096261318],[-79.57907238888468,43.56339216234273],[-79.57997218844483,43.56256436248146],[-79.58079408857311,43.561822662160466],[-79.58168138907787,43.56100976214512],[-79.58285318839812,43.55993736185318],[-79.58380148946488,43.559076962056345],[-79.58476028915199,43.558208361412085],[-79.58522649333747,43.55777571108874],[-79.58554778995156,43.557481861707664],[-79.5861735900996,43.556910661816936],[-79.58688178953531,43.55626166150795],[-79.5871483181098,43.55601572189757],[-79.5876973905074,43.55550906151711],[-79.58832689055433,43.554916861579926],[-79.58887809125424,43.55438966043517],[-79.58952599064429,43.553793959491095],[-79.59002459101907,43.55331745892489],[-79.59071019079651,43.55268266118679],[-79.5918976909981,43.55159626035426],[-79.59223379174132,43.55128896050627],[-79.5930844926342,43.55051066039059],[-79.59384419211179,43.5498149599202],[-79.59508189156625,43.548699959337696],[-79.59767079295013,43.54632045899861],[-79.59880539226283,43.545277658117406],[-79.60397799398977,43.54052245753345],[-79.60772369585563,43.53707825697219],[-79.61403569813712,43.53129695552597],[-79.61523289652293,43.53020015571385],[-79.62094679717616,43.52492975448041],[-79.62570309923933,43.52056935278891],[-79.6259923998436,43.520304153349244],[-79.62669619967306,43.51965815315947],[-79.62725169881143,43.51915935254653],[-79.62794489967602,43.51852095276469],[-79.62866379982383,43.51785945236791],[-79.62944860063351,43.51712475211377],[-79.63019489944925,43.516435952345155],[-79.6310583008215,43.51563815201563],[-79.63201310054797,43.51476195196132],[-79.63275240184473,43.51408195134389],[-79.63317730178234,43.51368695139639],[-79.63333610167786,43.513540451076274],[-79.63344450154564,43.513440451206655],[-79.63406740094953,43.51286955174203],[-79.63461795343231,43.51235898610378],[-79.63493490196699,43.51206505117645],[-79.63575260078862,43.51131505002389],[-79.6368520025138,43.51030055106039],[-79.63784780185063,43.509388651139524],[-79.63893860241117,43.508381649471566],[-79.63978450251238,43.507577148543945],[-79.64042520278144,43.50692495097557],[-79.64138470335861,43.50588634982197],[-79.64217780286006,43.504952149887586],[-79.64308090371674,43.50382284930526],[-79.64379580357485,43.50293084960571],[-79.64427960361931,43.50231724774114],[-79.64480360336105,43.50163944928664],[-79.64507110346838,43.50127984927972],[-79.6452780037121,43.501007948987436],[-79.64597690303249,43.50012084881762],[-79.64751940414263,43.498166647965206],[-79.64783620459866,43.497765148112414],[-79.651205004667,43.49349624650822],[-79.65159160516113,43.493006346814056],[-79.65372730606958,43.490323646224255],[-79.6545655055142,43.489270745952886],[-79.6558090059437,43.4876341458788],[-79.656318506862,43.48697844408463],[-79.65738760599469,43.48562954567964],[-79.65794260688725,43.48493194594747],[-79.65840520704961,43.484344445216216],[-79.65891710646216,43.48369824556845],[-79.65936560666945,43.483129844768925],[-79.66010130754775,43.482192444485726],[-79.66029660679447,43.481945645110095],[-79.66072260709332,43.48139774456007],[-79.66116690753044,43.480844243671044],[-79.66144560750635,43.48049094433833],[-79.66157100617028,43.48032894402215],[-79.66225120791842,43.47946284497265],[-79.66289280766688,43.47866704278467],[-79.66329650685452,43.47813724388535],[-79.66446060762281,43.476664443825506],[-79.66485840841386,43.47616374280235],[-79.66530310754912,43.47561024367485],[-79.66583000792853,43.47494324345143],[-79.66632720792576,43.47431134351381],[-79.66688490823472,43.47360594288823],[-79.66748130920567,43.47284824265462],[-79.66809580929971,43.47207684271263],[-79.66871340810141,43.471290642393406],[-79.66927570914045,43.47058134144552],[-79.66984210926145,43.46985974251101],[-79.67036780934723,43.46919604141231],[-79.67086590906344,43.46856554113868],[-79.67135010906938,43.46794594155046],[-79.67198010903884,43.467162841524015],[-79.67248350909483,43.466521341298275],[-79.67290760858279,43.465984441802014],[-79.67332370887254,43.465447341269794],[-79.67377290940634,43.46487924119155],[-79.67423820888958,43.46430143978555],[-79.67432460977044,43.464192341268316],[-79.67458291003744,43.46386304112157],[-79.67486581024853,43.46350324025261],[-79.67598580963312,43.46208673969243],[-79.67647061068848,43.46147154022661],[-79.67690181010272,43.460928839931604],[-79.67747430985298,43.46020003984685],[-79.6780306109498,43.459513240377525],[-79.67847011116488,43.45899314044243],[-79.67893261022066,43.458456139069256],[-79.67926781080041,43.45808713814356],[-79.6798772113969,43.4574370395941],[-79.68060021062777,43.4567058378879],[-79.68092861165933,43.45638173943771],[-79.6812471110164,43.456067439633806],[-79.6819665108667,43.45538593933822],[-79.68246474294268,43.45489641420063],[-79.6826475105841,43.45471683886904],[-79.68335621213262,43.454048637729315],[-79.68398001109144,43.45344983841742],[-79.68445451145611,43.45300973840648],[-79.68498921184334,43.45249973824961],[-79.6857815120779,43.45174053806215],[-79.68626841176437,43.45126523800769],[-79.68699531310254,43.45056763791386],[-79.6875714133509,43.45002353682784],[-79.68806971283166,43.44954583742401],[-79.68912471368955,43.448526937485575],[-79.68951761290101,43.44815253726887],[-79.68986291426965,43.44782713704917],[-79.69057441307483,43.447147237577624],[-79.69093451434958,43.44680383754329],[-79.69139411317481,43.446361937288046],[-79.69201361346411,43.44576373608927],[-79.6926467140557,43.44516093660734],[-79.69372571388965,43.444123136810425],[-79.69462721421164,43.443234736442875],[-79.70059461484908,43.43753093440989],[-79.70241081625612,43.435804733573505],[-79.70267531584295,43.43557363436456],[-79.70362371627658,43.43465713378345],[-79.70742391790198,43.43098413331206],[-79.7095471182029,43.428953432487226],[-79.71081551852451,43.42772943229527],[-79.71214551854106,43.426454332223464],[-79.7136165181769,43.42505323155487],[-79.71476931814699,43.42395893099946],[-79.71583501876316,43.42293413228654],[-79.71601631883313,43.42275323168342],[-79.71628341943612,43.422472131537525],[-79.7164014195286,43.42235183166577],[-79.71657991879164,43.42217193104169],[-79.71718311905218,43.42160353104631],[-79.71791712031637,43.420891831377325],[-79.71885571961919,43.419997831418705],[-79.71907651996682,43.41978813117437],[-79.72001091945667,43.41890153083312],[-79.72098841970259,43.41796133048262],[-79.72218902070298,43.41680053041656],[-79.72257888796345,43.41642455682362],[-79.72332312053214,43.41570682927797],[-79.72435342101788,43.414747829649826],[-79.72551932092973,43.413624629902294],[-79.72657972156944,43.41259712923611],[-79.72702252171996,43.4121728292491],[-79.72828672272685,43.41096452913911],[-79.72980882257453,43.40949862787789],[-79.73090002141296,43.40845502755587],[-79.73135572325558,43.40800542826045],[-79.73197692294416,43.407415827691025],[-79.73270242328557,43.406723927230445],[-79.73337792375922,43.406080427496455],[-79.734028323412,43.405449827765075],[-79.73420882386048,43.40527702800414],[-79.734790324006,43.40472002819487],[-79.73564252281952,43.403904327495844],[-79.73622382320583,43.40335572651489],[-79.73751132400756,43.40211572698819],[-79.73795232441717,43.40168562655625],[-79.73880622479926,43.40085922675117],[-79.73945072498354,43.40024022561476],[-79.74020442485839,43.3995234259542],[-79.74090712535659,43.39885182658072],[-79.74167692518081,43.3981016262233],[-79.74259352593555,43.39722522599259],[-79.74347972507657,43.396382425374114],[-79.7443954256321,43.395513925815486],[-79.74515342609894,43.39478712513539],[-79.74587342575933,43.39408482463289],[-79.7466437255826,43.39335482423896],[-79.74734692674322,43.39267342471366],[-79.74814302570857,43.391896024259495],[-79.74901542652863,43.39104942469335],[-79.74932832729405,43.390747124314025],[-79.74959422681981,43.390489223355154],[-79.75016162724793,43.3899515240914],[-79.75107422647135,43.389067722511065],[-79.75212102758312,43.38806442347604],[-79.75262432669858,43.387581223783656],[-79.7528381279213,43.38737322352744],[-79.75404292884562,43.38620522259609],[-79.75491492910446,43.38537212218983],[-79.75590172855169,43.38444382275414],[-79.7568791293636,43.383487522234375],[-79.75779362931586,43.38261402286758],[-79.7586923287891,43.38174972191859],[-79.75924862899659,43.38120992158796],[-79.75996922880233,43.38050582176108],[-79.76078252961064,43.37973522222376],[-79.76087077645522,43.37965044919296],[-79.76254632981875,43.3780408213659],[-79.76330723007679,43.37732432107275],[-79.76387793063634,43.376765121627976],[-79.76479853016487,43.37588642108175],[-79.76584723020369,43.37488062054978],[-79.76681913123156,43.37394282065162],[-79.76869373049455,43.37214752014765],[-79.77002993069571,43.3708559196714],[-79.77420893215604,43.3668428184705],[-79.77460683229894,43.366460619324016],[-79.78023083388888,43.36105851677897],[-79.78209863382165,43.35926411662494],[-79.78302683468999,43.35831511670186],[-79.78430733530114,43.35711011601039],[-79.78557363420848,43.35602901657349],[-79.78672523555912,43.355136116183786],[-79.7875845358716,43.35450591591014],[-79.78863983560336,43.353796115606215],[-79.78967933636092,43.353136515377514],[-79.79062483647138,43.35254861543485],[-79.79145833696566,43.35203011542178],[-79.79235563607028,43.35148021618613],[-79.79326663801685,43.35092151504784],[-79.7944197372315,43.35021381458437],[-79.79514413717928,43.34976311445431],[-79.79614873715931,43.34914861453469],[-79.79707693824417,43.348576714533365],[-79.7977833390055,43.3481438148405],[-79.79828245554489,43.3478442897984],[-79.79849753898267,43.347715213981424],[-79.79966673947729,43.34698621441415],[-79.8009017390313,43.346232314279106],[-79.80221263951185,43.3454287134881],[-79.80337454010827,43.34471261358123],[-79.8044348397507,43.34406181416302],[-79.80563944022752,43.34330741322575],[-79.80671584009136,43.34262211294724],[-79.80758414097906,43.34207861290146],[-79.80905437717811,43.341176147714975],[-79.80941104151498,43.34095721275701],[-79.81053094176875,43.34026991145409],[-79.8112892413619,43.33980491222484],[-79.81225004283714,43.339205011712345],[-79.81315234207436,43.33865371120669],[-79.81407254262216,43.33808001179214],[-79.81495254231827,43.337544511455725],[-79.81526669713922,43.337352594293264],[-79.81578574345664,43.337035310902024],[-79.81667374327387,43.33648401110583],[-79.81770624362329,43.33585171039536],[-79.81806884413871,43.33562401167297],[-79.81870904442547,43.335243110226294],[-79.81931324495189,43.33486191140188],[-79.81964294301913,43.33466251131481],[-79.82068094390762,43.33402161103564],[-79.82157854448903,43.33346861034349],[-79.82174304368355,43.33336801018189],[-79.82188874450033,43.33328041005682],[-79.82224274372118,43.33305951051625],[-79.8224367438821,43.332939210286376],[-79.82273214459197,43.33275831031367],[-79.82322974551727,43.33245211040354],[-79.824275145097,43.33181001043886],[-79.82609794526374,43.33070561014384],[-79.82760584626054,43.32977390961874],[-79.82849814644425,43.329227109528595],[-79.8298792462587,43.328379210000854],[-79.83118544613565,43.32757860923869],[-79.83213704648763,43.326986308766685],[-79.83314294783727,43.3263701087562],[-79.83382064716908,43.32595450879468],[-79.83454984787772,43.32550580822983],[-79.83496354807218,43.32525350834242],[-79.8352001486606,43.325109908747585],[-79.83542464852731,43.324971909102096],[-79.83597284797376,43.32463430810992],[-79.8367648495072,43.324152108229534],[-79.83759494818798,43.323640807968694],[-79.83870575010482,43.32295900798784],[-79.83957434901477,43.322423808008146],[-79.84032984918193,43.32195630797899],[-79.84108914996955,43.32148570755015],[-79.84187464901588,43.32100150742998],[-79.84281734976858,43.32042300698226],[-79.84381385102535,43.31980260791147],[-79.84471365099827,43.319242706928705],[-79.84550825081124,43.31875640723158],[-79.84619595102437,43.318330506817716],[-79.84731945078553,43.317639106111336],[-79.84867925103573,43.31680130667103],[-79.84999665236015,43.315988606324495],[-79.85116945228174,43.315266706446735],[-79.8521472528643,43.31466250588376],[-79.85320195224945,43.314014505654654],[-79.85421155227296,43.31338640524755],[-79.85445641982221,43.313236006544834],[-79.85524296950308,43.31275291879794],[-79.85534203425848,43.31269208599848],[-79.85636796319494,43.312064710566325],[-79.85767642655011,43.31126511338093],[-79.85874498346517,43.31060925693762],[-79.85956014751763,43.3101116123272],[-79.86029926603527,43.3096592252933],[-79.8612368574769,43.3090852384941],[-79.86208877583199,43.30856358934624],[-79.86301894189694,43.30799612241763],[-79.86576670709593,43.30632830157078],[-79.86594130767575,43.30622200143857],[-79.86725150784214,43.30542510063838],[-79.8674136084208,43.305326001187105],[-79.86915970795098,43.304255400593924],[-79.88262781108081,43.29594159867439],[-79.88280221131231,43.29584419870107],[-79.88335081217913,43.29550739850139],[-79.8837001123107,43.295285699382234],[-79.88393711241686,43.29513489806445],[-79.8844238115874,43.2948064984836],[-79.8846740112398,43.29461079833575],[-79.88489881226893,43.29445089819265],[-79.88508671104975,43.294290698755034],[-79.88527481253827,43.29411239907473],[-79.88545071163637,43.293933997969845],[-79.88566401213903,43.29372899856254],[-79.88583981288009,43.29355059808014],[-79.88599051219151,43.29339899881217],[-79.88611711209903,43.293220198591406],[-79.8862254242861,43.29311114290028],[-79.88626781236806,43.29306859804656],[-79.88636871203649,43.292943498829665],[-79.88647011318676,43.292791398381816],[-79.88660931316937,43.29259459800449],[-79.88673571154277,43.29242479787228],[-79.88678731300382,43.29229919789789],[-79.88835031349856,43.2897300971967],[-79.88872902326739,43.289084074349084],[-79.8890680472718,43.28854405047528],[-79.8893176888674,43.288135034117936],[-79.88957906605083,43.28770638093242],[-79.88997932476579,43.28705130991654],[-79.89002253885738,43.28698038314691],[-79.89047475806585,43.28625255781369],[-79.89073052118847,43.28578964079244],[-79.89081673094802,43.28562039182224],[-79.89087286235298,43.28547163043096],[-79.89093016222186,43.28531468766458],[-79.89098715293922,43.28515473297703],[-79.89102818266548,43.285030576773394],[-79.89106627925136,43.28487386160633],[-79.89110499662053,43.28470559752691],[-79.89112693673617,43.28456569736098],[-79.89118257780362,43.28419048855476],[-79.89117847429739,43.283973134812115],[-79.89114711267743,43.28370619622618],[-79.89100024312968,43.28286761314448],[-79.89095936819255,43.28261280376833],[-79.89085677036489,43.282059912773846],[-79.89083193758103,43.28184836579794],[-79.89077917061636,43.281480230200785],[-79.89075127509679,43.281298498149795],[-79.8907457682441,43.28126261815149],[-79.89071466150686,43.281083697555545],[-79.89067506098031,43.28082779801103],[-79.89065846227746,43.280679398403635],[-79.89065538774935,43.28053432832845]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak Only",NAME:"Niagara Extension",Shape_Leng:70020.9214091},geometry:{type:"MultiLineString",coordinates:[[[-79.0630646770275,43.1089970354404],[-79.0663437843824,43.108992407017695],[-79.06720248686675,43.1090186064676],[-79.0675279849601,43.10903840685601],[-79.06786488536385,43.10906990722953],[-79.068385987386,43.10912680718876],[-79.06891438574708,43.10918920650061],[-79.06918958557921,43.10923250735652],[-79.06932888700516,43.10925350722962],[-79.06952058729749,43.10929300734306],[-79.06982988768549,43.10936330740831],[-79.07012568597504,43.109435306842535],[-79.07064458581863,43.109588807058174],[-79.07142268585861,43.109857306877856],[-79.07200688785385,43.11008660723319],[-79.07237408869759,43.11025080735423],[-79.07279878647567,43.1104660068697],[-79.07339808897763,43.11079970726466],[-79.0736108867078,43.11093100797217],[-79.07378838761824,43.11104360798253],[-79.07413998741659,43.111291907653744],[-79.07442158865864,43.11150790619902],[-79.07489318987173,43.11190640673148],[-79.07534168767558,43.112344807314585],[-79.07572278911444,43.11275880784685],[-79.07598449007963,43.113109807549606],[-79.07628128865572,43.11354380810609],[-79.07658408958135,43.114068807143504],[-79.07773579077096,43.11625860707051],[-79.07815809072612,43.117059007298735],[-79.0785766911307,43.11786790830718],[-79.0790447901251,43.118745108429145],[-79.0795121887802,43.119624408646274],[-79.07982049024943,43.12020840921977],[-79.08011668973872,43.12077290898005],[-79.0804200925523,43.12135860926827],[-79.08073559134644,43.12194430800546],[-79.08122469166076,43.1228118091013],[-79.0816072931021,43.12350680956],[-79.0819184922137,43.12409280868333],[-79.0822696910919,43.1247577093866],[-79.08261279305282,43.12542140912104],[-79.0829556909735,43.12606900932003],[-79.08334829381577,43.12681680988013],[-79.0836575913545,43.12740990874527],[-79.08397509274764,43.128011510288886],[-79.08442539357675,43.128869608729545],[-79.0847582924712,43.12950600955144],[-79.08517079243113,43.13029111040816],[-79.08541889388727,43.130759610141546],[-79.08572249316589,43.131317609047336],[-79.08599599283322,43.13177411039324],[-79.08618679355156,43.1320573110724],[-79.08652859293437,43.1325336107796],[-79.08676719378462,43.13283691036551],[-79.08711209537613,43.13325151053635],[-79.08747579323406,43.13366480997811],[-79.08780479360435,43.134008610777975],[-79.08828909495524,43.134484111220296],[-79.08871109368407,43.13487871097487],[-79.08911079451464,43.13521981115386],[-79.08971199424317,43.13570051075184],[-79.09001869666368,43.13592821157825],[-79.09035639400619,43.136173709987865],[-79.09120269727019,43.13674940999465],[-79.09194029720014,43.13721221160337],[-79.0927397955723,43.13768691175649],[-79.09376149591644,43.1382724107633],[-79.09461049698336,43.138750011968604],[-79.09533769709046,43.13916761158282],[-79.09578909678267,43.139431911610124],[-79.0964391989709,43.13978101166688],[-79.09721369676396,43.140162211955],[-79.09807339754651,43.14054301133672],[-79.09853659953161,43.140731412365774],[-79.09946209804525,43.141080812062704],[-79.1003778994605,43.14139411136785],[-79.10131980002987,43.14165371091273],[-79.10226160097514,43.14188591150187],[-79.10371770094785,43.14219871223529],[-79.10455129936611,43.142347910025286],[-79.10511600057832,43.142438610695855],[-79.10592439991518,43.14254501070654],[-79.10720530203614,43.142682010455744],[-79.10797690279945,43.142747611417185],[-79.1082518005683,43.142767511456924],[-79.11295850151508,43.14310911088411],[-79.1161009050284,43.14335681120886],[-79.12076040420325,43.14372381160396],[-79.12469910638026,43.14402251129775],[-79.12516080640707,43.14405831123353],[-79.12956870749828,43.1443994112174],[-79.13361820931128,43.14471591117602],[-79.13779931109939,43.14504251031762],[-79.14178742830083,43.14531074431101],[-79.1428771117901,43.145384009931675],[-79.143769612053,43.1454233101863],[-79.14432511435423,43.145432309340286],[-79.14534881219595,43.14542181084293],[-79.14628831396458,43.14537380914945],[-79.14766141400032,43.145242509242344],[-79.14861591374132,43.14509531021747],[-79.14963181418642,43.14491331069953],[-79.15063701464227,43.14470380842213],[-79.15202741429601,43.14434740831935],[-79.1538253175003,43.143845309770384],[-79.15728931786427,43.14292940958703],[-79.1637812206987,43.14121250854344],[-79.16836552165668,43.13999970867773],[-79.16967621935702,43.1396345077906],[-79.17187302238473,43.139056408344665],[-79.17369582089533,43.13857200696108],[-79.17393052344156,43.138513206849616],[-79.17731002400882,43.137667005864664],[-79.1779831229679,43.13750110719491],[-79.17910432515313,43.13727580644505],[-79.17949422469987,43.137198907189656],[-79.18050802523716,43.13704370581266],[-79.18076202321781,43.13701250657021],[-79.18109522533057,43.136976107334654],[-79.18144202395463,43.136942005425965],[-79.18237552431908,43.13684930719604],[-79.18372352564207,43.136789907152924],[-79.18414352460454,43.136783305631404],[-79.18463192544203,43.13679530684439],[-79.18554662623215,43.13684560683808],[-79.18602102468822,43.13688110610297],[-79.18684052546901,43.13696770667977],[-79.18783652661911,43.137087005391855],[-79.18870962758956,43.13720750591825],[-79.18913212633106,43.13727110527248],[-79.18987982582333,43.13737300691643],[-79.19497002846985,43.13816090637587],[-79.19704522904622,43.13848190497384],[-79.20163613058052,43.13918730568784],[-79.2056337331972,43.13980140604255],[-79.2068605322516,43.139966406321086],[-79.20750143233914,43.14005780610103],[-79.20810093459532,43.140150906123836],[-79.2086364324015,43.14023450570188],[-79.20928053313655,43.14033000504885],[-79.20981143283143,43.140411006523976],[-79.21029273526598,43.14048470614817],[-79.21061783468377,43.14053730653677],[-79.21130873569115,43.140636106781685],[-79.2119687331291,43.14073930544106],[-79.21250133641648,43.140825806242134],[-79.21402583458831,43.14106170584614],[-79.21700613567651,43.14152260666303],[-79.21727743522987,43.14156450542077],[-79.21775603649533,43.14164620679682],[-79.21832183568563,43.14173880552514],[-79.21870683614566,43.141800906117965],[-79.21897973763721,43.14184410648861],[-79.21949663657209,43.14192080571327],[-79.22054823862364,43.142085105345465],[-79.2211523367384,43.14217570500488],[-79.22187663711124,43.142297905918625],[-79.22280263731864,43.14244460521638],[-79.22532613864281,43.14283080511758],[-79.22694253866577,43.14308260595067],[-79.2284796388688,43.143322105896075],[-79.23706074231261,43.14464610565191],[-79.24051654305805,43.14517900594342],[-79.24361954631902,43.14565750486644],[-79.24536404498951,43.14592640402348],[-79.24592454694827,43.146012705955314],[-79.25063324626532,43.14673840477033],[-79.25381534944657,43.14722860398934],[-79.25581854593737,43.14753711969337],[-79.25870635084833,43.14798180472219],[-79.26010904984717,43.1482025045029],[-79.26189135175402,43.14848280491548],[-79.26259875001791,43.14860410514422],[-79.26747465160938,43.1493967053215],[-79.27009355281238,43.14980410547293],[-79.27045145359222,43.14985970564722],[-79.27548305619717,43.15064220418819],[-79.27921105575477,43.15123420386451],[-79.28572685885493,43.152268503388854],[-79.28829586088813,43.15264910525226],[-79.29464146149608,43.15361860365925],[-79.29649516216968,43.15390170315432],[-79.29987476293834,43.15444280373513],[-79.30283066578343,43.154895903774936],[-79.30696596511584,43.15552960493539],[-79.31002516712061,43.156016002997305],[-79.31355596777857,43.156544904506745],[-79.31729296889476,43.15710450321771],[-79.31949267006443,43.15745650340885],[-79.32268857140996,43.15794890429731],[-79.3286298730635,43.15886390338455],[-79.3333457743132,43.159589804316454],[-79.33803797552325,43.16031190431219],[-79.33902947537916,43.160457603222376],[-79.34386057771837,43.16116760222329],[-79.34439447765774,43.161246002664264],[-79.34624097864238,43.16153360370971],[-79.34815507818443,43.1618316027237],[-79.34848307868113,43.161880803896494],[-79.34915037908225,43.16198410287508],[-79.34982337956157,43.16208420338346],[-79.3516099806789,43.16234970271822],[-79.35548078189298,43.16295470249446],[-79.36028658225479,43.16368500200347],[-79.36829878568513,43.16490180305551],[-79.37255258670388,43.16554760335059],[-79.37585688768444,43.16604900163811],[-79.37839888970163,43.16643470173248],[-79.38664259194162,43.16768490297665],[-79.39368479423338,43.16875220339535],[-79.39658339616166,43.16919130182714],[-79.40418469717795,43.1703745024602],[-79.40435349872178,43.17040070123134],[-79.40822369897595,43.17100280099728],[-79.40907279815309,43.1711326008262],[-79.4145810008825,43.171974201082385],[-79.41486870063815,43.17201810098378],[-79.41851490248894,43.172575001797796],[-79.42613140563529,43.173737600788044],[-79.42680730538639,43.17384080240751],[-79.43388680827763,43.17492080092313],[-79.43429480722534,43.174983001997724],[-79.44582841102354,43.176767700224886],[-79.45320791367247,43.177908802128165],[-79.45637911549954,43.17839890199003],[-79.46274071672212,43.179348801427444],[-79.46569191768377,43.17978930086828],[-79.46639991781508,43.17989830142374],[-79.47258431989434,43.180850501606244],[-79.47674884611628,43.18149094484746],[-79.47792622259077,43.181672601035594],[-79.48295762354654,43.18243620022061],[-79.48705752577226,43.18305810027978],[-79.48856512474727,43.18328679990853],[-79.49307922683582,43.18397130087754],[-79.4973631281659,43.184629800572736],[-79.50000667993392,43.185047996400414],[-79.50764148325732,43.18618069735769],[-79.51438708464427,43.187221497602145],[-79.52137788755671,43.188632096956184]],[[-79.52381738803146,43.18915659639383],[-79.52137788755671,43.188632096956184]],[[-79.56196180155183,43.196825296384965],[-79.5606093998773,43.19655319572361]],[[-79.56196180155183,43.196825296384965],[-79.5606093998773,43.19655319572361],[-79.56039999999541,43.196515296085245],[-79.55777949976975,43.19597719629425],[-79.55599669902348,43.195627096153025],[-79.55454249860523,43.19532739651906],[-79.55437959879418,43.195297895924874],[-79.54582659537058,43.1935755957207],[-79.53600059319868,43.19160339663626],[-79.52458198826166,43.18930449655856],[-79.52381738803146,43.18915659639383],[-79.52137788755671,43.188632096956184]],[[-79.59228691083415,43.20291779647648],[-79.5875798097016,43.20197649539111],[-79.58736161033602,43.20192799612384],[-79.58481620906855,43.20142249535625],[-79.57497810642751,43.19944399648787],[-79.57308160393565,43.199064596130285],[-79.5621501832529,43.196852833287004],[-79.56196180155183,43.196825296384965]],[[-79.59228691083415,43.20291779647648],[-79.5875798097016,43.20197649539111]],[[-79.86480119314113,43.2664551820593],[-79.74984966478132,43.239419594984206],[-79.74975926512285,43.239394395023254],[-79.74700546255444,43.23876669491279],[-79.7429928616773,43.237841695519485],[-79.73838286045978,43.236746295294076],[-79.72967625696432,43.2346828952407],[-79.72766575690498,43.23419659582652],[-79.72752885698273,43.23416299450332],[-79.72275645514164,43.2330376951578],[-79.72014595531604,43.2324256952286],[-79.71776575292905,43.23186389597572],[-79.7155225533871,43.231335595299704],[-79.71024395021642,43.230100794923636],[-79.70737445091957,43.22941489581577],[-79.69856584713135,43.22732959524988],[-79.6981872465534,43.22724359464025],[-79.69783184734912,43.227161795312455],[-79.69509974558662,43.22650899530079],[-79.68814444355627,43.224863394997826],[-79.68801924284965,43.22483189567718],[-79.68411074207613,43.22389539491798],[-79.67747663996784,43.222324495150126],[-79.66763993667095,43.219996794869814],[-79.65783913327793,43.2176741953358],[-79.65410943214158,43.21679549553483],[-79.65367593319196,43.21667995227503],[-79.64784193152336,43.215269996027935],[-79.64214903470912,43.21392816046964],[-79.64161712774639,43.213814795661904],[-79.63856632720771,43.213084596018035],[-79.63369352525459,43.21193569633422],[-79.63344017542524,43.211862945851756],[-79.62396882186857,43.209613495372814],[-79.61428301953185,43.20732409559475],[-79.61394241878052,43.207235595776766],[-79.60443071493208,43.20534679555298],[-79.59613132693104,43.203687370095494],[-79.595062412345,43.20347359636014],[-79.59228691083415,43.20291779647648]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak & Limited Off-Peak",NAME:"Kitchener Line",Shape_Leng:94631.3308354},geometry:{type:"MultiLineString",coordinates:[[[-80.49329281772661,43.45586655390336],[-80.49369672387094,43.4557300341253],[-80.5429424852427,43.43906979197684],[-80.57727599429676,43.42039768664485],[-80.5855538968108,43.418401986582346],[-80.60219290194583,43.41845198533339],[-80.61226650570364,43.417496085231235],[-80.62027190691138,43.41536178458193],[-80.62834251039763,43.41259688346167],[-80.63812571268748,43.41041318247862],[-80.64360081389673,43.40986808169205],[-80.65323411781524,43.4089081818135],[-80.6622850205798,43.407088580697724],[-80.67520622386796,43.400072179013804],[-80.68875872663683,43.3921414766888],[-80.75876124751221,43.36696116891396],[-80.77251795076923,43.365053368238115],[-80.9369612030947,43.366495961109266],[-80.94492420621523,43.36515816057238],[-80.95293410856019,43.364045359724855],[-80.96549121237126,43.36424185916433],[-80.97656571621089,43.36441895856486],[-80.98627321883166,43.36273875808731],[-80.98935051915751,43.36202675791791],[-80.9983526225497,43.35868825635137],[-81.13423685788939,43.26978043452843],[-81.13726005790399,43.26508333352638],[-81.13635145712867,43.260052433082],[-81.13711435726674,43.25598653168692],[-81.13875995680353,43.252709030958],[-81.13955555692947,43.24564253004921],[-81.13875315681832,43.241894629627446],[-81.13554895344491,43.22658912658773],[-81.13909775187737,43.183994119073894],[-81.14926364512058,43.07396599900251],[-81.15121764473119,43.06898909774894],[-81.17691414896551,43.02436928891777],[-81.18241495057964,43.01607038757684],[-81.20242315517989,42.994495482911],[-81.2064551562674,42.99052908192875],[-81.21996716014596,42.98537177995701],[-81.22890146207722,42.98586027964656],[-81.24179386681382,42.98225767848045],[-81.25035946850842,42.97995907804085]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak Only",NAME:"Kitchener Line",Shape_Leng:61719.8483891},geometry:{type:"MultiLineString",coordinates:[[[-79.82243191457074,43.67513928386025],[-79.91821875799873,43.65568348071216],[-79.91821889541525,43.655683452305254],[-79.91878770450361,43.65556746326715],[-79.91915600555043,43.65549196212165],[-79.91983760589302,43.65534616303547],[-79.92059860515292,43.655163562822125],[-79.92150060468624,43.6549493614789],[-79.9225419048364,43.65473156242922],[-79.92297510489246,43.654642061308074],[-79.9294371073666,43.65330735969373],[-79.9296977076008,43.65325346148709],[-79.93050010813218,43.653120561142046],[-79.93073258692873,43.653054610158705],[-79.9310951085123,43.652944361505924],[-79.93155360928412,43.65279466195289],[-79.93206730795475,43.65262906079149],[-79.93238550882239,43.65252586158106],[-79.93289750867943,43.65236446133685],[-79.93408810991951,43.65197876180843],[-79.9349191102762,43.65168726118524],[-79.93572980980564,43.65142466051141],[-79.9363782106787,43.65122366149329],[-79.9370421093707,43.65099806006341],[-79.93874831126536,43.65042636092208],[-79.93939680970595,43.65021626111748],[-79.94299911217671,43.64904706049829],[-79.94490901283945,43.64842706054595],[-79.94584451258567,43.64811545964648],[-79.94740321311382,43.647616659984976],[-79.9521171149088,43.64608695960607],[-79.96108221610078,43.643176758621614],[-79.96377621793623,43.64229275751747],[-79.96400281802009,43.642218457970586],[-79.9691994188736,43.640513057643275],[-79.97193412024393,43.6396314567271],[-79.97495902095446,43.63865605717742],[-79.97926022188003,43.63724485583949],[-79.98045672163299,43.63686835672551],[-79.98134222229496,43.6365611567508],[-79.98205342347369,43.63628835646189],[-79.98320202375125,43.63581235567122],[-79.98512482459657,43.63500105654355],[-79.98763402530263,43.63396985543427],[-79.98941952466795,43.63321135574072],[-79.99526162767584,43.63078675467467],[-79.99724792761947,43.62986775331692],[-79.9997061284679,43.62888995399964],[-80.00065342736005,43.62857405357617],[-80.00204782831197,43.62820805401963],[-80.00318122976338,43.62800865355738],[-80.0041727290872,43.62789345370405],[-80.0054383303095,43.62781445330379],[-80.00630633001963,43.62779495162283],[-80.00691363025247,43.62780025260127],[-80.00789173034566,43.62787175324752],[-80.00855883152136,43.627950152736695],[-80.00936353116225,43.628073652421],[-80.01028503113905,43.62824215230209],[-80.01100683271625,43.62839455289539],[-80.01171223176816,43.62855465371858],[-80.01221993161262,43.628681653285405],[-80.01453783195211,43.6292618540352],[-80.01697033393566,43.62984105293117],[-80.01992173346935,43.63053265369767],[-80.02342333589279,43.63133845125104],[-80.02370083591269,43.63140235295595],[-80.02579793707574,43.63189035122891],[-80.02719583757683,43.632215552357785],[-80.02928273810748,43.632719552486456],[-80.03054213863258,43.63303635243306],[-80.03116223773662,43.63318775183391],[-80.03136933799132,43.63324145108293],[-80.0315449383079,43.63328435256332],[-80.03323393902396,43.63369845275103],[-80.03418754204796,43.63390427348284],[-80.03469293965917,43.634013352119524],[-80.03531003933057,43.63411215251386],[-80.03627071578953,43.634221185910775],[-80.03750134031895,43.63430175093212],[-80.03821994080184,43.63432585282933],[-80.03970764117449,43.63432035273435],[-80.04119614202925,43.63426985234967],[-80.0422511413455,43.63418865174232],[-80.04306144185738,43.6341034526402],[-80.04381304201684,43.63399870154156],[-80.04515104276712,43.63382345124222],[-80.04662364335906,43.63363085229789],[-80.05024564355975,43.63317335167121],[-80.05057364378811,43.63313195033498],[-80.05158004417724,43.63298724989834],[-80.05456134493208,43.63259775055452],[-80.05651134622627,43.63236175102867],[-80.05948034767924,43.63196304956376],[-80.06245694790745,43.63156944988175],[-80.06625804899679,43.631075650457205],[-80.0693555505617,43.63067304941622],[-80.08363445514725,43.628807748965905],[-80.0850086548194,43.62862814949769],[-80.08604315563436,43.62849284839921],[-80.08730025554941,43.62832854878683],[-80.0890672558469,43.62809744896351],[-80.09680085936596,43.62708824886614],[-80.10347976079414,43.62621604670716],[-80.10578666133306,43.625914746996926],[-80.11365996093465,43.624885646863724],[-80.12642106707663,43.62321624636407],[-80.12652306636416,43.623202846019495],[-80.13205686830212,43.6224392451882],[-80.13250996806558,43.622376745778986],[-80.13555336840602,43.62197914549984],[-80.13844567036263,43.62160114535057],[-80.14039487037651,43.621353344226655],[-80.14234617101826,43.621105345035666],[-80.14399597259809,43.62089554442904],[-80.14599507272644,43.62064034380347],[-80.14743587190135,43.62042604495891],[-80.14840527256742,43.620235144609055],[-80.14942497453758,43.61999064320107],[-80.15025917340571,43.6197267440948],[-80.15119357365421,43.61938244388214],[-80.15207857442363,43.619019844357155],[-80.15250277544371,43.61882494366508],[-80.15290217365823,43.618620743303666],[-80.15366437467624,43.61818524283804],[-80.15408937368845,43.6179272427674],[-80.15442727518091,43.6176956430358],[-80.15514137446597,43.61714264289215],[-80.15547987520647,43.61686604315848],[-80.15578117487814,43.6165891436442],[-80.15633417530749,43.616043943357646],[-80.15667387441934,43.61567724366973],[-80.1584249745777,43.61363724274028],[-80.16176367633338,43.60970894145006],[-80.16787177743329,43.602561039079674],[-80.17579248039678,43.593288237987665],[-80.18353447987901,43.58418653581001],[-80.18479098105472,43.58286293611856],[-80.18550648208551,43.58215663672539],[-80.18620908110216,43.58149533460255],[-80.1866226816322,43.58112913550848],[-80.18753698235406,43.580379335784755],[-80.18759578151496,43.58033223587013],[-80.19007178196532,43.57835103493295],[-80.19377168353311,43.57539003449571],[-80.19482378380224,43.574506035285474],[-80.19704908437711,43.572728035479194],[-80.20157048555879,43.56911493372406],[-80.20576328729256,43.565740533013674],[-80.20689288721141,43.564833033396944],[-80.20800318685998,43.56394623197309],[-80.20917928808267,43.56301783248848],[-80.21027948706337,43.562206031989554],[-80.2110659870541,43.56170723244572],[-80.21228868787033,43.56099533189403],[-80.21343508791036,43.56042693220913],[-80.21373398866352,43.560293932265154],[-80.21479188790794,43.559868931922345],[-80.21557548880838,43.55959523168597],[-80.21666458948165,43.55922943108637],[-80.21745938950123,43.55899853162008],[-80.21859948953512,43.55870413062558],[-80.21983119038107,43.55841213093096],[-80.22228279074182,43.55789303087303],[-80.22336759207593,43.557691630608275],[-80.2268660925692,43.557041729857126],[-80.2278482918829,43.556842429988],[-80.2289850922819,43.556564130121934],[-80.22970109322935,43.556350730912676],[-80.23057079315763,43.55608463077806],[-80.23102789331105,43.55592283017209],[-80.23201099396252,43.55551392993294],[-80.23294359352234,43.55508963021714],[-80.23390149391638,43.554615929587996],[-80.23467089427191,43.554210529380576],[-80.2356846947958,43.55362642857072],[-80.23650459491502,43.5530491300306],[-80.23720019410176,43.55252572957016],[-80.23996519583645,43.550262328839906],[-80.24015019651364,43.550110928071696],[-80.24135929552708,43.549165828123535],[-80.24198659586348,43.548636628289955],[-80.242763096768,43.547927427908135],[-80.24364849685236,43.54711802856414],[-80.24404709713315,43.54675232779027],[-80.24419209755354,43.54661892715144],[-80.2450722965957,43.54579022788462],[-80.24579048710588,43.54513076520429],[-80.24744929763658,43.54360752623843],[-80.24785879711544,43.54326212730739],[-80.24822959766796,43.543005625962735],[-80.24861719710164,43.54276142646732],[-80.24919809736353,43.54240512552255],[-80.24925929805474,43.542369426000754],[-80.25146069856024,43.54117852663272],[-80.25306289995774,43.540390526190855],[-80.25530810001811,43.53928602665693],[-80.25697360041141,43.538394225721596],[-80.25751080052706,43.53812912550889],[-80.25795979987691,43.537915225665785],[-80.25820380037091,43.53779832467187],[-80.25856380122686,43.537641024460726],[-80.2593029005629,43.53734082581706],[-80.26026550095989,43.536946024848596],[-80.26167720072073,43.53638922486588],[-80.26248410076106,43.53609912525817],[-80.26266850161691,43.536030423650864],[-80.2633090021862,43.53582532480328],[-80.26366070130483,43.5357010256311],[-80.26507120111965,43.53523502493727],[-80.2658045030576,43.53501012504541],[-80.27064590348948,43.533466923634386],[-80.27085380402099,43.533396223096396],[-80.27281940437022,43.532728324333746],[-80.27367543333585,43.53247135223471],[-80.27459900457715,43.532148123223735],[-80.27583230639057,43.531697623907775],[-80.28041150645176,43.52997262378292],[-80.28435760731374,43.52849312271614],[-80.28770850879955,43.52715932173841],[-80.2900452092967,43.52629032144969],[-80.29473121093656,43.52447612146559],[-80.29525951091203,43.52427152151878],[-80.30201111293161,43.521656920724325],[-80.31868141742298,43.51519771875803],[-80.3193416177866,43.51494181803886],[-80.32221221826082,43.513815418544695],[-80.32562711978626,43.51248071794928],[-80.32652422047015,43.51213001768598],[-80.33315292154262,43.509556317161405],[-80.33735352335539,43.507925015676086],[-80.33799222278459,43.507676915744504],[-80.34014112329528,43.506878915493765],[-80.34383622499347,43.50545091480154],[-80.34807242600894,43.5038135145967],[-80.35373092688062,43.50162591470882],[-80.35883552866882,43.499639013282156],[-80.36094772871337,43.49881681421614],[-80.36401513077887,43.49762251362745],[-80.37250593203424,43.494348712483635],[-80.37308263181268,43.49412621244239],[-80.37480833295699,43.49346071242821],[-80.37495093333415,43.493405311293955],[-80.3814502342191,43.490865511969794],[-80.3898958366934,43.48759081051436],[-80.3929546379951,43.48640450985939],[-80.39875703945556,43.48415359959221],[-80.4006666407672,43.483493408322495],[-80.40176924079944,43.48313620926086],[-80.40279784063587,43.482830409424956],[-80.40375574156079,43.48257040915208],[-80.4048604422371,43.48229930864474],[-80.40892634199386,43.48138730964533],[-80.41540174473258,43.47993430822568],[-80.41557854475903,43.47989460802689],[-80.42231004680724,43.47838350745494],[-80.42309994803863,43.47820620571388],[-80.42747113055478,43.47722456749251],[-80.42903594953636,43.4768731073021],[-80.42965954874235,43.476723706516644],[-80.43142045027122,43.47625410554347],[-80.43304404996755,43.47576360621292],[-80.4377117259928,43.47420895979023],[-80.44181215119134,43.47291745319286],[-80.44485761147327,43.471920604021754],[-80.44813229497687,43.47074482724453],[-80.45424598882809,43.46877313703392],[-80.45959042629995,43.466924095550226],[-80.46041679778197,43.46664760842763],[-80.46348963183634,43.46561940279405],[-80.46439431143915,43.46531664899129],[-80.4645371054771,43.46527036456804],[-80.46849695826832,43.46402333932053],[-80.47143016532046,43.463006394170094],[-80.47208404769727,43.46278754608995],[-80.47424299062298,43.462069296589945],[-80.47607331510781,43.46145302395392],[-80.48098567647646,43.4598585000433],[-80.48281468277071,43.459240818251075],[-80.48297706257094,43.45918617707875],[-80.4842225938782,43.4587764165433],[-80.48578034794583,43.4582651351496],[-80.48625643487968,43.45810921592794],[-80.48875134743183,43.45731083192356],[-80.48906092658406,43.45721119556969],[-80.4919482371427,43.45627714755686],[-80.49329266942378,43.45586655249124]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"LRT / BRT",NAME:"ION Kitchener-Waterloo LRT (Stage 1)",Shape_Leng:32507.6128408},geometry:{type:"MultiLineString",coordinates:[[[-80.52926356194934,43.497816682802664],[-80.52987698812996,43.49902842143928],[-80.52991755102384,43.499091448375445],[-80.52994399074342,43.49911806624248],[-80.52997547013372,43.49914159888802],[-80.53001131790924,43.49916154646997],[-80.53005077254512,43.49917748377195],[-80.53007657892698,43.499185245522284],[-80.53045028536773,43.49925429881762],[-80.53054646451575,43.499281076503635],[-80.5306159078163,43.499308624406794],[-80.53068049047276,43.499341851939285],[-80.53073933931036,43.499380312404334],[-80.53320193043872,43.501546596448264],[-80.53322939332973,43.50156765755929],[-80.53329454427501,43.50160367163366],[-80.53333988402488,43.50161911082774],[-80.53338805159164,43.501629022715896],[-80.53343778491707,43.50163314775674],[-80.53348778124602,43.50163137800425],[-80.53354434428334,43.50162201999679],[-80.533606789252,43.501602845738354],[-80.53474962774504,43.50116518805168],[-80.5395306773377,43.499446934873],[-80.54147229958437,43.49870814004322],[-80.54247235954382,43.49838299858832],[-80.5432965905477,43.498087906807456],[-80.5433761000092,43.49805464523261],[-80.54342467906312,43.498026700440334],[-80.54346746181871,43.4979941214358],[-80.54350362570221,43.49795753773833],[-80.5435324669301,43.497917655196105],[-80.54355343249799,43.4978752466921],[-80.54356611237398,43.49783112971078],[-80.5435702641309,43.497786160712295],[-80.543565808724,43.49774120546531],[-80.54355282919074,43.497697135458566],[-80.54352066770183,43.49763461907755],[-80.54291556543863,43.496647134510695],[-80.54255199462992,43.49605307764318],[-80.54194452165129,43.49506046758292],[-80.54171635338339,43.49461705121428],[-80.54158989545716,43.494281289635005],[-80.5414994553335,43.49393941991631],[-80.54146791991896,43.493766830107205],[-80.54143245170513,43.4934196365225],[-80.54143733555708,43.49301926156885],[-80.54151233915928,43.49229481381597],[-80.54155793333601,43.49199888896685],[-80.54164064140542,43.49166075352902],[-80.54169413192326,43.49149347227754],[-80.54175563192562,43.491327656379255],[-80.541825063259,43.49116350996825],[-80.54190234027827,43.49100123274465],[-80.54201885510467,43.49079663540862],[-80.54207396759601,43.49069171710652],[-80.54244827035153,43.49007216068971],[-80.5434881688773,43.48835216384386],[-80.54376510551246,43.48787409192396],[-80.54401501903627,43.48737258751144],[-80.54422747815526,43.4868620125892],[-80.5443194674833,43.48660378596098],[-80.54440187008773,43.48634384831294],[-80.54447875077514,43.48606640443433],[-80.54519217920596,43.48310946967264],[-80.54524714151046,43.482783612651424],[-80.54525850388917,43.4826428947255],[-80.54526247993618,43.482501964374585],[-80.54525858052892,43.48235173720948],[-80.54514991898428,43.48093747753713],[-80.54512852357648,43.480754354772024],[-80.54505767358343,43.48039635996315],[-80.54500806098261,43.48021912463942],[-80.54494908640709,43.48004341690024],[-80.54488083603576,43.47986949878876],[-80.54369508483184,43.47745706608633],[-80.54239081769421,43.474665607056714],[-80.54221347140765,43.474370630509455],[-80.54200676296287,43.474085972410116],[-80.54156250807391,43.47359472475696],[-80.54113635360876,43.473152093569645],[-80.54084045535721,43.472844750439094],[-80.54037936965372,43.47239461739122],[-80.54007893447205,43.47215366044479],[-80.53975421134837,43.471930038241915],[-80.5361281023036,43.46983175794898],[-80.53510368523433,43.469216986829146],[-80.53393964942215,43.46854558719792],[-80.53379502764889,43.468461887688015],[-80.53359844903704,43.468342696420606],[-80.53341042083241,43.468220723459574],[-80.53322803955871,43.4680942829862],[-80.53288102076581,43.46782855675322],[-80.5326989414566,43.46767391347585],[-80.53073710071095,43.46592954026059],[-80.53065917793707,43.46586342311351],[-80.53049149881718,43.46573311272824],[-80.53035708431582,43.4656400929078],[-80.53021645612709,43.46555208248125],[-80.5300699640203,43.46546930151387],[-80.52991797729925,43.46539195639349],[-80.52976087244558,43.465320239941995],[-80.52959904176889,43.465254331337846],[-80.52943289343743,43.465194397916186],[-80.529262838954,43.46514058538024],[-80.52903266515827,43.465079027726254],[-80.52825930232892,43.46491131515321],[-80.52592141399859,43.46441264806074],[-80.52566599791726,43.46435808919034],[-80.52532859754804,43.46428601697636],[-80.52526096442033,43.46426856629407],[-80.5251985193857,43.46424577882629],[-80.52514736584435,43.46422041015147],[-80.52510096175138,43.4641905862991],[-80.5250528133368,43.464149829447024],[-80.52500491670152,43.46409632318316],[-80.52263873475198,43.46118814274919],[-80.52259578753643,43.46113782364514],[-80.52249448312975,43.46103541665944],[-80.52241607029822,43.46097010654682],[-80.52232595062829,43.46090608116087],[-80.52223804208175,43.46085181885497],[-80.52147967054064,43.460415133502515],[-80.52026896891334,43.45970270014113],[-80.52021600927029,43.45967429291245],[-80.52017805789622,43.459658314362564],[-80.52013140826871,43.4596447673206],[-80.52008236170045,43.45963690184076],[-80.52003221552717,43.459634927785324],[-80.51998229283754,43.45963889636112],[-80.51993390914556,43.45964870221729],[-80.51988834650618,43.4596640872765],[-80.51983673269015,43.45969080977763],[-80.51979369469713,43.45972266768542],[-80.51942272510183,43.460059734738365],[-80.51936540166237,43.46010168640309],[-80.51932130382335,43.46012484904793],[-80.51927303129837,43.46014306651395],[-80.51922161923636,43.46015594610099],[-80.5191681751982,43.4601632123858],[-80.51911384703067,43.4601647075087],[-80.51905980202666,43.460160401261305],[-80.51900720332678,43.46015038409564],[-80.51894039032474,43.46012818391152],[-80.51887328401725,43.460094770327345],[-80.51768951529895,43.45940370757971],[-80.51667720707022,43.45882896848756],[-80.51660737775698,43.458792254389394],[-80.51649349613062,43.45874210905124],[-80.5163775142795,43.45870068680303],[-80.5137681185338,43.457844535745295],[-80.51262323078849,43.45743491160667],[-80.5114897156223,43.457063158463],[-80.51115758817714,43.4569563595062],[-80.50994068029208,43.45657963849579],[-80.50902236554559,43.45627851260866],[-80.50653310218523,43.455467060862055],[-80.50479246989778,43.45491592071284],[-80.50243076011267,43.45419329862231],[-80.50149618121655,43.45389155974193],[-80.50134811092043,43.453843752865254],[-80.50084567679951,43.45364940290724],[-80.50077894882502,43.453623278330824],[-80.50061022015173,43.453563027467375],[-80.49856655546161,43.452918257116316],[-80.49854126697127,43.452909659097635],[-80.49851652014755,43.45290026330224],[-80.49848605310333,43.45288647426444],[-80.49844712449948,43.45286306258446],[-80.498413948503,43.452835346504365],[-80.49838741084821,43.45280406542793],[-80.49836821716693,43.45277005214744],[-80.49835688161882,43.45273421763994],[-80.49835370531301,43.4526975161486],[-80.49835877480801,43.452660928992756],[-80.49836603127123,43.45263830942597],[-80.49837967823912,43.45260795389499],[-80.49865337334937,43.45211121302234],[-80.49867748766741,43.45206507264161],[-80.4986922691617,43.45202589009413],[-80.49869858345838,43.45198559869027],[-80.49869561636821,43.45194510210219],[-80.49868344947384,43.451905527517134],[-80.49866242343582,43.451867978253475],[-80.49863312255813,43.45183349698944],[-80.4985963608416,43.45180304428173],[-80.49853978866958,43.45177113887913],[-80.49849426143518,43.45175312818572],[-80.49846168429711,43.45174217416554],[-80.49668253148393,43.45117865852098],[-80.4951914148288,43.45069777625123],[-80.4947139963769,43.450535264975],[-80.49105487775707,43.449375144586966],[-80.4909794260118,43.44934871900887],[-80.4908828983335,43.449310620011616],[-80.49081781976541,43.44928159118402],[-80.4907690135455,43.44925795820844],[-80.49013223804336,43.44891157159743],[-80.49000404691397,43.448851386046],[-80.48993579539312,43.44882653482603],[-80.48859597843648,43.44838266877613],[-80.4885592000146,43.44837146019662],[-80.48848758113584,43.44835196527308],[-80.48818139377777,43.44827885792678],[-80.4881174684892,43.448262464845904],[-80.48803800434472,43.44823879227864],[-80.48795968964447,43.44821028396251],[-80.48792200573226,43.448196565251564],[-80.4852368736613,43.447070556509466],[-80.48507000238942,43.4469952384152],[-80.48487486917044,43.44689832830481],[-80.48430134863312,43.446600434639606],[-80.48221432027876,43.44558461118503],[-80.48155887478391,43.44524847180415],[-80.47970646232334,43.44435700755503],[-80.4780391473178,43.44359185828176],[-80.47798400191046,43.44356316562025],[-80.47791601921301,43.44352311286357],[-80.47785209322552,43.44347965606855],[-80.47779254501701,43.44343301663667],[-80.47740508323442,43.443054370906225],[-80.47725885569156,43.44293325817937],[-80.47707397602515,43.442819541824186],[-80.47697293311455,43.442771893681964],[-80.47686699476529,43.44272825518614],[-80.47675678436177,43.44269174455941],[-80.4766310540868,43.442659090354795],[-80.47538749508912,43.44237391640852],[-80.47478783009868,43.442236394122915],[-80.47471717004453,43.442213642683534],[-80.47467646110512,43.44219499178132],[-80.47464614811857,43.442172657005045],[-80.47461523096243,43.44214839292242],[-80.47459198034768,43.442114799920766],[-80.47457691607116,43.442089251199825],[-80.47456484010378,43.4420476127177],[-80.47456077599124,43.44201800322451],[-80.47456889547743,43.441976943347974],[-80.47458695489473,43.44193011602765],[-80.47499763466062,43.441423407299595],[-80.47518980674025,43.44122315946095],[-80.47858350540588,43.43823883953607],[-80.47937110339682,43.437634238184295],[-80.48074585550091,43.43642460958218],[-80.48082805751648,43.436332143713834],[-80.4808698043405,43.43624028857211],[-80.48087648738588,43.43614364828534],[-80.48084762410693,43.43604919875896],[-80.48073878427493,43.43591881659241],[-80.47927807632979,43.43472378261474],[-80.47854536992142,43.434095447610304],[-80.47629061652597,43.432207597485466],[-80.47621654594198,43.43214571893401],[-80.47575133376854,43.4317601376687],[-80.47546204028447,43.4315429147422],[-80.47437921168932,43.43084681124575],[-80.47413088929427,43.43067158577216],[-80.47377877689325,43.43039124130523],[-80.4728777091232,43.42963758608935],[-80.47259779651145,43.429384841950124],[-80.47233371254454,43.42911069344269],[-80.4717785318784,43.42849264447258],[-80.47145142758119,43.42817713670482],[-80.46882975446417,43.42598219296967],[-80.4686220974182,43.425815002129],[-80.46857007863592,43.42578667980664],[-80.46851295562146,43.425764178848986],[-80.46845194390197,43.425747979543345],[-80.468388348271,43.42573842909889],[-80.46832352183837,43.42573572939194],[-80.46825884750878,43.425739937122806],[-80.46819570218709,43.42575096501954],[-80.46815456012851,43.425761967715694],[-80.46661520017734,43.426296501102854],[-80.4665307445131,43.42631135208719],[-80.4664287722418,43.42630798230015],[-80.46637951687094,43.426297824350144],[-80.46633297346214,43.42628229378308],[-80.46629023839552,43.426261755805726],[-80.4662523197464,43.42623669249351],[-80.46622010878201,43.42620769672977],[-80.46618176000453,43.42615411261661],[-80.46601878864966,43.42573799593689],[-80.46596352124543,43.42562087253367],[-80.4659009442948,43.42550572099501],[-80.46583119253665,43.42539277961471],[-80.46567076153087,43.425174477309206],[-80.4655804181385,43.4250695744031],[-80.4654835754105,43.42496780126276],[-80.46534778466587,43.42484005134071],[-80.46466531390193,43.42425988285078],[-80.46397553984464,43.42355805508804],[-80.46366420853741,43.42326146262985],[-80.46260049525235,43.42237073145863],[-80.46233446310387,43.42217414307954],[-80.46206143753588,43.42200881083666],[-80.46176796822603,43.42186327618912],[-80.46161439924634,43.42179835608445],[-80.46145674242685,43.42173887203515],[-80.46129535922964,43.421684957811],[-80.46113061839273,43.42163673902068],[-80.46083705744378,43.42156651956815],[-80.45908319762661,43.42122009070676],[-80.45872396230043,43.421117396770725],[-80.45846517456299,43.421017599984694],[-80.4583410961438,43.420960922235615],[-80.45819599064936,43.42088640734211],[-80.45808572073237,43.42082369861628],[-80.45734677226166,43.42036090321873],[-80.45609537059272,43.41951157748321],[-80.45599190152616,43.419457996945496],[-80.45592026085845,43.41943137305218],[-80.45584492050277,43.41941087686172],[-80.45576686518642,43.419396776487055],[-80.45568711535869,43.419389256029554],[-80.45560670737974,43.41938841214435],[-80.45552669232987,43.41939425675077],[-80.45544811371485,43.419406712717986],[-80.45536720277897,43.41942705286492],[-80.45530144618112,43.41944931872966],[-80.45457024093673,43.41973224492826],[-80.45427110463928,43.41982011610283],[-80.4490074825125,43.42105770383142],[-80.44842139706883,43.42116879493312],[-80.44630105596305,43.421522466351114],[-80.44481219358421,43.4217986172712],[-80.43996992333271,43.42262110387315],[-80.4399193355393,43.42264926910403],[-80.439994324689,43.42265641121031],[-80.44482224808313,43.42183637445013],[-80.44631357993305,43.42155982039312],[-80.44843542498022,43.42120589682578],[-80.44902151076779,43.42109480654985],[-80.45429204802761,43.419855586981015],[-80.45459118321865,43.41976771486114],[-80.45532019916764,43.41948548914592],[-80.45538956735815,43.41946200757732],[-80.45542031267192,43.419454352232904],[-80.45546044000663,43.419444360872],[-80.45553361280729,43.41943273051277],[-80.45560812985654,43.41942726760999],[-80.45568301547155,43.41942804332704],[-80.45575728899169,43.419435047856524],[-80.45582997834539,43.419448189406566],[-80.45590013490813,43.41946729677726],[-80.45596683720554,43.4194921193293],[-80.45606285165833,43.419541892405114],[-80.45731138992134,43.42038943133117],[-80.45806043706924,43.42085859473007],[-80.45817070702455,43.42092130347956],[-80.45831580137431,43.42099581309706],[-80.45843986865808,43.42105248646571],[-80.45869863169509,43.421152276314096],[-80.45905783877261,43.42125496966573],[-80.4607434031248,43.42158819121616],[-80.46103695425342,43.42165841459208],[-80.46120168519903,43.421706633600394],[-80.46152070785853,43.421820031380626],[-80.4618233837257,43.421955152628605],[-80.46224072918018,43.4221958040199],[-80.4625067486345,43.42239238372179],[-80.46359850043683,43.423306552026204],[-80.46386112143657,43.423553545699725],[-80.46438995261961,43.42408875998328],[-80.46531971307871,43.42487623550081],[-80.46543585330869,43.424986431625214],[-80.4655326972369,43.42508820569572],[-80.4656230380917,43.42519310776053],[-80.46578347021247,43.425411410123026],[-80.46585322190442,43.42552435153272],[-80.46591579878485,43.42563950309779],[-80.46597729998437,43.42577102960466],[-80.46614602922342,43.426206029050675],[-80.46615833166356,43.42622745973824],[-80.46618578964686,43.42626232874584],[-80.46621800062447,43.42629132451888],[-80.46625592174962,43.42631638692114],[-80.46629865685797,43.4263369258109],[-80.46634520030034,43.426352456391456],[-80.46639445569586,43.426362613455765],[-80.46644526321549,43.42636715835772],[-80.46649642805757,43.42636598327251],[-80.46655058517986,43.42635834849598],[-80.46658088135092,43.4263511332338],[-80.46813750026362,43.42581039338008],[-80.46818232609706,43.42579827930211],[-80.4682454702498,43.42578725232287],[-80.46831014461641,43.42578304369906],[-80.46837497109914,43.42578574341314],[-80.46843856802703,43.42579529475407],[-80.46849957730672,43.42581149318717],[-80.46855670283092,43.42583399413003],[-80.46860872164801,43.42586231645792],[-80.46864332469241,43.42588635928477],[-80.47140919636406,43.42820034164422],[-80.47173630180613,43.42851584952192],[-80.4722492085948,43.42908695993001],[-80.47255556490843,43.42940804731188],[-80.47283547868992,43.42966079154363],[-80.47374149762959,43.4304185843869],[-80.47409361003582,43.43069892986749],[-80.47434193365855,43.43087415451059],[-80.47521630594565,43.4314292380601],[-80.47554736730591,43.43165904062604],[-80.47652722892808,43.432463744782666],[-80.47685556610391,43.43273853713221],[-80.47737748791695,43.433215018180206],[-80.47828404335043,43.433973877067004],[-80.47836169289084,43.43405230733734],[-80.47840538793062,43.43410875445866],[-80.47844194266858,43.43416783532789],[-80.47847106403263,43.434229070872405],[-80.47849370364074,43.43429755237812],[-80.47850612336678,43.43435601250458],[-80.47851170658467,43.434422626298925],[-80.47850903142348,43.43448795871882],[-80.47849910183673,43.43454984708245],[-80.47844397055789,43.43473127501529],[-80.47814498115858,43.435657556828964],[-80.47811498827296,43.43573103984026],[-80.47806745210275,43.43581594294197],[-80.47802867873426,43.435868636160194],[-80.477939854661,43.43596364021147],[-80.47668554380073,43.43711527662917],[-80.47303008296005,43.44034720505073],[-80.47236728885933,43.441074872347926],[-80.47234406546521,43.441195366595046],[-80.47237646185057,43.44126957501206],[-80.47244161924638,43.44133130040923],[-80.4744639570129,43.442217134946475],[-80.47471165291306,43.44228820781445],[-80.47535771123313,43.44243590176932],[-80.47671255788343,43.44274561536043],[-80.47688976400728,43.4427981715594],[-80.47698969633124,43.44283768640098],[-80.47708474829221,43.44288314701933],[-80.47725758592188,43.44299059853181],[-80.47738620196839,43.44309960609859],[-80.477446561013,43.443159201142564],[-80.47769613646179,43.4434079631747],[-80.47775588086992,43.443461651045396],[-80.47781543032882,43.44350829138564],[-80.47787935505673,43.443551746411366],[-80.47794733777727,43.443591800089635],[-80.47800808849007,43.44362326683179],[-80.47967787972657,43.44438933150539],[-80.48151215535385,43.44527209881265],[-80.48296099511205,43.44602690350184],[-80.48483398873451,43.44693802645385],[-80.4849551095791,43.44699423431261],[-80.48518143875414,43.447092103321445],[-80.48793548541103,43.44824721155135],[-80.48797891476924,43.44826542642579],[-80.48804104077941,43.448296902022506],[-80.48808221170354,43.44832726063786],[-80.48811090585106,43.44835765684701],[-80.48813239900666,43.448391060605154],[-80.48814611560621,43.44842657312897],[-80.4881516867541,43.44846324073842],[-80.48814896297395,43.44850007905047],[-80.48813801709157,43.4485360981586],[-80.48813012802177,43.44855254745977],[-80.48811052750993,43.44858432778684],[-80.4878975707237,43.44887401948196],[-80.48779961537875,43.44901882215135],[-80.48706413922982,43.450146584590414],[-80.48704242281185,43.45019024170655],[-80.48703238101596,43.450231008442714],[-80.48703207580867,43.450266637628154],[-80.4870394910615,43.45030185630649],[-80.48705444066647,43.45033578032492],[-80.48707655005678,43.45036756136221],[-80.48710526511658,43.45039640305514],[-80.48713986735582,43.450421582471705],[-80.48717494479826,43.45044072940055],[-80.48722616321292,43.45046319807535],[-80.48930102563567,43.45129997971692],[-80.48944964063672,43.4513556352164],[-80.48968956067284,43.45144005612299],[-80.49163533152051,43.45223507926067],[-80.49172203382756,43.4522690851748],[-80.49175937299819,43.45228221690559],[-80.49182076950696,43.45230096488383],[-80.49188375702418,43.452316660086964],[-80.49195310400509,43.45233007758954],[-80.4920191969778,43.45233959588329],[-80.4927135093631,43.45241518296053],[-80.49283148916524,43.45242947841886],[-80.49295647539954,43.4524510573163],[-80.49304464708507,43.45247164968247],[-80.49315589088924,43.45250362934062],[-80.49486945887378,43.453042858478746],[-80.49494091139678,43.45306108790393],[-80.49500134901572,43.45307000286552],[-80.49506289879706,43.45307274472153],[-80.49512437736688,43.45306925985791],[-80.49518460335844,43.453059617067424],[-80.49524092000078,43.45304500968488],[-80.49529936278648,43.45302639065783],[-80.49558958292391,43.452930796487635],[-80.49565082973167,43.452909656722106],[-80.49574305909128,43.45287005758347],[-80.4957996778741,43.452838566595084],[-80.49585188843764,43.45280326398794],[-80.4958992080603,43.45276447532956],[-80.49594120148748,43.452722557279856],[-80.49598608094185,43.45266767337578],[-80.49612722492685,43.452481234117066],[-80.49615468245558,43.45245271368024],[-80.49619325780756,43.45242336364333],[-80.4962283803069,43.45240557022596],[-80.49627397201648,43.45238634974077],[-80.49631923086093,43.45237507875023],[-80.49636633492288,43.45236903059378],[-80.49641415730441,43.452368352813814],[-80.49646154914022,43.45237305902229],[-80.49649616189535,43.45237991184481],[-80.49654097305925,43.452392095636235],[-80.49780805608627,43.452797024546236],[-80.4984678543244,43.45304382990335],[-80.50047674416987,43.453677340133325],[-80.50069329741149,43.4537409434177],[-80.50082007148661,43.45377222248559],[-80.50117041272023,43.45384842258691],[-80.50134725490045,43.45389146792537],[-80.50147900628983,43.45392953398347],[-80.5014946385853,43.45393405088885],[-80.50287857712547,43.454376847946016],[-80.50441200598937,43.454839014276594],[-80.50651178109995,43.45550223144226],[-80.50938449585885,43.45643898776748],[-80.51481588923846,43.45823063047188],[-80.51635737314062,43.45873667865309],[-80.51647559673336,43.45878267900303],[-80.51656220011516,43.4588237709471],[-80.51707655798783,43.459111709622],[-80.5176255238564,43.459444812166915],[-80.51884899029749,43.460159371540016],[-80.51889927457194,43.4601906630441],[-80.51934761306376,43.46046965422776],[-80.52114847165123,43.46152433242354],[-80.52130382347036,43.46165137405544],[-80.52137648410734,43.461778748204466],[-80.5220056380149,43.464059487975675],[-80.52202260886811,43.464104257756524],[-80.52202976282231,43.464117811397195],[-80.52205322470633,43.4641506491702],[-80.52208375900038,43.46418024255951],[-80.52212053903541,43.4642057906078],[-80.52216256943707,43.464226601884796],[-80.52220871613018,43.46424211492349],[-80.52225772754271,43.464251909733264],[-80.52230828300961,43.46425571996991],[-80.52235605153514,43.4642540956468],[-80.52364946933623,43.46408519183277],[-80.52379954581804,43.4640727950873],[-80.52390673302115,43.464071031426414],[-80.5240137996349,43.46407515577688],[-80.52412013359078,43.46408514661657],[-80.5242251320968,43.46410094633612],[-80.52474661594135,43.464210832339724],[-80.52639494362762,43.464562443118645],[-80.52762584965429,43.46482499423646],[-80.52886743006954,43.465090799012614],[-80.52902293566854,43.46512756807073],[-80.52911539083024,43.46515145067558],[-80.52929274957127,43.465202886972264],[-80.5294662408115,43.465260901960136],[-80.52963540225521,43.46532534229206],[-80.52979978986039,43.46539603825597],[-80.52995896296443,43.46547280120798],[-80.53011250411535,43.46555542699427],[-80.53040107393525,43.465737382470046],[-80.53056869663116,43.46586241857424],[-80.53063416126244,43.4659156327053],[-80.53274850495131,43.4677917203411],[-80.53291276337787,43.4679307141715],[-80.53308325197823,43.46806566917503],[-80.53325978164996,43.46819643940727],[-80.53344216330017,43.468322879824015],[-80.53363019312398,43.46844485271569],[-80.53386414062834,43.468585818388064],[-80.53943061366664,43.471796456516785],[-80.53980095034578,43.472030959995486],[-80.5401137549929,43.47226341839912],[-80.54040138356973,43.472512525677764],[-80.54172733856383,43.47388104257199],[-80.54208499094176,43.47431156495285],[-80.54236208735398,43.47475025859854],[-80.543457170064,43.47710205503573],[-80.54470368295313,43.4796339789718],[-80.54485525171746,43.4799924579325],[-80.54491374109216,43.48016692884255],[-80.54496299913268,43.48034290453222],[-80.54500295453701,43.48052012552027],[-80.54503354713952,43.480698333121765],[-80.54505935968827,43.48093147404526],[-80.54516670884601,43.482319282157604],[-80.54517817191278,43.48258090723191],[-80.5451741956836,43.482721838480046],[-80.5451628318772,43.48286255730913],[-80.54514409912176,43.48300285651118],[-80.54509717567451,43.483234229984916],[-80.54441470017363,43.48606072267107],[-80.54433987711994,43.48633017324762],[-80.54425747425073,43.486590109954086],[-80.54416548592886,43.48684833742422],[-80.54395302633115,43.48735891223729],[-80.54370311233048,43.48786041562012],[-80.54352912947067,43.4881671108494],[-80.54218294515937,43.49039477853666],[-80.54199611082045,43.490704523862064],[-80.54193945855489,43.490801871466225],[-80.54184371042444,43.490980117430475],[-80.54176452178768,43.49114548515692],[-80.54169348934823,43.4913128056579],[-80.54163070099507,43.49148186571148],[-80.54157623959837,43.49165244763914],[-80.54149255756221,43.49199731244749],[-80.54141700358167,43.492577133131576],[-80.54140823849646,43.492658999984315],[-80.54136683709012,43.49306982890056],[-80.54135968747273,43.49340543957247],[-80.54138690380427,43.49374050406936],[-80.54149178017488,43.49423800844464],[-80.54160383222332,43.49456359462944],[-80.54174889512676,43.49488219717219],[-80.54235229457305,43.49588937120859],[-80.54253995868878,43.496195584333115],[-80.54344768134996,43.49768287896966],[-80.54346330831982,43.497735285441074],[-80.54346858228242,43.49778024402323],[-80.5434636130693,43.49782521057716],[-80.5434509318678,43.497869326659156],[-80.54342996622977,43.497911735145145],[-80.54340112493665,43.497951617662196],[-80.54332217818677,43.49802078029462],[-80.54321181791742,43.4980753247874],[-80.54261612977743,43.498290453564586],[-80.54126531365193,43.49874018315062],[-80.53950658338435,43.49941271682024],[-80.53472549516998,43.50113098105052],[-80.5336199816371,43.50155409036455],[-80.53356509124875,43.50157138973108],[-80.53350097371757,43.501582621743374],[-80.53345097742933,43.50158439150125],[-80.53340124537961,43.501580266454546],[-80.53335307659796,43.50157035368263],[-80.53330773811795,43.50155491448217],[-80.53326332953392,43.501532512286076],[-80.53321512434486,43.50149783930635],[-80.53076879323906,43.49934589238362],[-80.53070994443223,43.49930743283336],[-80.53064536178167,43.49927420441712],[-80.53057591728674,43.499246657442576],[-80.53049497444067,43.499223341262216],[-80.53011630818717,43.49915260540797],[-80.53005104595336,43.49912890638913],[-80.53001519942086,43.499108958808364],[-80.52998372003252,43.499085426173615],[-80.52995118527973,43.499051310044656],[-80.5299167161614,43.498995781404545],[-80.52931308636444,43.497803398074225]]]}},{type:"Feature",properties:{STATUS:"Existing",TECHNOLOGY:"GO Rail - Peak & Limited Off-Peak",NAME:"Lakeshore West Line",Shape_Leng:9260.7946386},geometry:{type:"MultiLineString",coordinates:[[[-79.85445641982221,43.313236006544834],[-79.85524296950308,43.31275291879794],[-79.85534203425848,43.31269208599848],[-79.85636796319494,43.312064710566325],[-79.85767642655011,43.31126511338093],[-79.85874498346517,43.31060925693762],[-79.85956014751763,43.3101116123272],[-79.86029926603527,43.3096592252933],[-79.8612368574769,43.3090852384941],[-79.86208877583199,43.30856358934624],[-79.86301894189694,43.30799612241763],[-79.86410665624248,43.30730070395286],[-79.86499815582117,43.30674810340475],[-79.86544555600871,43.30648030427601],[-79.86625825618381,43.30598760383652],[-79.86717805606273,43.30541570352002],[-79.8683775577117,43.30466790380269],[-79.86967635624003,43.303869102453376],[-79.87083305686646,43.30315710316377],[-79.87201465806456,43.302423103189234],[-79.87313145764283,43.30173840231149],[-79.87435885860295,43.3009716029494],[-79.8754052591477,43.30031750233258],[-79.87630945790379,43.29977730290572],[-79.87732215826348,43.29914900224182],[-79.8783841596415,43.298498301964116],[-79.87928106049546,43.297942801595845],[-79.88027565985291,43.297332601457015],[-79.88092386003635,43.29692450175151],[-79.8818305595155,43.29636330082845],[-79.88254076097509,43.29593100022254],[-79.88355836134403,43.29530360069693],[-79.88421696006704,43.294875301054475],[-79.88442406116408,43.29472560105791],[-79.8848520612438,43.29439560101376],[-79.88516896043987,43.294128700651065],[-79.8855917605605,43.29371760087125],[-79.88602086136082,43.29325160076583],[-79.88614974362832,43.293093899592215],[-79.88629246117527,43.29292590016549],[-79.88657926060918,43.29250760063834],[-79.88685036178909,43.29206649939015],[-79.88714636164862,43.29156760100591],[-79.8875987615546,43.29084900044799],[-79.88788396202322,43.29038659982169],[-79.88826226184078,43.28975879896591],[-79.88844806196495,43.28946940004524],[-79.88872902326739,43.289084074349084],[-79.8890680472718,43.28854405047528],[-79.8893176888674,43.288135034117936],[-79.88957906605083,43.28770638093242],[-79.88997932476579,43.28705130991654],[-79.89002253885738,43.28698038314691],[-79.89047475806585,43.28625255781369],[-79.89073052118847,43.28578964079244],[-79.89081673094802,43.28562039182224],[-79.89087286235298,43.28547163043096],[-79.89093016222186,43.28531468766458],[-79.89098715293922,43.28515473297703],[-79.89102818266548,43.285030576773394],[-79.89106627925136,43.28487386160633],[-79.89110499662053,43.28470559752691],[-79.89112693673617,43.28456569736098],[-79.89118257780362,43.28419048855476],[-79.89117847429739,43.283973134812115],[-79.89114711267743,43.28370619622618],[-79.89100024312968,43.28286761314448],[-79.89095936819255,43.28261280376833],[-79.89085677036489,43.282059912773846],[-79.89083193758103,43.28184836579794],[-79.89077917061636,43.281480230200785],[-79.89075085177502,43.28131340589715],[-79.8907457682441,43.28126261815149],[-79.89071466150686,43.281083697555545],[-79.89067506098031,43.28082779801103],[-79.89065846227746,43.280679398403635],[-79.89065538774935,43.28053432832845],[-79.89066486278608,43.280395297997224],[-79.8906870621223,43.28027749757561],[-79.890711561701,43.280169898385005],[-79.89075036169213,43.280041797940655],[-79.89078946200082,43.27995159820324],[-79.8908303607933,43.27987309752294],[-79.89096039719729,43.27961697387186],[-79.89100845821777,43.27951969220988],[-79.89124576140375,43.2790548984892],[-79.89133386195967,43.278878997237946],[-79.89149186171073,43.27857049761887],[-79.89159656136235,43.27835359762617],[-79.89169326139354,43.27815739787374],[-79.89178906118899,43.27796519797719],[-79.89206966158001,43.277483297168764],[-79.89222766180052,43.2771573975108],[-79.89232756229518,43.27692319712171],[-79.89241216163059,43.27663689638622],[-79.89245646145774,43.276400997082604],[-79.89248036192174,43.276083196969566],[-79.89241456203366,43.27563229671038],[-79.89234396178388,43.27540649741523],[-79.89224976254492,43.27516299655527],[-79.89201186247898,43.2747368967362],[-79.89174696147634,43.274392197122275],[-79.891408962045,43.274046697393196],[-79.8912536618756,43.2738863963386],[-79.89069406100778,43.27332479714008],[-79.89048445996484,43.273074996781276],[-79.89040596094318,43.272956396722066],[-79.89028986087621,43.272741696796],[-79.89012346104914,43.27238469628341],[-79.89008406039083,43.272269495901455],[-79.89004896003829,43.27212449699607],[-79.89001806166749,43.271926195817805],[-79.88999976067859,43.271574796946425],[-79.89003206069565,43.27115189588304],[-79.89007366069814,43.27090019635517],[-79.89017946046972,43.27050499649573],[-79.8902217605312,43.27020819562536],[-79.89024176135253,43.26994299563336],[-79.89022056022444,43.26959589509945],[-79.88975076001418,43.266295595228385],[-79.88953945934671,43.26504189483843],[-79.88950226032928,43.26437519506067],[-79.88951116000139,43.26388909490611],[-79.88956775978019,43.26356059524718],[-79.88965775925602,43.26327819514609],[-79.889894261341,43.26274753920422],[-79.88992945948327,43.26256949453706],[-79.89042325995874,43.261160495423],[-79.8905283603139,43.2608013939459],[-79.89056645985289,43.26051639486348],[-79.89056216053035,43.26029739350687],[-79.89055257107809,43.2602350597241],[-79.89051565935645,43.26003889425898],[-79.89042525901405,43.259692794542495],[-79.89035596082635,43.25952249416787],[-79.89027465952637,43.259376194335395],[-79.89002526039548,43.25900879423462],[-79.88979945899038,43.25875059345819],[-79.8895703600502,43.258552893985666],[-79.88934225920416,43.25837629396669],[-79.8890595592074,43.25819379386508],[-79.88872875808453,43.25803779358921],[-79.88837025867552,43.25789789369598],[-79.8880931587599,43.25781519412582],[-79.88763705809014,43.25769819365331],[-79.88581755849991,43.25725569470157],[-79.88491715756372,43.257036894193774],[-79.88351175825356,43.25669089411249],[-79.88140185643316,43.25617149399178],[-79.88016035598329,43.25588359355604],[-79.87715515446084,43.25518769457269],[-79.87356775337567,43.25435659387018],[-79.87327915430716,43.25428979429002],[-79.87288435454751,43.25420519402305],[-79.87253135346566,43.25413029363954],[-79.87232665418243,43.254079793736715],[-79.8721637533555,43.25403849434005],[-79.87198385334202,43.25398649442738],[-79.87182725383742,43.25393589392124],[-79.87166425587895,43.253877693814836],[-79.87153205328488,43.25382729449707],[-79.87124605306587,43.25371109378733],[-79.87092705208966,43.253573293801296],[-79.87053533488333,43.253424205049],[-79.87047437532298,43.253399550726314],[-79.87032575278789,43.253353794194666],[-79.87014015273432,43.25330399460743],[-79.86986725221114,43.25323469427021],[-79.86872345134572,43.252963168375295]]]}}],Cc={type:bc,name:wc,crs:Tc,features:Sc},Ac="FeatureCollection",Ec="future-lines",Lc={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},Pc=[{type:"Feature",properties:{STATUS:"Advancing",TECHNOLOGY:"LRT / BRT",NAME:"Eglinton Crosstown West Extension - Airport Segment",Shape_Leng:4332.58696645},geometry:{type:"MultiLineString",coordinates:[[[-79.59146106402368,43.66274896210292],[-79.59194350239058,43.66305407884866],[-79.59288370225157,43.66372407983965],[-79.59369260163979,43.66432377942822],[-79.59391140198393,43.66451557956567],[-79.59395850208313,43.66462417983266],[-79.59414510236768,43.66513068109392],[-79.5950031885592,43.66664973543324],[-79.59525557511641,43.66707724639225],[-79.5958159747727,43.66802647020123],[-79.59588166346973,43.66931489478798],[-79.59577622342721,43.66957284614417],[-79.59565880359361,43.66984488009899],[-79.59550171184253,43.670439868916134],[-79.5954570350078,43.670609082638975],[-79.59537172330869,43.67105562161627],[-79.59511745629369,43.671422537731694],[-79.59477695465831,43.67165298003617],[-79.59415960954752,43.67194990307225],[-79.59340840204912,43.67217768140847],[-79.59265833641929,43.67239285561579],[-79.59231865600677,43.67252235441073],[-79.5921736992431,43.67272154204095],[-79.59213037568732,43.67294680816758],[-79.59225943457012,43.67321856663913],[-79.59269809661052,43.67412816835102],[-79.59296209420195,43.67479462534031],[-79.59303130492853,43.6750523183328],[-79.5931001512677,43.67560015210344],[-79.5932164026247,43.67635878238361],[-79.5932224867249,43.676470760158516],[-79.59334901876221,43.67789967675155],[-79.59342883824417,43.67858551289419],[-79.59352414312295,43.67909986294473],[-79.59379331877268,43.68000274535194],[-79.59428288266238,43.680813992962776],[-79.5951189506906,43.68164091257716],[-79.59631738257015,43.68245155916971],[-79.59700580477426,43.682744882439835],[-79.59780660674036,43.683009582093185],[-79.59838791766785,43.6833447393858],[-79.59986387882715,43.68454781482192],[-79.60123757806078,43.685712238836565],[-79.6018711286553,43.68634356494188],[-79.60926810924468,43.68821718225895],[-79.6104294097965,43.68885338362268],[-79.61076480989651,43.689048483656435],[-79.61140640966309,43.68930848199951],[-79.61250313866557,43.68958875788111],[-79.61345566733276,43.689836168578545],[-79.61381651266738,43.68992908311724],[-79.61515294670068,43.69026531312733]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"LRT / BRT",NAME:"Hamilton B-Line LRT",Shape_Leng:13681.7476117},geometry:{type:"MultiLineString",coordinates:[[[-79.76416982396395,43.228109152560314],[-79.7738922671418,43.230018517770986],[-79.78154533196029,43.23183227839174],[-79.78441075754253,43.23229978940989],[-79.78508879821845,43.232422291723864],[-79.78595671634156,43.23264464841734],[-79.78645840019053,43.232777290170645],[-79.7866203086708,43.232837241347234],[-79.78810707025652,43.23323034162522],[-79.78898642461013,43.23346147386703],[-79.78978711146365,43.23367320845677],[-79.79074892676243,43.233925019989684],[-79.79092103519058,43.233970683552116],[-79.79189149373157,43.23422756762337],[-79.79289640874765,43.23448822159783],[-79.79575371050271,43.235146983205084],[-79.79676492995436,43.23538096609767],[-79.7986499729014,43.23581406323949],[-79.799518954165,43.23601739997367],[-79.79976085399868,43.23609534311621],[-79.79994288929284,43.23623618852918],[-79.80023574313215,43.23655627533191],[-79.8003663975112,43.23671211631192],[-79.80061580966935,43.23700353584605],[-79.80076888905108,43.23713451959097],[-79.80096946056102,43.23739054570795],[-79.80110347809178,43.23758202222272],[-79.80133262575468,43.23782269515771],[-79.8013988014033,43.23788548356398],[-79.80155672610746,43.238027224368196],[-79.80175143005727,43.238183810372895],[-79.80180503654763,43.23823487867396],[-79.80214745846581,43.23834361651603],[-79.80223257396504,43.238374574626214],[-79.8027324702217,43.23853191408919],[-79.80373313203056,43.2388442976286],[-79.80381096116788,43.238868333360664],[-79.80405939202439,43.23894222432714],[-79.80436655845955,43.23903349890249],[-79.80455394177397,43.23909145291426],[-79.80475420484821,43.23915092155251],[-79.80495015427168,43.239207752048486],[-79.80511969885697,43.23925688480817],[-79.80543920889681,43.23934553999847],[-79.80627680945332,43.23955082015387],[-79.80662003121256,43.239636512609714],[-79.80693727272917,43.23971492360817],[-79.80719504592226,43.23977987520227],[-79.80755189615275,43.23987053067337],[-79.80785777934688,43.23994683707619],[-79.80810845804248,43.24000925453299],[-79.80847231499091,43.240102423220776],[-79.80877829168762,43.24017874491015],[-79.80901545524945,43.240238534962934],[-79.80939762673827,43.2403224106735],[-79.80991682303127,43.2404492514098],[-79.81039620997647,43.24053497043883],[-79.81092244178053,43.240643085855815],[-79.81143477156782,43.24074663937473],[-79.81191206882063,43.240844731885765],[-79.81289012116484,43.24104409019009],[-79.81388183994268,43.24124890914986],[-79.81479451702448,43.24143735895044],[-79.81510877415066,43.24150410867984],[-79.81580689226351,43.241653215527684],[-79.81686509196363,43.24187722525715],[-79.81772864319935,43.242084819710065],[-79.81874997957247,43.24232958114988],[-79.81969856504095,43.2425576994559],[-79.81990343253278,43.24260637217208],[-79.82077273400125,43.242816333765106],[-79.82182606622182,43.24307097919763],[-79.82282119892234,43.243311586618866],[-79.82363663949863,43.24350903509084],[-79.82383052986093,43.24355429665627],[-79.82410306649072,43.24361824289594],[-79.82417118500402,43.243632655624545],[-79.82475365299375,43.24424077448063],[-79.82784426676079,43.24739387116421],[-79.8294019644083,43.248540060378716],[-79.83249613879386,43.25015732860744],[-79.83330148475922,43.25057824033372],[-79.83523560029451,43.2512076148198],[-79.8384102904209,43.25130876841864],[-79.8393242348523,43.25133787137788],[-79.8434787019416,43.25146060955964],[-79.84635021402778,43.25177787195064],[-79.84897137844149,43.25210949572495],[-79.85707918249742,43.253134871698336],[-79.85927717602574,43.25353787129299],[-79.86417593439165,43.255132681569606],[-79.86907072534949,43.256721794099],[-79.87374855053741,43.25802687952371],[-79.87869068277,43.259406780692444],[-79.88033316484947,43.259865284866805],[-79.8806691022484,43.259961653350565],[-79.88798265974542,43.262211995472],[-79.88904805977118,43.26257349481057],[-79.88947185938542,43.26268869560542],[-79.889894261341,43.26274753920422],[-79.89018955931896,43.262757494913146],[-79.89046155868185,43.26273989516478],[-79.8906891321805,43.26269670179646],[-79.8913115302171,43.26256670780679],[-79.89196416771217,43.26219845718425],[-79.89218402184335,43.262059988904625],[-79.892380107807,43.26191719436893],[-79.89254648502951,43.261800362288035],[-79.89267126631707,43.26167920148106],[-79.89284358300908,43.26148880702853],[-79.89300401804648,43.261346010510344],[-79.89361010063116,43.26081376583014],[-79.8938240124286,43.26067962225621],[-79.89402009972889,43.26061471438161],[-79.89438850311878,43.26051518747712],[-79.89487756100802,43.2604418941729],[-79.89584016193824,43.26035209437002],[-79.89648216076992,43.260277294456266],[-79.89703816107682,43.2601925938332],[-79.89731016251605,43.260141194312425],[-79.89756996088984,43.2600806941602],[-79.89943496259569,43.259627594278214],[-79.90048216188937,43.25940199387666],[-79.90131686341842,43.25928659349821],[-79.90242163353706,43.25910641782202],[-79.90540061902321,43.258696733982035],[-79.91178261885274,43.25791177153049],[-79.9194996691962,43.25770439375457]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"LRT / BRT",NAME:"Eglinton Crosstown LRT",Shape_Leng:18779.4363217},geometry:{type:"MultiLineString",coordinates:[[[-79.26453221184322,43.732266098722796],[-79.26796580548921,43.732175607501134],[-79.26873550618696,43.732065607061585],[-79.26983700624547,43.73175710610964],[-79.2711996014589,43.73143560841211],[-79.2738812052013,43.73084710738593],[-79.27676720800801,43.730219006977464],[-79.27702020882792,43.73023600637057],[-79.27791339961114,43.73006789922865],[-79.28076824985894,43.729443866843255],[-79.28325451041202,43.72888920686349],[-79.28534181144497,43.72840740671965],[-79.2876412109003,43.72793740593103],[-79.2900894121643,43.72737100570927],[-79.29148839207252,43.727071446915836],[-79.29534515300065,43.726199166356636],[-79.29611597065484,43.72602552645157],[-79.29656762018847,43.72592417879048],[-79.29754961511395,43.725724305289525],[-79.29873541498513,43.72547040408322],[-79.29913701313858,43.72531930456667],[-79.29976091756471,43.72514952866073],[-79.30032901358233,43.72502710371795],[-79.30044481599302,43.724975404784935],[-79.30058381528069,43.72487380371188],[-79.30078871399427,43.72484890531206],[-79.30189701630604,43.724720603338326],[-79.30258471489049,43.72466000500911],[-79.30272191650164,43.72465290497647],[-79.30402592643655,43.72463823211097],[-79.30476031550191,43.724679603805654],[-79.30752731739841,43.72508590502515],[-79.31352121785682,43.7259781047631],[-79.31497483056239,43.726176568034674],[-79.31554892710484,43.72621776294535],[-79.31661462124444,43.726233404404596],[-79.31721571304814,43.726204940343045],[-79.31768826971144,43.726153264610005],[-79.31826001911952,43.72607840356162],[-79.31905800038446,43.72599000008359],[-79.32193655869196,43.72524824381596],[-79.32528512625596,43.72438526198789],[-79.3284830000149,43.72356099969601],[-79.3301130202587,43.72320446879724],[-79.3303991876407,43.72314187423815],[-79.33398058372535,43.722029700188045],[-79.33884922150695,43.72051753514985],[-79.34996250052858,43.717064765235875],[-79.35043799969965,43.71691699997994],[-79.35415999882855,43.71580100075529],[-79.36481040282706,43.71357984632262],[-79.36815602804968,43.71288187358475],[-79.37715524568047,43.7110540399738],[-79.39018224283156,43.70840666679447],[-79.39831090446224,43.70675387196697],[-79.39843801831495,43.70672687584333],[-79.39865133851876,43.70668244766723],[-79.40851170339407,43.704613199478985],[-79.41737861925849,43.70275158130826],[-79.42556787174155,43.7010315228527],[-79.43589775090932,43.69886087124817],[-79.43599448729368,43.69883624212788],[-79.43620852543698,43.698791133011014],[-79.44279444211469,43.697314701630674],[-79.45024439588055,43.695643934572615],[-79.46347264151795,43.69267587072929],[-79.46462152259826,43.69217341784832],[-79.4666390004813,43.69178199993175],[-79.47038999999147,43.69121799999001],[-79.47506931366549,43.690163489790955],[-79.47881989243555,43.68931811043602],[-79.48046556780251,43.688940689968604],[-79.4805776685279,43.6888634904996],[-79.48291386879004,43.688291990082995],[-79.48528997090817,43.68774748872026],[-79.48677011798736,43.687456895062326],[-79.48726361240753,43.687386017226224]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"LRT / BRT",NAME:"Eglinton Crosstown West Extension",Shape_Leng:9211.61088041},geometry:{type:"MultiLineString",coordinates:[[[-79.48726361240753,43.687386017226224],[-79.49011097099532,43.68679058901412],[-79.49025419909097,43.68681485262974],[-79.49066053617985,43.6867258699352],[-79.49364701677855,43.68598879680491],[-79.49480457220014,43.68565498868513],[-79.49792307349351,43.68468018677736],[-79.49881677266114,43.684478689006184],[-79.50113602745124,43.68403159441132],[-79.50179549292646,43.683981869910475],[-79.50275456141102,43.68406291570264],[-79.50329367656053,43.68415558701616],[-79.50421748383208,43.68437386990641],[-79.50530477573916,43.68460388725823],[-79.5057301767968,43.684654286649156],[-79.50651827588734,43.684687686975636],[-79.5067571762978,43.684681887958234],[-79.50722387546841,43.684647287183495],[-79.50825767831348,43.68448968795402],[-79.50829637629109,43.684427188162545],[-79.50846299186153,43.68439030568349],[-79.51140920668163,43.683899593390315],[-79.51232037776384,43.68375938710896],[-79.51247177541859,43.68378443213617],[-79.51437544564948,43.68350686918166],[-79.5162505118145,43.68347521149424],[-79.5205363173304,43.68335930952684],[-79.52120123225886,43.68334268242349],[-79.5216696198399,43.68331607492181],[-79.52227786358836,43.68325365901685],[-79.52288379187114,43.68315601640798],[-79.52681957768625,43.68246717603187],[-79.529297609568,43.682031672920644],[-79.52974787633462,43.68193266729976],[-79.53017196336205,43.68182290394697],[-79.53150746961529,43.68142368281781],[-79.53238172626499,43.68116412053357],[-79.53307688489942,43.68100887924633],[-79.53392674952025,43.68086325172509],[-79.53774944810223,43.68029324388317],[-79.53839874473779,43.68017449828299],[-79.53906657396273,43.68002611752888],[-79.54084620261271,43.679620741356246],[-79.54300108202486,43.67912891117114],[-79.54471691334095,43.67865535688044],[-79.54810762683891,43.67786748271014],[-79.54971075985915,43.677503767244936],[-79.55091921241943,43.67724679310544],[-79.55358465983355,43.67662881047922],[-79.55551990690672,43.67614483007158],[-79.5576592375495,43.67561722240783],[-79.5585660561244,43.675397063401256],[-79.559240159341,43.67525849261372],[-79.55990641426783,43.675156166690506],[-79.56254786142102,43.674828694190296],[-79.5633241947185,43.67473351791665],[-79.56422442701327,43.67461053014237],[-79.56481826779957,43.67450849978493],[-79.56550781451455,43.6743614481165],[-79.56747966118076,43.67393227367324],[-79.56827980944591,43.67375406644829],[-79.56948118113988,43.6734442054839],[-79.57190401121366,43.67279676741648],[-79.58055730706401,43.67053539058598],[-79.5846767883079,43.66952542619022],[-79.58573321724238,43.66926151629367],[-79.58645644270736,43.66907991877444],[-79.5870383298173,43.66884194281448],[-79.58751454687602,43.66855104857983],[-79.58781707468344,43.6682791527095],[-79.58803076614146,43.66803272443941],[-79.58818169134864,43.66782103083998],[-79.58830156944227,43.66757131957799],[-79.58868073050576,43.66651752768785],[-79.58880676919404,43.66626449136658],[-79.58894800528553,43.666043409521116],[-79.58929344455285,43.66524213901555],[-79.59111090023808,43.66251388001935],[-79.59146097838803,43.66274890816338],[-79.59146106402368,43.66274896210292]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Scarborough Subway Extension",Shape_Leng:7592.01474042},geometry:{type:"MultiLineString",coordinates:[[[-79.26453221184322,43.732266098722796],[-79.26306389253463,43.73273709983114],[-79.26269946340406,43.73291262659512],[-79.26049902820093,43.733972425126694],[-79.25834394849942,43.734443408685955],[-79.25814220850614,43.734555903272934],[-79.25795343889013,43.734569505094655],[-79.25698813329382,43.73479408343812],[-79.25341640156483,43.73560630778982],[-79.25312518982751,43.73564745206586],[-79.24832407727854,43.73666921838491],[-79.24807599970302,43.73669810857936],[-79.24623421007607,43.73710658107447],[-79.24608714008905,43.7373598368753],[-79.24579689968971,43.738027708824035],[-79.24563501028837,43.738412554078806],[-79.24559379104444,43.73854215011336],[-79.24554582782382,43.73875620125827],[-79.24551871961458,43.738994941445476],[-79.24552020915988,43.73927757132204],[-79.24553699958831,43.73992441011044],[-79.24551299674422,43.740826239866706],[-79.24539522744858,43.741978501258714],[-79.2448525678187,43.744172747176925],[-79.24459102857857,43.746367602890196],[-79.24442702972051,43.75281330309855],[-79.24539872993117,43.755170304053294],[-79.2454178312284,43.755541803329486],[-79.24550833093882,43.75645560424553],[-79.24621703107746,43.7583789043132],[-79.24895613207214,43.765425705428584],[-79.2513974847625,43.77089008465632],[-79.2529367940297,43.774901191347155],[-79.25882218173405,43.78961081667707]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"LRT / BRT",NAME:"Finch West LRT",Shape_Leng:10384.9962655},geometry:{type:"MultiLineString",coordinates:[[[-79.49098663177287,43.7634904944869],[-79.49229119774657,43.76320061314488],[-79.49272357411952,43.76303612502938],[-79.49405567863035,43.762421022342416],[-79.4944766379711,43.76228784570509],[-79.49580735958276,43.76198693498053],[-79.49848739795483,43.76139372189309],[-79.50001346518619,43.76107851478541],[-79.50013862391562,43.76103128906746],[-79.50366101950708,43.76023514013827],[-79.50796107313406,43.75927968546178],[-79.5134310474082,43.758064001806844],[-79.51539083740514,43.7576283687743],[-79.51670702677013,43.75737904800729],[-79.51772124233588,43.75725878331145],[-79.51835699479017,43.75720550390905],[-79.51896784834277,43.757129347670165],[-79.51984804434164,43.75694948125249],[-79.52064126920541,43.756768481540085],[-79.52244345078613,43.75635933636967],[-79.52268060563105,43.756311301479315],[-79.52341483289227,43.75614081748921],[-79.52369562772259,43.75607969730509],[-79.52425961354001,43.75596026543038],[-79.52442108004016,43.75583431691142],[-79.5304864594724,43.75442933925745],[-79.53079527932762,43.75436897273837],[-79.53104501851777,43.754320155583486],[-79.53622320785092,43.753307796148974],[-79.53622589143949,43.75321739804526],[-79.5404916844831,43.75230334270165],[-79.54066929521625,43.752337797447964],[-79.54164966852618,43.75218646093678],[-79.54239457736585,43.7520793103857],[-79.5438529107978,43.75178787459437],[-79.5452621558857,43.75148738892251],[-79.54685414277081,43.75113275886554],[-79.54908354060402,43.750659487723794],[-79.55225226017575,43.74995876139815],[-79.55465054034835,43.74946154736196],[-79.55498739321163,43.7493801562136],[-79.55762369417809,43.74880969588659],[-79.55791502958185,43.74875189320207],[-79.5587530204704,43.74856882831155],[-79.5596565158237,43.748374498594266],[-79.56233222637016,43.74778918661513],[-79.56261342087517,43.74773071858655],[-79.56356939797226,43.7475230919713],[-79.56441387557953,43.74730985308402],[-79.56537946378816,43.74706344758897],[-79.56658080690114,43.7467180500451],[-79.56799807437237,43.74637534517991],[-79.56857395717198,43.74623858056697],[-79.57130031525699,43.7455885352556],[-79.5734075287142,43.74506416605832],[-79.57866667169479,43.74384649812977],[-79.57959917418685,43.743645802315726],[-79.58130871979068,43.74338118109931],[-79.58209437666036,43.74328009752397],[-79.58255775863971,43.743219071262146],[-79.58362715272234,43.74323653389166],[-79.58481436926479,43.743421495478096],[-79.58545146716429,43.74345250359445],[-79.5860730051035,43.74340554775052],[-79.58694700408027,43.743215841804776],[-79.58734646338432,43.743129134564754],[-79.58788135844479,43.742944473254624],[-79.58802875899438,43.74287136086294],[-79.5884477042148,43.74252390552174],[-79.58872976114772,43.74207955245396],[-79.58930599994633,43.74110750046925],[-79.58972099952469,43.73984700016146],[-79.5898469998748,43.7391474999721],[-79.59000200017564,43.73791400073935],[-79.59011920809071,43.73745409254019],[-79.5903095002023,43.737270000514066],[-79.59068857264326,43.737056497352626],[-79.5916963853988,43.73677116093309],[-79.59494660941498,43.736018892288065],[-79.59818020960168,43.735275291001614],[-79.6009673105733,43.73467469172267],[-79.6011201427973,43.734586550697706],[-79.60157839986557,43.734479403283345],[-79.60322971156586,43.73409809083704],[-79.60273104687288,43.73298002378004],[-79.60203972505953,43.73143527987458],[-79.60184337437985,43.73100952108212],[-79.60155991290507,43.73038259062893]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"LRT / BRT",NAME:"Hazel McCallion Line",Shape_Leng:17550.2942603},geometry:{type:"MultiLineString",coordinates:[[[-79.64370587076343,43.598366804427314],[-79.64411750436858,43.59782834105256],[-79.64442423381045,43.59736120565091],[-79.64451973227841,43.59688306049602],[-79.64475072905178,43.596619485851505],[-79.64559961129187,43.59573259617779],[-79.64633800003892,43.59504532446776],[-79.64709916567132,43.59433476065713]],[[-79.73305113690523,43.665987747774444],[-79.72735509434675,43.66176257049668],[-79.72326491071536,43.65873697413032],[-79.71677553069075,43.6539357177601],[-79.71672249035329,43.65389646890977],[-79.71648384577736,43.6537005601528],[-79.7125926864068,43.65077353665681],[-79.70668508875282,43.64650008458944],[-79.70616328536511,43.64610957361126],[-79.69881972149224,43.64061297006019],[-79.69425225407977,43.637172454824416],[-79.68444787574423,43.62978521455694],[-79.68397984751853,43.62943250563026],[-79.67957653485504,43.62629013666513],[-79.67844455294116,43.62548223244994],[-79.67673266749544,43.624251668331745],[-79.67028691390743,43.61948335670244],[-79.66355380036502,43.61450127199245],[-79.65552237824589,43.608556925568315],[-79.65291963248409,43.60677897923221],[-79.65194888925272,43.60611581948806],[-79.64727725422968,43.602724822654196],[-79.64620245412122,43.60195772251418],[-79.64557754936465,43.60118794101873],[-79.64536265609661,43.6006479210485],[-79.64530775062579,43.60016184015198],[-79.64526296887342,43.59979710825958],[-79.64523869755892,43.5996676002523],[-79.6451458430187,43.59947514133404],[-79.64508876958246,43.59938099928809],[-79.64506005510168,43.599333633232085],[-79.64500387781106,43.59925460072548],[-79.64492191287164,43.599172956259096],[-79.64485200354562,43.59910993304502],[-79.64477086202025,43.599041445733725],[-79.6446896194948,43.59899327564817],[-79.64399201709949,43.59853118699889],[-79.6431834584769,43.59811871851358],[-79.6426675856261,43.598034361914536],[-79.6421702006408,43.59802971299022],[-79.64162914072877,43.59796319328101],[-79.64113845946513,43.59786098830974],[-79.64054002199892,43.59766377297736],[-79.63845952913196,43.596149774105136],[-79.6311993106808,43.59086566935535],[-79.62899572762399,43.589294342404976],[-79.62623755483432,43.5873273743421],[-79.62248681670845,43.58461774801749],[-79.62230583004437,43.58448881665244],[-79.61654499190593,43.58038447551929],[-79.61638064012344,43.58026844293155],[-79.61011545455102,43.57584470925567],[-79.60757178285515,43.57411032571883],[-79.6067976246895,43.57358244121778],[-79.60327889716059,43.571089428891874],[-79.60185347170632,43.56985446574948],[-79.6003589562993,43.568429493138254],[-79.5998690242583,43.568097295424586],[-79.59928566500615,43.5677017414439],[-79.59781944451906,43.56682503836488],[-79.59070255777276,43.56171132903039],[-79.58522649333747,43.55777571108874]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line",Shape_Leng:15297.9716676},geometry:{type:"MultiLineString",coordinates:[[[-79.3516780461173,43.69644462111053],[-79.34146594055868,43.670037519772976]],[[-79.41819735968056,43.63637787891902],[-79.4161167855717,43.63694715978921],[-79.41610556244055,43.63695023092697],[-79.4160943380689,43.636953302062714],[-79.41608311493673,43.63695637229814],[-79.4160718905653,43.6369594416314],[-79.4160606661927,43.63696251096356],[-79.41604944058086,43.636965579393575],[-79.41603821496913,43.63696864692234],[-79.41602698935878,43.636971712649725],[-79.41601576250915,43.636974777474975],[-79.4160045344215,43.63697784049792],[-79.41599330633524,43.63698090171949],[-79.41598207577032,43.63698396203799],[-79.41597084520927,43.636987018754816],[-79.41595961340899,43.63699007456952],[-79.41594838161133,43.636993127682686],[-79.41593714733754,43.636996178092524],[-79.4159259105876,43.636999225798995],[-79.41591467384032,43.63700227080396],[-79.41590343585752,43.63700531220637],[-79.41589219539863,43.63700835090543],[-79.41588095246485,43.63701138600101],[-79.41586970953497,43.63701441749494],[-79.41585846289084,43.63701744538443],[-79.41584721501124,43.6370204696714],[-79.4158359658974,43.63702348945563],[-79.41582471307059,43.63702650473535],[-79.41581345900829,43.63702951641249],[-79.41580220247367,43.63703252268586],[-79.41579094346544,43.63703552445563],[-79.41577968198362,43.63703852172174],[-79.41576841803072,43.637041512683965],[-79.41546270207438,43.637120441588216],[-79.41539212428454,43.637138045589225],[-79.4153807713123,43.63714085551951],[-79.41536941586652,43.63714366094615],[-79.41535805918792,43.637146460969916],[-79.41534670003709,43.63714925558988],[-79.41533533841148,43.637152046606346],[-79.41532397431367,43.637154832219004],[-79.41531260898046,43.63715761422907],[-79.41530124117375,43.637160391735485],[-79.4152898721317,43.63716316563931],[-79.41527850061487,43.637165935939585],[-79.41526712786269,43.63716870263729],[-79.41525575387642,43.63717146483223],[-79.41524437741285,43.637174225223944],[-79.4152329997152,43.63717698111289],[-79.41522162077966,43.63717973519952],[-79.41521024184814,43.63718248568448],[-79.41519886043936,43.63718523436618],[-79.41518747779395,43.637187980345416],[-79.41517609515131,43.63719072362311],[-79.4151647100314,43.63719346509754],[-79.41515332491299,43.63719620477057],[-79.41514193979609,43.63719894264218],[-79.41513055344002,43.637201679611586],[-79.41511916584606,43.63720441477869],[-79.41510777825364,43.637207148144384],[-79.41509638942205,43.63720988060787],[-79.41508500058944,43.6372126130702],[-79.41507361175833,43.63721534373115],[-79.41506222292493,43.637218075291074],[-79.41505083409302,43.6372208050496],[-79.41503944401946,43.63722353570619],[-79.41420023691451,43.63742469924869],[-79.41418884676402,43.6374274298204],[-79.41417745785188,43.63743016039187],[-79.41416606893871,43.63743289096222],[-79.41415468002451,43.63743562153143],[-79.41414329110671,43.637438353899796],[-79.4141319021879,43.637441086267025],[-79.41412051450486,43.63744382043429],[-79.41410912682082,43.63744655460045],[-79.41409774037126,43.6374492914668],[-79.41408635515879,43.63745202923309],[-79.4140749699427,43.63745476879851],[-79.41406358472304,43.637457510163074],[-79.41405220197855,43.63746025332865],[-79.41404081922914,43.63746299919348],[-79.41402943771428,43.63746574775853],[-79.41401805867459,43.63746849812458],[-79.41400667962871,43.637471252090066],[-79.41399530181732,43.63747400875574],[-79.41398392647984,43.63747676812255],[-79.41397255113618,43.63747953108877],[-79.4139611782664,43.63748229675617],[-79.41394980662855,43.63748506692404],[-79.41393843746329,43.63748784069319],[-79.41392706953124,43.63749061806268],[-79.41391570407049,43.637493399933604],[-79.41390433984294,43.637496185404885],[-79.41389297808541,43.63749897627768],[-79.41388161880046,43.6375017707518],[-79.41387026198552,43.63750457062748],[-79.41385890640123,43.63750737590377],[-79.4138475545276,43.63751018568243],[-79.41345802418958,43.63761022627821],[-79.4134467637242,43.637613223315],[-79.41343550448802,43.63761622665255],[-79.41342424896243,43.637619234492455],[-79.41341299466868,43.637622246832905],[-79.4134017440855,43.63762526367577],[-79.41339049473282,43.63762828591927],[-79.41337924785262,43.6376313117641],[-79.41336800220556,43.63763434120928],[-79.41335675902964,43.63763737515595],[-79.41334551832621,43.637640412703895],[-79.41333427885588,43.637643453852256],[-79.4133230418593,43.63764649770179],[-79.41331180609454,43.637649546051854],[-79.41330057156541,43.637652596202],[-79.41328933950876,43.637655649953494],[-79.41327810744711,43.63765870640428],[-79.41326687785921,43.63766176555627],[-79.41325564950698,43.63766482650835],[-79.41324442114974,43.63766789015975],[-79.41323319526754,43.63767095561218],[-79.41322196938161,43.6376740228638],[-79.41321074473133,43.63767709191554],[-79.41319952007733,43.637680162766415],[-79.41318829789968,43.63768323451822],[-79.4131770744789,43.63768630806826],[-79.41316585229508,43.637689382518275],[-79.4131546313495,43.637692456968125],[-79.4131434091608,43.63769553321619],[-79.41313218821033,43.63769860946412],[-79.41312096725873,43.63770168571091],[-79.4131097475441,43.63770476285771],[-79.40910353491157,43.6388031782563],[-79.40908483305205,43.638808305873575],[-79.40906613118666,43.63881343528803],[-79.4090474317942,43.638818566501676],[-79.40849979668367,43.63898421216398],[-79.40842367817922,43.63900345197403],[-79.40798384037976,43.63916470417327],[-79.40763712599502,43.63931617073973],[-79.40729077950454,43.63948840993259],[-79.40712836668614,43.639573054898406],[-79.40576346687281,43.640286995758146],[-79.40545662220218,43.64044956473486],[-79.4050880711937,43.64066311678026],[-79.40474772303992,43.6408913723781],[-79.40443113010191,43.64113699876906],[-79.40413997022839,43.64139869505592],[-79.40387578391342,43.64167507741437],[-79.40363997181315,43.64196467998571],[-79.40335592529927,43.64239034117932],[-79.40101964576559,43.64626584968133],[-79.40100761272677,43.646285797096915],[-79.4008092861541,43.64660306204664],[-79.40055142096546,43.64694845903802],[-79.40033824725234,43.647175564223694],[-79.40004768630052,43.647428993374305],[-79.39983438279165,43.64758508300583],[-79.3995475262114,43.6477643815597],[-79.39924023973455,43.64792484042647],[-79.39891486219179,43.64806524002579],[-79.39850424496919,43.64820568276629],[-79.39825164590575,43.64827467332082],[-79.3979664139494,43.64834190143185],[-79.39762116303929,43.64841563799079],[-79.39358345180786,43.64926087475321],[-79.39302958741987,43.64937849712692],[-79.36995736761402,43.65433113492378],[-79.36849808505445,43.654661829816106],[-79.3682315118579,43.65472415698486],[-79.36788380077635,43.65478860772207],[-79.3674278154158,43.654782152434116],[-79.36696145757935,43.65469128925376],[-79.36673000038567,43.65458679746592],[-79.36647717989273,43.654514611324664],[-79.36620416858015,43.65439263790097],[-79.36590830165972,43.65427555175579],[-79.36562183366868,43.65412038665444],[-79.36537434858295,43.65393885226705],[-79.36515911708973,43.6537143541075],[-79.36500305983861,43.65351327404797],[-79.3648560291797,43.653206410589256],[-79.36470696683571,43.65283882676195],[-79.36458895976159,43.65254782255737],[-79.36425240586455,43.65188744737916],[-79.36409960120342,43.65145408979534],[-79.3639108231621,43.65104506574022],[-79.36368182671788,43.65072491513944],[-79.36341786519294,43.65042469901423],[-79.36311308900893,43.65018150383397],[-79.36249414891608,43.64991186242594],[-79.36173717411073,43.64969254483384],[-79.36082394862744,43.649558597255925],[-79.36016906700874,43.649473367104996],[-79.35964335747202,43.64941249653538],[-79.3592907301522,43.64936660075622],[-79.35860876354934,43.649391099047534],[-79.35804047157497,43.64946059368163],[-79.3576527964789,43.64951937117972],[-79.35725231593342,43.649640111156394],[-79.35693006314902,43.64974915137216],[-79.35661417181163,43.64985683044942],[-79.35638923433508,43.649950089349346],[-79.35612821338842,43.65004920189109],[-79.35590679730625,43.65015862801568],[-79.35567282291791,43.650285580608575],[-79.35240587832448,43.65201792565818],[-79.35086369081628,43.65287355913846],[-79.35040302935442,43.653117878764974],[-79.35018180604231,43.65323379567138],[-79.3494765727967,43.65360151170401],[-79.34946522316912,43.653607459257465],[-79.34912849411157,43.65378955744879],[-79.34898376922627,43.653875885585876],[-79.34884363848107,43.65396611990053],[-79.3487082980692,43.65406013194981],[-79.34857794543909,43.654157788791984],[-79.3483993890821,43.65428794757147],[-79.3482637151058,43.6543829037888],[-79.34795875727617,43.65460198583585],[-79.34772161104337,43.6548064717019],[-79.3474283690585,43.65510562416489],[-79.34737426608498,43.6551776554882],[-79.34721769457563,43.6553705343752],[-79.34708791821673,43.65551359849205],[-79.34708063120226,43.65552227505039],[-79.34688388202794,43.65576834271807],[-79.34658607427787,43.65620365840984],[-79.34641146815446,43.656482852018904],[-79.34620285456224,43.65693973667819],[-79.34594357918525,43.65780510052634],[-79.34559184294895,43.66067958969451],[-79.34559083624885,43.660688270132006],[-79.34558982954847,43.660696950569516],[-79.34552994228413,43.66115171480831],[-79.34549579077463,43.66135443743414],[-79.34545266334639,43.661591541141824],[-79.34540471214588,43.661772208878915],[-79.3453556081609,43.661984039480394],[-79.3453220932756,43.66219627190417],[-79.34526373394381,43.662396062333045],[-79.3452005790058,43.66259508201723],[-79.34504404785271,43.66312504806259],[-79.34504073929581,43.66313342112594],[-79.34490447201993,43.6634663714531],[-79.34476725630546,43.663780888266054],[-79.34462249998538,43.66409361778325],[-79.34447024535721,43.6644044655198],[-79.34431053968382,43.664713336096256],[-79.34408946884543,43.66510579019196],[-79.34390850410875,43.6653791605006],[-79.34390304676351,43.66538691940272],[-79.34267037092695,43.667186530104736],[-79.34266483769346,43.667194260036524],[-79.3426593044609,43.66720198906793],[-79.34265376750926,43.667209717193785],[-79.34264822683858,43.66721744441414],[-79.34264267997352,43.66722516892524],[-79.34263712815178,43.66723289162898],[-79.34263156641802,43.66724061071828],[-79.34262599725226,43.66724832619654],[-79.34262041693448,43.6672560380586],[-79.34261482422708,43.667263745402664],[-79.34260921789237,43.66727144732689],[-79.34260359793034,43.66727914383126],[-79.34259796186336,43.66728683401224],[-79.34259230845144,43.667294517868086],[-79.3425866364569,43.667302194497026],[-79.3425809446421,43.66730986299717],[-79.34257523176704,43.667317523366805],[-79.34256949659171,43.66732517560424],[-79.34256373788082,43.667332817907486],[-79.34255795439435,43.66734045027484],[-79.34255214365464,43.667348071802756],[-79.34254630690171,43.66735568249291],[-79.34254044041789,43.66736328144012],[-79.34253454296316,43.66737086864258],[-79.34252861578226,43.66737844230178],[-79.34252265515278,43.667386003312735],[-79.34251666108179,43.66739354897504],[-79.34251063232458,43.66740108108721],[-79.34250456764585,43.667408597847285],[-79.34249846457028,43.66741609745161],[-79.34249232309317,43.6674235817004],[-79.34246414060424,43.66745710794101],[-79.34243515550871,43.667490271214575],[-79.34240537774707,43.667523063432945],[-79.34237481726915,43.66755547290756],[-79.34234348154025,43.667587489746566],[-79.34231138050338,43.667619104961766],[-79.3422785241039,43.667650308664726],[-79.34227688328706,43.66765183752774],[-79.34226948726324,43.66765869714099],[-79.34226205532939,43.667665536901254],[-79.34225458996791,43.66767235591186],[-79.34207226243178,43.66787670088216],[-79.34185933900531,43.66807949820913],[-79.3415312959549,43.668372085923316],[-79.34150885150142,43.668396119870366],[-79.34128936421585,43.66867482515347],[-79.34124983431323,43.66876240723492],[-79.34121368762392,43.66884367956639],[-79.3411756332193,43.66892323808154],[-79.34115173565958,43.6690222915374],[-79.34113613562933,43.66912256719721],[-79.3411509781913,43.66921124103762],[-79.34116829744114,43.66929886966085],[-79.3411709379881,43.66931326105772],[-79.34117378568001,43.66932763113911],[-79.3411768330744,43.669341980794755],[-79.34118007149824,43.669356307312235],[-79.3411834947491,43.66937061158307],[-79.34118709538922,43.66938489269673],[-79.34119086721851,43.669399150644615],[-79.34119480155915,43.669413384514485],[-79.34119889220634,43.66942759609799],[-79.34120313296232,43.6694417844864],[-79.3412075151445,43.66945595056773],[-79.34121203255516,43.66947009343324],[-79.3412166789894,43.669484214874565],[-79.34122144576702,43.66949831487961],[-79.34122632792793,43.66951239344151],[-79.34123131678471,43.669526453248565],[-79.34123640737972,43.66954049339371],[-79.34124159102791,43.66955451566518],[-79.3412468627668,43.6695685209562],[-79.34125221391375,43.66958251015482],[-79.3412576382662,43.66959648415253],[-79.34126312962164,43.669610443840845],[-79.3412686817727,43.6696243919116],[-79.34147322447885,43.670055495629285]],[[-79.35167859328752,43.696443588472555],[-79.35176035034301,43.69664501464569],[-79.35178889658283,43.69672062827871],[-79.35181250395411,43.696783675103575],[-79.35184498513716,43.69687205224746],[-79.35187643746633,43.696960624275626],[-79.35189805167023,43.69702404655148],[-79.35193636967722,43.69714390152961],[-79.35196788348593,43.69725146902491],[-79.351996804805,43.69735941930804],[-79.35202312625921,43.697467719066715],[-79.35203948038739,43.69754129605357],[-79.35205797899782,43.69763177032784],[-79.35207742679637,43.69773534539847],[-79.3520956523526,43.697839036799316],[-79.3521088859989,43.69791684573918],[-79.35259958576106,43.700824151694086],[-79.35261314983933,43.700904856673354],[-79.3526231181633,43.700965403144615],[-79.35263586079053,43.70104617817024],[-79.35264482026747,43.701106807949564],[-79.35265569410576,43.701187726382635],[-79.35266285802153,43.7012484807626],[-79.35266900939277,43.70130929414497],[-79.35267769636383,43.70143108007009],[-79.35268034169623,43.701511079661664],[-79.35268063472992,43.70157077833275],[-79.35267949227752,43.701630470652525],[-79.35267691437441,43.70169014041869],[-79.35267290230554,43.70174976782995],[-79.35266745487004,43.70180933488209],[-79.35266057582766,43.701868824477295],[-79.3526522676997,43.70192821861602],[-79.35264253177118,43.701987497496795],[-79.35263137056127,43.70204664402004],[-79.3526187890706,43.702105641089396],[-79.35260478982504,43.70216446890482],[-79.35258937782312,43.70222311126994],[-79.35257255683153,43.70228154838623],[-79.3525543330875,43.70233976495896],[-79.35253471159851,43.702397741191085],[-79.35251369860636,43.70245545998753],[-79.35249130035285,43.70251290425319],[-79.3524675243206,43.70257005689444],[-79.35244237551535,43.7026268990142],[-79.35241586390137,43.70268341352208],[-79.35238799695935,43.70273958422443],[-79.3523587834131,43.7027953940291],[-79.35232823074796,43.70285082494222],[-79.35229635016942,43.702905859874775],[-79.35226314915643,43.70296048353313],[-79.35222864015543,43.703014678829845],[-79.35219283313158,43.70306842867416],[-79.35215573805007,43.70312171597535],[-79.35211736611046,43.70317452634463],[-79.35207772975967,43.70322684269439],[-79.3520368414427,43.70327864883715],[-79.35199471235941,43.703329930384015],[-79.35193985936218,43.70339380982519],[-79.35189408886644,43.70344495069791],[-79.35184726985277,43.70349559062198],[-79.35179953124418,43.703545775669774],[-79.3517509994626,43.7035955600118],[-79.35170179968944,43.703644997817065],[-79.35165205213673,43.70369414594881],[-79.35160187824641,43.70374306577269],[-79.35155139326123,43.70379181684622],[-79.35146688136443,43.70387286617518],[-79.35001660553095,43.70526135452935],[-79.34996587884224,43.70530997315355],[-79.34991536519208,43.70535870995121],[-79.34986528267335,43.70540767952526],[-79.34981585062243,43.70545699558052],[-79.3497672921141,43.70550676552614],[-79.3497198364365,43.705557093179344],[-79.34967372159076,43.70560807156759],[-79.34964384420769,43.70564246124511],[-79.34960051040343,43.70569470794012],[-79.34955919068919,43.70574780518898],[-79.34953289530246,43.70578370186352],[-79.34946464591228,43.70588709154734],[-79.34940537992716,43.70599335722935],[-79.34935532424163,43.70610208786417],[-79.34931467475809,43.7062128633626],[-79.34928358645294,43.706325257278515],[-79.34926218082475,43.70643883501836],[-79.34925053968037,43.70655315743337],[-79.34924870884731,43.70666778442461],[-79.34925669445691,43.70678227223797],[-79.34927446665218,43.706896178869535],[-79.3492928581706,43.706976372948645],[-79.34930946323597,43.7070361461835],[-79.34932817235007,43.707095591842055],[-79.34934871003196,43.707154719461656],[-79.34937080821507,43.70721355029112],[-79.34940224148669,43.707291588626425],[-79.349426950607,43.707349871105535],[-79.34946091795825,43.70742734928132],[-79.34949549127647,43.70750468602372],[-79.34969883258778,43.70795806944713],[-79.34972479499521,43.70801606456227],[-79.3497504954803,43.708074121435416],[-79.34978389998952,43.70815172838392],[-79.34980796299702,43.70821015214295],[-79.34983088014377,43.70826881832537],[-79.34985918357428,43.70834748339789],[-79.34987836659856,43.708406849464026],[-79.34989548653877,43.70846654676426],[-79.34991026172537,43.70852657132916],[-79.34992432003065,43.708597913146534],[-79.34993337001372,43.70866040733951],[-79.34994129270206,43.708754483704595],[-79.34994241880104,43.7088487311709],[-79.3499367427167,43.70894289229492],[-79.34992428243366,43.709036708762824],[-79.34990506958214,43.70912992407783],[-79.34987915936954,43.7092222817729],[-79.34984662064514,43.709313528998315],[-79.34980754334559,43.70940341653151],[-79.34976203477953,43.709491696071886],[-79.34971021960757,43.70957812834199],[-79.34965223986535,43.709662474086436],[-79.3495882537024,43.7097445021715],[-79.34951843662354,43.70982398958674],[-79.34944298150027,43.709900716944716],[-79.34938964605062,43.70995023196364],[-79.34930525899821,43.7100218968489],[-79.34921581721146,43.71009025963936],[-79.34912156561363,43.710155132520114],[-79.34902276151367,43.71021633849419],[-79.3489196783332,43.71027370958769],[-79.34881259691817,43.71032708773829],[-79.34870181049543,43.71037632750245],[-79.34858762343616,43.71042129425372],[-79.34847034877625,43.710461863279384],[-79.34837786949461,43.71049012524087],[-79.3482729419739,43.7105186829486],[-79.34816664772774,43.71054445015213],[-79.34805931578423,43.710567847644164],[-79.34795121557234,43.71058930964127],[-79.34784257429627,43.71060928290651],[-79.3477335806715,43.71062822135356],[-79.34759709104151,43.710651137604636],[-79.33921762032328,43.71204798174345],[-79.3391357049832,43.71206166632979],[-79.33905384990051,43.712075541768996],[-79.33891773405922,43.712099603037835],[-79.33883636520649,43.71211490930724],[-79.33875532156307,43.7121310936006],[-79.33867469569753,43.71214834147529],[-79.33859459508551,43.71216683220912],[-79.33851514458209,43.71218674240432],[-79.33843648519304,43.712208241485285],[-79.33824601115623,43.712269209500356],[-79.33811146961742,43.71232081140112],[-79.33798142440133,43.71237815782155],[-79.33785634014656,43.712441043307],[-79.33773666417352,43.71250924437712],[-79.33762282773797,43.7125825150267],[-79.33751523608426,43.71266059391233],[-79.33741427465743,43.71274320166036],[-79.33732030537794,43.71283004176165],[-79.33723366415244,43.71292080326786],[-79.337154663353,43.71301516169494],[-79.33708358437362,43.71311277811204],[-79.3370206813379,43.71321330454725],[-79.33696617986749,43.71331638038514],[-79.33692027583078,43.7134216359652],[-79.33688313285535,43.71352869437831],[-79.33685488480442,43.713637173270385],[-79.33683563205551,43.71374668393674],[-79.33682544397671,43.71385683312578],[-79.33682435767506,43.71396722663769],[-79.33683237550888,43.71407747112099],[-79.33684947130627,43.7141871686807],[-79.33686772183027,43.714267380655464],[-79.33689020317435,43.714347026183376],[-79.33691626262174,43.714426098029776],[-79.33694525726753,43.71450463038009],[-79.33697655402136,43.714582697939804],[-79.33700953088754,43.71466040153433],[-79.33704357201374,43.71473786360153],[-79.33706943446704,43.714795882981385],[-79.33817246911842,43.71726576933767],[-79.33819835485372,43.71732378306888],[-79.33822410900483,43.7173818281118],[-79.33824960118311,43.71743993398616],[-79.33827469975854,43.71749813021005],[-79.3382992706257,43.71755644359774],[-79.33833098421479,43.71763442402277],[-79.33835380804359,43.71769311027871],[-79.33837565717667,43.717751990478575],[-79.33839639628965,43.71781108243405],[-79.33841588759495,43.71787039675247],[-79.33843454440574,43.71793176307356],[-79.33845172255756,43.71799335593304],[-79.33846741589163,43.718055156420206],[-79.33848162072874,43.71811714652795],[-79.33849433090995,43.71817930734547],[-79.3385055440018,43.718241619067136],[-79.33851525508632,43.718304062783744],[-79.33852346296615,43.718366620491466],[-79.33853016520534,43.71842927328455],[-79.33853587330236,43.71849934620584],[-79.3385393968984,43.71856026806639],[-79.33854172651581,43.718621221544325],[-79.33854299995185,43.718682190632066],[-79.33854335498499,43.71874316652303],[-79.33854292938946,43.71880414221082],[-79.33854186093036,43.718865114289535],[-79.33854028737095,43.71892608025334],[-79.33853834646773,43.718987040296845],[-79.33853466816099,43.7190886340406],[-79.33852454047411,43.71936057277291],[-79.33852189198296,43.71943313892647],[-79.33851956366793,43.7195057109321],[-79.33851814927228,43.71956377511001],[-79.33851749253812,43.71970895267159],[-79.3385308950315,43.71994971817644],[-79.33854856285153,43.72008849381913],[-79.33857353369584,43.72022667848609],[-79.33858936628572,43.72029835440123],[-79.33861051399282,43.720384102272],[-79.33863348063248,43.72046960337078],[-79.33865361405444,43.720540711065716],[-79.33866195844169,43.72056921270128]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"GO Rail - Peak Only",NAME:"Bowmanville Extension",Shape_Leng:18434.3314557},geometry:{type:"MultiLineString",coordinates:[[[-78.88505190413174,43.87074000709018],[-78.88117812815827,43.87229553660196],[-78.8803310014154,43.87271811963071],[-78.88013485524156,43.8732239582612],[-78.88016716305532,43.87383445722583],[-78.88031875250654,43.87443199621375],[-78.88105686553581,43.87591346141895],[-78.88168338349041,43.87635568166597],[-78.88249102020134,43.87661101327125],[-78.88304636942698,43.87675019773953],[-78.88363479549747,43.87713336845031],[-78.88446810451244,43.878084216100184],[-78.88498299626023,43.878741074348575],[-78.88600489249201,43.8807667078635],[-78.88604266687229,43.88128013483243],[-78.88598039513116,43.881668755845716],[-78.88565851029172,43.882102999807586],[-78.88515267647718,43.882391801106024],[-78.88491483585412,43.882496379837576],[-78.8846134972923,43.88261594120251],[-78.8839482306093,43.88277132021054],[-78.88136887221393,43.88304472212457],[-78.87532079082357,43.883703952055086],[-78.87144761828604,43.884066662811335],[-78.8683656646479,43.88467580473673],[-78.86162668797337,43.886193666109506],[-78.85632085559567,43.88727146256874],[-78.83366481862934,43.89222079636284],[-78.82930204584612,43.89266203671144],[-78.82654603023879,43.892666981653385],[-78.82303289853964,43.892202656254554],[-78.81932921868832,43.891163637965164],[-78.8166096384801,43.889717780580995],[-78.80184782688538,43.87831303530768],[-78.7997429995156,43.87727160245066],[-78.797556210361,43.87658344811769],[-78.79506670988532,43.87620660905504],[-78.79245730742015,43.876229270312216],[-78.78907275240998,43.8770071432739],[-78.76382003084336,43.8842638897441],[-78.76199440208234,43.88447594260487],[-78.76037956454088,43.88442782135531],[-78.74901278216056,43.881583394706155],[-78.7473446816811,43.88149418085426],[-78.74542032158388,43.88170559140226],[-78.74378691305304,43.882047468686736],[-78.74182018977973,43.8830870615999],[-78.72227616406322,43.89299121897403],[-78.70363392035584,43.907196540757646]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"GO Rail - All-day",NAME:"Lakeshore East Line Two-Way All-Day",Shape_Leng:14145.2309908},geometry:{type:"MultiLineString",coordinates:[[[-78.85410291433341,43.88775621873924],[-78.83366481862934,43.89222079636284],[-78.82930204584612,43.89266203671144],[-78.82654603023879,43.892666981653385],[-78.82303289853964,43.892202656254554],[-78.81932921868832,43.891163637965164],[-78.8166096384801,43.889717780580995],[-78.80184782688538,43.87831303530768],[-78.7997429995156,43.87727160245066],[-78.797556210361,43.87658344811769],[-78.79506670988532,43.87620660905504],[-78.79245730742015,43.876229270312216],[-78.78907275240998,43.8770071432739],[-78.76382003084336,43.8842638897441],[-78.76199440208234,43.88447594260487],[-78.76037956454088,43.88442782135531],[-78.74901278216056,43.881583394706155],[-78.7473446816811,43.88149418085426],[-78.74542032158388,43.88170559140226],[-78.74378691305304,43.882047468686736],[-78.74182018977973,43.8830870615999],[-78.72227616406322,43.89299121897403],[-78.70363392035584,43.907196540757646]]]}},{type:"Feature",properties:{STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Yonge North Subway Extension",Shape_Leng:7609.1834472},geometry:{type:"MultiLineString",coordinates:[[[-79.41557005612061,43.7797706087645],[-79.41578175721547,43.780730807670075],[-79.41599415752889,43.78163920848984],[-79.41614987807714,43.782281800037765],[-79.41648775594744,43.78355475823285],[-79.41712699821782,43.786211883191655],[-79.417603427766,43.78808694768643],[-79.42005779380413,43.79803007382393],[-79.42119121262448,43.80217050844016],[-79.42340220503715,43.81142893585555],[-79.42424525149876,43.81523119003248],[-79.42573885228632,43.82352891643643],[-79.42574847990562,43.824424648874086],[-79.42523994028748,43.82533540465089],[-79.42449826117918,43.825712418124354],[-79.41731992903928,43.827735390221086],[-79.41631571155966,43.82827601858506],[-79.41562405506578,43.829119093120994],[-79.41567537282025,43.83012428329951],[-79.41592727185619,43.830849836929666],[-79.41921094349149,43.834127261577954],[-79.4200561059819,43.834399935786294],[-79.42112714462404,43.83508746707419],[-79.42204034784257,43.83615467809941],[-79.4233714764911,43.83785123365435],[-79.4256883542059,43.840803880302325]]]}}],Mc={type:Ac,name:Ec,crs:Lc,features:Pc},Ic="FeatureCollection",Oc="current-stations",Nc={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},kc=[{type:"Feature",properties:{LOCATION_N:"Creditstone",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Keele",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Eagle",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge North BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Mulock",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge North BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"19th-Gamble",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Major Mackenzie",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Elgin Mills",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Bernard",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Bantry-Scott",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"16th-Carrville",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Weldrick",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Yonge South BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Bathurst/Hwy 7",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Atkinson",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Disera-Promenade",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Taiga",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Dufferin",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Commerce",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Weston",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Pine Valley",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Ansley Grove",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Wigwoss-Helen",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 West BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Southlake",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Davis Drive BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Main",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Davis Drive BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Longford",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Davis Drive BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Yonge/Davis",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Davis Drive BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Bayview",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Chalmers",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Valleymede",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"West Beaver Creek",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Leslie",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"East Beaver Creek",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Allstate Parkway",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Woodbine",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Montgomery",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Town Centre Blvd.",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Cedarland",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Warden",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Kipling",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.5362799637415,43.636943838354725]}},{type:"Feature",properties:{LOCATION_N:"Islington",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.52459744576736,43.645333277840514]}},{type:"Feature",properties:{LOCATION_N:"Royal York",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.5112894933047,43.64812285676023]}},{type:"Feature",properties:{LOCATION_N:"Old Mill",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.49509379521679,43.650083196188476]}},{type:"Feature",properties:{LOCATION_N:"Jane",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.48446285910696,43.64979582509182]}},{type:"Feature",properties:{LOCATION_N:"Runnymede",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.47620752368927,43.651663652330654]}},{type:"Feature",properties:{LOCATION_N:"High Park",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.46622431348794,43.654058700220716]}},{type:"Feature",properties:{LOCATION_N:"Keele",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.45985421030888,43.65547528140698]}},{type:"Feature",properties:{LOCATION_N:"Dundas West",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.452411936657,43.65718086630647]}},{type:"Feature",properties:{LOCATION_N:"Lansdowne",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.44262387665961,43.65912663771799]}},{type:"Feature",properties:{LOCATION_N:"Dufferin",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.4354896618876,43.660251222702996]}},{type:"Feature",properties:{LOCATION_N:"Ossington",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.42593849689744,43.66242489538313]}},{type:"Feature",properties:{LOCATION_N:"Christie",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.41834650686539,43.66407775930855]}},{type:"Feature",properties:{LOCATION_N:"Bathurst",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.41149050831578,43.66572524041571]}},{type:"Feature",properties:{LOCATION_N:"St. George",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.399307859294,43.668283547722076]}},{type:"Feature",properties:{LOCATION_N:"Bay",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.38986907805769,43.67021507040404]}},{type:"Feature",properties:{LOCATION_N:"Bloor-Yonge",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38572134046599,43.67100393805821]}},{type:"Feature",properties:{LOCATION_N:"Sherbourne",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.37684698419655,43.67236249357562]}},{type:"Feature",properties:{LOCATION_N:"Castle Frank",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.36849745830627,43.67386707873992]}},{type:"Feature",properties:{LOCATION_N:"Broadview",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.35878761547585,43.676838512052576]}},{type:"Feature",properties:{LOCATION_N:"Chester",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.35225812937554,43.67834997645066]}},{type:"Feature",properties:{LOCATION_N:"Pape",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.34517720227016,43.67974099416643]}},{type:"Feature",properties:{LOCATION_N:"Donlands",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.33778294547442,43.681184391224114]}},{type:"Feature",properties:{LOCATION_N:"Greenwood",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.3302851185026,43.68281084196699]}},{type:"Feature",properties:{LOCATION_N:"Coxwell",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.32310038733308,43.684332709953]}},{type:"Feature",properties:{LOCATION_N:"Woodbine",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.31298853259938,43.6865499370791]}},{type:"Feature",properties:{LOCATION_N:"Main Street",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.30201583623007,43.688982285675884]}},{type:"Feature",properties:{LOCATION_N:"Victoria Park",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.28945003705832,43.69462148687933]}},{type:"Feature",properties:{LOCATION_N:"Warden",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.27920497226947,43.7111867500726]}},{type:"Feature",properties:{LOCATION_N:"Kennedy",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.2645323632752,43.732266101735114]}},{type:"Feature",properties:{LOCATION_N:"Union",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.37913555979762,43.64602190166318]}},{type:"Feature",properties:{LOCATION_N:"St. Andrew",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38479564606382,43.64766236621485]}},{type:"Feature",properties:{LOCATION_N:"King",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.37790760521344,43.64914935201374]}},{type:"Feature",properties:{LOCATION_N:"Osgoode",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38661865573371,43.65085632718073]}},{type:"Feature",properties:{LOCATION_N:"Queen",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.37925663425037,43.652439240452445]}},{type:"Feature",properties:{LOCATION_N:"St. Patrick",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38830576848008,43.65479390032494]}},{type:"Feature",properties:{LOCATION_N:"Dundas",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38091454935729,43.65632740126116]}},{type:"Feature",properties:{LOCATION_N:"Queen's Park",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.39046621702205,43.65985799872778]}},{type:"Feature",properties:{LOCATION_N:"College",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38314253208942,43.66145339590225]}},{type:"Feature",properties:{LOCATION_N:"Wellesley",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38352755742295,43.66526842864934]}},{type:"Feature",properties:{LOCATION_N:"Museum",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.39356634473577,43.66736898997834]}},{type:"Feature",properties:{LOCATION_N:"Rosedale",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.38852435191531,43.67709590126208]}},{type:"Feature",properties:{LOCATION_N:"Summerhill",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.39124599013212,43.68334261903202]}},{type:"Feature",properties:{LOCATION_N:"St. Clair",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.39340094471069,43.688302583630524]}},{type:"Feature",properties:{LOCATION_N:"Davisville",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.39726739540532,43.69798651844326]}},{type:"Feature",properties:{LOCATION_N:"Eglinton",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.39843816844888,43.706726878677124]}},{type:"Feature",properties:{LOCATION_N:"Lawrence",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.40217832799158,43.724957385448896]}},{type:"Feature",properties:{LOCATION_N:"York Mills",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.40620131068364,43.74427146983519]}},{type:"Feature",properties:{LOCATION_N:"Sheppard-Yonge",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.410923903092,43.76152180683054]}},{type:"Feature",properties:{LOCATION_N:"North York Centre",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.41277557839948,43.768840102252206]}},{type:"Feature",properties:{LOCATION_N:"Finch",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.41557020768036,43.77977061157681]}},{type:"Feature",properties:{LOCATION_N:"Spadina",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.40476243857377,43.668962141206585]}},{type:"Feature",properties:{LOCATION_N:"Dupont",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.40711050343715,43.6748563932314]}},{type:"Feature",properties:{LOCATION_N:"St Clair West",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.41533888679312,43.68382386412598]}},{type:"Feature",properties:{LOCATION_N:"Eglinton West",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.43599463740975,43.698836244912314]}},{type:"Feature",properties:{LOCATION_N:"Glencairn",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.44118242750598,43.70954053121957]}},{type:"Feature",properties:{LOCATION_N:"Lawrence West",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.44418943377585,43.716064609572726]}},{type:"Feature",properties:{LOCATION_N:"Yorkdale",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.44786848977213,43.725615657193615]}},{type:"Feature",properties:{LOCATION_N:"Wilson",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.4499209806949,43.734093180247044]}},{type:"Feature",properties:{LOCATION_N:"Sheppard West",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.46247546416902,43.750438450391414]}},{type:"Feature",properties:{LOCATION_N:"Bayview",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 4: Sheppard Subway"},geometry:{type:"Point",coordinates:[-79.38775574265331,43.76666344539524]}},{type:"Feature",properties:{LOCATION_N:"Bessarion",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 4: Sheppard Subway"},geometry:{type:"Point",coordinates:[-79.37665236985467,43.76919380922301]}},{type:"Feature",properties:{LOCATION_N:"Leslie",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 4: Sheppard Subway"},geometry:{type:"Point",coordinates:[-79.36813639593215,43.77102449689461]}},{type:"Feature",properties:{LOCATION_N:"Don Mills",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 4: Sheppard Subway"},geometry:{type:"Point",coordinates:[-79.346976001747,43.775143626666704]}},{type:"Feature",properties:{LOCATION_N:"Downsview Park",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.47833389274285,43.75360651222537]}},{type:"Feature",properties:{LOCATION_N:"Finch West",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.4909867820532,43.763490496298985]}},{type:"Feature",properties:{LOCATION_N:"York University",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.49964472759555,43.77412869603959]}},{type:"Feature",properties:{LOCATION_N:"Pioneer Village",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.5116353071362,43.77752252702931]}},{type:"Feature",properties:{LOCATION_N:"Highway 407",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.52323672812817,43.783556163356245]}},{type:"Feature",properties:{LOCATION_N:"Vaughan Metropolitan Centre",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 1: Yonge-University Subway"},geometry:{type:"Point",coordinates:[-79.52727364123814,43.79351382693669]}},{type:"Feature",properties:{LOCATION_N:"Weston",STATUS:"Existing",TECHNOLOGY:"UP Express - 15-Min",NAME:"UP Express"},geometry:{type:"Point",coordinates:[-79.51107390346606,43.69915724570287]}},{type:"Feature",properties:{LOCATION_N:"Bloor",STATUS:"Existing",TECHNOLOGY:"UP Express - 15-Min",NAME:"UP Express"},geometry:{type:"Point",coordinates:[-79.4519347336719,43.659026975981675]}},{type:"Feature",properties:{LOCATION_N:"Union",STATUS:"Existing",TECHNOLOGY:"UP Express - 15-Min",NAME:"UP Express"},geometry:{type:"Point",coordinates:[-79.3786569559827,43.64495230467468]}},{type:"Feature",properties:{LOCATION_N:"Terminal 1",STATUS:"Existing",TECHNOLOGY:"UP Express - 15-Min",NAME:"UP Express"},geometry:{type:"Point",coordinates:[-79.61318571016756,43.68276548243622]}},{type:"Feature",properties:{LOCATION_N:"Square One GO Bus terminal",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Central Parkway",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Cawthra",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Tomken",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Dixie",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Tahoe",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Etobicoke Creek",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Spectrum",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Renforth",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Orbitor",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Mississauga Transitway"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Sheppard-Yonge",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 4: Sheppard Subway"},geometry:{type:"Point",coordinates:[-79.410923903092,43.76152180683054]}},{type:"Feature",properties:{LOCATION_N:"Spadina",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.40397305801439,43.667288970818554]}},{type:"Feature",properties:{LOCATION_N:"St. George",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.399307859294,43.668283547722076]}},{type:"Feature",properties:{LOCATION_N:"Bloor-Yonge",STATUS:"Existing",TECHNOLOGY:"Subway",NAME:"Line 2: Bloor-Danforth Subway"},geometry:{type:"Point",coordinates:[-79.38572134046599,43.67100393805821]}},{type:"Feature",properties:{LOCATION_N:"Ajax",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.04227512380169,43.84806190264794]}},{type:"Feature",properties:{LOCATION_N:"Whitby",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-78.93821900633843,43.86480538441229]}},{type:"Feature",properties:{LOCATION_N:"Oshawa",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-78.8850551484734,43.87074865290072]}},{type:"Feature",properties:{LOCATION_N:"Pickering",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.0845972440219,43.83161520757389]}},{type:"Feature",properties:{LOCATION_N:"Danforth",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.29904975712789,43.686645619931916]}},{type:"Feature",properties:{LOCATION_N:"Scarborough",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.25482925419527,43.71726202192971]}},{type:"Feature",properties:{LOCATION_N:"Eglinton",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.23061221672899,43.740410974572626]}},{type:"Feature",properties:{LOCATION_N:"Guildwood",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.19808707379504,43.75497518644621]}},{type:"Feature",properties:{LOCATION_N:"Rouge Hill",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-79.13065891921468,43.779700643863556]}},{type:"Feature",properties:{LOCATION_N:"Oriole",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Richmond Hill"},geometry:{type:"Point",coordinates:[-79.36548324854252,43.766572567439134]}},{type:"Feature",properties:{LOCATION_N:"Old Cummer",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Richmond Hill"},geometry:{type:"Point",coordinates:[-79.3713589345969,43.792617550804216]}},{type:"Feature",properties:{LOCATION_N:"Langstaff",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Richmond Hill"},geometry:{type:"Point",coordinates:[-79.42245062442188,43.837354549346124]}},{type:"Feature",properties:{LOCATION_N:"Richmond Hill",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Richmond Hill"},geometry:{type:"Point",coordinates:[-79.42625917716911,43.87368781592823]}},{type:"Feature",properties:{LOCATION_N:"Old Elm",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.23241806988513,43.99847755583571]}},{type:"Feature",properties:{LOCATION_N:"Stouffville",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.25006005693743,43.972246578412864]}},{type:"Feature",properties:{LOCATION_N:"Mount Joy",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.2631102506044,43.89934925370311]}},{type:"Feature",properties:{LOCATION_N:"Markham",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.26279146428254,43.88234786084939]}},{type:"Feature",properties:{LOCATION_N:"Centennial",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.28857729982296,43.87391801541991]}},{type:"Feature",properties:{LOCATION_N:"Unionville",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.3148330411093,43.850934657062844]}},{type:"Feature",properties:{LOCATION_N:"Milliken",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.30146059608063,43.82304860315446]}},{type:"Feature",properties:{LOCATION_N:"Agincourt",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.28437209800119,43.78639703614165]}},{type:"Feature",properties:{LOCATION_N:"Kennedy",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Stouffville"},geometry:{type:"Point",coordinates:[-79.26269946340406,43.73291262659512]}},{type:"Feature",properties:{LOCATION_N:"Guelph",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-80.24579063562614,43.54513076693591]}},{type:"Feature",properties:{LOCATION_N:"Kitchener",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-80.49329281772661,43.45586655390336]}},{type:"Feature",properties:{LOCATION_N:"Acton",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-80.03418769077541,43.633904274588104]}},{type:"Feature",properties:{LOCATION_N:"Bramalea",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.6913481444926,43.701607433125275]}},{type:"Feature",properties:{LOCATION_N:"Brampton",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.76382459422442,43.68699464111052]}},{type:"Feature",properties:{LOCATION_N:"Mount Pleasant",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.82243206339777,43.6751392852407]}},{type:"Feature",properties:{LOCATION_N:"Georgetown",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.91821890678521,43.65568348286823]}},{type:"Feature",properties:{LOCATION_N:"Rutherford",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.49810886331836,43.83750288888539]}},{type:"Feature",properties:{LOCATION_N:"Maple",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.50719770452699,43.8595864945744]}},{type:"Feature",properties:{LOCATION_N:"King City",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.52674404725376,43.919151226447624]}},{type:"Feature",properties:{LOCATION_N:"Aurora",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.45955599611351,43.99981351408338]}},{type:"Feature",properties:{LOCATION_N:"Newmarket",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.45945337102687,44.05952750738553]}},{type:"Feature",properties:{LOCATION_N:"East Gwillimbury",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.45564744907728,44.07925965971121]}},{type:"Feature",properties:{LOCATION_N:"Bradford",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.55602625752509,44.11718260522234]}},{type:"Feature",properties:{LOCATION_N:"Barrie South",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.62717436474351,44.35117046606475]}},{type:"Feature",properties:{LOCATION_N:"Allandale Waterfront",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.6868676349291,44.373376509707526]}},{type:"Feature",properties:{LOCATION_N:"Weston",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.51107390346606,43.69915724570287]}},{type:"Feature",properties:{LOCATION_N:"Etobicoke North",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.56185628765184,43.706368908718076]}},{type:"Feature",properties:{LOCATION_N:"Malton",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.63803274525904,43.70487519293809]}},{type:"Feature",properties:{LOCATION_N:"Bloor",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.4519347336719,43.659026975981675]}},{type:"Feature",properties:{LOCATION_N:"Kipling",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.53759736349855,43.635422290158736]}},{type:"Feature",properties:{LOCATION_N:"Dixie",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.57700105382075,43.608049298943044]}},{type:"Feature",properties:{LOCATION_N:"Cooksville",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.6235350323897,43.58345595844538]}},{type:"Feature",properties:{LOCATION_N:"Erindale",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.66857607268938,43.56688633982996]}},{type:"Feature",properties:{LOCATION_N:"Streetsville",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.7090544760928,43.576117211979316]}},{type:"Feature",properties:{LOCATION_N:"Meadowvale",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.75345724620094,43.59761489833385]}},{type:"Feature",properties:{LOCATION_N:"Lisgar",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.78892852731336,43.59000253993433]}},{type:"Feature",properties:{LOCATION_N:"Milton",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Milton"},geometry:{type:"Point",coordinates:[-79.86617599165997,43.52368536672364]}},{type:"Feature",properties:{LOCATION_N:"Hamilton",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.8687235991467,43.25296317059947]}},{type:"Feature",properties:{LOCATION_N:"Union",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"ALL"},geometry:{type:"Point",coordinates:[-79.3786569559827,43.64495230467468]}},{type:"Feature",properties:{LOCATION_N:"Exhibition",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.41903151853546,43.63601679261667]}},{type:"Feature",properties:{LOCATION_N:"Mimico",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.49680987996385,43.61667703268178]}},{type:"Feature",properties:{LOCATION_N:"Long Branch",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.54497438110421,43.59218208867133]}},{type:"Feature",properties:{LOCATION_N:"Port Credit",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.58714846787625,43.55601572358371]}},{type:"Feature",properties:{LOCATION_N:"Clarkson",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.6346181018551,43.512358987729364]}},{type:"Feature",properties:{LOCATION_N:"Oakville",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.68246489122592,43.45489641576435]}},{type:"Feature",properties:{LOCATION_N:"Bronte",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.72257903615692,43.41642455923571]}},{type:"Feature",properties:{LOCATION_N:"Appleby",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.76087092456035,43.37965045155566]}},{type:"Feature",properties:{LOCATION_N:"Burlington",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.80905452518662,43.34117614911539]}},{type:"Feature",properties:{LOCATION_N:"Aldershot",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.85445656776879,43.31323600878694]}},{type:"Feature",properties:{LOCATION_N:"Niagara Falls",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Niagara Falls"},geometry:{type:"Point",coordinates:[-79.06306482567994,43.10899703780846]}},{type:"Feature",properties:{LOCATION_N:"St. Catharines",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Niagara Falls"},geometry:{type:"Point",coordinates:[-79.25581869468823,43.14753712271148]}},{type:"Feature",properties:{LOCATION_N:"West Harbour",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.86480119314113,43.2664551820593]}},{type:"Feature",properties:{LOCATION_N:"Gormley",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Richmond Hill"},geometry:{type:"Point",coordinates:[-79.39838311087846,43.940025967084445]}},{type:"Feature",properties:{LOCATION_N:"Downsview Park",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.47833389274285,43.75360651222537]}},{type:"Feature",properties:{LOCATION_N:"Bloomington",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Richmond Hill"},geometry:{type:"Point",coordinates:[-79.39729763171735,43.97565744842512]}},{type:"Feature",properties:{LOCATION_N:"Richmond Hill Centre",STATUS:"Existing",TECHNOLOGY:"BRT",NAME:"Highway 7 East BRT"},geometry:null},{type:"Feature",properties:{LOCATION_N:"Conestoga",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.52945143789093,43.4981369272445]}},{type:"Feature",properties:{LOCATION_N:"Northfield",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.54321202619914,43.49721126124788]}},{type:"Feature",properties:{LOCATION_N:"Research and Technology",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.54515805833339,43.481623567746894]}},{type:"Feature",properties:{LOCATION_N:"University of Waterloo",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.54116479762575,43.4732380983172]}},{type:"Feature",properties:{LOCATION_N:"Laurier-Waterloo Park",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.53440442736702,43.46885717725017]}},{type:"Feature",properties:{LOCATION_N:"Waterloo Public Square",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.52298866762466,43.464141377081745]}},{type:"Feature",properties:{LOCATION_N:"Willis Way",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.52336904237791,43.46214399917674]}},{type:"Feature",properties:{LOCATION_N:"Allen",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.51836078626975,43.45983591005758]}},{type:"Feature",properties:{LOCATION_N:"Grand River Hospital",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.51205622272272,43.45728346164216]}},{type:"Feature",properties:{LOCATION_N:"Central Station",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.49913146293855,43.4531756207267]}},{type:"Feature",properties:{LOCATION_N:"Kitchener City Hall",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.49080287862174,43.45192775100741]}},{type:"Feature",properties:{LOCATION_N:"Victoria Park",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.49370802390088,43.450184801224324]}},{type:"Feature",properties:{LOCATION_N:"Frederick",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.48734599288981,43.44964770989569]}},{type:"Feature",properties:{LOCATION_N:"Queen",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.48942320139524,43.448626004069276]}},{type:"Feature",properties:{LOCATION_N:"Kitchener Market",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.48359184457289,43.44629470089538]}},{type:"Feature",properties:{LOCATION_N:"Mill",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.47787647523356,43.433581584078986]}},{type:"Feature",properties:{LOCATION_N:"Block Line",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.4630819516898,43.42282486418266]}},{type:"Feature",properties:{LOCATION_N:"Fairway",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.44180342642942,43.42232678425045]}},{type:"Feature",properties:{LOCATION_N:"Borden",STATUS:"Existing",TECHNOLOGY:"LRT",NAME:"ION LRT"},geometry:{type:"Point",coordinates:[-80.47537310243919,43.44240342046416]}},{type:"Feature",properties:{LOCATION_N:"Stratford",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-80.96549121237126,43.36424185916433]}},{type:"Feature",properties:{LOCATION_N:"St. Marys",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-81.13875315681832,43.241894629627446]}},{type:"Feature",properties:{LOCATION_N:"London",STATUS:"Existing",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-81.25035946850842,42.97995907804085]}}],Rc={type:Ic,name:Oc,crs:Nc,features:kc},Dc="FeatureCollection",zc="future-stations",Bc={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},Fc=[{type:"Feature",properties:{LOCATION_N:"Convair",STATUS:"Advancing",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.59550186189198,43.67043986969088]}},{type:"Feature",properties:{LOCATION_N:"Silver Dart",STATUS:"Advancing",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.59322263679074,43.676470761836406]}},{type:"Feature",properties:{LOCATION_N:"Pearson",STATUS:"Advancing",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.61515294670068,43.69026531312733]}},{type:"Feature",properties:{LOCATION_N:"Davis",STATUS:"In Delivery",TECHNOLOGY:"BRT",NAME:"Yonge North BRT"},geometry:{type:"Point",coordinates:[-79.4803594628246,44.054794401893346]}},{type:"Feature",properties:{LOCATION_N:"Avenue",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.40851185352732,43.704613199599144]}},{type:"Feature",properties:{LOCATION_N:"Forest Hill",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.42556802310328,43.70103152565168]}},{type:"Feature",properties:{LOCATION_N:"Leaside",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.3771553958241,43.71105404283557]}},{type:"Feature",properties:{LOCATION_N:"Sloane",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.31352136803723,43.725978106808356]}},{type:"Feature",properties:{LOCATION_N:"Birchmount",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.27791354980035,43.730067901320716]}},{type:"Feature",properties:{LOCATION_N:"Caledonia",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.46462167269905,43.69217342059516]}},{type:"Feature",properties:{LOCATION_N:"Chaplin",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.41737876938342,43.70275158411716]}},{type:"Feature",properties:{LOCATION_N:"Science Centre",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.33889176171549,43.72048733201268]}},{type:"Feature",properties:{LOCATION_N:"Fairbank",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.4502445459893,43.69564393733833]}},{type:"Feature",properties:{LOCATION_N:"Eglinton",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.39865148865105,43.70668245140083]}},{type:"Feature",properties:{LOCATION_N:"Cedarvale",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.43599463740975,43.698836244912314]}},{type:"Feature",properties:{LOCATION_N:"Aga Khan Park & Museum",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.33398073389665,43.72202970220639]}},{type:"Feature",properties:{LOCATION_N:"Ionview",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.27119975164786,43.731435611413126]}},{type:"Feature",properties:{LOCATION_N:"Keelesdale",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.47506946376213,43.69016349162396]}},{type:"Feature",properties:{LOCATION_N:"Kennedy",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.2645323632752,43.732266101735114]}},{type:"Feature",properties:{LOCATION_N:"Laird",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.36481055297638,43.7135798492006]}},{type:"Feature",properties:{LOCATION_N:"Hakimi Lebovic",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.2914885422548,43.72707144899006]}},{type:"Feature",properties:{LOCATION_N:"Sunnybrook Park",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.34996265068807,43.71706476723325]}},{type:"Feature",properties:{LOCATION_N:"Mount Dennis",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.4872637624976,43.68738601904319]}},{type:"Feature",properties:{LOCATION_N:"Mount Pleasant",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.39018239297091,43.70840666873896]}},{type:"Feature",properties:{LOCATION_N:"Oakwood",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.44279459222729,43.69731470440617]}},{type:"Feature",properties:{LOCATION_N:"Pharmacy",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.29754976529915,43.72572430555554]}},{type:"Feature",properties:{LOCATION_N:"O'Connor",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.30258486506422,43.72466000796886]}},{type:"Feature",properties:{LOCATION_N:"Golden Mile",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.28764136108778,43.72793740711019]}},{type:"Feature",properties:{LOCATION_N:"Wynford",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown LRT"},geometry:{type:"Point",coordinates:[-79.32528527643022,43.724385264917835]}},{type:"Feature",properties:{LOCATION_N:"Scarborough Centre",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Scarborough Subway Extension"},geometry:{type:"Point",coordinates:[-79.25342699700309,43.776220174765086]}},{type:"Feature",properties:{LOCATION_N:"Kennedy",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Scarborough Subway Extension"},geometry:{type:"Point",coordinates:[-79.2645323632752,43.732266101735114]}},{type:"Feature",properties:{LOCATION_N:"McMaster",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.9194998182416,43.25770439590858]}},{type:"Feature",properties:{LOCATION_N:"Longwood",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.90242178135381,43.25910642000261]}},{type:"Feature",properties:{LOCATION_N:"Dundurn",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.88798280879527,43.262211996766844]}},{type:"Feature",properties:{LOCATION_N:"Queen",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.87869083058683,43.25940678290369]}},{type:"Feature",properties:{LOCATION_N:"James",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.86907087315957,43.2567217963227]}},{type:"Feature",properties:{LOCATION_N:"Mary",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.86417608219776,43.25513268379966]}},{type:"Feature",properties:{LOCATION_N:"Wellington",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.85927732383314,43.253537874429576]}},{type:"Feature",properties:{LOCATION_N:"Wentworth",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.8489715262347,43.252109497074485]}},{type:"Feature",properties:{LOCATION_N:"Sherman",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.83841043821204,43.25130876978183]}},{type:"Feature",properties:{LOCATION_N:"Scott Park",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.83249628658702,43.25015733087848]}},{type:"Feature",properties:{LOCATION_N:"Ottawa",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.81969871281538,43.242557701743515]}},{type:"Feature",properties:{LOCATION_N:"Kenilworth",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.80991697203156,43.24044925370675]}},{type:"Feature",properties:{LOCATION_N:"Queenston",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.80110362585803,43.2375820254346]}},{type:"Feature",properties:{LOCATION_N:"Parkdale",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.79289655650176,43.23448822392013]}},{type:"Feature",properties:{LOCATION_N:"Nash",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.7738924148845,43.230018520117866]}},{type:"Feature",properties:{LOCATION_N:"Eastgate",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.76416997170175,43.22810915491978]}},{type:"Feature",properties:{LOCATION_N:"Port Credit",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.58522664187173,43.55777571367846]}},{type:"Feature",properties:{LOCATION_N:"Mineola",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.59070270631689,43.56171133161301]}},{type:"Feature",properties:{LOCATION_N:"North Service",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.60185362150894,43.56985446831646]}},{type:"Feature",properties:{LOCATION_N:"Queensway",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.60757193266853,43.574110328278316]}},{type:"Feature",properties:{LOCATION_N:"Dundas",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.6163807899507,43.58026844457932]}},{type:"Feature",properties:{LOCATION_N:"Cooksville",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.62230597864213,43.58448881739361]}},{type:"Feature",properties:{LOCATION_N:"Fairview",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.62770203823794,43.58846711597595]}},{type:"Feature",properties:{LOCATION_N:"Burnhamthorpe",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.63423524747517,43.59289517381247]}},{type:"Feature",properties:{LOCATION_N:"Robert Speck",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.63844222577941,43.59621527608839]}},{type:"Feature",properties:{LOCATION_N:"Mississauga City Centre",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.64709916567132,43.59433476065713]}},{type:"Feature",properties:{LOCATION_N:"Eglinton",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.65291978238028,43.606778981732134]}},{type:"Feature",properties:{LOCATION_N:"Matheson",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.67028706383584,43.61948335917955]}},{type:"Feature",properties:{LOCATION_N:"Courtneypark",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.69425240281075,43.63717245637197]}},{type:"Feature",properties:{LOCATION_N:"Derry",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.70616343536102,43.646109576041155]}},{type:"Feature",properties:{LOCATION_N:"County Court",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.72326506074664,43.65873697743782]}},{type:"Feature",properties:{LOCATION_N:"Sir Lou",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.7273552431357,43.66176257110089]}},{type:"Feature",properties:{LOCATION_N:"Brampton Gateway Terminal",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.73305128570811,43.665987749271345]}},{type:"Feature",properties:{LOCATION_N:"Britannia",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.67957668479804,43.62629013822987]}},{type:"Feature",properties:{LOCATION_N:"Bristol",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hazel McCallion Line"},geometry:{type:"Point",coordinates:[-79.66355395027836,43.61450127357825]}},{type:"Feature",properties:{LOCATION_N:"Humber College",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.6015600631072,43.73038259319584]}},{type:"Feature",properties:{LOCATION_N:"Westmore",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.60096745954321,43.7346746933913]}},{type:"Feature",properties:{LOCATION_N:"Martin Grove",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.59169653561788,43.73677116441306]}},{type:"Feature",properties:{LOCATION_N:"Albion",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.58930615017343,43.74110750215209]}},{type:"Feature",properties:{LOCATION_N:"Stevenson",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.58694715306972,43.74321584259155]}},{type:"Feature",properties:{LOCATION_N:"Mount Olive",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.58209452689394,43.74328010011644]}},{type:"Feature",properties:{LOCATION_N:"Rowntree Mills",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.56857410741135,43.746238582277044]}},{type:"Feature",properties:{LOCATION_N:"Pearldale",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.56233237661233,43.74778918743332]}},{type:"Feature",properties:{LOCATION_N:"Duncanwoods",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.55762384442362,43.74880969761106]}},{type:"Feature",properties:{LOCATION_N:"Milvan Rumike",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.55225241042399,43.74995876312971]}},{type:"Feature",properties:{LOCATION_N:"Emery",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.54239472761849,43.75207931123008]}},{type:"Feature",properties:{LOCATION_N:"Signet Arrow",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.53622335810711,43.753307797901584]}},{type:"Feature",properties:{LOCATION_N:"Norfinch Oakdale",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.52425976256102,43.755960268099095]}},{type:"Feature",properties:{LOCATION_N:"Jane and Finch",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.51772139260115,43.75725878418825]}},{type:"Feature",properties:{LOCATION_N:"Driftwood",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.51343119767543,43.75806400268929]}},{type:"Feature",properties:{LOCATION_N:"Tobermory",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.50796122340446,43.75927968815165]}},{type:"Feature",properties:{LOCATION_N:"Sentinel",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.5000136142188,43.76107851658564]}},{type:"Feature",properties:{LOCATION_N:"Finch West",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Finch West LRT"},geometry:{type:"Point",coordinates:[-79.4909867820532,43.763490496298985]}},{type:"Feature",properties:{LOCATION_N:"Confederation",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.75850689723787,43.24148178519232]}},{type:"Feature",properties:{LOCATION_N:"Mount Dennis",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Kitchener"},geometry:{type:"Point",coordinates:[-79.4872637624976,43.68738601904319]}},{type:"Feature",properties:{LOCATION_N:"Caledonia",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Barrie"},geometry:{type:"Point",coordinates:[-79.46462167269905,43.69217342059516]}},{type:"Feature",properties:{LOCATION_N:"Ritson Road",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-78.85417843082882,43.88793659102587]}},{type:"Feature",properties:{LOCATION_N:"Grimsby",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Lakeshore West"},geometry:{type:"Point",coordinates:[-79.59613147460381,43.20368737267203]}},{type:"Feature",properties:{LOCATION_N:"Thorntons Corners East",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-78.88593729583958,43.880635232808544]}},{type:"Feature",properties:{LOCATION_N:"Courtice",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-78.76577616641529,43.883711556589596]}},{type:"Feature",properties:{LOCATION_N:"Bowmanville",STATUS:"In Delivery",TECHNOLOGY:"GO Rail",NAME:"Lakeshore East"},geometry:{type:"Point",coordinates:[-78.70363695593804,43.90720519829822]}},{type:"Feature",properties:{LOCATION_N:"Gage Park",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Hamilton B-Line LRT"},geometry:{type:"Point",coordinates:[-79.8247538007676,43.24424077586155]}},{type:"Feature",properties:{LOCATION_N:"High Tech",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Yonge North Subway Extension"},geometry:{type:"Point",coordinates:[-79.4256883542059,43.840803880302325]}},{type:"Feature",properties:{LOCATION_N:"Mount Dennis",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.4872637624976,43.68738601904319]}},{type:"Feature",properties:{LOCATION_N:"Jane",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.49881692150396,43.684478691708115]}},{type:"Feature",properties:{LOCATION_N:"Scarlett",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.5114093567639,43.68389959607575]}},{type:"Feature",properties:{LOCATION_N:"Royal York",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.52674420956069,43.68248036801166]}},{type:"Feature",properties:{LOCATION_N:"Islington",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.53906657396273,43.68002611752888]}},{type:"Feature",properties:{LOCATION_N:"Kipling",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.55091921241943,43.67724679310544]}},{type:"Feature",properties:{LOCATION_N:"Martin Grove",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.56327380125458,43.67473969642727]}},{type:"Feature",properties:{LOCATION_N:"Renforth",STATUS:"In Delivery",TECHNOLOGY:"LRT",NAME:"Eglinton Crosstown West Extension"},geometry:{type:"Point",coordinates:[-79.59146112841827,43.662748908943456]}},{type:"Feature",properties:{LOCATION_N:"Steeles",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Yonge North Subway Extension"},geometry:{type:"Point",coordinates:[-79.4200519085159,43.79804020947927]}},{type:"Feature",properties:{LOCATION_N:"Clark",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Yonge North Subway Extension"},geometry:{type:"Point",coordinates:[-79.42237430952677,43.80714821031268]}},{type:"Feature",properties:{LOCATION_N:"Royal Orchard",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Yonge North Subway Extension"},geometry:{type:"Point",coordinates:[-79.42555940714023,43.82339941804701]}},{type:"Feature",properties:{LOCATION_N:"McCowan",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Scarborough Subway Extension"},geometry:{type:"Point",coordinates:[-79.2587731613471,43.78962166581119]}},{type:"Feature",properties:{LOCATION_N:"Lawrence East",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Scarborough Subway Extension"},geometry:{type:"Point",coordinates:[-79.24545654996516,43.75544836537077]}},{type:"Feature",properties:{LOCATION_N:"Osgoode",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.3865762991481,43.65076395099828]}},{type:"Feature",properties:{LOCATION_N:"Queen",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.37922012001921,43.65234344722537]}},{type:"Feature",properties:{LOCATION_N:"Pape",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.34521525931372,43.67972664270028]}},{type:"Feature",properties:{LOCATION_N:"Science Centre",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.33866195844169,43.72056921270128]}},{type:"Feature",properties:{LOCATION_N:"Exhibition",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.41821498274923,43.63638573083377]}},{type:"Feature",properties:{LOCATION_N:"East Harbour",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.34735855589491,43.65519186205182]}},{type:"Feature",properties:{LOCATION_N:"King / Bathurst",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.40249937091461,43.643816245179934]}},{type:"Feature",properties:{LOCATION_N:"Queen / Spadina",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.39634141365518,43.64867926258551]}},{type:"Feature",properties:{LOCATION_N:"Moss Park",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.3702094501528,43.65427610087593]}},{type:"Feature",properties:{LOCATION_N:"Corktown",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.36438510536595,43.65214868839946]}},{type:"Feature",properties:{LOCATION_N:"Riverside/Leslieville",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.34569853932673,43.65984990870291]}},{type:"Feature",properties:{LOCATION_N:"Gerrard",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.3424885828288,43.6674284795736]}},{type:"Feature",properties:{LOCATION_N:"Cosburn",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.34895194671236,43.68940003829995]}},{type:"Feature",properties:{LOCATION_N:"Thorncliffe Park",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.35005436305896,43.70522583912843]}},{type:"Feature",properties:{LOCATION_N:"Flemingdon Park",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Ontario Line"},geometry:{type:"Point",coordinates:[-79.33717113187302,43.715023610332146]}},{type:"Feature",properties:{LOCATION_N:"Bridge",STATUS:"In Delivery",TECHNOLOGY:"Subway",NAME:"Yonge North Subway Extension"},geometry:{type:"Point",coordinates:[-79.42245062442188,43.837354549346124]}}],Gc={type:Dc,name:zc,crs:Bc,features:Fc},zl=Math.min,Ha=Math.max,Bl=Math.round,kl=Math.floor,ao=b=>({x:b,y:b}),Uc={left:"right",right:"left",bottom:"top",top:"bottom"},jc={start:"end",end:"start"};function _1(b,T,L){return Ha(b,zl(T,L))}function Ul(b,T){return typeof b=="function"?b(T):b}function Va(b){return b.split("-")[0]}function jl(b){return b.split("-")[1]}function t2(b){return b==="x"?"y":"x"}function i2(b){return b==="y"?"height":"width"}function Vs(b){return["top","bottom"].includes(Va(b))?"y":"x"}function r2(b){return t2(Vs(b))}function Hc(b,T,L){L===void 0&&(L=!1);const k=jl(b),D=r2(b),J=i2(D);let S=D==="x"?k===(L?"end":"start")?"right":"left":k==="start"?"bottom":"top";return T.reference[J]>T.floating[J]&&(S=Fl(S)),[S,Fl(S)]}function Vc(b){const T=Fl(b);return[c9(b),T,c9(T)]}function c9(b){return b.replace(/start|end/g,T=>jc[T])}function Zc(b,T,L){const k=["left","right"],D=["right","left"],J=["top","bottom"],S=["bottom","top"];switch(b){case"top":case"bottom":return L?T?D:k:T?k:D;case"left":case"right":return T?J:S;default:return[]}}function Yc(b,T,L,k){const D=jl(b);let J=Zc(Va(b),L==="start",k);return D&&(J=J.map(S=>S+"-"+D),T&&(J=J.concat(J.map(c9)))),J}function Fl(b){return b.replace(/left|right|bottom|top/g,T=>Uc[T])}function qc(b){return{top:0,right:0,bottom:0,left:0,...b}}function $c(b){return typeof b!="number"?qc(b):{top:b,right:b,bottom:b,left:b}}function Gl(b){const{x:T,y:L,width:k,height:D}=b;return{width:k,height:D,top:L,left:T,right:T+k,bottom:L+D,x:T,y:L}}function y1(b,T,L){let{reference:k,floating:D}=b;const J=Vs(T),S=r2(T),c=i2(S),be=Va(T),me=J==="y",de=k.x+k.width/2-D.width/2,Ae=k.y+k.height/2-D.height/2,fe=k[c]/2-D[c]/2;let te;switch(be){case"top":te={x:de,y:k.y-D.height};break;case"bottom":te={x:de,y:k.y+k.height};break;case"right":te={x:k.x+k.width,y:Ae};break;case"left":te={x:k.x-D.width,y:Ae};break;default:te={x:k.x,y:k.y}}switch(jl(T)){case"start":te[S]-=fe*(L&&me?-1:1);break;case"end":te[S]+=fe*(L&&me?-1:1);break}return te}const Wc=async(b,T,L)=>{const{placement:k="bottom",strategy:D="absolute",middleware:J=[],platform:S}=L,c=J.filter(Boolean),be=await(S.isRTL==null?void 0:S.isRTL(T));let me=await S.getElementRects({reference:b,floating:T,strategy:D}),{x:de,y:Ae}=y1(me,k,be),fe=k,te={},Ce=0;for(let Je=0;Je<c.length;Je++){const{name:it,fn:je}=c[Je],{x:Fe,y:dt,data:He,reset:ft}=await je({x:de,y:Ae,initialPlacement:k,placement:fe,strategy:D,middlewareData:te,rects:me,platform:S,elements:{reference:b,floating:T}});de=Fe??de,Ae=dt??Ae,te={...te,[it]:{...te[it],...He}},ft&&Ce<=50&&(Ce++,typeof ft=="object"&&(ft.placement&&(fe=ft.placement),ft.rects&&(me=ft.rects===!0?await S.getElementRects({reference:b,floating:T,strategy:D}):ft.rects),{x:de,y:Ae}=y1(me,fe,be)),Je=-1)}return{x:de,y:Ae,placement:fe,strategy:D,middlewareData:te}};async function n2(b,T){var L;T===void 0&&(T={});const{x:k,y:D,platform:J,rects:S,elements:c,strategy:be}=b,{boundary:me="clippingAncestors",rootBoundary:de="viewport",elementContext:Ae="floating",altBoundary:fe=!1,padding:te=0}=Ul(T,b),Ce=$c(te),it=c[fe?Ae==="floating"?"reference":"floating":Ae],je=Gl(await J.getClippingRect({element:(L=await(J.isElement==null?void 0:J.isElement(it)))==null||L?it:it.contextElement||await(J.getDocumentElement==null?void 0:J.getDocumentElement(c.floating)),boundary:me,rootBoundary:de,strategy:be})),Fe=Ae==="floating"?{x:k,y:D,width:S.floating.width,height:S.floating.height}:S.reference,dt=await(J.getOffsetParent==null?void 0:J.getOffsetParent(c.floating)),He=await(J.isElement==null?void 0:J.isElement(dt))?await(J.getScale==null?void 0:J.getScale(dt))||{x:1,y:1}:{x:1,y:1},ft=Gl(J.convertOffsetParentRelativeRectToViewportRelativeRect?await J.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:Fe,offsetParent:dt,strategy:be}):Fe);return{top:(je.top-ft.top+Ce.top)/He.y,bottom:(ft.bottom-je.bottom+Ce.bottom)/He.y,left:(je.left-ft.left+Ce.left)/He.x,right:(ft.right-je.right+Ce.right)/He.x}}const Xc=function(b){return b===void 0&&(b={}),{name:"flip",options:b,async fn(T){var L,k;const{placement:D,middlewareData:J,rects:S,initialPlacement:c,platform:be,elements:me}=T,{mainAxis:de=!0,crossAxis:Ae=!0,fallbackPlacements:fe,fallbackStrategy:te="bestFit",fallbackAxisSideDirection:Ce="none",flipAlignment:Je=!0,...it}=Ul(b,T);if((L=J.arrow)!=null&&L.alignmentOffset)return{};const je=Va(D),Fe=Vs(c),dt=Va(c)===c,He=await(be.isRTL==null?void 0:be.isRTL(me.floating)),ft=fe||(dt||!Je?[Fl(c)]:Vc(c)),mt=Ce!=="none";!fe&&mt&&ft.push(...Yc(c,Je,Ce,He));const ot=[c,...ft],we=await n2(T,it),Et=[];let Dt=((k=J.flip)==null?void 0:k.overflows)||[];if(de&&Et.push(we[je]),Ae){const Zt=Hc(D,S,He);Et.push(we[Zt[0]],we[Zt[1]])}if(Dt=[...Dt,{placement:D,overflows:Et}],!Et.every(Zt=>Zt<=0)){var Bi,si;const Zt=(((Bi=J.flip)==null?void 0:Bi.index)||0)+1,gi=ot[Zt];if(gi)return{data:{index:Zt,overflows:Dt},reset:{placement:gi}};let xt=(si=Dt.filter(Ii=>Ii.overflows[0]<=0).sort((Ii,ct)=>Ii.overflows[1]-ct.overflows[1])[0])==null?void 0:si.placement;if(!xt)switch(te){case"bestFit":{var Wt;const Ii=(Wt=Dt.filter(ct=>{if(mt){const li=Vs(ct.placement);return li===Fe||li==="y"}return!0}).map(ct=>[ct.placement,ct.overflows.filter(li=>li>0).reduce((li,dr)=>li+dr,0)]).sort((ct,li)=>ct[1]-li[1])[0])==null?void 0:Wt[0];Ii&&(xt=Ii);break}case"initialPlacement":xt=c;break}if(D!==xt)return{reset:{placement:xt}}}return{}}}};async function Kc(b,T){const{placement:L,platform:k,elements:D}=b,J=await(k.isRTL==null?void 0:k.isRTL(D.floating)),S=Va(L),c=jl(L),be=Vs(L)==="y",me=["left","top"].includes(S)?-1:1,de=J&&be?-1:1,Ae=Ul(T,b);let{mainAxis:fe,crossAxis:te,alignmentAxis:Ce}=typeof Ae=="number"?{mainAxis:Ae,crossAxis:0,alignmentAxis:null}:{mainAxis:Ae.mainAxis||0,crossAxis:Ae.crossAxis||0,alignmentAxis:Ae.alignmentAxis};return c&&typeof Ce=="number"&&(te=c==="end"?Ce*-1:Ce),be?{x:te*de,y:fe*me}:{x:fe*me,y:te*de}}const Jc=function(b){return b===void 0&&(b=0),{name:"offset",options:b,async fn(T){var L,k;const{x:D,y:J,placement:S,middlewareData:c}=T,be=await Kc(T,b);return S===((L=c.offset)==null?void 0:L.placement)&&(k=c.arrow)!=null&&k.alignmentOffset?{}:{x:D+be.x,y:J+be.y,data:{...be,placement:S}}}}},Qc=function(b){return b===void 0&&(b={}),{name:"shift",options:b,async fn(T){const{x:L,y:k,placement:D}=T,{mainAxis:J=!0,crossAxis:S=!1,limiter:c={fn:it=>{let{x:je,y:Fe}=it;return{x:je,y:Fe}}},...be}=Ul(b,T),me={x:L,y:k},de=await n2(T,be),Ae=Vs(Va(D)),fe=t2(Ae);let te=me[fe],Ce=me[Ae];if(J){const it=fe==="y"?"top":"left",je=fe==="y"?"bottom":"right",Fe=te+de[it],dt=te-de[je];te=_1(Fe,te,dt)}if(S){const it=Ae==="y"?"top":"left",je=Ae==="y"?"bottom":"right",Fe=Ce+de[it],dt=Ce-de[je];Ce=_1(Fe,Ce,dt)}const Je=c.fn({...T,[fe]:te,[Ae]:Ce});return{...Je,data:{x:Je.x-L,y:Je.y-k,enabled:{[fe]:J,[Ae]:S}}}}}};function Hl(){return typeof window<"u"}function Ys(b){return o2(b)?(b.nodeName||"").toLowerCase():"#document"}function In(b){var T;return(b==null||(T=b.ownerDocument)==null?void 0:T.defaultView)||window}function lo(b){var T;return(T=(o2(b)?b.ownerDocument:b.document)||window.document)==null?void 0:T.documentElement}function o2(b){return Hl()?b instanceof Node||b instanceof In(b).Node:!1}function Jn(b){return Hl()?b instanceof Element||b instanceof In(b).Element:!1}function so(b){return Hl()?b instanceof HTMLElement||b instanceof In(b).HTMLElement:!1}function x1(b){return!Hl()||typeof ShadowRoot>"u"?!1:b instanceof ShadowRoot||b instanceof In(b).ShadowRoot}function w3(b){const{overflow:T,overflowX:L,overflowY:k,display:D}=Qn(b);return/auto|scroll|overlay|hidden|clip/.test(T+k+L)&&!["inline","contents"].includes(D)}function e8(b){return["table","td","th"].includes(Ys(b))}function Vl(b){return[":popover-open",":modal"].some(T=>{try{return b.matches(T)}catch{return!1}})}function f9(b){const T=m9(),L=Jn(b)?Qn(b):b;return["transform","translate","scale","rotate","perspective"].some(k=>L[k]?L[k]!=="none":!1)||(L.containerType?L.containerType!=="normal":!1)||!T&&(L.backdropFilter?L.backdropFilter!=="none":!1)||!T&&(L.filter?L.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(k=>(L.willChange||"").includes(k))||["paint","layout","strict","content"].some(k=>(L.contain||"").includes(k))}function t8(b){let T=ta(b);for(;so(T)&&!Zs(T);){if(f9(T))return T;if(Vl(T))return null;T=ta(T)}return null}function m9(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Zs(b){return["html","body","#document"].includes(Ys(b))}function Qn(b){return In(b).getComputedStyle(b)}function Zl(b){return Jn(b)?{scrollLeft:b.scrollLeft,scrollTop:b.scrollTop}:{scrollLeft:b.scrollX,scrollTop:b.scrollY}}function ta(b){if(Ys(b)==="html")return b;const T=b.assignedSlot||b.parentNode||x1(b)&&b.host||lo(b);return x1(T)?T.host:T}function a2(b){const T=ta(b);return Zs(T)?b.ownerDocument?b.ownerDocument.body:b.body:so(T)&&w3(T)?T:a2(T)}function v3(b,T,L){var k;T===void 0&&(T=[]),L===void 0&&(L=!0);const D=a2(b),J=D===((k=b.ownerDocument)==null?void 0:k.body),S=In(D);if(J){const c=h9(S);return T.concat(S,S.visualViewport||[],w3(D)?D:[],c&&L?v3(c):[])}return T.concat(D,v3(D,[],L))}function h9(b){return b.parent&&Object.getPrototypeOf(b.parent)?b.frameElement:null}function s2(b){const T=Qn(b);let L=parseFloat(T.width)||0,k=parseFloat(T.height)||0;const D=so(b),J=D?b.offsetWidth:L,S=D?b.offsetHeight:k,c=Bl(L)!==J||Bl(k)!==S;return c&&(L=J,k=S),{width:L,height:k,$:c}}function g9(b){return Jn(b)?b:b.contextElement}function Hs(b){const T=g9(b);if(!so(T))return ao(1);const L=T.getBoundingClientRect(),{width:k,height:D,$:J}=s2(T);let S=(J?Bl(L.width):L.width)/k,c=(J?Bl(L.height):L.height)/D;return(!S||!Number.isFinite(S))&&(S=1),(!c||!Number.isFinite(c))&&(c=1),{x:S,y:c}}const i8=ao(0);function l2(b){const T=In(b);return!m9()||!T.visualViewport?i8:{x:T.visualViewport.offsetLeft,y:T.visualViewport.offsetTop}}function r8(b,T,L){return T===void 0&&(T=!1),!L||T&&L!==In(b)?!1:T}function Za(b,T,L,k){T===void 0&&(T=!1),L===void 0&&(L=!1);const D=b.getBoundingClientRect(),J=g9(b);let S=ao(1);T&&(k?Jn(k)&&(S=Hs(k)):S=Hs(b));const c=r8(J,L,k)?l2(J):ao(0);let be=(D.left+c.x)/S.x,me=(D.top+c.y)/S.y,de=D.width/S.x,Ae=D.height/S.y;if(J){const fe=In(J),te=k&&Jn(k)?In(k):k;let Ce=fe,Je=h9(Ce);for(;Je&&k&&te!==Ce;){const it=Hs(Je),je=Je.getBoundingClientRect(),Fe=Qn(Je),dt=je.left+(Je.clientLeft+parseFloat(Fe.paddingLeft))*it.x,He=je.top+(Je.clientTop+parseFloat(Fe.paddingTop))*it.y;be*=it.x,me*=it.y,de*=it.x,Ae*=it.y,be+=dt,me+=He,Ce=In(Je),Je=h9(Ce)}}return Gl({width:de,height:Ae,x:be,y:me})}function _9(b,T){const L=Zl(b).scrollLeft;return T?T.left+L:Za(lo(b)).left+L}function c2(b,T,L){L===void 0&&(L=!1);const k=b.getBoundingClientRect(),D=k.left+T.scrollLeft-(L?0:_9(b,k)),J=k.top+T.scrollTop;return{x:D,y:J}}function n8(b){let{elements:T,rect:L,offsetParent:k,strategy:D}=b;const J=D==="fixed",S=lo(k),c=T?Vl(T.floating):!1;if(k===S||c&&J)return L;let be={scrollLeft:0,scrollTop:0},me=ao(1);const de=ao(0),Ae=so(k);if((Ae||!Ae&&!J)&&((Ys(k)!=="body"||w3(S))&&(be=Zl(k)),so(k))){const te=Za(k);me=Hs(k),de.x=te.x+k.clientLeft,de.y=te.y+k.clientTop}const fe=S&&!Ae&&!J?c2(S,be,!0):ao(0);return{width:L.width*me.x,height:L.height*me.y,x:L.x*me.x-be.scrollLeft*me.x+de.x+fe.x,y:L.y*me.y-be.scrollTop*me.y+de.y+fe.y}}function o8(b){return Array.from(b.getClientRects())}function a8(b){const T=lo(b),L=Zl(b),k=b.ownerDocument.body,D=Ha(T.scrollWidth,T.clientWidth,k.scrollWidth,k.clientWidth),J=Ha(T.scrollHeight,T.clientHeight,k.scrollHeight,k.clientHeight);let S=-L.scrollLeft+_9(b);const c=-L.scrollTop;return Qn(k).direction==="rtl"&&(S+=Ha(T.clientWidth,k.clientWidth)-D),{width:D,height:J,x:S,y:c}}function s8(b,T){const L=In(b),k=lo(b),D=L.visualViewport;let J=k.clientWidth,S=k.clientHeight,c=0,be=0;if(D){J=D.width,S=D.height;const me=m9();(!me||me&&T==="fixed")&&(c=D.offsetLeft,be=D.offsetTop)}return{width:J,height:S,x:c,y:be}}function l8(b,T){const L=Za(b,!0,T==="fixed"),k=L.top+b.clientTop,D=L.left+b.clientLeft,J=so(b)?Hs(b):ao(1),S=b.clientWidth*J.x,c=b.clientHeight*J.y,be=D*J.x,me=k*J.y;return{width:S,height:c,x:be,y:me}}function v1(b,T,L){let k;if(T==="viewport")k=s8(b,L);else if(T==="document")k=a8(lo(b));else if(Jn(T))k=l8(T,L);else{const D=l2(b);k={x:T.x-D.x,y:T.y-D.y,width:T.width,height:T.height}}return Gl(k)}function h2(b,T){const L=ta(b);return L===T||!Jn(L)||Zs(L)?!1:Qn(L).position==="fixed"||h2(L,T)}function c8(b,T){const L=T.get(b);if(L)return L;let k=v3(b,[],!1).filter(c=>Jn(c)&&Ys(c)!=="body"),D=null;const J=Qn(b).position==="fixed";let S=J?ta(b):b;for(;Jn(S)&&!Zs(S);){const c=Qn(S),be=f9(S);!be&&c.position==="fixed"&&(D=null),(J?!be&&!D:!be&&c.position==="static"&&!!D&&["absolute","fixed"].includes(D.position)||w3(S)&&!be&&h2(b,S))?k=k.filter(de=>de!==S):D=c,S=ta(S)}return T.set(b,k),k}function h8(b){let{element:T,boundary:L,rootBoundary:k,strategy:D}=b;const S=[...L==="clippingAncestors"?Vl(T)?[]:c8(T,this._c):[].concat(L),k],c=S[0],be=S.reduce((me,de)=>{const Ae=v1(T,de,D);return me.top=Ha(Ae.top,me.top),me.right=zl(Ae.right,me.right),me.bottom=zl(Ae.bottom,me.bottom),me.left=Ha(Ae.left,me.left),me},v1(T,c,D));return{width:be.right-be.left,height:be.bottom-be.top,x:be.left,y:be.top}}function u8(b){const{width:T,height:L}=s2(b);return{width:T,height:L}}function p8(b,T,L){const k=so(T),D=lo(T),J=L==="fixed",S=Za(b,!0,J,T);let c={scrollLeft:0,scrollTop:0};const be=ao(0);if(k||!k&&!J)if((Ys(T)!=="body"||w3(D))&&(c=Zl(T)),k){const fe=Za(T,!0,J,T);be.x=fe.x+T.clientLeft,be.y=fe.y+T.clientTop}else D&&(be.x=_9(D));const me=D&&!k&&!J?c2(D,c):ao(0),de=S.left+c.scrollLeft-be.x-me.x,Ae=S.top+c.scrollTop-be.y-me.y;return{x:de,y:Ae,width:S.width,height:S.height}}function o9(b){return Qn(b).position==="static"}function b1(b,T){if(!so(b)||Qn(b).position==="fixed")return null;if(T)return T(b);let L=b.offsetParent;return lo(b)===L&&(L=L.ownerDocument.body),L}function u2(b,T){const L=In(b);if(Vl(b))return L;if(!so(b)){let D=ta(b);for(;D&&!Zs(D);){if(Jn(D)&&!o9(D))return D;D=ta(D)}return L}let k=b1(b,T);for(;k&&e8(k)&&o9(k);)k=b1(k,T);return k&&Zs(k)&&o9(k)&&!f9(k)?L:k||t8(b)||L}const d8=async function(b){const T=this.getOffsetParent||u2,L=this.getDimensions,k=await L(b.floating);return{reference:p8(b.reference,await T(b.floating),b.strategy),floating:{x:0,y:0,width:k.width,height:k.height}}};function f8(b){return Qn(b).direction==="rtl"}const m8={convertOffsetParentRelativeRectToViewportRelativeRect:n8,getDocumentElement:lo,getClippingRect:h8,getOffsetParent:u2,getElementRects:d8,getClientRects:o8,getDimensions:u8,getScale:Hs,isElement:Jn,isRTL:f8};function p2(b,T){return b.x===T.x&&b.y===T.y&&b.width===T.width&&b.height===T.height}function g8(b,T){let L=null,k;const D=lo(b);function J(){var c;clearTimeout(k),(c=L)==null||c.disconnect(),L=null}function S(c,be){c===void 0&&(c=!1),be===void 0&&(be=1),J();const me=b.getBoundingClientRect(),{left:de,top:Ae,width:fe,height:te}=me;if(c||T(),!fe||!te)return;const Ce=kl(Ae),Je=kl(D.clientWidth-(de+fe)),it=kl(D.clientHeight-(Ae+te)),je=kl(de),dt={rootMargin:-Ce+"px "+-Je+"px "+-it+"px "+-je+"px",threshold:Ha(0,zl(1,be))||1};let He=!0;function ft(mt){const ot=mt[0].intersectionRatio;if(ot!==be){if(!He)return S();ot?S(!1,ot):k=setTimeout(()=>{S(!1,1e-7)},1e3)}ot===1&&!p2(me,b.getBoundingClientRect())&&S(),He=!1}try{L=new IntersectionObserver(ft,{...dt,root:D.ownerDocument})}catch{L=new IntersectionObserver(ft,dt)}L.observe(b)}return S(!0),J}function _8(b,T,L,k){k===void 0&&(k={});const{ancestorScroll:D=!0,ancestorResize:J=!0,elementResize:S=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:be=!1}=k,me=g9(b),de=D||J?[...me?v3(me):[],...v3(T)]:[];de.forEach(je=>{D&&je.addEventListener("scroll",L,{passive:!0}),J&&je.addEventListener("resize",L)});const Ae=me&&c?g8(me,L):null;let fe=-1,te=null;S&&(te=new ResizeObserver(je=>{let[Fe]=je;Fe&&Fe.target===me&&te&&(te.unobserve(T),cancelAnimationFrame(fe),fe=requestAnimationFrame(()=>{var dt;(dt=te)==null||dt.observe(T)})),L()}),me&&!be&&te.observe(me),te.observe(T));let Ce,Je=be?Za(b):null;be&&it();function it(){const je=Za(b);Je&&!p2(Je,je)&&L(),Je=je,Ce=requestAnimationFrame(it)}return L(),()=>{var je;de.forEach(Fe=>{D&&Fe.removeEventListener("scroll",L),J&&Fe.removeEventListener("resize",L)}),Ae==null||Ae(),(je=te)==null||je.disconnect(),te=null,be&&cancelAnimationFrame(Ce)}}const y8=Jc,x8=Qc,v8=Xc,b8=(b,T,L)=>{const k=new Map,D={platform:m8,...L},J={...D.platform,_c:k};return Wc(b,T,{...D,platform:J})};function w8(b){let T,L;const k={autoUpdate:!0};let D=b;const J=de=>({...k,...b||{},...de||{}}),S=de=>{T&&L&&(D=J(de),b8(T,L,D).then(Ae=>{Object.assign(L.style,{position:Ae.strategy,left:`${Ae.x}px`,top:`${Ae.y}px`}),D!=null&&D.onComputed&&D.onComputed(Ae)}))},c=de=>{if("subscribe"in de)return me(de),{};T=de,S()},be=(de,Ae)=>{let fe;L=de,D=J(Ae),setTimeout(()=>S(Ae),0),S(Ae);const te=()=>{fe&&(fe(),fe=void 0)},Ce=({autoUpdate:Je}=D||{})=>{te(),Je!==!1&&u5().then(()=>_8(T,L,()=>S(D),Je===!0?{}:Je))};return fe=Ce(),{update(Je){S(Je),fe=Ce(Je)},destroy(){te()}}},me=de=>{const Ae=de.subscribe(fe=>{T===void 0?(T=fe,S()):(Object.assign(T,fe),S())});N1(Ae)};return[c,be,S]}function T8({loadOptions:b,filterText:T,items:L,multiple:k,value:D,itemId:J,groupBy:S,filterSelectedItems:c,itemFilter:be,convertStringItemsToObjects:me,filterGroupedItems:de,label:Ae}){if(L&&b)return L;if(!L)return[];L&&L.length>0&&typeof L[0]!="object"&&(L=me(L));let fe=L.filter(te=>{let Ce=be(te[Ae],T,te);return Ce&&k&&(D!=null&&D.length)&&(Ce=!D.some(Je=>c?Je[J]===te[J]:!1)),Ce});return S&&(fe=de(fe)),fe}async function S8({dispatch:b,loadOptions:T,convertStringItemsToObjects:L,filterText:k}){let D=await T(k).catch(J=>{console.warn("svelte-select loadOptions error :>> ",J),b("error",{type:"loadOptions",details:J})});if(D&&!D.cancelled)return D?(D&&D.length>0&&typeof D[0]!="object"&&(D=L(D)),b("loaded",{items:D})):D=[],{filteredItems:D,loading:!1,focused:!0,listOpen:!0}}var C8=u9(`<svg width="100%" height="100%" viewBox="0 0 20 20" focusable="false" aria-hidden="true" class="svelte-qbd276"><path fill="currentColor" d="M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747
          3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0
          1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502
          0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0
          0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"></path></svg>`);function A8(b){var T=C8();ri(b,T)}var E8=u9(`<svg width="100%" height="100%" viewBox="-2 -2 50 50" focusable="false" aria-hidden="true" role="presentation" class="svelte-whdbu1"><path fill="currentColor" d="M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124
    l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z"></path></svg>`);function a9(b){var T=E8();ri(b,T)}var L8=u9('<svg class="loading svelte-1p3nqvd" viewBox="25 25 50 50"><circle class="circle_path svelte-1p3nqvd" cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="5" stroke-miterlimit="10"></circle></svg>');function P8(b){var T=L8();ri(b,T)}var M8=an('<div class="list-item svelte-82qwg8" tabindex="-1" role="none"><div class="item svelte-82qwg8"><!></div></div>'),I8=an('<div class="empty svelte-82qwg8">No options</div>'),O8=an('<div class="svelte-select-list svelte-82qwg8" role="none"><!> <!> <!></div>'),N8=an('<span id="aria-selection" class="svelte-82qwg8"> </span> <span id="aria-context" class="svelte-82qwg8"> </span>',1),k8=an('<div class="multi-item-clear svelte-82qwg8"><!></div>'),R8=an('<div class="multi-item svelte-82qwg8" role="none"><span class="multi-item-text svelte-82qwg8"><!></span> <!></div>'),D8=an('<div class="selected-item svelte-82qwg8"><!></div>'),z8=an('<div class="icon loading svelte-82qwg8" aria-hidden="true"><!></div>'),B8=an('<button type="button" class="icon clear-select svelte-82qwg8"><!></button>'),F8=an('<div class="icon chevron svelte-82qwg8" aria-hidden="true"><!></div>'),G8=an('<input type="hidden" class="svelte-82qwg8">'),U8=an('<select class="required svelte-82qwg8" required tabindex="-1" aria-hidden="true"></select>'),j8=an('<div role="none"><!> <span aria-live="polite" aria-atomic="false" aria-relevant="additions text" class="a11y-text svelte-82qwg8"><!></span> <div class="prepend svelte-82qwg8"><!></div> <div class="value-container svelte-82qwg8"><!> <input></div> <div class="indicators svelte-82qwg8"><!> <!> <!></div> <!> <!></div>');function H8(b,T){const L=b5(T);P1(T,!1);const k=Ti(),D=Ti(),J=Ti(),S=Ti(),c=Ti(),be=Ti(),me=Ti(),de=Ti(),Ae=Ti(),fe=g5();let te=bt(T,"justValue",12,null),Ce=bt(T,"filter",8,T8),Je=bt(T,"getItems",8,S8),it=bt(T,"id",8,null),je=bt(T,"name",8,null),Fe=bt(T,"container",12,void 0),dt=bt(T,"input",12,void 0),He=bt(T,"multiple",8,!1),ft=bt(T,"multiFullItemClearable",8,!1),mt=bt(T,"disabled",8,!1),ot=bt(T,"focused",12,!1),we=bt(T,"value",12,null),Et=bt(T,"filterText",12,""),Dt=bt(T,"placeholder",8,"Please select"),Bi=bt(T,"placeholderAlwaysShow",8,!1),si=bt(T,"items",12,null),Wt=bt(T,"label",8,"label"),Zt=bt(T,"itemFilter",8,(ve,Re,et)=>`${ve}`.toLowerCase().includes(Re.toLowerCase())),gi=bt(T,"groupBy",8,void 0),xt=bt(T,"groupFilter",8,ve=>ve),Ii=bt(T,"groupHeaderSelectable",8,!1),ct=bt(T,"itemId",8,"value"),li=bt(T,"loadOptions",8,void 0),dr=bt(T,"containerStyles",8,""),fr=bt(T,"hasError",8,!1),Ei=bt(T,"filterSelectedItems",8,!0),Fi=bt(T,"required",8,!1),Li=bt(T,"closeListOnChange",8,!0),ci=bt(T,"clearFilterTextOnBlur",8,!0),Tr=bt(T,"createGroupHeaderItem",8,(ve,Re)=>({value:ve,[Wt()]:ve}));const nr=()=>he(me);let or=bt(T,"searchable",8,!0),Oi=bt(T,"inputStyles",8,""),qr=bt(T,"clearable",8,!0),Kt=bt(T,"loading",12,!1),at=bt(T,"listOpen",12,!1),Sr,_i=bt(T,"debounce",8,(ve,Re=1)=>{clearTimeout(Sr),Sr=setTimeout(ve,Re)}),$r=bt(T,"debounceWait",8,300),fn=bt(T,"hideEmptyState",8,!1),Gi=bt(T,"inputAttributes",24,()=>({})),kr=bt(T,"listAutoWidth",8,!0),Rr=bt(T,"showChevron",8,!1),Ui=bt(T,"listOffset",8,5),Lt=bt(T,"hoverItemIndex",12,0),ar=bt(T,"floatingConfig",24,()=>({})),Wr=bt(T,"class",8,""),zt=Ti(),ji=Ti(),mr=Ti(),Cr=Ti();function Ot(){if(typeof we()=="string"){let ve=(si()||[]).find(Re=>Re[ct()]===we());we(ve||{[ct()]:we(),label:we()})}else He()&&Array.isArray(we())&&we().length>0&&we(we().map(ve=>typeof ve=="string"?{value:ve,label:ve}:ve))}let Yt=Ti();function sn(){Ut(Yt,Object.assign({autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:!1,tabindex:0,type:"text","aria-autocomplete":"list"},Gi())),it()&&Pl(Yt,he(Yt).id=it()),or()||Pl(Yt,he(Yt).readonly=!0)}function gr(ve){return ve.map((Re,et)=>({index:et,value:Re,label:`${Re}`}))}function Pi(ve){const Re=[],et={};ve.forEach(Mt=>{const vt=gi()(Mt);Re.includes(vt)||(Re.push(vt),et[vt]=[],vt&&et[vt].push(Object.assign(Tr()(vt,Mt),{id:vt,groupHeader:!0,selectable:Ii()}))),et[vt].push(Object.assign({groupItem:!!vt},Mt))});const Xt=[];return xt()(Re).forEach(Mt=>{et[Mt]&&Xt.push(...et[Mt])}),Xt}function mn(){if(He()){JSON.stringify(we())!==JSON.stringify(he(ji))&&ye()&&fe("input",we());return}(!he(ji)||JSON.stringify(we()[ct()])!==JSON.stringify(he(ji)[ct()]))&&fe("input",we())}function Dr(){we()&&(Array.isArray(we())?we([...we()]):we([we()]))}function V(){we()&&we(null)}function B(){const ve=he(me).findIndex(Re=>Re[ct()]===we()[ct()]);U(ve,!0)}function G(ve){fe("hoverItem",ve)}function U(ve=0,Re){Lt(ve<0?0:ve),!Re&&gi()&&he(me)[Lt()]&&!he(me)[Lt()].selectable&&On(1)}function X(){!li()&&Et().length===0||(li()?_i()(async function(){Kt(!0);let ve=await Je()({dispatch:fe,loadOptions:li(),convertStringItemsToObjects:gr,filterText:Et()});ve?(Kt(ve.loading),at(at()?ve.listOpen:Et().length>0),ot(at()&&ve.focused),si(gi()?Pi(ve.filteredItems):ve.filteredItems)):(Kt(!1),ot(!0),at(!0))},$r()):(at(!0),He()&&Ut(zt,void 0)))}function ne(ve){at()&&fe("filter",ve)}_5(async()=>{Ut(ji,we()),Ut(mr,Et()),Ut(Cr,He())});function ue(){return He()?we()?we().map(ve=>ve[ct()]):null:we()?we()[ct()]:we()}function ye(){let ve=!0;if(we()){const Re=[],et=[];we().forEach(Xt=>{Re.includes(Xt[ct()])?ve=!1:(Re.push(Xt[ct()]),et.push(Xt))}),ve||we(et)}return ve}function ce(ve){let Re=ve?ve[ct()]:we()[ct()];return si().find(et=>et[ct()]===Re)}function Me(ve){!ve||ve.length===0||ve.some(Re=>typeof Re!="object")||!we()||(He()?we().some(Re=>!Re||!Re[ct()]):!we()[ct()])||(Array.isArray(we())?we(we().map(Re=>ce(Re)||Re)):we(ce()||we()))}async function Se(ve){const Re=we()[ve];we().length===1?we(void 0):we(we().filter(et=>et!==Re)),fe("clear",Re)}function pe(ve){if(ot())switch(ve.stopPropagation(),ve.key){case"Escape":ve.preventDefault(),Ee();break;case"Enter":if(ve.preventDefault(),at()){if(he(me).length===0)break;const Re=he(me)[Lt()];if(we()&&!He()&&we()[ct()]===Re[ct()]){Ee();break}else ti(he(me)[Lt()])}break;case"ArrowDown":ve.preventDefault(),at()?On(1):(at(!0),Ut(zt,void 0));break;case"ArrowUp":ve.preventDefault(),at()?On(-1):(at(!0),Ut(zt,void 0));break;case"Tab":if(at()&&ot()){if(he(me).length===0||we()&&we()[ct()]===he(me)[Lt()][ct()])return Ee();ve.preventDefault(),ti(he(me)[Lt()]),Ee()}break;case"Backspace":if(!He()||Et().length>0)return;if(He()&&we()&&we().length>0){if(Se(he(zt)!==void 0?he(zt):we().length-1),he(zt)===0||he(zt)===void 0)break;Ut(zt,we().length>he(zt)?he(zt)-1:void 0)}break;case"ArrowLeft":if(!we()||!He()||Et().length>0)return;he(zt)===void 0?Ut(zt,we().length-1):we().length>he(zt)&&he(zt)!==0&&Ut(zt,he(zt)-1);break;case"ArrowRight":if(!we()||!He()||Et().length>0||he(zt)===void 0)return;he(zt)===we().length-1?Ut(zt,void 0):he(zt)<we().length-1&&Ut(zt,he(zt)+1);break}}function se(ve){var Re;ot()&&dt()===(document==null?void 0:document.activeElement)||(ve&&fe("focus",ve),(Re=dt())==null||Re.focus(),ot(!0))}async function Ve(ve){var Re;xi||(at()||ot())&&(fe("blur",ve),Ee(),ot(!1),Ut(zt,void 0),(Re=dt())==null||Re.blur())}function Ze(){if(!mt()){if(Et().length>0)return at(!0);at(!at())}}function st(){fe("clear",we()),we(void 0),Ee(),se()}k1(()=>{at()&&ot(!0),ot()&&dt()&&dt().focus()});function gt(ve){if(ve){Et("");const Re=Object.assign({},ve);if(Re.groupHeader&&!Re.selectable)return;we(He()?we()?we().concat([Re]):[Re]:we(Re)),setTimeout(()=>{Li()&&Ee(),Ut(zt,void 0),fe("change",we()),fe("select",ve)})}}function Ee(){ci()&&Et(""),at(!1)}let $e=bt(T,"ariaValues",8,ve=>`Option ${ve}, selected.`),Xe=bt(T,"ariaListOpen",8,(ve,Re)=>`You are currently focused on option ${ve}. There are ${Re} results available.`),Tt=bt(T,"ariaFocused",8,()=>"Select is focused, type to refine list, press down to open the menu.");function Pt(ve){let Re;return ve&&we().length>0?Re=we().map(et=>et[Wt()]).join(", "):Re=we()[Wt()],$e()(Re)}function ut(){if(!he(me)||he(me).length===0)return"";let ve=he(me)[Lt()];if(at()&&ve){let Re=he(me)?he(me).length:0;return Xe()(ve[Wt()],Re)}else return Tt()()}let qe=Ti(null),ui;function gn(){clearTimeout(ui),ui=setTimeout(()=>{xi=!1},100)}function Ni(ve){var Re;!at()&&!ot()&&Fe()&&!Fe().contains(ve.target)&&!((Re=he(qe))!=null&&Re.contains(ve.target))&&Ve()}N1(()=>{var ve;(ve=he(qe))==null||ve.remove()});let xi=!1;function ti(ve){!ve||ve.selectable===!1||gt(ve)}function _r(ve){xi||Lt(ve)}function hi(ve){const{item:Re,i:et}=ve;if((Re==null?void 0:Re.selectable)!==!1){if(we()&&!He()&&we()[ct()]===Re[ct()])return Ee();Hn(Re)&&(Lt(et),ti(Re))}}function On(ve){if(he(me).filter(Xt=>!Object.hasOwn(Xt,"selectable")||Xt.selectable===!0).length===0)return Lt(0);ve>0&&Lt()===he(me).length-1?Lt(0):ve<0&&Lt()===0?Lt(he(me).length-1):Lt(Lt()+ve);const et=he(me)[Lt()];if(et&&et.selectable===!1){(ve===1||ve===-1)&&On(ve);return}}function jn(ve,Re,et){if(!He())return Re&&Re[et]===ve[et]}function ia(ve){return ve===0}function Hn(ve){return ve.groupHeader&&ve.selectable||ve.selectable||!ve.hasOwnProperty("selectable")}const Vn=Io,Ya=Io;function Io(ve){return{update(Re){Re.scroll&&(gn(),ve.scrollIntoView({behavior:"auto",block:"nearest"}))}}}function qa(){const{width:ve}=Fe().getBoundingClientRect();Pl(qe,he(qe).style.width=kr()?ve+"px":"auto")}let ln=Ti({strategy:"absolute",placement:"bottom-start",middleware:[y8(Ui()),v8(),x8()],autoUpdate:!1});const[$a,qs,$s]=w8(he(ln));let ra=Ti(!0);function Wa(ve,Re){if(!ve||!Re)return Ut(ra,!0);setTimeout(()=>{Ut(ra,!1)},0)}Gt(()=>(nt(si()),nt(we())),()=>{si(),we()&&Ot()}),Gt(()=>(nt(Gi()),nt(or())),()=>{(Gi()||!or())&&sn()}),Gt(()=>nt(He()),()=>{He()&&Dr()}),Gt(()=>(he(Cr),nt(He())),()=>{he(Cr)&&!He()&&V()}),Gt(()=>(nt(He()),nt(we())),()=>{He()&&we()&&we().length>1&&ye()}),Gt(()=>nt(we()),()=>{we()&&mn()}),Gt(()=>(nt(we()),nt(He()),he(ji)),()=>{!we()&&He()&&he(ji)&&fe("input",we())}),Gt(()=>(nt(ot()),nt(dt())),()=>{!ot()&&dt()&&Ee()}),Gt(()=>(nt(Et()),he(mr)),()=>{Et()!==he(mr)&&X()}),Gt(()=>(nt(Ce()),nt(li()),nt(Et()),nt(si()),nt(He()),nt(we()),nt(ct()),nt(gi()),nt(Wt()),nt(Ei()),nt(Zt())),()=>{Ut(me,Ce()({loadOptions:li(),filterText:Et(),items:si(),multiple:He(),value:we(),itemId:ct(),groupBy:gi(),label:Wt(),filterSelectedItems:Ei(),itemFilter:Zt(),convertStringItemsToObjects:gr,filterGroupedItems:Pi}))}),Gt(()=>(nt(He()),nt(at()),nt(we()),he(me)),()=>{!He()&&at()&&we()&&he(me)&&B()}),Gt(()=>(nt(at()),nt(He())),()=>{at()&&He()&&Lt(0)}),Gt(()=>nt(Et()),()=>{Et()&&Lt(0)}),Gt(()=>nt(Lt()),()=>{G(Lt())}),Gt(()=>(nt(He()),nt(we())),()=>{Ut(k,He()?we()&&we().length>0:we())}),Gt(()=>(he(k),nt(Et())),()=>{Ut(D,he(k)&&Et().length>0)}),Gt(()=>(he(k),nt(qr()),nt(mt()),nt(Kt())),()=>{Ut(J,he(k)&&qr()&&!mt()&&!Kt())}),Gt(()=>(nt(Bi()),nt(He()),nt(Dt()),nt(we())),()=>{var ve;Ut(S,Bi()&&He()||He()&&((ve=we())==null?void 0:ve.length)===0?Dt():we()?"":Dt())}),Gt(()=>(nt(we()),nt(He())),()=>{Ut(c,we()?Pt(He()):"")}),Gt(()=>(he(me),nt(Lt()),nt(ot()),nt(at())),()=>{Ut(be,ut({filteredItems:he(me),hoverItemIndex:Lt(),focused:ot(),listOpen:at()}))}),Gt(()=>nt(si()),()=>{Me(si())}),Gt(()=>(nt(He()),nt(we()),nt(ct())),()=>{te(ue(He(),we(),ct()))}),Gt(()=>(nt(He()),he(ji),nt(we())),()=>{!He()&&he(ji)&&!we()&&fe("input",we())}),Gt(()=>(nt(at()),he(me),nt(He()),nt(we())),()=>{at()&&he(me)&&!He()&&!we()&&U()}),Gt(()=>he(me),()=>{ne(he(me))}),Gt(()=>(nt(Fe()),nt(ar()),he(ln)),()=>{Fe()&&ar()&&$s(Object.assign(he(ln),ar()))}),Gt(()=>he(qe),()=>{Ut(de,!!he(qe))}),Gt(()=>(he(qe),nt(at())),()=>{Wa(he(qe),at())}),Gt(()=>(nt(at()),nt(Fe()),he(qe)),()=>{at()&&Fe()&&he(qe)&&qa()}),Gt(()=>nt(Lt()),()=>{Ut(Ae,Lt())}),Gt(()=>(nt(dt()),nt(at()),nt(ot())),()=>{dt()&&at()&&!ot()&&se()}),Gt(()=>(nt(Fe()),nt(ar())),()=>{var ve;Fe()&&((ve=ar())==null?void 0:ve.autoUpdate)===void 0&&Pl(ln,he(ln).autoUpdate=!0)}),M1(),O1();var Ji=j8();pr("click",r1,Ni),pr("keydown",r1,pe);var Nn=Ht(Ji);on(Nn,at,ve=>{var Re=O8(),et=Ht(Re);on(et,()=>L["list-prepend"],vt=>{var jt=oo(),Hi=$n(jt);pn(Hi,T,"list-prepend",{},null),ri(vt,jt)});var Xt=ei(et,2);on(Xt,()=>L.list,vt=>{var jt=oo(),Hi=$n(jt);pn(Hi,T,"list",{get filteredItems(){return he(me)}},null),ri(vt,jt)},vt=>{var jt=oo(),Hi=$n(jt);on(Hi,()=>he(me).length>0,Er=>{var kt=oo(),Vi=$n(kt);s1(Vi,1,()=>he(me),a1,(Kr,ki,qt)=>{var Ri=M8(),vi=Ht(Ri);const ko=n1(()=>jn(he(ki),we(),ct()));dn(()=>Yr(vi,"active",he(ko)));const uo=n1(()=>ia(qt));dn(()=>Yr(vi,"first",he(uo)));var Jt=Ht(vi);pn(Jt,T,"item",{get item(){return he(ki)},index:qt},sr=>{var Ct=Q7();dn(()=>{var _t;return Kn(Ct,(_t=he(ki))==null?void 0:_t[Wt()])}),ri(sr,Ct)}),Vt(vi),Ml(vi,(sr,Ct)=>Vn(sr),()=>({scroll:jn(he(ki),we(),ct()),listDom:he(de)})),Ml(vi,(sr,Ct)=>Ya(sr),()=>({scroll:he(Ae)===qt,listDom:he(de)})),Vt(Ri),dn(()=>{var sr;Yr(vi,"list-group-title",he(ki).groupHeader),Yr(vi,"hover",Lt()===qt),Yr(vi,"group-item",he(ki).groupItem),Yr(vi,"not-selectable",((sr=he(ki))==null?void 0:sr.selectable)===!1)}),pr("mouseover",Ri,()=>_r(qt)),pr("focus",Ri,()=>_r(qt)),pr("click",Ri,Fs(()=>hi({item:he(ki),i:qt}))),pr("keydown",Ri,ja(Fs(function(sr){Ol.call(this,T,sr)}))),ri(Kr,Ri)}),ri(Er,kt)},Er=>{var kt=oo(),Vi=$n(kt);on(Vi,()=>!fn(),Kr=>{var ki=oo(),qt=$n(ki);pn(qt,T,"empty",{},Ri=>{var vi=I8();ri(Ri,vi)}),ri(Kr,ki)},null,!0),ri(Er,kt)},!0),ri(vt,jt)});var Mt=ei(Xt,2);on(Mt,()=>L["list-append"],vt=>{var jt=oo(),Hi=$n(jt);pn(Hi,T,"list-append",{},null),ri(vt,jt)}),Vt(Re),Ml(Re,vt=>qs(vt)),t9(Re,vt=>Ut(qe,vt),()=>he(qe)),_3(()=>pr("scroll",Re,gn)),_3(()=>pr("pointerup",Re,ja(Fs(function(vt){Ol.call(this,T,vt)})))),_3(()=>pr("mousedown",Re,ja(Fs(function(vt){Ol.call(this,T,vt)})))),dn(()=>Yr(Re,"prefloat",he(ra))),ri(ve,Re)});var co=ei(Nn,2),Xa=Ht(co);on(Xa,ot,ve=>{var Re=N8(),et=$n(Re),Xt=Ht(et,!0);Vt(et);var Mt=ei(et,2),vt=Ht(Mt,!0);Vt(Mt),dn(()=>{Kn(Xt,he(c)),Kn(vt,he(be))}),ri(ve,Re)}),Vt(co);var _n=ei(co,2),na=Ht(_n);pn(na,T,"prepend",{},null),Vt(_n);var eo=ei(_n,2),oa=Ht(eo);on(oa,()=>he(k),ve=>{var Re=oo(),et=$n(Re);on(et,He,Xt=>{var Mt=oo(),vt=$n(Mt);s1(vt,1,we,a1,(jt,Hi,Er)=>{var kt=R8(),Vi=Ht(kt),Kr=Ht(Vi);pn(Kr,T,"selection",{get selection(){return he(Hi)},index:Er},qt=>{var Ri=Q7();dn(()=>Kn(Ri,he(Hi)[Wt()])),ri(qt,Ri)}),Vt(Vi);var ki=ei(Vi,2);on(ki,()=>!mt()&&!ft()&&a9,qt=>{var Ri=k8(),vi=Ht(Ri);pn(vi,T,"multi-clear-icon",{},ko=>{a9(ko)}),Vt(Ri),pr("pointerup",Ri,ja(Fs(()=>Se(Er)))),ri(qt,Ri)}),Vt(kt),dn(()=>{Yr(kt,"active",he(zt)===Er),Yr(kt,"disabled",mt())}),pr("click",kt,ja(()=>ft()?Se(Er):{})),pr("keydown",kt,ja(Fs(function(qt){Ol.call(this,T,qt)}))),ri(jt,kt)}),ri(Xt,Mt)},Xt=>{var Mt=D8(),vt=Ht(Mt);pn(vt,T,"selection",{get selection(){return we()}},jt=>{var Hi=Q7();dn(()=>Kn(Hi,we()[Wt()])),ri(jt,Hi)}),Vt(Mt),dn(()=>Yr(Mt,"hide-selected-item",he(D))),ri(Xt,Mt)}),ri(ve,Re)});var Ar=ei(oa,2);Us(Ar);let Oo;t9(Ar,ve=>dt(ve),()=>dt()),Vt(eo);var zr=ei(eo,2),wt=Ht(zr);on(wt,Kt,ve=>{var Re=z8(),et=Ht(Re);pn(et,T,"loading-icon",{},Xt=>{P8(Xt)}),Vt(Re),ri(ve,Re)});var Xr=ei(wt,2);on(Xr,()=>he(J),ve=>{var Re=B8(),et=Ht(Re);pn(et,T,"clear-icon",{},Xt=>{a9(Xt)}),Vt(Re),pr("click",Re,st),ri(ve,Re)});var St=ei(Xr,2);on(St,Rr,ve=>{var Re=F8(),et=Ht(Re);pn(et,T,"chevron-icon",{get listOpen(){return at()}},Xt=>{A8(Xt)}),Vt(Re),ri(ve,Re)}),Vt(zr);var ho=ei(zr,2);pn(ho,T,"input-hidden",{get value(){return we()}},ve=>{var Re=G8();Us(Re),dn(()=>T5(Re,we()?JSON.stringify(we()):null)),dn(()=>En(Re,"name",je())),ri(ve,Re)});var No=ei(ho,2);return on(No,()=>Fi()&&(!we()||we().length===0),ve=>{var Re=oo(),et=$n(Re);pn(et,T,"required",{get value(){return we()}},Xt=>{var Mt=U8();ri(Xt,Mt)}),ri(ve,Re)}),Vt(Ji),_3(()=>pr("pointerup",Ji,ja(Ze))),t9(Ji,ve=>Fe(ve),()=>Fe()),Ml(Ji,ve=>$a(ve)),dn(()=>{C5(Ji,`svelte-select ${Wr()??""} svelte-82qwg8`),En(Ji,"style",dr()),Yr(Ji,"multi",He()),Yr(Ji,"disabled",mt()),Yr(Ji,"focused",ot()),Yr(Ji,"list-open",at()),Yr(Ji,"show-chevron",Rr()),Yr(Ji,"error",fr()),Oo=S5(Ar,Oo,{readOnly:!or(),...he(Yt),placeholder:he(S),style:Oi(),disabled:mt()},"svelte-82qwg8")}),pr("keydown",Ar,pe),pr("blur",Ar,Ve),pr("focus",Ar,se),E5(Ar,Et),ri(b,Ji),d1(T,"getFilteredItems",nr),d1(T,"handleClear",st),I1({getFilteredItems:nr,handleClear:st})}const w1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgzO9IAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAC1JREFUCJltyKENACAAA7D9fwAJ3AnYonBzTYMgaw7f9+yeSE0kLdccPZGayAPVNG+dIVuuRAAAAABJRU5ErkJggg==",V8=[{id:"water_waterway_label",type:"symbol",source:"protomaps","source-layer":"water",minzoom:13,filter:["in","kind","river","stream"],layout:{"symbol-placement":"line","text-font":["TradeGothic LT Bold"],"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-size":12,"text-letter-spacing":.2},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"roads_labels_minor",type:"symbol",source:"protomaps","source-layer":"roads",minzoom:15,filter:["in","kind","minor_road","other","path"],layout:{"symbol-sort-key":["get","min_zoom"],"symbol-placement":"line","text-font":["TradeGothic LT Bold"],"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-size":12},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-blur":1,"text-halo-width":1}},{id:"water_label_ocean",type:"symbol",source:"protomaps","source-layer":"water",filter:["in","kind","sea","ocean","lake","water","bay","strait","fjord"],layout:{"text-font":["TradeGothic LT Bold"],"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-size":["interpolate",["linear"],["zoom"],3,10,10,12],"text-letter-spacing":.1,"text-max-width":9,"text-transform":"uppercase"},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"water_label_lakes",type:"symbol",source:"protomaps","source-layer":"water",filter:["in","kind","lake","water"],layout:{"text-font":["TradeGothic LT Bold"],"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-size":["interpolate",["linear"],["zoom"],3,0,6,12,10,12],"text-letter-spacing":.1,"text-max-width":9},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"roads_labels_major",type:"symbol",source:"protomaps","source-layer":"roads",minzoom:11,filter:["in","kind","highway","major_road"],layout:{"symbol-sort-key":["get","min_zoom"],"symbol-placement":"line","text-font":["TradeGothic LT Bold"],"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-size":12},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"pois",type:"symbol",source:"protomaps","source-layer":"pois",filter:["all",["in",["get","kind"],["literal",["beach","forest","marina","park","peak","zoo","garden","bench","aerodrome","station","bus_stop","ferry_terminal","stadium","university","library","school","animal","toilets","drinking_water"]]],[">=",["zoom"],["+",["get","min_zoom"],0]]],layout:{"text-font":["TradeGothic LT Bold Italic"],"text-justify":"auto","text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold Italic"]],["literal",["TradeGothic LT Bold Italic"]]]}]]]],"text-size":["interpolate",["linear"],["zoom"],17,10,19,16],"text-max-width":8,"text-offset":[1.1,0],"text-variable-anchor":["left","right"]},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"places_subplace",type:"symbol",source:"protomaps","source-layer":"places",filter:["==","kind","neighbourhood"],layout:{"symbol-sort-key":["get","min_zoom"],"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-font":["TradeGothic LT Bold"],"text-max-width":7,"text-letter-spacing":.1,"text-padding":["interpolate",["linear"],["zoom"],5,2,8,4,12,18,15,20],"text-size":["interpolate",["exponential",1.2],["zoom"],11,10,14,14,18,24]},minzoom:13,paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"places_locality",type:"symbol",source:"protomaps","source-layer":"places",minzoom:5,filter:["==","kind","locality"],layout:{"icon-image":["step",["zoom"],"townspot",8,""],"icon-size":.7,"text-field":["case",["all",["any",["has","name"],["has","pgf:name"]],["!",["any",["has","name2"],["has","pgf:name2"]]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["has","script"],["case",["any",["is-supported-script",["get","name"]],["has","pgf:name"]],["format",["coalesce",["get","name:undefined"],["get","name:en"]],{},`
`,{},["case",["all",["!",["has","name:undefined"]],["has","name:en"],["!",["has","script"]]],"",["coalesce",["get","pgf:name"],["get","name"]]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["get","name:en"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{}]],["all",["any",["has","name"],["has","pgf:name"]],["any",["has","name2"],["has","pgf:name2"]],["!",["any",["has","name3"],["has","pgf:name3"]]]],["case",["all",["has","script"],["has","script2"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["has","script2"],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]],["case",["all",["has","script"],["has","script2"],["has","script3"]],["format",["get","name:undefined"],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["case",["!",["has","script"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name"],["get","name"]],{},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["!",["has","script2"]],["format",["coalesce",["get","name:undefined"],["get","pgf:name2"],["get","name2"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name3"],["get","name3"]],{"text-font":["case",["==",["get","script3"],"TradeGothic LT Bold"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}],["format",["coalesce",["get","name:undefined"],["get","pgf:name3"],["get","name3"]],{},`
`,{},["coalesce",["get","pgf:name"],["get","name"]],{"text-font":["case",["==",["get","script"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]},`
`,{},["coalesce",["get","pgf:name2"],["get","name2"]],{"text-font":["case",["==",["get","script2"],"Devanagari"],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]]}]]]],"text-font":["case",["<=",["get","min_zoom"],5],["literal",["TradeGothic LT Bold"]],["literal",["TradeGothic LT Bold"]]],"text-padding":["interpolate",["linear"],["zoom"],5,3,8,7,12,11],"text-size":["interpolate",["linear"],["zoom"],2,["case",["<",["get","population_rank"],13],8,[">=",["get","population_rank"],13],11,0],4,["case",["<",["get","population_rank"],13],9,[">=",["get","population_rank"],13],12,0],6,["case",["<",["get","population_rank"],12],10,[">=",["get","population_rank"],12],14,0],8,["case",["<",["get","population_rank"],11],11,[">=",["get","population_rank"],11],15,0],10,["case",["<",["get","population_rank"],9],12,[">=",["get","population_rank"],9],17,0],15,["case",["<",["get","population_rank"],8],12,[">=",["get","population_rank"],8],22,0]],"icon-padding":["interpolate",["linear"],["zoom"],0,0,8,4,10,8,12,6,22,2],"text-justify":"auto","text-anchor":["step",["zoom"],"left",8,"center"],"text-radial-offset":.4},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"places_region",type:"symbol",source:"protomaps","source-layer":"places",filter:["==","kind","region"],layout:{"symbol-sort-key":["get","min_zoom"],"text-field":["format",["coalesce",["get","name:undefined"],["get","name:en"]],{}],"text-font":["TradeGothic LT Bold"],"text-size":11,"icon-padding":2,"text-transform":"uppercase"},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}},{id:"places_country",type:"symbol",source:"protomaps","source-layer":"places",filter:["==","kind","country"],layout:{"symbol-sort-key":["get","min_zoom"],"text-field":["format",["coalesce",["get","name:undefined"],["get","name:en"]],{}],"text-font":["TradeGothic LT Bold"],"text-size":14,"icon-padding":["interpolate",["linear"],["zoom"],0,2,14,2,16,20,17,2,22,2],"text-transform":"uppercase"},paint:{"text-opacity":.95,"text-color":"#44454a","text-halo-color":"#fff","text-halo-width":1,"text-halo-blur":1}}];var Z8=an("<p>Loading map...</p>"),Y8=an(`<div id="container" class="svelte-1d96gn4"><div id="panel" class="svelte-1d96gn4"><img alt="dot city" style="padding-left: 20px" class="svelte-1d96gn4"> <h1>Greater Golden Horseshoe</h1> <h2>Mapping data about the region's transportation geography and travel patterns</h2> <div id="line" class="svelte-1d96gn4"></div> <div id="line" class="svelte-1d96gn4"></div> <div id="select-wrapper" class="svelte-1d96gn4"><!></div> <svg width="350" height="40" class="svelte-1d96gn4"><rect class="box" width="59" height="20" x="20" y="0"></rect><rect class="box" width="59" height="20" x="80" y="0"></rect><rect class="box" width="59" height="20" x="140" y="0"></rect><rect class="box" width="59" height="20" x="200" y="0"></rect><rect class="box" width="59" height="20" x="260" y="0"></rect><text class="legend-label svelte-1d96gn4" text-anchor="middle" x="80" y="35"> </text><text class="legend-label svelte-1d96gn4" text-anchor="middle" x="140" y="35"> </text><text class="legend-label svelte-1d96gn4" text-anchor="middle" x="200" y="35"> </text><text class="legend-label svelte-1d96gn4" text-anchor="middle" x="260" y="35"> </text></svg> <p class="des svelte-1d96gn4"> </p> <p class="des svelte-1d96gn4"><span style="
				display: inline-flex;
				align-items: center;
				gap: 8px;
			"><span></span> <span style="font-size: 14px"></span></span> <span style="
				display: inline-flex;
				align-items: center;
				gap: 8px;
			"><span style="
					margin-left: 7px;
					width: 30px;
					height: 16px;
					background-size: 6px 6px;
					background-color: #BBBCB4;
					opacity: 0.8;
					"></span> <span style="font-size: 14px">No data</span></span></p> <p class="des svelte-1d96gn4" style="font-size: 11px; color: #AB1368; padding-bottom; -20px">Selected zone</p> <p class="des svelte-1d96gn4" style="font-size: 13px; padding: 4px; border: solid 1px #AB1368; margin-top: -10px;"> </p> <div id="line" class="svelte-1d96gn4"></div> <div id="checkbox" class="check-box svelte-1d96gn4"><label class="label-format svelte-1d96gn4"><input type="checkbox" class="check-box-item"> Major transit routes (GO, Subway, LRT) <svg width="30" height="12"><line x1="0" y1="6" x2="40" y2="6" stroke="#1E3765" stroke-width="2"></line><circle cx="15" cy="6" r="4" fill="#1E3765" ,="" stroke="#ffffff" stroke-width="2"></circle></svg></label> <br> <label class="label-format svelte-1d96gn4"><input type="checkbox" class="check-box-item"> Major transit routes under development <svg width="30" height="12"><line x1="0" y1="6" x2="40" y2="6" stroke="#1E3765" stroke-width="2" stroke-dasharray="4,1"></line><circle cx="15" cy="6" r="4" fill="#1E3765" ,="" stroke="#ffffff" stroke-width="2"></circle></svg></label> <br> <label class="label-format svelte-1d96gn4"><input type="checkbox" class="check-box-item"> Major highways <svg width="30" height="12"><line x1="0" y1="8" x2="40" y2="8" stroke="#DC4633" stroke-width="3" opacity="0.5"></line></svg></label> <br> <label class="label-format svelte-1d96gn4"><input type="checkbox" class="check-box-item"> Cycling infrastructure <svg width="30" height="12"><line x1="0" y1="8" x2="40" y2="8" stroke="#00A189" stroke-width="3" opacity="0.95"></line></svg></label></div> <div id="line" class="svelte-1d96gn4"></div> <div id="line" class="svelte-1d96gn4"></div> <p class="notes svelte-1d96gn4">These maps were created by <a href="https://jamaps.github.io" target="_blank">Jeff Allen</a> and <a href="https://mkbs-mkbs2000.github.io/Personal-Portfolio/">Muhammad Khalis Bin Samion</a> at the <a href="https://schoolofcities.utoronto.ca/" target="_blank">School of Cities, University of Toronto</a>.</p> <p class="notes svelte-1d96gn4">All the travel-related data are from the <a href="https://dmg.utoronto.ca/tts-introduction/" target="_blank">2022 Transportation Tomorrow Survey</a>. The base-map data pertaining to roads and water are from <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>. Cycling data are from <a href="https://chatrlab.ca/projects/can-bics-english/" target="_blank">Can-BICS (CHATR Lab)</a> and include bike lanes, cycle tracks, and trails. Transit route data are from <a href="https://www.metrolinx.com/en/about-us/open-data" target="_blank">Metrolinx</a>.</p> <p class="notes svelte-1d96gn4">If there's anything on this map you have questions about, have feedback for ways to improve it, or want to see additional data on the map, please add an issue on the <a href="https://github.com/schoolofcities/ggh-transport-geography" target="_blank">GitHub page</a> or just email us directly. Thank you! :)</p> <a href="https://schoolofcities.utoronto.ca/" target="_blank"><img alt="School of Cities logo" style="display: block; margin: 0 auto; width: 300px; height: auto; opacity: 0.8" class="svelte-1d96gn4"></a> <br></div> <div id="map" class="svelte-1d96gn4"></div></div>`);function q8(b,T){P1(T,!1);let L="map-layers.pmtiles",k="tts2022zones_data.pmtiles",D=Ti(null),J=["#cdf1ff","#9acef4","#6fb1ea","#6e6db4","#6d247a"];const S="% of trips by walking";let c=Ti(S),be="",me=Ti("NA");const de={"Population density":{dataSource:"population_density",breaks:[500,1e3,4e3,7e3],colours:J,text:"Residents per square kilometre."},"% low income households":{dataSource:"low_income_hhlds_percent",breaks:[10,20,30,40],colours:J,text:"Percentage of households that have a before-tax income of less than $60,000."},"% recent immigrants":{dataSource:"immig_recent",breaks:[1,5,10,15],colours:J,text:"Percentage of population that immigrated in the last 5 years or is not a permanent resident, based on the date of filling out the survey."},"Vehicles per household":{dataSource:"veh_per_hhld",breaks:[.5,1,1.5,2],colours:J,text:"Average number of private vehicles per household."},"% of households without vehicles":{dataSource:"hhlds_no_veh",breaks:[5,10,25,50],colours:J,text:"Percentage of households without a private vehicle."},"% of residents with a driver's license":{dataSource:"drivers_lic_perperson_20to75",breaks:[75,80,85,90],colours:J,text:"Percent of residents aged 20 to 75 that have a driver's license."},"% of trips by bicycle":{dataSource:"mode_bike",breaks:[2,4,8,16],colours:J,text:"Percentage of trips made by residents of this zone that are taken by bicycle."},"% of trips by walking":{dataSource:"mode_walk",breaks:[5,15,30,50],colours:J,text:"Percentage of trips made by residents of this zone that are solely pedestrian/walking trips."},"% of trips by public transit":{dataSource:"mode_transit",breaks:[5,10,20,30],colours:J,text:"Percentage of trips made by residents of this zone that are by public transit. These trips can include different access and egress modes, but the main mode is public transit."},"% of trips by car":{dataSource:"mode_drive",breaks:[50,65,80,90],colours:J,text:"Percentage of trips made by residents of this zone that are by car. These include trips as a driver or as a passenger, including all taxi/ride-share trips"},"Average trip distance (km)":{dataSource:"trip_km_avg",breaks:[5,10,15,20],colours:J,text:"Average straight line (i.e. Euclidean) distance of trips made by households in this zone (i.e. how far do people travel on average on a per trip basis)"},"Trips per person":{dataSource:"trips_5up_per_person",breaks:[1.75,2,2.25,2.5],colours:J,text:"Average number of trips that people make per day"},"Activity participation":{dataSource:"activities_mean",breaks:[.8,1,1.2,1.4],colours:J,text:"Average number of activity destinations people visit per day. (This metric has been used by researchers as an indicator of transport-related social inclusion/exclusion)."},"% of trips that are local trips":{dataSource:"trips_less5km_percent",breaks:[20,40,60,80],colours:J,text:"Percentage of trips made by residents of this zone that are less than 5km in length. In other words, what proportion of trips do people make that are local"},"% of local trips by car":{dataSource:"trips_less5km_percent_car",breaks:[20,40,60,80],colours:J,text:"Of trips <5km in length made by residents that live in this zone, what percent are by car. In other words, how dependent are residents on cars for local trips"},"% of children driven to/from school":{dataSource:"children_driven_to_school",breaks:[5,20,35,50],colours:J,text:"Percent of home-school trips by children (aged 6-17) that are by car"}},Ae=Object.keys(de).map(Ot=>({label:Ot,value:Ot}));let fe=Ti(!1),te=Ti(!1),Ce=[];function Je(){if(he(D)&&he(fe)&&he(te)&&he(D).isStyleLoaded())for(;Ce.length>0;){const Ot=Ce.shift();it(Ot)}}function it(Ot){if(console.log("layerSelect called with:",Ot.detail),!he(D)||!he(fe)||!he(te)||!he(D).isStyleLoaded()){console.warn("Map is not ready. Adding to queue..."),Ce.push(Ot);return}console.log("Setting layer:",Ot.detail.value),Ut(c,Ot.detail.value),je(he(c))}function je(Ot){let Yt=de[Ot];console.log(Yt),he(D).setPaintProperty("ttszones","fill-opacity",.8),he(D).setPaintProperty("ttszones","fill-color",["case",["==",["get",Yt.dataSource],null],"#BBBCB4",["step",["get",Yt.dataSource],Yt.colours[0],Yt.breaks[0],Yt.colours[1],Yt.breaks[1],Yt.colours[2],Yt.breaks[2],Yt.colours[3],Yt.breaks[3],Yt.colours[4]]])}let Fe=Ti(!0);function dt(){he(D)&&(he(Fe)?(he(D).setPaintProperty("current_lines","line-opacity",1),he(D).setPaintProperty("currentstations","circle-opacity",1),he(D).setPaintProperty("currentstations","circle-stroke-opacity",1)):(he(D).setPaintProperty("current_lines","line-opacity",0),he(D).setPaintProperty("currentstations","circle-opacity",0),he(D).setPaintProperty("currentstations","circle-stroke-opacity",0)))}let He=Ti(!1);function ft(){he(D)&&(he(He)?(he(D).setPaintProperty("future_lines","line-opacity",1),he(D).setPaintProperty("futurestations","circle-opacity",1),he(D).setPaintProperty("futurestations","circle-stroke-opacity",1)):(he(D).setPaintProperty("future_lines","line-opacity",0),he(D).setPaintProperty("futurestations","circle-opacity",0),he(D).setPaintProperty("futurestations","circle-stroke-opacity",0)))}let mt=Ti(!1);function ot(){he(D)&&(he(mt)?he(D).setPaintProperty("highways","line-opacity",1):he(D).setPaintProperty("highways","line-opacity",0))}let we=Ti(!1);function Et(){he(D)&&(he(we)?(he(D).setPaintProperty("bikes_case","line-opacity",1),he(D).setPaintProperty("bikes","line-opacity",1)):(he(D).setPaintProperty("bikes_case","line-opacity",0),he(D).setPaintProperty("bikes","line-opacity",0)))}k1(async()=>{let Ot=new oc;Nl.addProtocol("pmtiles",Ot.tile),Ut(D,new Nl.Map({container:"map",style:{version:8,name:"Empty",glyphs:"https://schoolofcities.github.io/fonts/fonts/{fontstack}/{range}.pbf",sprite:"https://protomaps.github.io/basemaps-assets/sprites/v4/dark",sources:{protomaps:{type:"vector",url:"https://api.protomaps.com/tiles/v4.json?key=7f48bb9c6a1f1e3b"}},layers:[{id:"background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"#f6f5f4","background-opacity":1}}]},maxPitch:0,maxZoom:14,minZoom:8,center:[-79.44,43.72],zoom:10,scrollZoom:!1,dragPan:!0,dragRotate:!1,doubleClickZoom:!0,touchZoomRotate:!1,attributionControl:!1})),he(D).on("load",async()=>{const gr=new Nl.NavigationControl({showCompass:!1,showZoom:!0});he(D).addControl(gr,"top-left"),he(D).addSource("ttszones",{type:"vector",url:"pmtiles://"+k}),he(D).addSource("maplayers",{type:"vector",url:"pmtiles://"+L}),he(D).addSource("current_lines",{type:"geojson",data:Cc}),he(D).addSource("future_lines",{type:"geojson",data:Mc}),he(D).addSource("currentstations",{type:"geojson",data:Rc}),he(D).addSource("futurestations",{type:"geojson",data:Gc}),he(D).addLayer({id:"ttszones",type:"fill",source:"ttszones","source-layer":"tts2022zones_data"}),he(D).addLayer({id:"water",type:"fill",filter:["==",["geometry-type"],"Polygon"],source:"protomaps","source-layer":"water",paint:{"fill-color":"#fff","fill-opacity":1}}),he(D).addLayer({id:"roads_minor",type:"line",source:"protomaps","source-layer":"roads",filter:["all",["==","kind","minor_road"],["!=","kind_detail","service"]],minzoom:11,paint:{"line-opacity":.35,"line-color":"#fff","line-width":["interpolate",["exponential",1.6],["zoom"],11,0,12.5,.5,15,4]}}),he(D).addLayer({id:"roads_major",type:"line",source:"protomaps","source-layer":"roads",filter:["any",["==","kind","major_road"],["==","kind","highway"]],minzoom:10,paint:{"line-opacity":.45,"line-color":"#fff","line-width":["interpolate",["exponential",1.6],["zoom"],7,0,12,2,15,4]}}),he(D).addLayer({id:"lowertier",type:"line",source:"maplayers","source-layer":"Lower_Tier",paint:{"line-color":"#fff","line-width":["interpolate",["linear"],["zoom"],7,.5,10,3]}}),he(D).addLayer({id:"uppertier",type:"line",source:"maplayers","source-layer":"Upper_Single_Tier",paint:{"line-color":"#fff","line-width":["interpolate",["linear"],["zoom"],7,1,10,6]}}),he(D).addLayer({id:"highways",type:"line",source:"protomaps","source-layer":"roads",filter:["any",["==","kind","highway"],["==","kind_detail","trunk"],["==","kind_detail","trunk_link"]],paint:{"line-opacity":0,"line-color":"#ce6456","line-width":["interpolate",["exponential",1.6],["zoom"],7,1,15,5]}}),he(D).addLayer({id:"bikes_case",type:"line",source:"maplayers","source-layer":"CanBICS_wgs84",paint:{"line-color":"#fff","line-width":["interpolate",["linear"],["zoom"],9,1.5,14,5],"line-opacity":0}}),he(D).addLayer({id:"bikes",type:"line",source:"maplayers","source-layer":"CanBICS_wgs84",paint:{"line-color":"#00A189","line-width":["interpolate",["linear"],["zoom"],9,1,14,3],"line-opacity":0}}),he(D).addLayer({id:"current_lines",type:"line",source:"current_lines",paint:{"line-color":"#1E3765","line-width":["interpolate",["linear"],["zoom"],9,1,14,4]}}),he(D).addLayer({id:"future_lines",type:"line",source:"future_lines",paint:{"line-color":"#1E3765","line-width":["interpolate",["linear"],["zoom"],9,1,14,4],"line-dasharray":[4,2],"line-opacity":0}}),he(D).addLayer({id:"currentstations",type:"circle",source:"currentstations",paint:{"circle-radius":["interpolate",["linear"],["zoom"],8,1,16,6],"circle-color":"#1E3765","circle-stroke-color":"#ffffff","circle-stroke-width":["interpolate",["linear"],["zoom"],8,0,11,1]}}),he(D).addLayer({id:"futurestations",type:"circle",source:"futurestations",paint:{"circle-radius":["interpolate",["linear"],["zoom"],8,1,16,6],"circle-color":"#1E3765","circle-stroke-color":"#ffffff","circle-stroke-width":["interpolate",["linear"],["zoom"],8,0,11,1],"circle-opacity":0,"circle-stroke-opacity":0}}),he(D).addLayer({id:"outline-hover",type:"line",source:"ttszones","source-layer":"tts2022zones_data",paint:{"line-color":"#AB1368","line-width":2},filter:["==","TTS2022",""]}),V8.forEach(Pi=>{he(D).addLayer(Pi)}),fetch(w1).then(Pi=>Pi.blob()).then(Pi=>createImageBitmap(Pi)).then(Pi=>{he(D).addImage("polygon-pattern",Pi,{pixelRatio:1}),he(D).addLayer({id:"tts-low-sample",type:"fill",source:"ttszones","source-layer":"tts2022zones_data",paint:{"fill-pattern":"polygon-pattern"},filter:["any",["<",["get","hhld_sample"],10]]},"lowertier"),he(D).addLayer({id:"ttszones_lines",type:"line",source:"ttszones","source-layer":"tts2022zones_data",minzoom:9,paint:{"line-width":["interpolate",["linear"],["zoom"],8,0,9,.5,10,.9],"line-color":"#fff"}},"lowertier")}).catch(Pi=>console.error("Error fetching image:",Pi)),console.log("Map loaded successfully."),Ut(fe,!0),he(D).once("styledata",()=>{console.log("Map style fully loaded."),Ut(te,!0),je(S),Je()})});let Yt=0;he(D).on("mousemove","ttszones",gr=>{const Pi=performance.now();if(Pi-Yt<100||(Yt=Pi,he(D).getCanvas().style.cursor="pointer",!gr.features.length))return;const mn=gr.features[0].properties,Dr=mn.TTS2022;Dr!==be&&(he(D).setFilter("outline-hover",["==","TTS2022",Dr]),Ut(me,mn[de[he(c)].dataSource]>=0?Math.round(mn[de[he(c)].dataSource]*10)/10:"No Data"),be=Dr)}),he(D).on("mouseleave","ttszones",()=>{he(D).getCanvas().style.cursor="",Ut(me,"no data"),be="",he(D).setFilter("outline-hover",["==","TTS2022",""])}),he(D).on("error",gr=>{console.error("Map load error:",gr)});let sn=new Nl.ScaleControl({maxWidth:100,unit:"metric"});he(D).addControl(sn,"bottom-right")}),Gt(()=>he(Fe),()=>{he(Fe),dt()}),Gt(()=>he(He),()=>{he(He),ft()}),Gt(()=>he(mt),()=>{he(mt),ot()}),Gt(()=>he(we),()=>{he(we),Et()}),M1(),O1();var Dt=Y8(),Bi=Ht(Dt),si=Ht(Bi);En(si,"src",xc);var Wt=ei(si,10),Zt=Ht(Wt);on(Zt,()=>he(D)&&he(fe)&&he(te),Ot=>{H8(Ot,{id:"select",items:Ae,get value(){return he(c)},clearable:!1,showChevron:!0,listAutoWidth:!0,searchable:!1,listOffset:"10",$$events:{change:it}})},Ot=>{var Yt=Z8();ri(Ot,Yt)}),Vt(Wt);var gi=ei(Wt,2),xt=Ht(gi),Ii=ei(xt),ct=ei(Ii),li=ei(ct),dr=ei(li),fr=ei(dr),Ei=Ht(fr);Vt(fr);var Fi=ei(fr),Li=Ht(Fi,!0);Vt(Fi);var ci=ei(Fi),Tr=Ht(ci,!0);Vt(ci);var nr=ei(ci),or=Ht(nr);Vt(nr),Vt(gi);var Oi=ei(gi,2),qr=Ht(Oi,!0);Vt(Oi);var Kt=ei(Oi,2),at=Ht(Kt),Sr=Ht(at);En(Sr,"style",`
					width: 30px;
					height: 16px;
					background: url('${w1}') repeat;
					background-size: 6px 6px;
					background-color: #6FC7EA;
					opacity: 0.8;
					`);var _i=ei(Sr,2);_i.textContent="Low sample (n < 10)",Vt(at),Ua(2),Vt(Kt);var $r=ei(Kt,4),fn=Ht($r);Vt($r);var Gi=ei($r,4),kr=Ht(Gi),Rr=Ht(kr);Us(Rr),Ua(2),Vt(kr);var Ui=ei(kr,4),Lt=Ht(Ui);Us(Lt),Ua(2),Vt(Ui);var ar=ei(Ui,4),Wr=Ht(ar);Us(Wr),Ua(2),Vt(ar);var zt=ei(ar,4),ji=Ht(zt);Us(ji),Ua(2),Vt(zt),Vt(Gi);var mr=ei(Gi,12),Cr=Ht(mr);En(Cr,"src",vc),Vt(mr),Ua(2),Vt(Bi),Ua(2),Vt(Dt),dn(()=>{En(xt,"style",`fill:${de[he(c)].colours[0]??""};`),En(Ii,"style",`fill:${de[he(c)].colours[1]??""};`),En(ct,"style",`fill:${de[he(c)].colours[2]??""};`),En(li,"style",`fill:${de[he(c)].colours[3]??""};`),En(dr,"style",`fill:${de[he(c)].colours[4]??""};`),Kn(Ei,`<${de[he(c)].breaks[0]??""}`),Kn(Li,de[he(c)].breaks[1]),Kn(Tr,de[he(c)].breaks[2]),Kn(or,`>${de[he(c)].breaks[3]??""}`),Kn(qr,de[he(c)].text),Kn(fn,`${he(c)??""}: ${he(me)??""}`)}),Il(Rr,()=>he(Fe),Ot=>Ut(Fe,Ot)),Il(Lt,()=>he(He),Ot=>Ut(He,Ot)),Il(Wr,()=>he(mt),Ot=>Ut(mt,Ot)),Il(ji,()=>he(we),Ot=>Ut(we,Ot)),pr("mouseover",Cr,()=>event.target.style.opacity=1),pr("mouseout",Cr,()=>event.target.style.opacity=.8),ri(b,Dt),I1()}function th(b){q8(b,{})}export{th as component,eh as universal};
